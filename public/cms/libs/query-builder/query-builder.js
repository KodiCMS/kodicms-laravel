function Model(e){return this instanceof Model?(this.root=null,void(this.$=$(this))):Model.getModel(e)}function defineModelProperties(e,t){t.forEach(function(t){Object.defineProperty(e.prototype,t,{enumerable:!0,get:function(){return this.__[t]},set:function(e){var r=null!==this.__[t]&&"object"==typeof this.__[t]?$.extend({},this.__[t]):this.__[t];this.__[t]=e,null!==this.model&&this.model.trigger("update",this,t,e,r)}})})}function getQueryBuildField(e){if(type=e.filter.type||e.filter.input,_.has(QueryBuilderField,type))var t=Object.create(QueryBuilderField[type]);else var t=Object.create(QueryBuilderField["default"]);return t.construct(e)}function moveSortableToTarget(e,t){var r;return r=t.closest(Selectors.rule_container),r.length?void e.moveAfter(Model(r)):(r=t.closest(Selectors.group_header),r.length?(r=t.closest(Selectors.group_container),void e.moveAtBegin(Model(r))):(r=t.closest(Selectors.group_container),r.length?void e.moveAtEnd(Model(r)):void 0))}!function(e,t){"function"==typeof define&&define.amd?define(["jquery"],t):t(e.jQuery)}(this,function(e){"use strict";e.extendext=function(){var t,r,i,n,o,l,u=arguments[0]||{},s=1,a=arguments.length,d=!1,p="default";for("boolean"==typeof u&&(d=u,u=arguments[s++]||{}),"string"==typeof u&&(p=e([u.toLowerCase(),"default"]).filter(["default","concat","replace","extend"])[0],u=arguments[s++]||{}),"object"==typeof u||e.isFunction(u)||(u={}),s===a&&(u=this,s--);a>s;s++)if(null!==(t=arguments[s]))if(e.isArray(t)&&"default"!==p)switch(l=u&&e.isArray(u)?u:[],p){case"concat":u=l.concat(e.extend(d,[],t));break;case"replace":u=e.extend(d,[],t);break;case"extend":t.forEach(function(t,r){if("object"==typeof t){var i=e.isArray(t)?[]:{};l[r]=e.extendext(d,p,l[r]||i,t)}else-1===l.indexOf(t)&&l.push(t)}),u=l}else for(r in t)i=u[r],n=t[r],u!==n&&(d&&n&&(e.isPlainObject(n)||(o=e.isArray(n)))?(o?(o=!1,l=i&&e.isArray(i)?i:[]):l=i&&e.isPlainObject(i)?i:{},u[r]=e.extendext(d,p,l,n)):void 0!==n&&(u[r]=n));return u}}),function(){"use strict";function e(t,r,i){return("string"==typeof r?r:r.toString()).replace(t.define||o,function(e,r,n,o){return 0===r.indexOf("def.")&&(r=r.substring(4)),r in i||(":"===n?(t.defineParams&&o.replace(t.defineParams,function(e,t,n){i[r]={arg:t,text:n}}),r in i||(i[r]=o)):new Function("def","def['"+r+"']="+o)(i)),""}).replace(t.use||o,function(r,n){t.useParams&&(n=n.replace(t.useParams,function(e,t,r,n){if(i[r]&&i[r].arg&&n){var o=(r+":"+n).replace(/'|\\/g,"_");return i.__exp=i.__exp||{},i.__exp[o]=i[r].text.replace(new RegExp("(^|[^\\w$])"+i[r].arg+"([^\\w$])","g"),"$1"+n+"$2"),t+"def.__exp['"+o+"']"}}));var o=new Function("def","return "+n)(i);return o?e(t,o,i):o})}function t(e){return e.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}var r,i={version:"1.0.3",templateSettings:{evaluate:/\{\{([\s\S]+?(\}?)+)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,useParams:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParams:/^\s*([\w$]+):([\s\S]+)/,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"it",strip:!0,append:!0,selfcontained:!1,doNotSkipEncoded:!1},template:void 0,compile:void 0};i.encodeHTMLSource=function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},r=e?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return e?e.toString().replace(r,function(e){return t[e]||e}):""}},r=function(){return this||(0,eval)("this")}(),"undefined"!=typeof module&&module.exports?module.exports=i:"function"==typeof define&&define.amd?define(function(){return i}):r.doT=i;var n={append:{start:"'+(",end:")+'",startencode:"'+encodeHTML("},split:{start:"';out+=(",end:");out+='",startencode:"';out+=encodeHTML("}},o=/$^/;i.template=function(l,u,s){u=u||i.templateSettings;var a,d,p=u.append?n.append:n.split,c=0,f=u.use||u.define?e(u,l,s||{}):l;f=("var out='"+(u.strip?f.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):f).replace(/'|\\/g,"\\$&").replace(u.interpolate||o,function(e,r){return p.start+t(r)+p.end}).replace(u.encode||o,function(e,r){return a=!0,p.startencode+t(r)+p.end}).replace(u.conditional||o,function(e,r,i){return r?i?"';}else if("+t(i)+"){out+='":"';}else{out+='":i?"';if("+t(i)+"){out+='":"';}out+='"}).replace(u.iterate||o,function(e,r,i,n){return r?(c+=1,d=n||"i"+c,r=t(r),"';var arr"+c+"="+r+";if(arr"+c+"){var "+i+","+d+"=-1,l"+c+"=arr"+c+".length-1;while("+d+"<l"+c+"){"+i+"=arr"+c+"["+d+"+=1];out+='"):"';} } out+='"}).replace(u.evaluate||o,function(e,r){return"';"+t(r)+"out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|\}|^|\{)out\+='';/g,"$1").replace(/\+''/g,""),a&&(u.selfcontained||!r||r._encodeHTML||(r._encodeHTML=i.encodeHTMLSource(u.doNotSkipEncoded)),f="var encodeHTML = typeof _encodeHTML !== 'undefined' ? _encodeHTML : ("+i.encodeHTMLSource.toString()+"("+(u.doNotSkipEncoded||"")+"));"+f);try{return new Function(u.varname,f)}catch(h){throw"undefined"!=typeof console&&console.log("Could not create a template function: "+f),h}},i.compile=function(e,t){return i.template(e,null,t)}}();var QueryBuilder=function(e,t){this.init(e,t)};$.extend(QueryBuilder.prototype,{change:function(e,t){var r=new $.Event(e+".queryBuilder.filter",{builder:this,value:t});return this.$el.triggerHandler(r,Array.prototype.slice.call(arguments,2)),r.value},trigger:function(e){var t=new $.Event(e+".queryBuilder",{builder:this});return this.$el.triggerHandler(t,Array.prototype.slice.call(arguments,1)),t},on:function(e,t){return this.$el.on(e+".queryBuilder",t),this},off:function(e,t){return this.$el.off(e+".queryBuilder",t),this},once:function(e,t){return this.$el.one(e+".queryBuilder",t),this}}),QueryBuilder.plugins={},QueryBuilder.defaults=function(e){return"object"!=typeof e?"string"==typeof e?"object"==typeof QueryBuilder.DEFAULTS[e]?$.extend(!0,{},QueryBuilder.DEFAULTS[e]):QueryBuilder.DEFAULTS[e]:$.extend(!0,{},QueryBuilder.DEFAULTS):void $.extendext(!0,"replace",QueryBuilder.DEFAULTS,e)},QueryBuilder.define=function(e,t,r){QueryBuilder.plugins[e]={fct:t,def:r||{}}},QueryBuilder.extend=function(e){$.extend(QueryBuilder.prototype,e)},QueryBuilder.prototype.initPlugins=function(){if(this.plugins){if($.isArray(this.plugins)){var e={};this.plugins.forEach(function(t){e[t]=null}),this.plugins=e}Object.keys(this.plugins).forEach(function(e){e in QueryBuilder.plugins?(this.plugins[e]=$.extend(!0,{},QueryBuilder.plugins[e].def,this.plugins[e]||{}),QueryBuilder.plugins[e].fct.call(this,this.plugins[e])):Utils.error("Config",'Unable to find plugin "{0}"',e)},this)}},QueryBuilder.types={string:"string",integer:"number",number:"number","double":"number",date:"datetime",time:"datetime",datetime:"datetime","boolean":"boolean",client_purchases:"client_purchases"},QueryBuilder.inputs=["text","textarea","radio","checkbox","select","date","datetime","time","number"],QueryBuilder.modifiable_options=["display_errors","allow_groups","allow_empty","default_condition","default_filter"];var Selectors=QueryBuilder.selectors={group_container:".rules-group-container",rule_container:".rule-container",filter_container:".rule-filter-container",operator_container:".rule-operator-container",value_container:".rule-value-container",error_container:".error-container",condition_container:".rules-group-header .group-conditions",rule_header:".rule-header",group_header:".rules-group-header",group_actions:".group-actions",rule_actions:".rule-actions",rules_list:".rules-group-body>.rules-list",group_condition:".rules-group-header [name$=_cond]",rule_filter:".rule-filter-container [name$=_filter]",rule_operator:".rule-operator-container [name$=_operator]",rule_value:".rule-value-container [name*=_value_]",add_rule:"[data-add=rule]",delete_rule:"[data-delete=rule]",add_group:"[data-add=group]",delete_group:"[data-delete=group]"};QueryBuilder.templates={},QueryBuilder.regional={en:{__locale:"English (en)",__author:'Damien "Mistic" Sorel, http://www.strangeplanet.fr',add_rule:"Add rule",add_group:"Add group",delete_rule:"Delete",delete_group:"Delete",conditions:{AND:"AND",OR:"OR"},operators:{equal:"equal",not_equal:"not equal","in":"in",not_in:"not in",less:"less",less_or_equal:"less or equal",greater:"greater",greater_or_equal:"greater or equal",between:"between",not_between:"not between",begins_with:"begins with",not_begins_with:"doesn't begin with",contains:"contains",not_contains:"doesn't contain",ends_with:"ends with",not_ends_with:"doesn't end with",is_empty:"is empty",is_not_empty:"is not empty",is_null:"is null",is_not_null:"is not null"},errors:{no_filter:"No filter selected",empty_group:"The group is empty",radio_empty:"No value selected",checkbox_empty:"No value selected",select_empty:"No value selected",string_empty:"Empty value",string_exceed_min_length:"Must contain at least {0} characters",string_exceed_max_length:"Must not contain more than {0} characters",string_invalid_format:"Invalid format ({0})",number_nan:"Not a number",number_not_integer:"Not an integer",number_not_double:"Not a real number",number_exceed_min:"Must be greater than {0}",number_exceed_max:"Must be lower than {0}",number_wrong_step:"Must be a multiple of {0}",datetime_empty:"Empty value",datetime_invalid:"Invalid date format ({0})",datetime_exceed_min:"Must be after {0}",datetime_exceed_max:"Must be before {0}",boolean_not_valid:"Not a boolean",operator_not_multiple:"Operator {0} cannot accept multiple values"},datetimes:{today:"Today"},invert:"Invert"},ru:{__locale:"Russian (ru)",add_rule:"Добавить",add_group:"Добавить группу",delete_rule:"Удалить",delete_group:"Удалить",conditions:{AND:"И",OR:"ИЛИ"},operators:{equal:"равно",not_equal:"не равно","in":"из указанных",not_in:"не из указанных",less:"меньше",less_or_equal:"меньше или равно",greater:"больше",greater_or_equal:"больше или равно",between:"между",not_between:"не между",begins_with:"начинается с",not_begins_with:"не начинается с",contains:"содержит",not_contains:"не содержит",ends_with:"оканчивается на",not_ends_with:"не оканчивается на",is_empty:"пустая строка",is_not_empty:"не пустая строка",is_null:"пусто",is_not_null:"не пусто"},errors:{no_filter:"Фильтр не выбран",empty_group:"Группа пуста",radio_empty:"Не выбранно значение",checkbox_empty:"Не выбранно значение",select_empty:"Не выбранно значение",string_empty:"Не заполненно",string_exceed_min_length:"Должен содержать больше {0} символов",string_exceed_max_length:"Должен содержать меньше {0} символов",string_invalid_format:"Неверный формат ({0})",number_nan:"Не число",number_not_integer:"Не число",number_not_double:"Не число",number_exceed_min:"Должно быть больше {0}",number_exceed_max:"Должно быть меньше, чем {0}",number_wrong_step:"Должно быть кратно {0}",datetime_empty:"Не заполненно",datetime_invalid:"Неверный формат даты ({0})",datetime_exceed_min:"Должно быть, после {0}",datetime_exceed_max:"Должно быть, до {0}",boolean_not_valid:"Не логическое",operator_not_multiple:"Оператор {0} не поддерживает много значений"},datetimes:{today:"Сегодня"}}},QueryBuilder.DEFAULTS={filters:[],plugins:[],display_errors:!0,allow_groups:-1,allow_empty:!1,conditions:["AND","OR"],default_condition:"AND",inputs_separator:" , ",select_placeholder:"------",display_empty_filter:!0,default_filter:null,optgroups:{},default_rule_flags:{filter_readonly:!1,operator_readonly:!1,value_readonly:!1,no_delete:!1},default_group_flags:{condition_readonly:!1,no_delete:!1},templates:{group:null,rule:null,filterSelect:null,operatorSelect:null,operatorInput:null},lang_code:"ru",lang:{},operators:[{type:"equal",nb_inputs:1,multiple:!1,apply_to:["string","number","datetime","boolean","client_purchases"]},{type:"not_equal",nb_inputs:1,multiple:!1,apply_to:["string","number","datetime","boolean","client_purchases"]},{type:"in",nb_inputs:1,multiple:!0,apply_to:["select"]},{type:"not_in",nb_inputs:1,multiple:!0,apply_to:["select"]},{type:"less",nb_inputs:1,multiple:!1,apply_to:["number","datetime","client_purchases"]},{type:"less_or_equal",nb_inputs:1,multiple:!1,apply_to:["number","datetime","client_purchases"]},{type:"greater",nb_inputs:1,multiple:!1,apply_to:["number","datetime","client_purchases"]},{type:"greater_or_equal",nb_inputs:1,multiple:!1,apply_to:["number","datetime","client_purchases"]},{type:"between",nb_inputs:2,multiple:!1,apply_to:["number","datetime","client_purchases"]},{type:"not_between",nb_inputs:2,multiple:!1,apply_to:["number","datetime","client_purchases"]},{type:"begins_with",nb_inputs:1,multiple:!1,apply_to:["string"]},{type:"not_begins_with",nb_inputs:1,multiple:!1,apply_to:["string"]},{type:"contains",nb_inputs:1,multiple:!1,apply_to:["string"]},{type:"not_contains",nb_inputs:1,multiple:!1,apply_to:["string"]},{type:"ends_with",nb_inputs:1,multiple:!1,apply_to:["string"]},{type:"not_ends_with",nb_inputs:1,multiple:!1,apply_to:["string"]},{type:"is_empty",nb_inputs:0,multiple:!1,apply_to:["string"]},{type:"is_not_empty",nb_inputs:0,multiple:!1,apply_to:["string"]},{type:"is_null",nb_inputs:0,multiple:!1,apply_to:["boolean"]},{type:"is_not_null",nb_inputs:0,multiple:!1,apply_to:["boolean"]}],icons:{add_group:"fa fa-folder-open-o",add_rule:"fa fa-plus",remove_group:"fa fa-close",remove_rule:"fa fa-close",error:"fa fa-exclamation-triangle"}},QueryBuilder.prototype.init=function(e,t){e[0].queryBuilder=this,this.$el=e,this.settings=$.extendext(!0,"replace",{},QueryBuilder.DEFAULTS,t),this.model=new Model,this.status={group_id:0,rule_id:0,generated_id:!1,has_optgroup:!1,id:null,updating_value:!1},this.settings.allow_groups===!1?this.settings.allow_groups=0:this.settings.allow_groups===!0&&(this.settings.allow_groups=-1),this.filters=this.settings.filters,this.icons=this.settings.icons,this.operators=this.settings.operators,this.templates=this.settings.templates,this.plugins=this.settings.plugins,void 0===QueryBuilder.regional.en&&Utils.error("Config",'"i18n/en.js" not loaded.'),this.lang=$.extendext(!0,"replace",{},QueryBuilder.regional.en,QueryBuilder.regional[this.settings.lang_code],this.settings.lang),Object.keys(this.templates).forEach(function(e){this.templates[e]||(this.templates[e]=QueryBuilder.templates[e]),"string"==typeof this.templates[e]&&(this.templates[e]=doT.template(this.templates[e]))},this),this.$el.attr("id")||(this.$el.attr("id","qb_"+Math.floor(99999*Math.random())),this.status.generated_id=!0),this.status.id=this.$el.attr("id"),this.$el.addClass("query-builder form-inline"),this.filters=this.checkFilters(this.filters),this.bindEvents(),this.initPlugins(),this.trigger("afterInit"),t.rules?(this.setRules(t.rules),delete this.settings.rules):this.setRoot(!0)},QueryBuilder.prototype.checkFilters=function(e){var t=[];if(e&&0!==e.length||Utils.error("Config","Missing filters list"),e.forEach(function(e,r){if(e.id||Utils.error("Config","Missing filter {0} id",r),-1!=t.indexOf(e.id)&&Utils.error("Config",'Filter "{0}" already defined',e.id),t.push(e.id),e.type?QueryBuilder.types[e.type]||Utils.error("Config",'Invalid type "{0}"',e.type):e.type="string",e.input)"function"!=typeof e.input&&-1==QueryBuilder.inputs.indexOf(e.input)&&Utils.error("Config",'Invalid input "{0}"',e.input);else switch(e.type){case"date":case"datetime":e.input="date";break;default:e.input="text"}switch(e.field||(e.field=e.id),e.label||(e.label=e.field),e.optgroup?(this.status.has_optgroup=!0,this.settings.optgroups[e.optgroup]||(this.settings.optgroups[e.optgroup]=e.optgroup)):e.optgroup=null,e.input){case"radio":case"checkbox":(!e.values||e.values.length<1)&&Utils.error("Config",'Missing filter "{0}" values',e.id);break;case"select":e.placeholder&&(void 0===e.placeholder_value&&(e.placeholder_value=-1),Utils.iterateOptions(e.values,function(t,r){t==e.placeholder_value&&Utils.error("Config",'Placeholder of filter "{0}" overlaps with one of its values',e.id)}))}},this),this.status.has_optgroup){var r=[],i=[];e.forEach(function(e,t){var n;e.optgroup?(n=r.lastIndexOf(e.optgroup),-1==n?n=r.length:n++):n=r.length,r.splice(n,0,e.optgroup),i.splice(n,0,e)}),e=i}return e},QueryBuilder.prototype.bindEvents=function(){var e=this;this.$el.on("change.queryBuilder",Selectors.group_condition,function(){if($(this).is(":checked")){var e=$(this).closest(Selectors.group_container);Model(e).condition=$(this).val()}}),this.$el.on("change.queryBuilder",Selectors.rule_filter,function(){var t=$(this).closest(Selectors.rule_container);Model(t).filter=e.getFilterById($(this).val())}),this.$el.on("change.queryBuilder",Selectors.rule_operator,function(){var t=$(this).closest(Selectors.rule_container);Model(t).operator=e.getOperatorByType($(this).val())}),this.$el.on("click.queryBuilder",Selectors.add_rule,function(){var t=$(this).closest(Selectors.group_container);e.addRule(Model(t))}),this.$el.on("click.queryBuilder",Selectors.delete_rule,function(){var t=$(this).closest(Selectors.rule_container);e.deleteRule(Model(t))}),0!==this.settings.allow_groups&&(this.$el.on("click.queryBuilder",Selectors.add_group,function(){var t=$(this).closest(Selectors.group_container);e.addGroup(Model(t))}),this.$el.on("click.queryBuilder",Selectors.delete_group,function(){var t=$(this).closest(Selectors.group_container);e.deleteGroup(Model(t))})),this.model.on({drop:function(e,t){t.$el.remove()},add:function(e,t,r){t.$el.detach(),0===r?t.$el.prependTo(t.parent.$el.find(">"+Selectors.rules_list)):t.$el.insertAfter(t.parent.rules[r-1].$el)},update:function(t,r,i,n,o){if(r instanceof Rule)switch(i){case"error":e.displayError(r);break;case"flags":e.applyRuleFlags(r);break;case"filter":e.updateRuleFilter(r);break;case"operator":e.updateRuleOperator(r,o);break;case"value":e.updateRuleValue(r)}else switch(i){case"error":e.displayError(r);break;case"flags":e.applyGroupFlags(r);break;case"condition":e.updateGroupCondition(r)}}})},QueryBuilder.prototype.setRoot=function(e,t){e=void 0===e||e===!0;var r=this.nextGroupId(),i=$(this.getGroupTemplate(r,1));return this.$el.append(i),this.model.root=new Group(null,i),this.model.root.model=this.model,this.model.root.condition=this.settings.default_condition,void 0!==t&&(this.model.root.data=t),e&&this.addRule(this.model.root),this.model.root},QueryBuilder.prototype.addGroup=function(e,t,r){t=void 0===t||t===!0;var i=e.level+1,n=this.trigger("beforeAddGroup",e,t,i);if(n.isDefaultPrevented())return null;var o=this.nextGroupId(),l=$(this.getGroupTemplate(o,i)),u=e.addGroup(l);return void 0!==r&&(u.data=r),this.trigger("afterAddGroup",u),u.condition=this.settings.default_condition,t&&this.addRule(u),u},QueryBuilder.prototype.deleteGroup=function(e){if(e.isRoot())return!1;var t=this.trigger("beforeDeleteGroup",e);if(t.isDefaultPrevented())return!1;var r=!0;return e.each("reverse",function(e){r&=this.deleteRule(e)},function(e){r&=this.deleteGroup(e)},this),r&&(e.drop(),this.trigger("afterDeleteGroup")),r},QueryBuilder.prototype.updateGroupCondition=function(e){e.$el.find(">"+Selectors.group_condition).each(function(){var t=$(this);t.prop("checked",t.val()===e.condition),t.parent().toggleClass("active",t.val()===e.condition)}),this.trigger("afterUpdateGroupCondition",e)},QueryBuilder.prototype.addRule=function(e,t){var r=this.trigger("beforeAddRule",e);if(r.isDefaultPrevented())return null;var i=this.nextRuleId(),n=$(this.getRuleTemplate(i)),o=e.addRule(n);return void 0!==t&&(o.data=t),this.trigger("afterAddRule",o),this.createRuleFilters(o),(this.settings.default_filter||!this.settings.display_empty_filter)&&(o.filter=this.getFilterById(this.settings.default_filter||this.filters[0].id)),o},QueryBuilder.prototype.deleteRule=function(e){if(e.flags.no_delete)return!1;var t=this.trigger("beforeDeleteRule",e);return t.isDefaultPrevented()?!1:(e.drop(),this.trigger("afterDeleteRule"),!0)},QueryBuilder.prototype.createRuleFilters=function(e){var t=this.change("getRuleFilters",this.filters,e),r=$(this.getRuleFilterSelect(e,t));e.$el.find(Selectors.filter_container).html(r),this.trigger("afterCreateRuleFilters",e)},QueryBuilder.prototype.createRuleOperators=function(e){var t=e.$el.find(Selectors.operator_container).empty();if(e.filter){var r=this.getOperators(e.filter),i=$(this.getRuleOperatorSelect(e,r));i.is(":input")?(i.on("change",function(){}),t.html(i)):(i.find(":input").on("change",function(){}),t.html(i)),e.__.operator=r[0],this.trigger("afterCreateRuleOperators",e,r)}},QueryBuilder.prototype.createRuleInput=function(e){var t=e.$el.find(Selectors.value_container).empty();if(e.__.value=void 0,e.filter&&e.operator){var r=this,n=$(),o=e.filter;e.field=getQueryBuildField(e);var l=e.field.getInputs();for(i in l)t.append(l[i]),n=n.add(l[i]);t.show(),n.on("change "+(o.input_event||""),function(){r.status.updating_value=!0,e.value=r.getRuleValue(e),r.status.updating_value=!1}),o.plugin&&n[o.plugin](o.plugin_config||{}),this.trigger("afterCreateRuleInput",e),void 0!==o.default_value?e.value=o.default_value:(r.status.updating_value=!0,e.value=r.getRuleValue(e),r.status.updating_value=!1)}},QueryBuilder.prototype.updateRuleFilter=function(e){this.createRuleOperators(e),this.createRuleInput(e),e.$el.find(Selectors.rule_filter).val(e.filter?e.filter.id:"-1"),this.trigger("afterUpdateRuleFilter",e)},QueryBuilder.prototype.updateRuleOperator=function(e,t){var r=e.$el.find(Selectors.value_container);e.operator&&0!==e.operator.nb_inputs?(r.show(),(r.is(":empty")||e.operator.nb_inputs!==t.nb_inputs||e.operator.multiple!==t.multiple)&&this.createRuleInput(e)):(r.hide(),e.__.value=void 0),e.operator&&e.$el.find(Selectors.rule_operator).val(e.operator.type),this.trigger("afterUpdateRuleOperator",e)},QueryBuilder.prototype.updateRuleValue=function(e){this.status.updating_value||this.setRuleValue(e,e.value),this.trigger("afterUpdateRuleValue",e)},QueryBuilder.prototype.applyRuleFlags=function(e){var t=e.flags;t.filter_readonly&&e.$el.find(Selectors.rule_filter).prop("disabled",!0),t.operator_readonly&&e.$el.find(Selectors.rule_operator).prop("disabled",!0),t.value_readonly&&e.$el.find(Selectors.rule_value).prop("disabled",!0),t.no_delete&&e.$el.find(Selectors.delete_rule).remove(),this.trigger("afterApplyRuleFlags",e)},QueryBuilder.prototype.applyGroupFlags=function(e){var t=e.flags;t.condition_readonly&&(e.$el.find(">"+Selectors.condition_container+" .btn").addClass("disabled"),e.$el.find(">"+Selectors.group_condition).prop("disabled",!0)),t.no_delete&&e.$el.find(Selectors.delete_group).remove(),this.trigger("afterApplyGroupFlags",e)},QueryBuilder.prototype.clearErrors=function(e){e=e||this.model.root,e&&(e.error=null,e instanceof Group&&e.each(function(e){e.error=null},function(e){this.clearErrors(e)},this))},QueryBuilder.prototype.displayError=function(e){if(this.settings.display_errors)if(null===e.error)e.$el.removeClass("has-error");else{var t=$.extend([],e.error,[this.lang.errors[e.error[0]]||e.error[0]]);e.$el.addClass("has-error").find(Selectors.error_container).eq(0).attr("title",Utils.fmt.apply(null,t))}},QueryBuilder.prototype.triggerValidationError=function(e,t,r){$.isArray(t)||(t=[t]);var i=this.trigger("validationError",e,t,r);i.isDefaultPrevented()||(e.error=t)},QueryBuilder.prototype.destroy=function(){this.trigger("beforeDestroy"),this.status.generated_id&&this.$el.removeAttr("id"),this.clear(),this.model=null,this.$el.off(".queryBuilder").removeClass("query-builder").removeData("queryBuilder"),delete this.$el[0].queryBuilder},QueryBuilder.prototype.reset=function(){this.status.group_id=1,this.status.rule_id=0,this.model.root.empty(),this.addRule(this.model.root),this.trigger("afterReset")},QueryBuilder.prototype.clear=function(){this.status.group_id=0,this.status.rule_id=0,this.model.root&&(this.model.root.drop(),this.model.root=null),this.trigger("afterClear")},QueryBuilder.prototype.setOptions=function(e){$.makeArray($(Object.keys(e)).filter(QueryBuilder.modifiable_options)).forEach(function(t){this.settings[t]=e[t]},this)},QueryBuilder.prototype.getModel=function(e){return e?Model(e):this.model.root},QueryBuilder.prototype.validate=function(){this.clearErrors();var e=this,t=function r(t){var i=0,n=0;return t.each(function(t){if(!t.filter)return e.triggerValidationError(t,"no_filter",null),void n++;if(0!==t.operator.nb_inputs){var r=e.validateValue(t,t.value);if(r!==!0)return e.triggerValidationError(t,r,t.value),void n++}i++},function(e){r(e)?i++:n++}),n>0?!1:0!==i||e.settings.allow_empty&&t.isRoot()?!0:(e.triggerValidationError(t,"empty_group",null),!1)}(this.model.root);return this.change("validate",t)},QueryBuilder.prototype.getRules=function(){var e=function t(e){var r={condition:e.condition,rules:[]};return e.data&&(r.data=$.extendext(!0,"replace",{},e.data)),e.each(function(e){if(e.operator){var t=null;0!==e.operator.nb_inputs&&(t=e.value);var i={id:e.filter.id,field:e.filter.field,type:e.filter.type,input:e.filter.input,operator:e.operator.type,value:t};(e.filter.data||e.data)&&(i.data=$.extendext(!0,"replace",{},e.filter.data,e.data)),r.rules.push(i)}},function(e){r.rules.push(t(e))}),r}(this.model.root);return this.change("getRules",e)},QueryBuilder.prototype.getRulesWithValidate=function(){return this.validate()?this.getRules():{}},QueryBuilder.prototype.setRules=function(e){$.isArray(e)&&(e={condition:this.settings.default_condition,rules:e}),e&&e.rules&&(0!==e.rules.length||this.settings.allow_empty)||Utils.error("RulesParse","Incorrect data object passed"),this.clear(),this.setRoot(!1,e.data),this.model.root.flags=this.parseGroupFlags(e),e=this.change("setRules",e);var t=this;!function r(e,i){null!==i&&(void 0===e.condition?e.condition=t.settings.default_condition:-1==t.settings.conditions.indexOf(e.condition)&&Utils.error("UndefinedCondition",'Invalid condition "{0}"',e.condition),i.condition=e.condition,e.rules.forEach(function(e){var n;if(e.rules&&e.rules.length>0)if(-1!=t.settings.allow_groups&&t.settings.allow_groups<i.level)t.reset(),Utils.error("RulesParse","No more than {0} groups are allowed",t.settings.allow_groups);else{if(n=t.addGroup(i,!1,e.data),null===n)return;n.flags=t.parseGroupFlags(e),r(e,n)}else{if(void 0===e.id&&Utils.error("RulesParse","Missing rule field id"),void 0===e.operator&&(e.operator="equal"),n=t.addRule(i,e.data),null===n)return;n.filter=t.getFilterById(e.id),n.operator=t.getOperatorByType(e.operator),n.flags=t.parseRuleFlags(e),0!==n.operator.nb_inputs&&void 0!==e.value&&(n.value=e.value)}}))}(e,this.model.root)},QueryBuilder.prototype.validateValue=function(e,t){var r=e.filter.validation||{},i=!0;return i=r.callback?r.callback.call(this,t,e):this.validateValueInternal(e,t),this.change("validateValue",i,t,e)},QueryBuilder.prototype.validateValueInternal=function(e,t){return e.field.validate(t)},QueryBuilder.prototype.nextGroupId=function(){return this.status.id+"_group_"+this.status.group_id++},QueryBuilder.prototype.nextRuleId=function(){return this.status.id+"_rule_"+this.status.rule_id++},QueryBuilder.prototype.getOperators=function(e){"string"==typeof e&&(e=this.getFilterById(e));for(var t=[],r=QueryBuilder.types[e.type]||QueryBuilder.types[e.input],i=0,n=this.operators.length;n>i;i++){if(e.operators){if(-1==e.operators.indexOf(this.operators[i].type))continue}else if(-1==this.operators[i].apply_to.indexOf(r))continue;t.push(this.operators[i])}return _.isEmpty(t)&&t.push(this.operators[0]),e.operators&&t.sort(function(t,r){return e.operators.indexOf(t.type)-e.operators.indexOf(r.type)}),this.change("getOperators",t,e)},QueryBuilder.prototype.getFilterById=function(e){if("-1"==e)return null;for(var t=0,r=this.filters.length;r>t;t++)if(this.filters[t].id==e)return this.filters[t];Utils.error("UndefinedFilter",'Undefined filter "{0}"',e)},QueryBuilder.prototype.getOperatorByType=function(e){if("-1"==e)return null;for(var t=0,r=this.operators.length;r>t;t++)if(this.operators[t].type==e)return this.operators[t];Utils.error("UndefinedOperator",'Undefined operator "{0}"',e)},QueryBuilder.prototype.getRuleValue=function(e){return value=e.field.getValue(),this.change("getRuleValue",value,e)},QueryBuilder.prototype.setRuleValue=function(e,t){{var r=e.filter;e.operator}r.valueSetter&&r.valueSetter.call(this,e,t),e.field.setValue(t)},QueryBuilder.prototype.parseRuleFlags=function(e){var t=$.extend({},this.settings.default_rule_flags);return e.readonly&&$.extend(t,{filter_readonly:!0,operator_readonly:!0,value_readonly:!0,no_delete:!0}),e.flags&&$.extend(t,e.flags),this.change("parseRuleFlags",t,e)},QueryBuilder.prototype.parseGroupFlags=function(e){var t=$.extend({},this.settings.default_group_flags);return e.readonly&&$.extend(t,{condition_readonly:!0,no_delete:!0}),e.flags&&$.extend(t,e.flags),this.change("parseGroupFlags",t,e)},QueryBuilder.prototype.translateLabel=function(e){return"string"==typeof e?e:e[this.settings.lang_code]||e.en},QueryBuilder.templates.group='\r\n<dl id="{{= it.group_id }}" class="rules-group-container"> \r\n  <dt class="rules-group-header"> \r\n    <div class="btn-group pull-right group-actions"> \r\n      <button type="button" class="btn btn-xs btn-success" data-add="rule"> \r\n        <i class="{{= it.icons.add_rule }}"></i> \r\n        <span class="hidden-xs hidden-sm">{{= it.lang.add_rule }}</span> \r\n      </button> \r\n      {{? it.settings.allow_groups===-1 || it.settings.allow_groups>=it.level }} \r\n        <button type="button" class="btn btn-xs btn-success" data-add="group"> \r\n          <i class="{{= it.icons.add_group }}"></i> \r\n          <span class="hidden-xs hidden-sm">{{= it.lang.add_group }}</span> \r\n        </button> \r\n      {{?}} \r\n      {{? it.level>1 }} \r\n        <button type="button" class="btn btn-xs btn-danger" data-delete="group"> \r\n          <i class="{{= it.icons.remove_group }}"></i> \r\n          <span class="hidden-xs hidden-sm">{{= it.lang.delete_group }}</span> \r\n        </button> \r\n      {{?}} \r\n    </div> \r\n    <div class="btn-group group-conditions"> \r\n      {{~ it.conditions: condition }} \r\n        <label class="btn btn-sm btn-primary"> \r\n          <input type="radio" name="{{= it.group_id }}_cond" value="{{= condition }}"> {{= it.lang.conditions[condition] || condition }} \r\n        </label> \r\n      {{~}} \r\n    </div> \r\n  </dt> \r\n  <dd class=rules-group-body> \r\n    <ul class=rules-list></ul> \r\n  </dd> \r\n</dl>',QueryBuilder.templates.rule='\r\n<li id="{{= it.rule_id }}" class="rule-container"> \r\n  <div class="rule-header"> \r\n    <div class="btn-group pull-right rule-actions"> \r\n      <button type="button" class="btn btn-xs btn-danger" data-delete="rule"> \r\n        <i class="{{= it.icons.remove_rule }}"></i> \r\n        <span class="hidden-xs hidden-sm">{{= it.lang.delete_rule }}</span> \r\n      </button> \r\n    </div> \r\n  </div> \r\n  <div class="rule-filter-container"></div> \r\n  <div class="rule-operator-container"></div> \r\n  <div class="rule-value-container"></div> \r\n</li>',QueryBuilder.templates.filterSelect='\r\n{{ var optgroup = null; }} \r\n<select class="form-control" name="{{= it.rule.id }}_filter"> \r\n  {{? it.settings.display_empty_filter }} \r\n    <option value="-1">{{= it.settings.select_placeholder }}</option> \r\n  {{?}} \r\n  {{~ it.filters: filter }} \r\n    {{? optgroup !== filter.optgroup }} \r\n      {{? optgroup !== null }}</optgroup>{{?}} \r\n      {{? (optgroup = filter.optgroup) !== null}} \r\n        <optgroup label="{{= it.translate(it.settings.optgroups[optgroup]) }}"> \r\n      {{?}} \r\n    {{?}} \r\n    <option value="{{= filter.id }}">{{= it.translate(filter.label) }}</option> \r\n  {{~}} \r\n  {{? optgroup !== null }}</optgroup>{{?}} \r\n</select>',QueryBuilder.templates.operatorSelect='\r\n<select class="form-control" name="{{= it.rule.id }}_operator"> \r\n  {{~ it.operators: operator }} \r\n    <option value="{{= operator.type }}">{{= it.lang.operators[operator.type] || operator.type }}</option> \r\n  {{~}} \r\n</select>',QueryBuilder.templates.operatorInput='<span> \r\n<input type="hidden" name="{{= it.rule.id }}_operator" value="{{= it.operator.type }}" /> \r\n<span class="label label-info">{{= it.lang.operators[it.operator.type] || it.operator.type }}</span> \r\n</span>',
QueryBuilder.prototype.getGroupTemplate=function(e,t){var r=this.templates.group({builder:this,group_id:e,level:t,conditions:this.settings.conditions,icons:this.icons,lang:this.lang,settings:this.settings});return this.change("getGroupTemplate",r,t)},QueryBuilder.prototype.getRuleTemplate=function(e){var t=this.templates.rule({builder:this,rule_id:e,icons:this.icons,lang:this.lang,settings:this.settings});return this.change("getRuleTemplate",t)},QueryBuilder.prototype.getRuleFilterSelect=function(e,t){var r=this.templates.filterSelect({builder:this,rule:e,filters:t,icons:this.icons,lang:this.lang,settings:this.settings,translate:this.translateLabel});return this.change("getRuleFilterSelect",r,e)},QueryBuilder.prototype.getRuleOperatorSelect=function(e,t){if(!t)var t=[];var r={builder:this,rule:e,operators:t,icons:this.icons,lang:this.lang,settings:this.settings};if(_.size(t)>1)var i=this.templates.operatorSelect(r);else if(1==_.size(t))var i=this.templates.operatorInput($.extend({},r,{operator:t[0]}));else var i=this.templates.operatorInput($.extend({},r,{operator:QueryBuilder.DEFAULTS.operators[0]}));return this.change("getRuleOperatorSelect",i,e)},QueryBuilder.prototype.getRuleInput=function(e,t){var r=e.filter,i=e.filter.validation||{},n=e.id+"_value_"+t,o=(r.vertical?" class=block":"","");if(e.operator.multiple&&(r.multiple=!0),"function"==typeof r.input)o=r.input.call(this,e,n);else switch(r.input){case"radio":case"checkbox":Utils.iterateOptions(r.values,function(e,t){o+='<label class="radio-inline"><input type="'+r.input+'" name="'+n+'" value="'+e+'"> '+t+"</label> "});break;case"select":o+='<select class="form-control" name="'+n+'"'+(r.multiple?" multiple":"")+">",r.placeholder&&(o+='<option value="'+r.placeholder_value+'" disabled selected>'+r.placeholder+"</option>"),Utils.iterateOptions(r.values,function(e,t){o+='<option value="'+e+'">'+t+"</option> "}),o+="</select>";break;case"textarea":o+='<textarea class="form-control" name="'+n+'"',r.size&&(o+=' cols="'+r.size+'"'),r.rows&&(o+=' rows="'+r.rows+'"'),void 0!==i.min&&(o+=' minlength="'+i.min+'"'),void 0!==i.max&&(o+=' maxlength="'+i.max+'"'),r.placeholder&&(o+=' placeholder="'+r.placeholder+'"'),o+="></textarea>";break;default:switch(QueryBuilder.types[r.type]){case"number":o+='<input class="form-control" type="number" name="'+n+'"',void 0!==i.step&&(o+=' step="'+i.step+'"'),void 0!==i.min&&(o+=' min="'+i.min+'"'),void 0!==i.max&&(o+=' max="'+i.max+'"'),r.placeholder&&(o+=' placeholder="'+r.placeholder+'"'),r.size&&(o+=' size="'+r.size+'"'),o+=">";break;case"datetime":o=$('<input type="text" name="'+n+'" class="form-control" />');break;default:o+='<input class="form-control" type="text" name="'+n+'"',r.placeholder&&(o+=' placeholder="'+r.placeholder+'"'),"string"===r.type&&void 0!==i.min&&(o+=' minlength="'+i.min+'"'),"string"===r.type&&void 0!==i.max&&(o+=' maxlength="'+i.max+'"'),r.size&&(o+=' size="'+r.size+'"'),o+=">"}}return this.change("getRuleInput",o,e,n)},$.extend(Model.prototype,{trigger:function(e){return this.$.triggerHandler(e,Array.prototype.slice.call(arguments,1)),this},on:function(){return this.$.on.apply(this.$,Array.prototype.slice.call(arguments)),this},off:function(){return this.$.off.apply(this.$,Array.prototype.slice.call(arguments)),this},once:function(){return this.$.one.apply(this.$,Array.prototype.slice.call(arguments)),this}}),Model.getModel=function(e){return e?e instanceof Node?e:$(e).data("queryBuilderModel"):null};var Node=function(e,t){return this instanceof Node?(Object.defineProperty(this,"__",{value:{}}),t.data("queryBuilderModel",this),this.__.level=0,this.__.error=null,this.__.data=void 0,this.$el=t,this.id=t[0].id,this.model=null,void(this.parent=e)):new Node};defineModelProperties(Node,["level","error","data","flags"]),Object.defineProperty(Node.prototype,"parent",{enumerable:!0,get:function(){return this.__.parent},set:function(e){this.__.parent=e,this.level=null===e?1:e.level+1,this.model=null===e?null:e.model}}),Node.prototype.isRoot=function(){return 1===this.level},Node.prototype.getPos=function(){return this.isRoot()?-1:this.parent.getNodePos(this)},Node.prototype.drop=function(){null!==this.model&&this.model.trigger("drop",this),this.isRoot()||(this.parent._dropNode(this),this.parent=null)},Node.prototype.moveAfter=function(e){return this.isRoot()?void 0:(this.parent._dropNode(this),e.parent._addNode(this,e.getPos()+1),this)},Node.prototype.moveAtBegin=function(e){return this.isRoot()?void 0:(void 0===e&&(e=this.parent),this.parent._dropNode(this),e._addNode(this,0),this)},Node.prototype.moveAtEnd=function(e){return this.isRoot()?void 0:(void 0===e&&(e=this.parent),this.parent._dropNode(this),e._addNode(this,e.length()),this)};var Group=function(e,t){return this instanceof Group?(Node.call(this,e,t),this.rules=[],void(this.__.condition=null)):new Group(e,t)};Group.prototype=Object.create(Node.prototype),Group.prototype.constructor=Group,defineModelProperties(Group,["condition"]),Group.prototype.empty=function(){this.each("reverse",function(e){e.drop()},function(e){e.drop()})},Group.prototype.drop=function(){this.empty(),Node.prototype.drop.call(this)},Group.prototype.length=function(){return this.rules.length},Group.prototype._addNode=function(e,t){return void 0===t&&(t=this.length()),this.rules.splice(t,0,e),e.parent=this,null!==this.model&&this.model.trigger("add",e,t),e},Group.prototype.addGroup=function(e,t){return this._addNode(new Group(this,e),t)},Group.prototype.addRule=function(e,t){return this._addNode(new Rule(this,e),t)},Group.prototype._dropNode=function(e){var t=this.getNodePos(e);return-1!==t&&(e.parent=null,this.rules.splice(t,1)),this},Group.prototype.getNodePos=function(e){return this.rules.indexOf(e)},Group.prototype.each=function(e,t,r,i){"function"==typeof e&&(i=r,r=t,t=e,e=!1),i=void 0===i?null:i;for(var n=e?this.rules.length-1:0,o=e?0:this.rules.length-1,l=e?-1:1,u=function(){return e?n>=o:o>=n},s=!1;u()&&(this.rules[n]instanceof Group?void 0!==r&&(s=r.call(i,this.rules[n])===!1):s=t.call(i,this.rules[n])===!1,!s);n+=l);return!s},Group.prototype.contains=function(e,t){return-1!==this.getNodePos(e)?!0:t?!this.each(function(e){return!0},function(t){return!t.contains(e,!0)}):!1};var Rule=function(e,t){return this instanceof Rule?(Node.call(this,e,t),this.__.filter=null,this.__.operator=null,this.__.flags={},this.__.value=void 0,void(this.__.field=void 0)):new Rule(e,t)};Rule.prototype=Object.create(Node.prototype),Rule.prototype.constructor=Rule,defineModelProperties(Rule,["filter","operator","value"]),QueryBuilder.Group=Group,QueryBuilder.Rule=Rule;var Utils=QueryBuilder.utils={};Utils.iterateOptions=function(e,t){e&&($.isArray(e)?e.forEach(function(e){$.isPlainObject(e)?$.each(e,function(e,r){return t(e,r),!1}):t(e,e)}):$.each(e,function(e,r){t(e,r)}))},Utils.fmt=function(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{([0-9]+)}/g,function(e,r){return t[parseInt(r)]})},Utils.error=function(e,t){},Utils.changeType=function(e,t,r){switch(t){case"integer":return parseInt(e);case"double":return parseFloat(e);case"boolean":var i="true"===e.trim().toLowerCase()||"1"===e.trim()||1===e;return r?i?1:0:i;default:return e}},Utils.escapeString=function(e){return"string"!=typeof e?e:e.replace(/[\0\n\r\b\\\'\"]/g,function(e){switch(e){case"\x00":return"\\0";case"\n":return"\\n";case"\r":return"\\r";case"\b":return"\\b";default:return"\\"+e}}).replace(/\t/g,"\\t").replace(/\x1a/g,"\\Z")},Utils.escapeRegExp=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},$.fn.queryBuilder=function(e){this.length>1&&Utils.error("Config","Unable to initialize on multiple target");var t=this.data("queryBuilder"),r="object"==typeof e&&e||{};return t||"destroy"!=e?(t||this.data("queryBuilder",new QueryBuilder(this,r)),"string"==typeof e?t[e].apply(t,Array.prototype.slice.call(arguments,1)):this):this},$.fn.queryBuilder.constructor=QueryBuilder,$.fn.queryBuilder.defaults=QueryBuilder.defaults,$.fn.queryBuilder.extend=QueryBuilder.extend,$.fn.queryBuilder.define=QueryBuilder.define,$.fn.queryBuilder.regional=QueryBuilder.regional;var QueryBuilderFieldType={extend:function(e,t){if(!t)var t={};return QueryBuilderFieldType[e]=$.extend({},this._decorator,t),QueryBuilderFieldType[e]},_decorator:{field:null,input:null,isValidate:!0,attributes:void 0,construct:function(e,t){return this.field=e,this.attributes=t,this},_getInput:function(e){return this.input=$('<input type="text" />'),this.input.addClass("form-control").attr("name",e),this.field.filter.placeholder&&this.input.attr("placeholder",this.field.filter.placeholder),_.isObject(this.attributes)&&this.input.attr(this.attributes),this.input},getInput:function(e){return this._getInput(e)},getValue:function(){return this.input?this.input.val():null},setValues:function(e){this.values=e},getValues:function(){return this.values||this.field.filter.values},setValue:function(e){this.input?this.input.val(e):null,this.afterSetValue(e)},afterSetValue:function(){},validate:function(e){if(!this.isValidate)return!0;if(!this.field.filter.required)return!0;var t=this.field.filter,r=t.validation||{};return void 0===e||0===e.length?["string_empty"]:void 0!==r.min&&e.length<parseInt(r.min)?["string_exceed_min_length",r.min]:void 0!==r.max&&e.length>parseInt(r.max)?["string_exceed_max_length",r.max]:r.format&&("string"==typeof r.format&&(r.format=new RegExp(r.format)),!r.format.test(e))?["string_invalid_format",r.format]:!0}}};QueryBuilderFieldType.extend("default"),QueryBuilderFieldType.extend("checkbox",{values:!1,getInput:function(e){var t=$('<span class="checkbox checkbox-success" />'),r="checkbox";return this.field.multiple||(r="radio"),Utils.iterateOptions(this.getValues(),function(i,n){var o=$('<input type="'+r+'" id="'+e+'" name="'+e+'" value="'+i+'" class="styled checkboxToggle-apply" />');t.append(o),$('<label for="'+e+'"/>').insertAfter(o).text(n)}),this.input=t,this.input},getValue:function(){return tmp=[],this.input.find("input:checked").each(function(){tmp.push($(this).val())}),tmp},setValue:function(e){var t=this;e.forEach(function(e){t.input.find('[value="'+e+'"]').prop("checked",!0).trigger("change")})}}),QueryBuilderFieldType.extend("date",{getInput:function(e){return this._getInput(e).addClass("datepicker").attr("type","date")}}),QueryBuilderFieldType.extend("datetime",{getInput:function(e){return this._getInput(e).addClass("datetimepicker").attr("type","datetime")}}),QueryBuilderFieldType.extend("time",{getInput:function(e){return this._getInput(e).addClass("timepicker").attr("type","time")}}),QueryBuilderFieldType.extend("number",{getInput:function(e){return this._getInput(e).attr("type","number")}}),QueryBuilderFieldType.extend("integer",QueryBuilderFieldType.number),QueryBuilderFieldType.extend("select",{getInput:function(e,t){var r=this;return this.input=$("<select />"),this.input.addClass("form-control").attr("name",e),this.field.multiple&&this.input.attr("multiple","multiple"),Utils.iterateOptions(this.getValues(),function(e,t){r.input.append($('<option value="'+e+'">'+t+"</option>"))}),this.input},validate:function(e){var t=this.field.filter,r=this.field.operator;if(t.multiple){if(void 0===e||0===e.length||t.placeholder&&e==t.placeholder_value)return["select_empty"];if(!r.multiple&&e.length>1)return["operator_not_multiple",r.type]}else if(void 0===e||t.placeholder&&e==t.placeholder_value)return["select_empty"];return!0}}),QueryBuilderFieldType.extend("textarea",{getInput:function(e){return this.input=$("<textarea/>"),this.input.addClass("form-control").attr("name",e),this.field.filter.size&&this.input.attr("cols",this.field.filter.size),this.field.filter.rows&&this.input.attr("rows",this.field.filter.rows),this.field.filter.placeholder&&this.input.attr("placeholder",this.field.filter.placeholder),Utils.iterateOptions(this.field.filter.values,function(e,t){this.input.append($("<option />").attr("value",e).val(t))}),this.input}});var QueryBuilderField={extend:function(e,t){if(!t)var t={};return QueryBuilderField[e]=$.extend({},this._decorator,t),QueryBuilderField[e]},_decorator:{rule:null,filter:null,validation:null,operator:null,multiple:!1,value:null,inputs:[],construct:function(e){return this.rule=e,this.filter=this.rule.filter,this.validation=this.filter.validation||{},this.operator=this.rule.operator,e.operator.multiple&&(this.multiple=!0),this},validate:function(e){var t=!0;for(i in this.inputs){var r=this.inputs[i];if(t=r instanceof jQuery?_.isEmpty(r.val())?["string_empty"]:!0:this.inputs[i].validate(this.inputs[i].getValue()),t!==!0)return t}return t},getInputs:function(){this.inputs=[];for(var e=[],t=0;t<this.operator.nb_inputs;t++){if(_.has(QueryBuilderFieldType,this.filter.input))var r=Object.create(QueryBuilderFieldType[this.filter.input]);else var r=Object.create(QueryBuilderFieldType["default"]);r=r.construct(this),this.inputs.push(r),e.push(r.getInput(this.rule.id+t))}return e},getValue:function(){var e=[];if(_.isEmpty(this.inputs))return e;for(i in this.inputs){var t=this.inputs[i];e.push(t instanceof jQuery?t.val():t.getValue())}return e},setValue:function(e){this.value=e;for(i in this.inputs){var t=this.inputs[i];t instanceof jQuery?t.val(e[i]):t.setValue(e[i])}}}};QueryBuilderField.extend("default"),Selectors.rule_and_group_containers=Selectors.rule_container+", "+Selectors.group_container,QueryBuilder.define("sortable",function(e){this.on("afterInit",function(e){$.event.props.push("dataTransfer");var t,r,i=e.builder;i.$el.on("mouseover.queryBuilder",".drag-handle",function(){i.$el.find(Selectors.rule_and_group_containers).attr("draggable",!0)}),i.$el.on("mouseout.queryBuilder",".drag-handle",function(){i.$el.find(Selectors.rule_and_group_containers).removeAttr("draggable")}),i.$el.on("dragstart.queryBuilder","[draggable]",function(e){e.stopPropagation(),e.dataTransfer.setData("text","drag"),r=Model(e.target),setTimeout(function(){var e=$('<div class="rule-placeholder">&nbsp;</div>');e.css("min-height",r.$el.height()),t=r.parent.addRule(e,r.getPos()),r.$el.hide()},0)}),i.$el.on("dragenter.queryBuilder","[draggable]",function(e){e.preventDefault(),e.stopPropagation(),t&&moveSortableToTarget(t,$(e.target))}),i.$el.on("dragover.queryBuilder","[draggable]",function(e){e.preventDefault(),e.stopPropagation()}),i.$el.on("drop.queryBuilder",function(e){e.preventDefault(),e.stopPropagation(),moveSortableToTarget(r,$(e.target))}),i.$el.on("dragend.queryBuilder","[draggable]",function(e){e.preventDefault(),e.stopPropagation(),r.$el.show(),t.drop(),r=t=null,i.$el.find(Selectors.rule_and_group_containers).removeAttr("draggable")})}),this.on("parseRuleFlags.filter",function(t){void 0===t.value.no_sortable&&(t.value.no_sortable=e.default_no_sortable)}),this.on("afterApplyRuleFlags",function(e,t){t.flags.no_sortable&&t.$el.find(".drag-handle").remove()}),this.on("getGroupTemplate.filter",function(t,r){if(r>1){var i=$(t.value);i.find(Selectors.condition_container).after('<div class="drag-handle"><i class="'+e.icon+'"></i></div>'),t.value=i.prop("outerHTML")}}),this.on("getRuleTemplate.filter",function(t){var r=$(t.value);r.find(Selectors.rule_header).after('<div class="drag-handle"><i class="'+e.icon+'"></i></div>'),t.value=r.prop("outerHTML")})},{default_no_sortable:!1,icon:"fa fa-sort"});