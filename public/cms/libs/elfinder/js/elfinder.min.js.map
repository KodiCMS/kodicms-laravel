{"version":3,"sources":["elfinder.js","elFinder.version.js","jquery.elfinder.js","elFinder.options.js","elFinder.history.js","elFinder.command.js","elFinder.resources.js","jquery.dialogelfinder.js","elfinder.en.js","button.js","contextmenu.js","cwd.js","dialog.js","navbar.js","overlay.js","panel.js","path.js","places.js","searchbutton.js","sortbutton.js","stat.js","toolbar.js","tree.js","uploadButton.js","viewbutton.js","workzone.js","archive.js","back.js","copy.js","cut.js","download.js","duplicate.js","edit.js","extract.js","forward.js","getfile.js","help.js","home.js","info.js","mkdir.js","mkfile.js","netmount.js","open.js","paste.js","quicklook.js","audio.js","flash.js","images.js","pdf.js","text.js","video.js","browser.media.js","reload.js","rename.js","resize.js","rm.js","search.js","sort.js","up.js","upload.js","view.js","elfinder.end.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACr6FA;AACA;AACA;AACA;AACA;AACA;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACheA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1RA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChkCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACljBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/NA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACn0BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvBA","file":"elfinder.min.js","sourcesContent":["/*!\r\n * elFinder - file manager for web\r\n * Version 2.x (Nightly: 5b3b866) (2014-03-05)\r\n * http://elfinder.org\r\n *\r\n * Copyright 2009-2013, Studio 42\r\n * Licensed under a 3 clauses BSD license\r\n */\r\n(function ($) {\r\n\twindow.elFinder = function (node, opts) {\r\n\t\tthis.time('load');\r\n\r\n\t\tvar self = this,\r\n\r\n\t\t\t/**\r\n\t\t\t * Node on which elfinder creating\r\n\t\t\t *\r\n\t\t\t * @type jQuery\r\n\t\t\t **/\r\n\t\t\tnode = $(node),\r\n\r\n\t\t\t/**\r\n\t\t\t * Store node contents.\r\n\t\t\t *\r\n\t\t\t * @see this.destroy\r\n\t\t\t * @type jQuery\r\n\t\t\t **/\r\n\t\t\tprevContent = $('<div/>').append(node.contents()),\r\n\r\n\t\t\t/**\r\n\t\t\t * Store node inline styles\r\n\t\t\t *\r\n\t\t\t * @see this.destroy\r\n\t\t\t * @type String\r\n\t\t\t **/\r\n\t\t\tprevStyle = node.attr('style'),\r\n\r\n\t\t\t/**\r\n\t\t\t * Instance ID. Required to get/set cookie\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t **/\r\n\t\t\tid = node.attr('id') || '',\r\n\r\n\t\t\t/**\r\n\t\t\t * Events namespace\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t **/\r\n\t\t\tnamespace = 'elfinder-' + (id || Math.random().toString().substr(2, 7)),\r\n\r\n\t\t\t/**\r\n\t\t\t * Mousedown event\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t **/\r\n\t\t\tmousedown = 'mousedown.' + namespace,\r\n\r\n\t\t\t/**\r\n\t\t\t * Keydown event\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t **/\r\n\t\t\tkeydown = 'keydown.' + namespace,\r\n\r\n\t\t\t/**\r\n\t\t\t * Keypress event\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t **/\r\n\t\t\tkeypress = 'keypress.' + namespace,\r\n\r\n\t\t\t/**\r\n\t\t\t * Is shortcuts/commands enabled\r\n\t\t\t *\r\n\t\t\t * @type Boolean\r\n\t\t\t **/\r\n\t\t\tenabled = true,\r\n\r\n\t\t\t/**\r\n\t\t\t * Store enabled value before ajax requiest\r\n\t\t\t *\r\n\t\t\t * @type Boolean\r\n\t\t\t **/\r\n\t\t\tprevEnabled = true,\r\n\r\n\t\t\t/**\r\n\t\t\t * List of build-in events which mapped into methods with same names\r\n\t\t\t *\r\n\t\t\t * @type Array\r\n\t\t\t **/\r\n\t\t\tevents = ['enable', 'disable', 'load', 'open', 'reload', 'select', 'add', 'remove', 'change', 'dblclick', 'getfile', 'lockfiles', 'unlockfiles', 'dragstart', 'dragstop'],\r\n\r\n\t\t\t/**\r\n\t\t\t * Rules to validate data from backend\r\n\t\t\t *\r\n\t\t\t * @type Object\r\n\t\t\t **/\r\n\t\t\trules = {},\r\n\r\n\t\t\t/**\r\n\t\t\t * Current working directory hash\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t **/\r\n\t\t\tcwd = '',\r\n\r\n\t\t\t/**\r\n\t\t\t * Current working directory options\r\n\t\t\t *\r\n\t\t\t * @type Object\r\n\t\t\t **/\r\n\t\t\tcwdOptions = {\r\n\t\t\t\tpath: '',\r\n\t\t\t\turl: '',\r\n\t\t\t\ttmbUrl: '',\r\n\t\t\t\tdisabled: [],\r\n\t\t\t\tseparator: '/',\r\n\t\t\t\tarchives: [],\r\n\t\t\t\textract: [],\r\n\t\t\t\tcopyOverwrite: true,\r\n\t\t\t\ttmb: false // old API\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Files/dirs cache\r\n\t\t\t *\r\n\t\t\t * @type Object\r\n\t\t\t **/\r\n\t\t\tfiles = {},\r\n\r\n\t\t\t/**\r\n\t\t\t * Selected files hashes\r\n\t\t\t *\r\n\t\t\t * @type Array\r\n\t\t\t **/\r\n\t\t\tselected = [],\r\n\r\n\t\t\t/**\r\n\t\t\t * Events listeners\r\n\t\t\t *\r\n\t\t\t * @type Object\r\n\t\t\t **/\r\n\t\t\tlisteners = {},\r\n\r\n\t\t\t/**\r\n\t\t\t * Shortcuts\r\n\t\t\t *\r\n\t\t\t * @type Object\r\n\t\t\t **/\r\n\t\t\tshortcuts = {},\r\n\r\n\t\t\t/**\r\n\t\t\t * Buffer for copied files\r\n\t\t\t *\r\n\t\t\t * @type Array\r\n\t\t\t **/\r\n\t\t\tclipboard = [],\r\n\r\n\t\t\t/**\r\n\t\t\t * Copied/cuted files hashes\r\n\t\t\t * Prevent from remove its from cache.\r\n\t\t\t * Required for dispaly correct files names in error messages\r\n\t\t\t *\r\n\t\t\t * @type Array\r\n\t\t\t **/\r\n\t\t\tremember = [],\r\n\r\n\t\t\t/**\r\n\t\t\t * Queue for 'open' requests\r\n\t\t\t *\r\n\t\t\t * @type Array\r\n\t\t\t **/\r\n\t\t\tqueue = [],\r\n\r\n\t\t\t/**\r\n\t\t\t * Net drivers names\r\n\t\t\t *\r\n\t\t\t * @type Array\r\n\t\t\t **/\r\n\t\t\tnetDrivers = [],\r\n\r\n\t\t\t/**\r\n\t\t\t * Commands prototype\r\n\t\t\t *\r\n\t\t\t * @type Object\r\n\t\t\t **/\r\n\t\t\tbase = new self.command(self),\r\n\r\n\t\t\t/**\r\n\t\t\t * elFinder node width\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t * @default \"auto\"\r\n\t\t\t **/\r\n\t\t\twidth = 'auto',\r\n\r\n\t\t\t/**\r\n\t\t\t * elFinder node height\r\n\t\t\t *\r\n\t\t\t * @type Number\r\n\t\t\t * @default 400\r\n\t\t\t **/\r\n\t\t\theight = 400,\r\n\r\n\t\t\tbeeper = $(document.createElement('audio')).hide().appendTo('body')[0],\r\n\r\n\t\t\tsyncInterval,\r\n\r\n\t\t\topen = function (data) {\r\n\t\t\t\tif (data.init) {\r\n\t\t\t\t\t// init - reset cache\r\n\t\t\t\t\tfiles = {};\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// remove only files from prev cwd\r\n\t\t\t\t\tfor (var i in files) {\r\n\t\t\t\t\t\tif (files.hasOwnProperty(i)\r\n\t\t\t\t\t\t\t&& files[i].mime != 'directory'\r\n\t\t\t\t\t\t\t&& files[i].phash == cwd\r\n\t\t\t\t\t\t\t&& $.inArray(i, remember) === -1) {\r\n\t\t\t\t\t\t\tdelete files[i];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcwd = data.cwd.hash;\r\n\t\t\t\tcache(data.files);\r\n\t\t\t\tif (!files[cwd]) {\r\n\t\t\t\t\tcache([data.cwd]);\r\n\t\t\t\t}\r\n\t\t\t\tself.lastDir(cwd);\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Store info about files/dirs in \"files\" object.\r\n\t\t\t *\r\n\t\t\t * @param  Array  files\r\n\t\t\t * @return void\r\n\t\t\t **/\r\n\t\t\tcache = function (data) {\r\n\t\t\t\tvar l = data.length, f;\r\n\r\n\t\t\t\twhile (l--) {\r\n\t\t\t\t\tf = data[l];\r\n\t\t\t\t\tif (f.name && f.hash && f.mime) {\r\n\t\t\t\t\t\tif (!f.phash) {\r\n\t\t\t\t\t\t\tvar name = 'volume_' + f.name,\r\n\t\t\t\t\t\t\t\ti18 = self.i18n(name);\r\n\r\n\t\t\t\t\t\t\tif (name != i18) {\r\n\t\t\t\t\t\t\t\tf.i18 = i18;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfiles[f.hash] = f;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Exec shortcut\r\n\t\t\t *\r\n\t\t\t * @param  jQuery.Event  keydown/keypress event\r\n\t\t\t * @return void\r\n\t\t\t */\r\n\t\t\texecShortcut = function (e) {\r\n\t\t\t\tvar code = e.keyCode,\r\n\t\t\t\t\tctrlKey = !!(e.ctrlKey || e.metaKey);\r\n\r\n\t\t\t\tif (enabled) {\r\n\r\n\t\t\t\t\t$.each(shortcuts, function (i, shortcut) {\r\n\t\t\t\t\t\tif (shortcut.type == e.type\r\n\t\t\t\t\t\t\t&& shortcut.keyCode == code\r\n\t\t\t\t\t\t\t&& shortcut.shiftKey == e.shiftKey\r\n\t\t\t\t\t\t\t&& shortcut.ctrlKey == ctrlKey\r\n\t\t\t\t\t\t\t&& shortcut.altKey == e.altKey) {\r\n\t\t\t\t\t\t\te.preventDefault()\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t\tshortcut.callback(e, self);\r\n\t\t\t\t\t\t\tself.debug('shortcut-exec', i + ' : ' + shortcut.description);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// prevent tab out of elfinder\r\n\t\t\t\t\tif (code == 9 && !$(e.target).is(':input')) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tdate = new Date(),\r\n\t\t\tutc,\r\n\t\t\ti18n\r\n\t\t\t;\r\n\r\n\r\n\t\t/**\r\n\t\t * Protocol version\r\n\t\t *\r\n\t\t * @type String\r\n\t\t **/\r\n\t\tthis.api = null;\r\n\r\n\t\t/**\r\n\t\t * elFinder use new api\r\n\t\t *\r\n\t\t * @type Boolean\r\n\t\t **/\r\n\t\tthis.newAPI = false;\r\n\r\n\t\t/**\r\n\t\t * elFinder use old api\r\n\t\t *\r\n\t\t * @type Boolean\r\n\t\t **/\r\n\t\tthis.oldAPI = false;\r\n\r\n\t\t/**\r\n\t\t * User os. Required to bind native shortcuts for open/rename\r\n\t\t *\r\n\t\t * @type String\r\n\t\t **/\r\n\t\tthis.OS = navigator.userAgent.indexOf('Mac') !== -1 ? 'mac' : navigator.userAgent.indexOf('Win') !== -1 ? 'win' : 'other';\r\n\r\n\t\t/**\r\n\t\t * User browser UA.\r\n\t\t * jQuery.browser: version deprecated: 1.3, removed: 1.9\r\n\t\t *\r\n\t\t * @type Object\r\n\t\t **/\r\n\t\tthis.UA = (function () {\r\n\t\t\tvar webkit = !document.uniqueID && !window.opera && !window.sidebar && window.localStorage && typeof window.orientation == \"undefined\";\r\n\t\t\treturn {\r\n\t\t\t\t// Browser IE <= IE 6\r\n\t\t\t\tltIE6: typeof window.addEventListener == \"undefined\" && typeof document.documentElement.style.maxHeight == \"undefined\",\r\n\t\t\t\t// Browser IE <= IE 7\r\n\t\t\t\tltIE7: typeof window.addEventListener == \"undefined\" && typeof document.querySelectorAll == \"undefined\",\r\n\t\t\t\t// Browser IE <= IE 8\r\n\t\t\t\tltIE8: typeof window.addEventListener == \"undefined\" && typeof document.getElementsByClassName == \"undefined\",\r\n\t\t\t\tIE: document.uniqueID,\r\n\t\t\t\tFirefox: window.sidebar,\r\n\t\t\t\tOpera: window.opera,\r\n\t\t\t\tWebkit: webkit,\r\n\t\t\t\tChrome: webkit && window.chrome,\r\n\t\t\t\tSafari: webkit && !window.chrome,\r\n\t\t\t\tMobile: typeof window.orientation != \"undefined\"\r\n\t\t\t}\r\n\t\t})();\r\n\r\n\t\t/**\r\n\t\t * Configuration options\r\n\t\t *\r\n\t\t * @type Object\r\n\t\t **/\r\n\t\tthis.options = $.extend(true, {}, this._options, opts || {});\r\n\r\n\t\tif (opts.ui) {\r\n\t\t\tthis.options.ui = opts.ui;\r\n\t\t}\r\n\r\n\t\tif (opts.commands) {\r\n\t\t\tthis.options.commands = opts.commands;\r\n\t\t}\r\n\r\n\t\tif (opts.uiOptions && opts.uiOptions.toolbar) {\r\n\t\t\tthis.options.uiOptions.toolbar = opts.uiOptions.toolbar;\r\n\t\t}\r\n\r\n\t\t$.extend(this.options.contextmenu, opts.contextmenu);\r\n\r\n\r\n\t\t/**\r\n\t\t * Ajax request type\r\n\t\t *\r\n\t\t * @type String\r\n\t\t * @default \"get\"\r\n\t\t **/\r\n\t\tthis.requestType = /^(get|post)$/i.test(this.options.requestType) ? this.options.requestType.toLowerCase() : 'get',\r\n\r\n\t\t/**\r\n\t\t * Any data to send across every ajax request\r\n\t\t *\r\n\t\t * @type Object\r\n\t\t * @default {}\r\n\t\t **/\r\n\t\t\tthis.customData = $.isPlainObject(this.options.customData) ? this.options.customData : {};\r\n\r\n\t\t/**\r\n\t\t * ID. Required to create unique cookie name\r\n\t\t *\r\n\t\t * @type String\r\n\t\t **/\r\n\t\tthis.id = id;\r\n\r\n\t\t/**\r\n\t\t * URL to upload files\r\n\t\t *\r\n\t\t * @type String\r\n\t\t **/\r\n\t\tthis.uploadURL = opts.urlUpload || opts.url;\r\n\r\n\t\t/**\r\n\t\t * Events namespace\r\n\t\t *\r\n\t\t * @type String\r\n\t\t **/\r\n\t\tthis.namespace = namespace;\r\n\r\n\t\t/**\r\n\t\t * Interface language\r\n\t\t *\r\n\t\t * @type String\r\n\t\t * @default \"en\"\r\n\t\t **/\r\n\t\tthis.lang = this.i18[this.options.lang] && this.i18[this.options.lang].messages ? this.options.lang : 'en';\r\n\r\n\t\ti18n = this.lang == 'en'\r\n\t\t\t? this.i18['en']\r\n\t\t\t: $.extend(true, {}, this.i18['en'], this.i18[this.lang]);\r\n\r\n\t\t/**\r\n\t\t * Interface direction\r\n\t\t *\r\n\t\t * @type String\r\n\t\t * @default \"ltr\"\r\n\t\t **/\r\n\t\tthis.direction = i18n.direction;\r\n\r\n\t\t/**\r\n\t\t * i18 messages\r\n\t\t *\r\n\t\t * @type Object\r\n\t\t **/\r\n\t\tthis.messages = i18n.messages;\r\n\r\n\t\t/**\r\n\t\t * Date/time format\r\n\t\t *\r\n\t\t * @type String\r\n\t\t * @default \"m.d.Y\"\r\n\t\t **/\r\n\t\tthis.dateFormat = this.options.dateFormat || i18n.dateFormat;\r\n\r\n\t\t/**\r\n\t\t * Date format like \"Yesterday 10:20:12\"\r\n\t\t *\r\n\t\t * @type String\r\n\t\t * @default \"{day} {time}\"\r\n\t\t **/\r\n\t\tthis.fancyFormat = this.options.fancyDateFormat || i18n.fancyDateFormat;\r\n\r\n\t\t/**\r\n\t\t * Today timestamp\r\n\t\t *\r\n\t\t * @type Number\r\n\t\t **/\r\n\t\tthis.today = (new Date(date.getFullYear(), date.getMonth(), date.getDate())).getTime() / 1000;\r\n\r\n\t\t/**\r\n\t\t * Yesterday timestamp\r\n\t\t *\r\n\t\t * @type Number\r\n\t\t **/\r\n\t\tthis.yesterday = this.today - 86400;\r\n\r\n\t\tutc = this.options.UTCDate ? 'UTC' : '';\r\n\r\n\t\tthis.getHours = 'get' + utc + 'Hours';\r\n\t\tthis.getMinutes = 'get' + utc + 'Minutes';\r\n\t\tthis.getSeconds = 'get' + utc + 'Seconds';\r\n\t\tthis.getDate = 'get' + utc + 'Date';\r\n\t\tthis.getDay = 'get' + utc + 'Day';\r\n\t\tthis.getMonth = 'get' + utc + 'Month';\r\n\t\tthis.getFullYear = 'get' + utc + 'FullYear';\r\n\r\n\t\t/**\r\n\t\t * Css classes\r\n\t\t *\r\n\t\t * @type String\r\n\t\t **/\r\n\t\tthis.cssClass = 'ui-widget ui-panel-body elfinder panel no-margin elfinder-' + (this.direction == 'rtl' ? 'rtl' : 'ltr') + ' ' + this.options.cssClass;\r\n\r\n\t\t/**\r\n\t\t * Method to store/fetch data\r\n\t\t *\r\n\t\t * @type Function\r\n\t\t **/\r\n\t\tthis.storage = (function () {\r\n\t\t\ttry {\r\n\t\t\t\treturn 'localStorage' in window && window['localStorage'] !== null ? self.localStorage : self.cookie;\r\n\t\t\t} catch (e) {\r\n\t\t\t\treturn self.cookie;\r\n\t\t\t}\r\n\t\t})();\r\n\r\n\t\tthis.viewType = this.storage('view') || this.options.defaultView || 'icons';\r\n\r\n\t\tthis.sortType = this.storage('sortType') || this.options.sortType || 'name';\r\n\r\n\t\tthis.sortOrder = this.storage('sortOrder') || this.options.sortOrder || 'asc';\r\n\r\n\t\tthis.sortStickFolders = this.storage('sortStickFolders');\r\n\r\n\t\tif (this.sortStickFolders === null) {\r\n\t\t\tthis.sortStickFolders = !!this.options.sortStickFolders;\r\n\t\t} else {\r\n\t\t\tthis.sortStickFolders = !!this.sortStickFolders\r\n\t\t}\r\n\r\n\t\tthis.sortRules = $.extend(true, {}, this._sortRules, this.options.sortsRules);\r\n\r\n\t\t$.each(this.sortRules, function (name, method) {\r\n\t\t\tif (typeof method != 'function') {\r\n\t\t\t\tdelete self.sortRules[name];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.compare = $.proxy(this.compare, this);\r\n\r\n\t\t/**\r\n\t\t * Delay in ms before open notification dialog\r\n\t\t *\r\n\t\t * @type Number\r\n\t\t * @default 500\r\n\t\t **/\r\n\t\tthis.notifyDelay = this.options.notifyDelay > 0 ? parseInt(this.options.notifyDelay) : 500;\r\n\r\n\t\t/**\r\n\t\t * Base draggable options\r\n\t\t *\r\n\t\t * @type Object\r\n\t\t **/\r\n\t\tthis.draggable = {\r\n\t\t\tappendTo: 'body',\r\n\t\t\taddClasses: true,\r\n\t\t\tdelay: 30,\r\n\t\t\tdistance: 8,\r\n\t\t\trevert: true,\r\n\t\t\trefreshPositions: true,\r\n\t\t\tcursor: 'move',\r\n\t\t\tcursorAt: {left: 50, top: 47},\r\n\t\t\tdrag: function (e, ui) {\r\n\t\t\t\tif (!ui.helper.data('locked')) {\r\n\t\t\t\t\tui.helper.toggleClass('elfinder-drag-helper-plus', e.shiftKey || e.ctrlKey || e.metaKey);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tstart: function (e, ui) {\r\n\t\t\t\tvar targets = $.map(ui.helper.data('files') || [], function (h) {\r\n\t\t\t\t\t\treturn h || null;\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tcnt, h;\r\n\t\t\t\tcnt = targets.length;\r\n\t\t\t\twhile (cnt--) {\r\n\t\t\t\t\th = targets[cnt];\r\n\t\t\t\t\tif (files[h].locked) {\r\n\t\t\t\t\t\tui.helper.addClass('elfinder-drag-helper-plus').data('locked', true);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tstop: function () {\r\n\t\t\t\tself.trigger('focus').trigger('dragstop');\r\n\t\t\t},\r\n\t\t\thelper: function (e, ui) {\r\n\t\t\t\tvar element = this.id ? $(this) : $(this).parents('[id]:first'),\r\n\t\t\t\t\thelper = $('<div class=\"elfinder-drag-helper\"><span class=\"elfinder-drag-helper-icon-plus\"/></div>'),\r\n\t\t\t\t\ticon = function (mime) {\r\n\t\t\t\t\t\treturn '<div class=\"elfinder-cwd-icon ' + self.mime2class(mime) + ' \"/>';\r\n\t\t\t\t\t},\r\n\t\t\t\t\thashes, l;\r\n\r\n\t\t\t\tself.trigger('dragstart', {target: element[0], originalEvent: e});\r\n\r\n\t\t\t\thashes = element.is('.' + self.res('class', 'cwdfile'))\r\n\t\t\t\t\t? self.selected()\r\n\t\t\t\t\t: [self.navId2Hash(element.attr('id'))];\r\n\r\n\t\t\t\thelper.append(icon(files[hashes[0]].mime)).data('files', hashes).data('locked', false);\r\n\r\n\t\t\t\tif ((l = hashes.length) > 1) {\r\n\t\t\t\t\thelper.append(icon(files[hashes[l - 1]].mime) + '<span class=\"elfinder-drag-num\">' + l + '</span>');\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn helper;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Base droppable options\r\n\t\t *\r\n\t\t * @type Object\r\n\t\t **/\r\n\t\tthis.droppable = {\r\n\t\t\ttolerance: 'pointer',\r\n\t\t\taccept: '.elfinder-cwd-file-wrapper,.elfinder-navbar-dir,.elfinder-cwd-file',\r\n\t\t\thoverClass: this.res('class', 'adroppable'),\r\n\t\t\tdrop: function (e, ui) {\r\n\t\t\t\tvar dst = $(this),\r\n\t\t\t\t\ttargets = $.map(ui.helper.data('files') || [], function (h) {\r\n\t\t\t\t\t\treturn h || null\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tresult = [],\r\n\t\t\t\t\tc = 'class',\r\n\t\t\t\t\tcnt, hash, i, h;\r\n\r\n\t\t\t\tif (dst.is('.' + self.res(c, 'cwd'))) {\r\n\t\t\t\t\thash = cwd;\r\n\t\t\t\t} else if (dst.is('.' + self.res(c, 'cwdfile'))) {\r\n\t\t\t\t\thash = dst.attr('id');\r\n\t\t\t\t} else if (dst.is('.' + self.res(c, 'navdir'))) {\r\n\t\t\t\t\thash = self.navId2Hash(dst.attr('id'));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcnt = targets.length;\r\n\r\n\t\t\t\twhile (cnt--) {\r\n\t\t\t\t\th = targets[cnt];\r\n\t\t\t\t\t// ignore drop into itself or in own location\r\n\t\t\t\t\th != hash && files[h].phash != hash && result.push(h);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (result.length) {\r\n\t\t\t\t\tui.helper.hide();\r\n\t\t\t\t\tself.clipboard(result, !(e.ctrlKey || e.shiftKey || e.metaKey || ui.helper.data('locked')));\r\n\t\t\t\t\tself.exec('paste', hash);\r\n\t\t\t\t\tself.trigger('drop', {files: targets});\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Return true if filemanager is active\r\n\t\t *\r\n\t\t * @return Boolean\r\n\t\t **/\r\n\t\tthis.enabled = function () {\r\n\t\t\treturn node.is(':visible') && enabled;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Return true if filemanager is visible\r\n\t\t *\r\n\t\t * @return Boolean\r\n\t\t **/\r\n\t\tthis.visible = function () {\r\n\t\t\treturn node.is(':visible');\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Return root dir hash for current working directory\r\n\t\t *\r\n\t\t * @return String\r\n\t\t */\r\n\t\tthis.root = function (hash) {\r\n\t\t\tvar dir = files[hash || cwd], i;\r\n\r\n\t\t\twhile (dir && dir.phash) {\r\n\t\t\t\tdir = files[dir.phash]\r\n\t\t\t}\r\n\t\t\tif (dir) {\r\n\t\t\t\treturn dir.hash;\r\n\t\t\t}\r\n\r\n\t\t\twhile (i in files && files.hasOwnProperty(i)) {\r\n\t\t\t\tdir = files[i]\r\n\t\t\t\tif (!dir.phash && !dir.mime == 'directory' && dir.read) {\r\n\t\t\t\t\treturn dir.hash\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn '';\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Return current working directory info\r\n\t\t *\r\n\t\t * @return Object\r\n\t\t */\r\n\t\tthis.cwd = function () {\r\n\t\t\treturn files[cwd] || {};\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Return required cwd option\r\n\t\t *\r\n\t\t * @param  String  option name\r\n\t\t * @return mixed\r\n\t\t */\r\n\t\tthis.option = function (name) {\r\n\t\t\treturn cwdOptions[name] || '';\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Return file data from current dir or tree by it's hash\r\n\t\t *\r\n\t\t * @param  String  file hash\r\n\t\t * @return Object\r\n\t\t */\r\n\t\tthis.file = function (hash) {\r\n\t\t\treturn files[hash];\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Return all cached files\r\n\t\t *\r\n\t\t * @return Array\r\n\t\t */\r\n\t\tthis.files = function () {\r\n\t\t\treturn $.extend(true, {}, files);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Return list of file parents hashes include file hash\r\n\t\t *\r\n\t\t * @param  String  file hash\r\n\t\t * @return Array\r\n\t\t */\r\n\t\tthis.parents = function (hash) {\r\n\t\t\tvar parents = [],\r\n\t\t\t\tdir;\r\n\r\n\t\t\twhile ((dir = this.file(hash))) {\r\n\t\t\t\tparents.unshift(dir.hash);\r\n\t\t\t\thash = dir.phash;\r\n\t\t\t}\r\n\t\t\treturn parents;\r\n\t\t}\r\n\r\n\t\tthis.path2array = function (hash, i18) {\r\n\t\t\tvar file,\r\n\t\t\t\tpath = [];\r\n\r\n\t\t\twhile (hash && (file = files[hash]) && file.hash) {\r\n\t\t\t\tpath.unshift(i18 && file.i18 ? file.i18 : file.name);\r\n\t\t\t\thash = file.phash;\r\n\t\t\t}\r\n\r\n\t\t\treturn path;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Return file path\r\n\t\t *\r\n\t\t * @param  Object  file\r\n\t\t * @return String\r\n\t\t */\r\n\t\tthis.path = function (hash, i18) {\r\n\t\t\treturn files[hash] && files[hash].path\r\n\t\t\t\t? files[hash].path\r\n\t\t\t\t: this.path2array(hash, i18).join(cwdOptions.separator);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Return file url if set\r\n\t\t *\r\n\t\t * @param  Object  file\r\n\t\t * @return String\r\n\t\t */\r\n\t\tthis.url = function (hash) {\r\n\t\t\tvar file = files[hash];\r\n\r\n\t\t\tif (!file || !file.read) {\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\r\n\t\t\tif (file.url) {\r\n\t\t\t\treturn file.url;\r\n\t\t\t}\r\n\r\n\t\t\tif (cwdOptions.url) {\r\n\t\t\t\treturn cwdOptions.url + $.map(this.path2array(hash), function (n) {\r\n\t\t\t\t\t\treturn encodeURIComponent(n);\r\n\t\t\t\t\t}).slice(1).join('/')\r\n\t\t\t}\r\n\r\n\t\t\tvar params = $.extend({}, this.customData, {\r\n\t\t\t\tcmd: 'file',\r\n\t\t\t\ttarget: file.hash\r\n\t\t\t});\r\n\t\t\tif (this.oldAPI) {\r\n\t\t\t\tparams.cmd = 'open';\r\n\t\t\t\tparams.current = file.phash;\r\n\t\t\t}\r\n\t\t\treturn this.options.url + (this.options.url.indexOf('?') === -1 ? '?' : '&') + $.param(params, true);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Return thumbnail url\r\n\t\t *\r\n\t\t * @param  String  file hash\r\n\t\t * @return String\r\n\t\t */\r\n\t\tthis.tmb = function (hash) {\r\n\t\t\tvar file = files[hash],\r\n\t\t\t\turl = file && file.tmb && file.tmb != 1 ? cwdOptions['tmbUrl'] + file.tmb : '';\r\n\r\n\t\t\tif (url && (this.UA.Opera || this.UA.IE)) {\r\n\t\t\t\turl += '?_=' + new Date().getTime();\r\n\t\t\t}\r\n\t\t\treturn url;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Return selected files hashes\r\n\t\t *\r\n\t\t * @return Array\r\n\t\t **/\r\n\t\tthis.selected = function () {\r\n\t\t\treturn selected.slice(0);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Return selected files info\r\n\t\t *\r\n\t\t * @return Array\r\n\t\t */\r\n\t\tthis.selectedFiles = function () {\r\n\t\t\treturn $.map(selected, function (hash) {\r\n\t\t\t\treturn files[hash] ? $.extend({}, files[hash]) : null\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Return true if file with required name existsin required folder\r\n\t\t *\r\n\t\t * @param  String  file name\r\n\t\t * @param  String  parent folder hash\r\n\t\t * @return Boolean\r\n\t\t */\r\n\t\tthis.fileByName = function (name, phash) {\r\n\t\t\tvar hash;\r\n\r\n\t\t\tfor (hash in files) {\r\n\t\t\t\tif (files.hasOwnProperty(hash) && files[hash].phash == phash && files[hash].name == name) {\r\n\t\t\t\t\treturn files[hash];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Valid data for required command based on rules\r\n\t\t *\r\n\t\t * @param  String  command name\r\n\t\t * @param  Object  cammand's data\r\n\t\t * @return Boolean\r\n\t\t */\r\n\t\tthis.validResponse = function (cmd, data) {\r\n\t\t\treturn data.error || this.rules[this.rules[cmd] ? cmd : 'defaults'](data);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Proccess ajax request.\r\n\t\t * Fired events :\r\n\t\t * @todo\r\n\t\t * @example\r\n\t\t * @todo\r\n\t\t * @return $.Deferred\r\n\t\t */\r\n\t\tthis.request = function (options) {\r\n\t\t\tvar self = this,\r\n\t\t\t\to = this.options,\r\n\t\t\t\tdfrd = $.Deferred(),\r\n\t\t\t// request data\r\n\t\t\t\tdata = $.extend({}, o.customData, {mimes: o.onlyMimes}, options.data || options),\r\n\t\t\t// command name\r\n\t\t\t\tcmd = data.cmd,\r\n\t\t\t// call default fail callback (display error dialog) ?\r\n\t\t\t\tdeffail = !(options.preventDefault || options.preventFail),\r\n\t\t\t// call default success callback ?\r\n\t\t\t\tdefdone = !(options.preventDefault || options.preventDone),\r\n\t\t\t// options for notify dialog\r\n\t\t\t\tnotify = $.extend({}, options.notify),\r\n\t\t\t// do not normalize data - return as is\r\n\t\t\t\traw = !!options.raw,\r\n\t\t\t// sync files on request fail\r\n\t\t\t\tsyncOnFail = options.syncOnFail,\r\n\t\t\t// open notify dialog timeout\r\n\t\t\t\ttimeout,\r\n\t\t\t// request options\r\n\t\t\t\toptions = $.extend({\r\n\t\t\t\t\turl: o.url,\r\n\t\t\t\t\tasync: true,\r\n\t\t\t\t\ttype: this.requestType,\r\n\t\t\t\t\tdataType: 'json',\r\n\t\t\t\t\tcache: false,\r\n\t\t\t\t\t// timeout  : 100,\r\n\t\t\t\t\tdata: data\r\n\t\t\t\t}, options.options || {}),\r\n\t\t\t\t/**\r\n\t\t\t\t * Default success handler.\r\n\t\t\t\t * Call default data handlers and fire event with command name.\r\n\t\t\t\t *\r\n\t\t\t\t * @param Object  normalized response data\r\n\t\t\t\t * @return void\r\n\t\t\t\t **/\r\n\t\t\t\tdone = function (data) {\r\n\t\t\t\t\tdata.warning && self.error(data.warning);\r\n\r\n\t\t\t\t\tcmd == 'open' && open($.extend(true, {}, data));\r\n\r\n\t\t\t\t\t// fire some event to update cache/ui\r\n\t\t\t\t\tdata.removed && data.removed.length && self.remove(data);\r\n\t\t\t\t\tdata.added && data.added.length && self.add(data);\r\n\t\t\t\t\tdata.changed && data.changed.length && self.change(data);\r\n\r\n\t\t\t\t\t// fire event with command name\r\n\t\t\t\t\tself.trigger(cmd, data);\r\n\r\n\t\t\t\t\t// force update content\r\n\t\t\t\t\tdata.sync && self.sync();\r\n\t\t\t\t},\r\n\t\t\t\t/**\r\n\t\t\t\t * Request error handler. Reject dfrd with correct error message.\r\n\t\t\t\t *\r\n\t\t\t\t * @param jqxhr  request object\r\n\t\t\t\t * @param String request status\r\n\t\t\t\t * @return void\r\n\t\t\t\t **/\r\n\t\t\t\terror = function (xhr, status) {\r\n\t\t\t\t\tvar error;\r\n\r\n\t\t\t\t\tswitch (status) {\r\n\t\t\t\t\t\tcase 'abort':\r\n\t\t\t\t\t\t\terror = xhr.quiet ? '' : ['errConnect', 'errAbort'];\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'timeout':\r\n\t\t\t\t\t\t\terror = ['errConnect', 'errTimeout'];\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 'parsererror':\r\n\t\t\t\t\t\t\terror = ['errResponse', 'errDataNotJSON'];\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tif (xhr.status == 403) {\r\n\t\t\t\t\t\t\t\terror = ['errConnect', 'errAccess'];\r\n\t\t\t\t\t\t\t} else if (xhr.status == 404) {\r\n\t\t\t\t\t\t\t\terror = ['errConnect', 'errNotFound'];\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\terror = 'errConnect';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdfrd.reject(error, xhr, status);\r\n\t\t\t\t},\r\n\t\t\t\t/**\r\n\t\t\t\t * Request success handler. Valid response data and reject/resolve dfrd.\r\n\t\t\t\t *\r\n\t\t\t\t * @param Object  response data\r\n\t\t\t\t * @param String request status\r\n\t\t\t\t * @return void\r\n\t\t\t\t **/\r\n\t\t\t\tsuccess = function (response) {\r\n\t\t\t\t\tif (raw) {\r\n\t\t\t\t\t\treturn dfrd.resolve(response);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!response) {\r\n\t\t\t\t\t\treturn dfrd.reject(['errResponse', 'errDataEmpty'], xhr);\r\n\t\t\t\t\t} else if (!$.isPlainObject(response)) {\r\n\t\t\t\t\t\treturn dfrd.reject(['errResponse', 'errDataNotJSON'], xhr);\r\n\t\t\t\t\t} else if (response.error) {\r\n\t\t\t\t\t\treturn dfrd.reject(response.error, xhr);\r\n\t\t\t\t\t} else if (!self.validResponse(cmd, response)) {\r\n\t\t\t\t\t\treturn dfrd.reject('errResponse', xhr);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tresponse = self.normalize(response);\r\n\r\n\t\t\t\t\tif (!self.api) {\r\n\t\t\t\t\t\tself.api = response.api || 1;\r\n\t\t\t\t\t\tself.newAPI = self.api >= 2;\r\n\t\t\t\t\t\tself.oldAPI = !self.newAPI;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (response.options) {\r\n\t\t\t\t\t\tcwdOptions = $.extend({}, cwdOptions, response.options);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (response.netDrivers) {\r\n\t\t\t\t\t\tself.netDrivers = response.netDrivers;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdfrd.resolve(response);\r\n\t\t\t\t\tresponse.debug && self.debug('backend-debug', response.debug);\r\n\t\t\t\t},\r\n\t\t\t\txhr, _xhr\r\n\t\t\t\t;\r\n\r\n\t\t\tdefdone && dfrd.done(done);\r\n\t\t\tdfrd.fail(function (error) {\r\n\t\t\t\tif (error) {\r\n\t\t\t\t\tdeffail ? self.error(error) : self.debug('error', self.i18n(error));\r\n\t\t\t\t}\r\n\t\t\t})\r\n\r\n\t\t\tif (!cmd) {\r\n\t\t\t\treturn dfrd.reject('errCmdReq');\r\n\t\t\t}\r\n\r\n\t\t\tif (syncOnFail) {\r\n\t\t\t\tdfrd.fail(function (error) {\r\n\t\t\t\t\terror && self.sync();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (notify.type && notify.cnt) {\r\n\t\t\t\ttimeout = setTimeout(function () {\r\n\t\t\t\t\tself.notify(notify);\r\n\t\t\t\t\tdfrd.always(function () {\r\n\t\t\t\t\t\tnotify.cnt = -(parseInt(notify.cnt) || 0);\r\n\t\t\t\t\t\tself.notify(notify);\r\n\t\t\t\t\t})\r\n\t\t\t\t}, self.notifyDelay)\r\n\r\n\t\t\t\tdfrd.always(function () {\r\n\t\t\t\t\tclearTimeout(timeout);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// quiet abort not completed \"open\" requests\r\n\t\t\tif (cmd == 'open') {\r\n\t\t\t\twhile ((_xhr = queue.pop())) {\r\n\t\t\t\t\tif (_xhr.state() == 'pending') {\r\n\t\t\t\t\t\t_xhr.quiet = true;\r\n\t\t\t\t\t\t_xhr.abort();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tdelete options.preventFail\r\n\r\n\t\t\txhr = this.transport.send(options).fail(error).done(success);\r\n\r\n\t\t\t// this.transport.send(options)\r\n\r\n\t\t\t// add \"open\" xhr into queue\r\n\t\t\tif (cmd == 'open') {\r\n\t\t\t\tqueue.unshift(xhr);\r\n\t\t\t\tdfrd.always(function () {\r\n\t\t\t\t\tvar ndx = $.inArray(xhr, queue);\r\n\r\n\t\t\t\t\tndx !== -1 && queue.splice(ndx, 1);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn dfrd;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Compare current files cache with new files and return diff\r\n\t\t *\r\n\t\t * @param  Array  new files\r\n\t\t * @return Object\r\n\t\t */\r\n\t\tthis.diff = function (incoming) {\r\n\t\t\tvar raw = {},\r\n\t\t\t\tadded = [],\r\n\t\t\t\tremoved = [],\r\n\t\t\t\tchanged = [],\r\n\t\t\t\tisChanged = function (hash) {\r\n\t\t\t\t\tvar l = changed.length;\r\n\r\n\t\t\t\t\twhile (l--) {\r\n\t\t\t\t\t\tif (changed[l].hash == hash) {\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t$.each(incoming, function (i, f) {\r\n\t\t\t\traw[f.hash] = f;\r\n\t\t\t});\r\n\r\n\t\t\t// find removed\r\n\t\t\t$.each(files, function (hash, f) {\r\n\t\t\t\t!raw[hash] && removed.push(hash);\r\n\t\t\t});\r\n\r\n\t\t\t// compare files\r\n\t\t\t$.each(raw, function (hash, file) {\r\n\t\t\t\tvar origin = files[hash];\r\n\r\n\t\t\t\tif (!origin) {\r\n\t\t\t\t\tadded.push(file);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$.each(file, function (prop) {\r\n\t\t\t\t\t\tif (file[prop] != origin[prop]) {\r\n\t\t\t\t\t\t\tchanged.push(file)\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// parents of removed dirs mark as changed (required for tree correct work)\r\n\t\t\t$.each(removed, function (i, hash) {\r\n\t\t\t\tvar file = files[hash],\r\n\t\t\t\t\tphash = file.phash;\r\n\r\n\t\t\t\tif (phash\r\n\t\t\t\t\t&& file.mime == 'directory'\r\n\t\t\t\t\t&& $.inArray(phash, removed) === -1\r\n\t\t\t\t\t&& raw[phash]\r\n\t\t\t\t\t&& !isChanged(phash)) {\r\n\t\t\t\t\tchanged.push(raw[phash]);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn {\r\n\t\t\t\tadded: added,\r\n\t\t\t\tremoved: removed,\r\n\t\t\t\tchanged: changed\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Sync content\r\n\t\t *\r\n\t\t * @return jQuery.Deferred\r\n\t\t */\r\n\t\tthis.sync = function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tdfrd = $.Deferred().done(function () {\r\n\t\t\t\t\tself.trigger('sync');\r\n\t\t\t\t}),\r\n\t\t\t\topts1 = {\r\n\t\t\t\t\tdata: {cmd: 'open', init: 1, target: cwd, tree: this.ui.tree ? 1 : 0},\r\n\t\t\t\t\tpreventDefault: true\r\n\t\t\t\t},\r\n\t\t\t\topts2 = {\r\n\t\t\t\t\tdata: {cmd: 'tree', target: (cwd == this.root()) ? cwd : this.file(cwd).phash},\r\n\t\t\t\t\tpreventDefault: true\r\n\t\t\t\t};\r\n\r\n\t\t\t$.when(\r\n\t\t\t\tthis.request(opts1),\r\n\t\t\t\tthis.request(opts2)\r\n\t\t\t)\r\n\t\t\t\t.fail(function (error) {\r\n\t\t\t\t\tdfrd.reject(error);\r\n\t\t\t\t\terror && self.request({\r\n\t\t\t\t\t\tdata: {cmd: 'open', target: self.lastDir(''), tree: 1, init: 1},\r\n\t\t\t\t\t\tnotify: {type: 'open', cnt: 1, hideCnt: true},\r\n\t\t\t\t\t\tpreventDefault: true\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.done(function (odata, pdata) {\r\n\t\t\t\t\tvar diff = self.diff(odata.files.concat(pdata && pdata.tree ? pdata.tree : []));\r\n\r\n\t\t\t\t\tdiff.added.push(odata.cwd)\r\n\t\t\t\t\tdiff.removed.length && self.remove(diff);\r\n\t\t\t\t\tdiff.added.length && self.add(diff);\r\n\t\t\t\t\tdiff.changed.length && self.change(diff);\r\n\t\t\t\t\treturn dfrd.resolve(diff);\r\n\t\t\t\t});\r\n\r\n\t\t\treturn dfrd;\r\n\t\t}\r\n\r\n\t\tthis.upload = function (files) {\r\n\t\t\treturn this.transport.upload(files, this);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Attach listener to events\r\n\t\t * To bind to multiply events at once, separate events names by space\r\n\t\t *\r\n\t\t * @param  String  event(s) name(s)\r\n\t\t * @param  Object  event handler\r\n\t\t * @return elFinder\r\n\t\t */\r\n\t\tthis.bind = function (event, callback) {\r\n\t\t\tvar i;\r\n\r\n\t\t\tif (typeof(callback) == 'function') {\r\n\t\t\t\tevent = ('' + event).toLowerCase().split(/\\s+/);\r\n\r\n\t\t\t\tfor (i = 0; i < event.length; i++) {\r\n\t\t\t\t\tif (listeners[event[i]] === void(0)) {\r\n\t\t\t\t\t\tlisteners[event[i]] = [];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlisteners[event[i]].push(callback);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Remove event listener if exists\r\n\t\t *\r\n\t\t * @param  String    event name\r\n\t\t * @param  Function  callback\r\n\t\t * @return elFinder\r\n\t\t */\r\n\t\tthis.unbind = function (event, callback) {\r\n\t\t\tvar l = listeners[('' + event).toLowerCase()] || [],\r\n\t\t\t\ti = l.indexOf(callback);\r\n\r\n\t\t\ti > -1 && l.splice(i, 1);\r\n\t\t\t//delete callback; // need this?\r\n\t\t\tcallback = null\r\n\t\t\treturn this;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Fire event - send notification to all event listeners\r\n\t\t *\r\n\t\t * @param  String   event type\r\n\t\t * @param  Object   data to send across event\r\n\t\t * @return elFinder\r\n\t\t */\r\n\t\tthis.trigger = function (event, data) {\r\n\t\t\tvar event = event.toLowerCase(),\r\n\t\t\t\thandlers = listeners[event] || [], i, j;\r\n\r\n\t\t\tthis.debug('event-' + event, data)\r\n\r\n\t\t\tif (handlers.length) {\r\n\t\t\t\tevent = $.Event(event);\r\n\r\n\t\t\t\tfor (i = 0; i < handlers.length; i++) {\r\n\t\t\t\t\t// to avoid data modifications. remember about \"sharing\" passing arguments in js :)\r\n\t\t\t\t\tevent.data = $.extend(true, {}, data);\r\n\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tif (handlers[i](event, this) === false\r\n\t\t\t\t\t\t\t|| event.isDefaultPrevented()) {\r\n\t\t\t\t\t\t\tthis.debug('event-stoped', event.type);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch (ex) {\r\n\t\t\t\t\t\twindow.console && window.console.log && window.console.log(ex);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Bind keybord shortcut to keydown event\r\n\t\t *\r\n\t\t * @example\r\n\t\t *    elfinder.shortcut({\r\n\t *       pattern : 'ctrl+a', \r\n\t *       description : 'Select all files', \r\n\t *       callback : function(e) { ... }, \r\n\t *       keypress : true|false (bind to keypress instead of keydown) \r\n\t *    })\r\n\t\t *\r\n\t\t * @param  Object  shortcut config\r\n\t\t * @return elFinder\r\n\t\t */\r\n\t\tthis.shortcut = function (s) {\r\n\t\t\tvar patterns, pattern, code, i, parts;\r\n\r\n\t\t\tif (this.options.allowShortcuts && s.pattern && $.isFunction(s.callback)) {\r\n\t\t\t\tpatterns = s.pattern.toUpperCase().split(/\\s+/);\r\n\r\n\t\t\t\tfor (i = 0; i < patterns.length; i++) {\r\n\t\t\t\t\tpattern = patterns[i]\r\n\t\t\t\t\tparts = pattern.split('+');\r\n\t\t\t\t\tcode = (code = parts.pop()).length == 1\r\n\t\t\t\t\t\t? code > 0 ? code : code.charCodeAt(0)\r\n\t\t\t\t\t\t: $.ui.keyCode[code];\r\n\r\n\t\t\t\t\tif (code && !shortcuts[pattern]) {\r\n\t\t\t\t\t\tshortcuts[pattern] = {\r\n\t\t\t\t\t\t\tkeyCode: code,\r\n\t\t\t\t\t\t\taltKey: $.inArray('ALT', parts) != -1,\r\n\t\t\t\t\t\t\tctrlKey: $.inArray('CTRL', parts) != -1,\r\n\t\t\t\t\t\t\tshiftKey: $.inArray('SHIFT', parts) != -1,\r\n\t\t\t\t\t\t\ttype: s.type || 'keydown',\r\n\t\t\t\t\t\t\tcallback: s.callback,\r\n\t\t\t\t\t\t\tdescription: s.description,\r\n\t\t\t\t\t\t\tpattern: pattern\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Registered shortcuts\r\n\t\t *\r\n\t\t * @type Object\r\n\t\t **/\r\n\t\tthis.shortcuts = function () {\r\n\t\t\tvar ret = [];\r\n\r\n\t\t\t$.each(shortcuts, function (i, s) {\r\n\t\t\t\tret.push([s.pattern, self.i18n(s.description)]);\r\n\t\t\t});\r\n\t\t\treturn ret;\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * Get/set clipboard content.\r\n\t\t * Return new clipboard content.\r\n\t\t *\r\n\t\t * @example\r\n\t\t *   this.clipboard([]) - clean clipboard\r\n\t\t *   this.clipboard([{...}, {...}], true) - put 2 files in clipboard and mark it as cutted\r\n\t\t *\r\n\t\t * @param  Array    new files hashes\r\n\t\t * @param  Boolean  cut files?\r\n\t\t * @return Array\r\n\t\t */\r\n\t\tthis.clipboard = function (hashes, cut) {\r\n\t\t\tvar map = function () {\r\n\t\t\t\treturn $.map(clipboard, function (f) {\r\n\t\t\t\t\treturn f.hash\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (hashes !== void(0)) {\r\n\t\t\t\tclipboard.length && this.trigger('unlockfiles', {files: map()});\r\n\t\t\t\tremember = [];\r\n\r\n\t\t\t\tclipboard = $.map(hashes || [], function (hash) {\r\n\t\t\t\t\tvar file = files[hash];\r\n\t\t\t\t\tif (file) {\r\n\r\n\t\t\t\t\t\tremember.push(hash);\r\n\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\thash: hash,\r\n\t\t\t\t\t\t\tphash: file.phash,\r\n\t\t\t\t\t\t\tname: file.name,\r\n\t\t\t\t\t\t\tmime: file.mime,\r\n\t\t\t\t\t\t\tread: file.read,\r\n\t\t\t\t\t\t\tlocked: file.locked,\r\n\t\t\t\t\t\t\tcut: !!cut\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t});\r\n\t\t\t\tthis.trigger('changeclipboard', {clipboard: clipboard.slice(0, clipboard.length)});\r\n\t\t\t\tcut && this.trigger('lockfiles', {files: map()});\r\n\t\t\t}\r\n\r\n\t\t\t// return copy of clipboard instead of refrence\r\n\t\t\treturn clipboard.slice(0, clipboard.length);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Return true if command enabled\r\n\t\t *\r\n\t\t * @param  String  command name\r\n\t\t * @return Boolean\r\n\t\t */\r\n\t\tthis.isCommandEnabled = function (name) {\r\n\t\t\treturn this._commands[name] ? $.inArray(name, cwdOptions.disabled) === -1 : false;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Exec command and return result;\r\n\t\t *\r\n\t\t * @param  String         command name\r\n\t\t * @param  String|Array   usualy files hashes\r\n\t\t * @param  String|Array   command options\r\n\t\t * @return $.Deferred\r\n\t\t */\r\n\t\tthis.exec = function (cmd, files, opts) {\r\n\t\t\treturn this._commands[cmd] && this.isCommandEnabled(cmd)\r\n\t\t\t\t? this._commands[cmd].exec(files, opts)\r\n\t\t\t\t: $.Deferred().reject('No such command');\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Create and return dialog.\r\n\t\t *\r\n\t\t * @param  String|DOMElement  dialog content\r\n\t\t * @param  Object             dialog options\r\n\t\t * @return jQuery\r\n\t\t */\r\n\t\tthis.dialog = function (content, options) {\r\n\t\t\treturn $('<div/>').append(content).appendTo(node).elfinderdialog(options);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Return UI widget or node\r\n\t\t *\r\n\t\t * @param  String  ui name\r\n\t\t * @return jQuery\r\n\t\t */\r\n\t\tthis.getUI = function (ui) {\r\n\t\t\treturn this.ui[ui] || node;\r\n\t\t}\r\n\r\n\t\tthis.command = function (name) {\r\n\t\t\treturn name === void(0) ? this._commands : this._commands[name];\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Resize elfinder node\r\n\t\t *\r\n\t\t * @param  String|Number  width\r\n\t\t * @param  Number         height\r\n\t\t * @return void\r\n\t\t */\r\n\t\tthis.resize = function (w, h) {\r\n\t\t\tnode.css('width', w).height(h).trigger('resize');\r\n\t\t\tthis.trigger('resize', {width: node.width(), height: node.height()});\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Restore elfinder node size\r\n\t\t *\r\n\t\t * @return elFinder\r\n\t\t */\r\n\t\tthis.restoreSize = function () {\r\n\t\t\tthis.resize(width, height);\r\n\t\t}\r\n\r\n\t\tthis.show = function () {\r\n\t\t\tnode.show();\r\n\t\t\tthis.enable().trigger('show');\r\n\t\t}\r\n\r\n\t\tthis.hide = function () {\r\n\t\t\tthis.disable().trigger('hide');\r\n\t\t\tnode.hide();\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Destroy this elFinder instance\r\n\t\t *\r\n\t\t * @return void\r\n\t\t **/\r\n\t\tthis.destroy = function () {\r\n\t\t\tif (node && node[0].elfinder) {\r\n\t\t\t\tthis.trigger('destroy').disable();\r\n\t\t\t\tlisteners = {};\r\n\t\t\t\tshortcuts = {};\r\n\t\t\t\t$(document).add(node).unbind('.' + this.namespace);\r\n\t\t\t\tself.trigger = function () {\r\n\t\t\t\t}\r\n\t\t\t\tnode.children().remove();\r\n\t\t\t\tnode.append(prevContent.contents()).removeClass(this.cssClass).attr('style', prevStyle);\r\n\t\t\t\tnode[0].elfinder = null;\r\n\t\t\t\tif (syncInterval) {\r\n\t\t\t\t\tclearInterval(syncInterval);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/*************  init stuffs  ****************/\r\n\r\n\t\t// check jquery ui\r\n\t\tif (!($.fn.selectable && $.fn.draggable && $.fn.droppable)) {\r\n\t\t\treturn alert(this.i18n('errJqui'));\r\n\t\t}\r\n\r\n\t\t// check node\r\n\t\tif (!node.length) {\r\n\t\t\treturn alert(this.i18n('errNode'));\r\n\t\t}\r\n\t\t// check connector url\r\n\t\tif (!this.options.url) {\r\n\t\t\treturn alert(this.i18n('errURL'));\r\n\t\t}\r\n\r\n\t\t$.extend($.ui.keyCode, {\r\n\t\t\t'F1': 112,\r\n\t\t\t'F2': 113,\r\n\t\t\t'F3': 114,\r\n\t\t\t'F4': 115,\r\n\t\t\t'F5': 116,\r\n\t\t\t'F6': 117,\r\n\t\t\t'F7': 118,\r\n\t\t\t'F8': 119,\r\n\t\t\t'F9': 120\r\n\t\t});\r\n\r\n\t\tthis.dragUpload = false;\r\n\t\tthis.xhrUpload = (typeof XMLHttpRequestUpload != 'undefined' || typeof XMLHttpRequestEventTarget != 'undefined') && typeof File != 'undefined' && typeof FormData != 'undefined';\r\n\r\n\t\t// configure transport object\r\n\t\tthis.transport = {}\r\n\r\n\t\tif (typeof(this.options.transport) == 'object') {\r\n\t\t\tthis.transport = this.options.transport;\r\n\t\t\tif (typeof(this.transport.init) == 'function') {\r\n\t\t\t\tthis.transport.init(this)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (typeof(this.transport.send) != 'function') {\r\n\t\t\tthis.transport.send = function (opts) {\r\n\t\t\t\treturn $.ajax(opts);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.transport.upload == 'iframe') {\r\n\t\t\tthis.transport.upload = $.proxy(this.uploads.iframe, this);\r\n\t\t} else if (typeof(this.transport.upload) == 'function') {\r\n\t\t\tthis.dragUpload = !!this.options.dragUploadAllow;\r\n\t\t} else if (this.xhrUpload && !!this.options.dragUploadAllow) {\r\n\t\t\tthis.transport.upload = $.proxy(this.uploads.xhr, this);\r\n\t\t\tthis.dragUpload = true;\r\n\t\t} else {\r\n\t\t\tthis.transport.upload = $.proxy(this.uploads.iframe, this);\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Alias for this.trigger('error', {error : 'message'})\r\n\t\t *\r\n\t\t * @param  String  error message\r\n\t\t * @return elFinder\r\n\t\t **/\r\n\t\tthis.error = function () {\r\n\t\t\tvar arg = arguments[0];\r\n\t\t\treturn arguments.length == 1 && typeof(arg) == 'function'\r\n\t\t\t\t? self.bind('error', arg)\r\n\t\t\t\t: self.trigger('error', {error: arg});\r\n\t\t}\r\n\r\n\t\t// create bind/trigger aliases for build-in events\r\n\t\t$.each(['enable', 'disable', 'load', 'open', 'reload', 'select', 'add', 'remove', 'change', 'dblclick', 'getfile', 'lockfiles', 'unlockfiles', 'dragstart', 'dragstop', 'search', 'searchend', 'viewchange'], function (i, name) {\r\n\t\t\tself[name] = function () {\r\n\t\t\t\tvar arg = arguments[0];\r\n\t\t\t\treturn arguments.length == 1 && typeof(arg) == 'function'\r\n\t\t\t\t\t? self.bind(name, arg)\r\n\t\t\t\t\t: self.trigger(name, $.isPlainObject(arg) ? arg : {});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// bind core event handlers\r\n\t\tthis\r\n\t\t\t.enable(function () {\r\n\t\t\t\tif (!enabled && self.visible() && self.ui.overlay.is(':hidden')) {\r\n\t\t\t\t\tenabled = true;\r\n\t\t\t\t\t$('textarea:focus, input:focus, button').blur();\r\n\t\t\t\t\tnode.removeClass('elfinder-disabled');\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.disable(function () {\r\n\t\t\t\tprevEnabled = enabled;\r\n\t\t\t\tenabled = false;\r\n\t\t\t\tnode.addClass('elfinder-disabled');\r\n\t\t\t})\r\n\t\t\t.open(function () {\r\n\t\t\t\tselected = [];\r\n\t\t\t})\r\n\t\t\t.select(function (e) {\r\n\t\t\t\tselected = $.map(e.data.selected || e.data.value || [], function (hash) {\r\n\t\t\t\t\treturn files[hash] ? hash : null;\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.error(function (e) {\r\n\t\t\t\tvar opts = {\r\n\t\t\t\t\tcssClass: 'elfinder-dialog-error',\r\n\t\t\t\t\ttitle: self.i18n(self.i18n('error')),\r\n\t\t\t\t\tresizable: false,\r\n\t\t\t\t\tdestroyOnClose: true,\r\n\t\t\t\t\tbuttons: {}\r\n\t\t\t\t};\r\n\r\n\t\t\t\topts.buttons[self.i18n(self.i18n('btnClose'))] = function () {\r\n\t\t\t\t\t$(this).elfinderdialog('close');\r\n\t\t\t\t};\r\n\r\n\t\t\t\tself.dialog('<span class=\"elfinder-dialog-icon elfinder-dialog-icon-error\"/>' + self.i18n(e.data.error), opts);\r\n\t\t\t})\r\n\t\t\t.bind('tree parents', function (e) {\r\n\t\t\t\tcache(e.data.tree || []);\r\n\t\t\t})\r\n\t\t\t.bind('tmb', function (e) {\r\n\t\t\t\t$.each(e.data.images || [], function (hash, tmb) {\r\n\t\t\t\t\tif (files[hash]) {\r\n\t\t\t\t\t\tfiles[hash].tmb = tmb;\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t\t.add(function (e) {\r\n\t\t\t\tcache(e.data.added || []);\r\n\t\t\t})\r\n\t\t\t.change(function (e) {\r\n\t\t\t\t$.each(e.data.changed || [], function (i, file) {\r\n\t\t\t\t\tvar hash = file.hash;\r\n\t\t\t\t\tif ((files[hash].width && !file.width) || (files[hash].height && !file.height)) {\r\n\t\t\t\t\t\tfiles[hash].width = undefined;\r\n\t\t\t\t\t\tfiles[hash].height = undefined;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfiles[hash] = files[hash] ? $.extend(files[hash], file) : file;\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.remove(function (e) {\r\n\t\t\t\tvar removed = e.data.removed || [],\r\n\t\t\t\t\tl = removed.length,\r\n\t\t\t\t\trm = function (hash) {\r\n\t\t\t\t\t\tvar file = files[hash];\r\n\t\t\t\t\t\tif (file) {\r\n\t\t\t\t\t\t\tif (file.mime == 'directory' && file.dirs) {\r\n\t\t\t\t\t\t\t\t$.each(files, function (h, f) {\r\n\t\t\t\t\t\t\t\t\tf.phash == hash && rm(h);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tdelete files[hash];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\twhile (l--) {\r\n\t\t\t\t\trm(removed[l]);\r\n\t\t\t\t}\r\n\r\n\t\t\t})\r\n\t\t\t.bind('search', function (e) {\r\n\t\t\t\tcache(e.data.files);\r\n\t\t\t})\r\n\t\t\t.bind('rm', function (e) {\r\n\t\t\t\tvar play = beeper.canPlayType && beeper.canPlayType('audio/wav; codecs=\"1\"');\r\n\r\n\t\t\t\tplay && play != '' && play != 'no' && $(beeper).html('<source src=\"./sounds/rm.wav\" type=\"audio/wav\">')[0].play()\r\n\t\t\t})\r\n\r\n\t\t;\r\n\r\n\t\t// bind external event handlers\r\n\t\t$.each(this.options.handlers, function (event, callback) {\r\n\t\t\tself.bind(event, callback);\r\n\t\t});\r\n\r\n\t\t/**\r\n\t\t * History object. Store visited folders\r\n\t\t *\r\n\t\t * @type Object\r\n\t\t **/\r\n\t\tthis.history = new this.history(this);\r\n\r\n\t\t// in getFileCallback set - change default actions on double click/enter/ctrl+enter\r\n\t\tif (typeof(this.options.getFileCallback) == 'function' && this.commands.getfile) {\r\n\t\t\tthis.bind('dblclick', function (e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tself.exec('getfile').fail(function () {\r\n\t\t\t\t\tself.exec('open');\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tthis.shortcut({\r\n\t\t\t\tpattern: 'enter',\r\n\t\t\t\tdescription: this.i18n('cmdgetfile'),\r\n\t\t\t\tcallback: function () {\r\n\t\t\t\t\tself.exec('getfile').fail(function () {\r\n\t\t\t\t\t\tself.exec(self.OS == 'mac' ? 'rename' : 'open')\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t\t.shortcut({\r\n\t\t\t\t\tpattern: 'ctrl+enter',\r\n\t\t\t\t\tdescription: this.i18n(this.OS == 'mac' ? 'cmdrename' : 'cmdopen'),\r\n\t\t\t\t\tcallback: function () {\r\n\t\t\t\t\t\tself.exec(self.OS == 'mac' ? 'rename' : 'open')\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Loaded commands\r\n\t\t *\r\n\t\t * @type Object\r\n\t\t **/\r\n\t\tthis._commands = {};\r\n\r\n\t\tif (!$.isArray(this.options.commands)) {\r\n\t\t\tthis.options.commands = [];\r\n\t\t}\r\n\t\t// check required commands\r\n\t\t$.each(['open', 'reload', 'back', 'forward', 'up', 'home', 'info', 'quicklook', 'getfile', 'help'], function (i, cmd) {\r\n\t\t\t$.inArray(cmd, self.options.commands) === -1 && self.options.commands.push(cmd);\r\n\t\t});\r\n\r\n\t\t// load commands\r\n\t\t$.each(this.options.commands, function (i, name) {\r\n\t\t\tvar cmd = self.commands[name];\r\n\t\t\tif ($.isFunction(cmd) && !self._commands[name]) {\r\n\t\t\t\tcmd.prototype = base;\r\n\t\t\t\tself._commands[name] = new cmd();\r\n\t\t\t\tself._commands[name].setup(name, self.options.commandsOptions[name] || {});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// prepare node\r\n\t\tnode.addClass(this.cssClass)\r\n\t\t\t.bind(mousedown, function () {\r\n\t\t\t\t!enabled && self.enable();\r\n\t\t\t});\r\n\r\n\t\t/**\r\n\t\t * UI nodes\r\n\t\t *\r\n\t\t * @type Object\r\n\t\t **/\r\n\t\tthis.ui = {\r\n\t\t\t// container for nav panel and current folder container\r\n\t\t\tworkzone: $('<div/>').appendTo(node).elfinderworkzone(this),\r\n\t\t\t// container for folders tree / places\r\n\t\t\tnavbar: $('<div/>').appendTo(node).elfindernavbar(this, this.options.uiOptions.navbar || {}),\r\n\t\t\t// contextmenu\r\n\t\t\tcontextmenu: $('<div/>').appendTo(node).elfindercontextmenu(this),\r\n\t\t\t// overlay\r\n\t\t\toverlay: $('<div/>').appendTo(node).elfinderoverlay({\r\n\t\t\t\tshow: function () {\r\n\t\t\t\t\tself.disable();\r\n\t\t\t\t},\r\n\t\t\t\thide: function () {\r\n\t\t\t\t\tprevEnabled && self.enable();\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t\t// current folder container\r\n\t\t\tcwd: $('<div/>').appendTo(node).elfindercwd(this, this.options.uiOptions.cwd || {}),\r\n\t\t\t// notification dialog window\r\n\t\t\tnotify: this.dialog('', {\r\n\t\t\t\tcssClass: 'elfinder-dialog-notify',\r\n\t\t\t\tposition: {top: '12px', right: '12px'},\r\n\t\t\t\tresizable: false,\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\ttitle: '&nbsp;',\r\n\t\t\t\twidth: 280\r\n\t\t\t}),\r\n\t\t\tstatusbar: $('<div class=\"panel-footer elfinder-statusbar\"/>').hide().appendTo(node)\r\n\t\t}\r\n\r\n\t\t// load required ui\r\n\t\t$.each(this.options.ui || [], function (i, ui) {\r\n\t\t\tvar name = 'elfinder' + ui,\r\n\t\t\t\topts = self.options.uiOptions[ui] || {};\r\n\r\n\t\t\tif (!self.ui[ui] && $.fn[name]) {\r\n\t\t\t\tself.ui[ui] = $('<' + (opts.tag || 'div') + '/>').appendTo(node)[name](self, opts);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\r\n\t\t// store instance in node\r\n\t\tnode[0].elfinder = this;\r\n\r\n\t\t// make node resizable\r\n\t\tthis.options.resizable\r\n\t\t&& $.fn.resizable\r\n\t\t&& node.resizable({\r\n\t\t\thandles: 'se',\r\n\t\t\tminWidth: 300,\r\n\t\t\tminHeight: 200\r\n\t\t});\r\n\r\n\t\tif (this.options.width) {\r\n\t\t\twidth = this.options.width;\r\n\t\t}\r\n\r\n\t\tif (this.options.height) {\r\n\t\t\theight = parseInt(this.options.height);\r\n\t\t}\r\n\r\n\t\t// update size\r\n\t\tself.resize(width, height);\r\n\r\n\t\t// attach events to document\r\n\t\t$(document)\r\n\t\t\t// disable elfinder on click outside elfinder\r\n\t\t\t.bind('click.' + this.namespace, function (e) {\r\n\t\t\t\tenabled && !$(e.target).closest(node).length && self.disable();\r\n\t\t\t})\r\n\t\t\t// exec shortcuts\r\n\t\t\t.bind(keydown + ' ' + keypress, execShortcut);\r\n\r\n\t\t// attach events to window\r\n\t\tself.options.useBrowserHistory && $(window)\r\n\t\t\t.on('popstate', function (ev) {\r\n\t\t\t\tvar target = ev.originalEvent.state && ev.originalEvent.state.thash;\r\n\t\t\t\ttarget && !$.isEmptyObject(self.files()) && self.request({\r\n\t\t\t\t\tdata: {cmd: 'open', target: target, onhistory: 1},\r\n\t\t\t\t\tnotify: {type: 'open', cnt: 1, hideCnt: true},\r\n\t\t\t\t\tsyncOnFail: true\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t// send initial request and start to pray >_<\r\n\t\tthis.trigger('init')\r\n\t\t\t.request({\r\n\t\t\t\tdata: {cmd: 'open', target: self.startDir(), init: 1, tree: this.ui.tree ? 1 : 0},\r\n\t\t\t\tpreventDone: true,\r\n\t\t\t\tnotify: {type: 'open', cnt: 1, hideCnt: true},\r\n\t\t\t\tfreeze: true\r\n\t\t\t})\r\n\t\t\t.fail(function () {\r\n\t\t\t\tself.trigger('fail').disable().lastDir('');\r\n\t\t\t\tlisteners = {};\r\n\t\t\t\tshortcuts = {};\r\n\t\t\t\t$(document).add(node).unbind('.' + this.namespace);\r\n\t\t\t\tself.trigger = function () {\r\n\t\t\t\t};\r\n\t\t\t})\r\n\t\t\t.done(function (data) {\r\n\t\t\t\tself.load().debug('api', self.api);\r\n\t\t\t\tdata = $.extend(true, {}, data);\r\n\t\t\t\topen(data);\r\n\t\t\t\tself.trigger('open', data);\r\n\t\t\t});\r\n\r\n\t\t// update ui's size after init\r\n\t\tthis.one('load', function () {\r\n\t\t\tnode.trigger('resize');\r\n\t\t\tif (self.options.sync > 1000) {\r\n\t\t\t\tsyncInterval = setInterval(function () {\r\n\t\t\t\t\tself.sync();\r\n\t\t\t\t}, self.options.sync)\r\n\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t\t// self.timeEnd('load');\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Prototype\r\n\t *\r\n\t * @type  Object\r\n\t */\r\n\telFinder.prototype = {\r\n\r\n\t\tres: function (type, id) {\r\n\t\t\treturn this.resources[type] && this.resources[type][id];\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Internationalization object\r\n\t\t *\r\n\t\t * @type  Object\r\n\t\t */\r\n\t\ti18: {\r\n\t\t\ten: {\r\n\t\t\t\ttranslator: '',\r\n\t\t\t\tlanguage: 'English',\r\n\t\t\t\tdirection: 'ltr',\r\n\t\t\t\tdateFormat: 'd.m.Y H:i',\r\n\t\t\t\tfancyDateFormat: '$1 H:i',\r\n\t\t\t\tmessages: {}\r\n\t\t\t},\r\n\t\t\tmonths: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],\r\n\t\t\tmonthsShort: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],\r\n\r\n\t\t\tdays: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],\r\n\t\t\tdaysShort: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * File mimetype to kind mapping\r\n\t\t *\r\n\t\t * @type  Object\r\n\t\t */\r\n\t\tkinds: {\r\n\t\t\t'unknown': 'Unknown',\r\n\t\t\t'directory': 'Folder',\r\n\t\t\t'symlink': 'Alias',\r\n\t\t\t'symlink-broken': 'AliasBroken',\r\n\t\t\t'application/x-empty': 'TextPlain',\r\n\t\t\t'application/postscript': 'Postscript',\r\n\t\t\t'application/vnd.ms-office': 'MsOffice',\r\n\t\t\t'application/vnd.ms-word': 'MsWord',\r\n\t\t\t'application/vnd.openxmlformats-officedocument.wordprocessingml.document': 'MsWord',\r\n\t\t\t'application/vnd.ms-word.document.macroEnabled.12': 'MsWord',\r\n\t\t\t'application/vnd.openxmlformats-officedocument.wordprocessingml.template': 'MsWord',\r\n\t\t\t'application/vnd.ms-word.template.macroEnabled.12': 'MsWord',\r\n\t\t\t'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': 'MsWord',\r\n\t\t\t'application/vnd.ms-excel': 'MsExcel',\r\n\t\t\t'application/vnd.ms-excel.sheet.macroEnabled.12': 'MsExcel',\r\n\t\t\t'application/vnd.openxmlformats-officedocument.spreadsheetml.template': 'MsExcel',\r\n\t\t\t'application/vnd.ms-excel.template.macroEnabled.12': 'MsExcel',\r\n\t\t\t'application/vnd.ms-excel.sheet.binary.macroEnabled.12': 'MsExcel',\r\n\t\t\t'application/vnd.ms-excel.addin.macroEnabled.12': 'MsExcel',\r\n\t\t\t'application/vnd.ms-powerpoint': 'MsPP',\r\n\t\t\t'application/vnd.openxmlformats-officedocument.presentationml.presentation': 'MsPP',\r\n\t\t\t'application/vnd.ms-powerpoint.presentation.macroEnabled.12': 'MsPP',\r\n\t\t\t'application/vnd.openxmlformats-officedocument.presentationml.slideshow': 'MsPP',\r\n\t\t\t'application/vnd.ms-powerpoint.slideshow.macroEnabled.12': 'MsPP',\r\n\t\t\t'application/vnd.openxmlformats-officedocument.presentationml.template': 'MsPP',\r\n\t\t\t'application/vnd.ms-powerpoint.template.macroEnabled.12': 'MsPP',\r\n\t\t\t'application/vnd.ms-powerpoint.addin.macroEnabled.12': 'MsPP',\r\n\t\t\t'application/vnd.openxmlformats-officedocument.presentationml.slide': 'MsPP',\r\n\t\t\t'application/vnd.ms-powerpoint.slide.macroEnabled.12': 'MsPP',\r\n\t\t\t'application/pdf': 'PDF',\r\n\t\t\t'application/xml': 'XML',\r\n\t\t\t'application/vnd.oasis.opendocument.text': 'OO',\r\n\t\t\t'application/vnd.oasis.opendocument.text-template': 'OO',\r\n\t\t\t'application/vnd.oasis.opendocument.text-web': 'OO',\r\n\t\t\t'application/vnd.oasis.opendocument.text-master': 'OO',\r\n\t\t\t'application/vnd.oasis.opendocument.graphics': 'OO',\r\n\t\t\t'application/vnd.oasis.opendocument.graphics-template': 'OO',\r\n\t\t\t'application/vnd.oasis.opendocument.presentation': 'OO',\r\n\t\t\t'application/vnd.oasis.opendocument.presentation-template': 'OO',\r\n\t\t\t'application/vnd.oasis.opendocument.spreadsheet': 'OO',\r\n\t\t\t'application/vnd.oasis.opendocument.spreadsheet-template': 'OO',\r\n\t\t\t'application/vnd.oasis.opendocument.chart': 'OO',\r\n\t\t\t'application/vnd.oasis.opendocument.formula': 'OO',\r\n\t\t\t'application/vnd.oasis.opendocument.database': 'OO',\r\n\t\t\t'application/vnd.oasis.opendocument.image': 'OO',\r\n\t\t\t'application/vnd.openofficeorg.extension': 'OO',\r\n\t\t\t'application/x-shockwave-flash': 'AppFlash',\r\n\t\t\t'application/flash-video': 'Flash video',\r\n\t\t\t'application/x-bittorrent': 'Torrent',\r\n\t\t\t'application/javascript': 'JS',\r\n\t\t\t'application/rtf': 'RTF',\r\n\t\t\t'application/rtfd': 'RTF',\r\n\t\t\t'application/x-font-ttf': 'TTF',\r\n\t\t\t'application/x-font-otf': 'OTF',\r\n\t\t\t'application/x-rpm': 'RPM',\r\n\t\t\t'application/x-web-config': 'TextPlain',\r\n\t\t\t'application/xhtml+xml': 'HTML',\r\n\t\t\t'application/docbook+xml': 'DOCBOOK',\r\n\t\t\t'application/x-awk': 'AWK',\r\n\t\t\t'application/x-gzip': 'GZIP',\r\n\t\t\t'application/x-bzip2': 'BZIP',\r\n\t\t\t'application/zip': 'ZIP',\r\n\t\t\t'application/x-zip': 'ZIP',\r\n\t\t\t'application/x-rar': 'RAR',\r\n\t\t\t'application/x-tar': 'TAR',\r\n\t\t\t'application/x-7z-compressed': '7z',\r\n\t\t\t'application/x-jar': 'JAR',\r\n\t\t\t'text/plain': 'TextPlain',\r\n\t\t\t'text/x-php': 'PHP',\r\n\t\t\t'text/html': 'HTML',\r\n\t\t\t'text/javascript': 'JS',\r\n\t\t\t'text/css': 'CSS',\r\n\t\t\t'text/rtf': 'RTF',\r\n\t\t\t'text/rtfd': 'RTF',\r\n\t\t\t'text/x-c': 'C',\r\n\t\t\t'text/x-csrc': 'C',\r\n\t\t\t'text/x-chdr': 'CHeader',\r\n\t\t\t'text/x-c++': 'CPP',\r\n\t\t\t'text/x-c++src': 'CPP',\r\n\t\t\t'text/x-c++hdr': 'CPPHeader',\r\n\t\t\t'text/x-shellscript': 'Shell',\r\n\t\t\t'application/x-csh': 'Shell',\r\n\t\t\t'text/x-python': 'Python',\r\n\t\t\t'text/x-java': 'Java',\r\n\t\t\t'text/x-java-source': 'Java',\r\n\t\t\t'text/x-ruby': 'Ruby',\r\n\t\t\t'text/x-perl': 'Perl',\r\n\t\t\t'text/x-sql': 'SQL',\r\n\t\t\t'text/xml': 'XML',\r\n\t\t\t'text/x-comma-separated-values': 'CSV',\r\n\t\t\t'image/x-ms-bmp': 'BMP',\r\n\t\t\t'image/jpeg': 'JPEG',\r\n\t\t\t'image/gif': 'GIF',\r\n\t\t\t'image/png': 'PNG',\r\n\t\t\t'image/tiff': 'TIFF',\r\n\t\t\t'image/x-targa': 'TGA',\r\n\t\t\t'image/vnd.adobe.photoshop': 'PSD',\r\n\t\t\t'image/xbm': 'XBITMAP',\r\n\t\t\t'image/pxm': 'PXM',\r\n\t\t\t'audio/mpeg': 'AudioMPEG',\r\n\t\t\t'audio/midi': 'AudioMIDI',\r\n\t\t\t'audio/ogg': 'AudioOGG',\r\n\t\t\t'audio/mp4': 'AudioMPEG4',\r\n\t\t\t'audio/x-m4a': 'AudioMPEG4',\r\n\t\t\t'audio/wav': 'AudioWAV',\r\n\t\t\t'audio/x-mp3-playlist': 'AudioPlaylist',\r\n\t\t\t'video/x-dv': 'VideoDV',\r\n\t\t\t'video/mp4': 'VideoMPEG4',\r\n\t\t\t'video/mpeg': 'VideoMPEG',\r\n\t\t\t'video/x-msvideo': 'VideoAVI',\r\n\t\t\t'video/quicktime': 'VideoMOV',\r\n\t\t\t'video/x-ms-wmv': 'VideoWM',\r\n\t\t\t'video/x-flv': 'VideoFlash',\r\n\t\t\t'video/x-matroska': 'VideoMKV',\r\n\t\t\t'video/ogg': 'VideoOGG'\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Ajax request data validation rules\r\n\t\t *\r\n\t\t * @type  Object\r\n\t\t */\r\n\t\trules: {\r\n\t\t\tdefaults: function (data) {\r\n\t\t\t\tif (!data\r\n\t\t\t\t\t|| (data.added && !$.isArray(data.added))\r\n\t\t\t\t\t|| (data.removed && !$.isArray(data.removed))\r\n\t\t\t\t\t|| (data.changed && !$.isArray(data.changed))) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t\topen: function (data) {\r\n\t\t\t\treturn data && data.cwd && data.files && $.isPlainObject(data.cwd) && $.isArray(data.files);\r\n\t\t\t},\r\n\t\t\ttree: function (data) {\r\n\t\t\t\treturn data && data.tree && $.isArray(data.tree);\r\n\t\t\t},\r\n\t\t\tparents: function (data) {\r\n\t\t\t\treturn data && data.tree && $.isArray(data.tree);\r\n\t\t\t},\r\n\t\t\ttmb: function (data) {\r\n\t\t\t\treturn data && data.images && ($.isPlainObject(data.images) || $.isArray(data.images));\r\n\t\t\t},\r\n\t\t\tupload: function (data) {\r\n\t\t\t\treturn data && ($.isPlainObject(data.added) || $.isArray(data.added));\r\n\t\t\t},\r\n\t\t\tsearch: function (data) {\r\n\t\t\t\treturn data && data.files && $.isArray(data.files)\r\n\t\t\t}\r\n\t\t},\r\n\r\n\r\n\t\t/**\r\n\t\t * Commands costructors\r\n\t\t *\r\n\t\t * @type Object\r\n\t\t */\r\n\t\tcommands: {},\r\n\r\n\t\tparseUploadData: function (text) {\r\n\t\t\tvar data;\r\n\r\n\t\t\tif (!$.trim(text)) {\r\n\t\t\t\treturn {error: ['errResponse', 'errDataEmpty']};\r\n\t\t\t}\r\n\r\n\t\t\ttry {\r\n\t\t\t\tdata = $.parseJSON(text);\r\n\t\t\t} catch (e) {\r\n\t\t\t\treturn {error: ['errResponse', 'errDataNotJSON']}\r\n\t\t\t}\r\n\r\n\t\t\tif (!this.validResponse('upload', data)) {\r\n\t\t\t\treturn {error: ['errResponse']};\r\n\t\t\t}\r\n\t\t\tdata = this.normalize(data);\r\n\t\t\tdata.removed = $.map(data.added || [], function (f) {\r\n\t\t\t\treturn f.hash;\r\n\t\t\t})\r\n\t\t\treturn data;\r\n\r\n\t\t},\r\n\r\n\t\tiframeCnt: 0,\r\n\r\n\t\tuploads: {\r\n\t\t\t// upload transport using iframe\r\n\t\t\tiframe: function (data, fm) {\r\n\t\t\t\tvar self = fm ? fm : this,\r\n\t\t\t\t\tinput = data.input,\r\n\t\t\t\t\tdfrd = $.Deferred()\r\n\t\t\t\t\t\t.fail(function (error) {\r\n\t\t\t\t\t\t\terror && self.error(error);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.done(function (data) {\r\n\t\t\t\t\t\t\tdata.warning && self.error(data.warning);\r\n\t\t\t\t\t\t\tdata.removed && self.remove(data);\r\n\t\t\t\t\t\t\tdata.added && self.add(data);\r\n\t\t\t\t\t\t\tdata.changed && self.change(data);\r\n\t\t\t\t\t\t\tself.trigger('upload', data);\r\n\t\t\t\t\t\t\tdata.sync && self.sync();\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\tname = 'iframe-' + self.namespace + (++self.iframeCnt),\r\n\t\t\t\t\tform = $('<form action=\"' + self.uploadURL + '\" method=\"post\" enctype=\"multipart/form-data\" encoding=\"multipart/form-data\" target=\"' + name + '\" style=\"display:none\"><input type=\"hidden\" name=\"cmd\" value=\"upload\" /></form>'),\r\n\t\t\t\t\tmsie = this.UA.IE,\r\n\t\t\t\t// clear timeouts, close notification dialog, remove form/iframe\r\n\t\t\t\t\tonload = function () {\r\n\t\t\t\t\t\tabortto && clearTimeout(abortto);\r\n\t\t\t\t\t\tnotifyto && clearTimeout(notifyto);\r\n\t\t\t\t\t\tnotify && self.notify({type: 'upload', cnt: -cnt});\r\n\r\n\t\t\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\t\t\tmsie && $('<iframe src=\"javascript:false;\"/>').appendTo(form);\r\n\t\t\t\t\t\t\tform.remove();\r\n\t\t\t\t\t\t\tiframe.remove();\r\n\t\t\t\t\t\t}, 100);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tiframe = $('<iframe src=\"' + (msie ? 'javascript:false;' : 'about:blank') + '\" name=\"' + name + '\" style=\"position:absolute;left:-1000px;top:-1000px\" />')\r\n\t\t\t\t\t\t.bind('load', function () {\r\n\t\t\t\t\t\t\tiframe.unbind('load')\r\n\t\t\t\t\t\t\t\t.bind('load', function () {\r\n\t\t\t\t\t\t\t\t\tvar data = self.parseUploadData(iframe.contents().text());\r\n\r\n\t\t\t\t\t\t\t\t\tonload();\r\n\t\t\t\t\t\t\t\t\tdata.error ? dfrd.reject(data.error) : dfrd.resolve(data);\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t// notify dialog\r\n\t\t\t\t\t\t\tnotifyto = setTimeout(function () {\r\n\t\t\t\t\t\t\t\tnotify = true;\r\n\t\t\t\t\t\t\t\tself.notify({type: 'upload', cnt: cnt});\r\n\t\t\t\t\t\t\t}, self.options.notifyDelay);\r\n\r\n\t\t\t\t\t\t\t// emulate abort on timeout\r\n\t\t\t\t\t\t\tif (self.options.iframeTimeout > 0) {\r\n\t\t\t\t\t\t\t\tabortto = setTimeout(function () {\r\n\t\t\t\t\t\t\t\t\tonload();\r\n\t\t\t\t\t\t\t\t\tdfrd.reject([errors.connect, errors.timeout]);\r\n\t\t\t\t\t\t\t\t}, self.options.iframeTimeout);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tform.submit();\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\tcnt, notify, notifyto, abortto\r\n\r\n\t\t\t\t\t;\r\n\r\n\t\t\t\tif (input && $(input).is(':file') && $(input).val()) {\r\n\t\t\t\t\tform.append(input);\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn dfrd.reject();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcnt = input.files ? input.files.length : 1;\r\n\r\n\t\t\t\tform.append('<input type=\"hidden\" name=\"' + (self.newAPI ? 'target' : 'current') + '\" value=\"' + self.cwd().hash + '\"/>')\r\n\t\t\t\t\t.append('<input type=\"hidden\" name=\"html\" value=\"1\"/>')\r\n\t\t\t\t\t.append($(input).attr('name', 'upload[]'));\r\n\r\n\t\t\t\t$.each(self.options.onlyMimes || [], function (i, mime) {\r\n\t\t\t\t\tform.append('<input type=\"hidden\" name=\"mimes[]\" value=\"' + mime + '\"/>');\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$.each(self.options.customData, function (key, val) {\r\n\t\t\t\t\tform.append('<input type=\"hidden\" name=\"' + key + '\" value=\"' + val + '\"/>');\r\n\t\t\t\t});\r\n\r\n\t\t\t\tform.appendTo('body');\r\n\t\t\t\tiframe.appendTo('body');\r\n\r\n\t\t\t\treturn dfrd;\r\n\t\t\t},\r\n\t\t\t// upload transport using XMLHttpRequest\r\n\t\t\txhr: function (data, fm) {\r\n\t\t\t\tvar self = fm ? fm : this,\r\n\t\t\t\t\tdfrd = $.Deferred()\r\n\t\t\t\t\t\t.fail(function (error) {\r\n\t\t\t\t\t\t\terror && self.error(error);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.done(function (data) {\r\n\t\t\t\t\t\t\tdata.warning && self.error(data.warning);\r\n\t\t\t\t\t\t\tdata.removed && self.remove(data);\r\n\t\t\t\t\t\t\tdata.added && self.add(data);\r\n\t\t\t\t\t\t\tdata.changed && self.change(data);\r\n\t\t\t\t\t\t\tself.trigger('upload', data);\r\n\t\t\t\t\t\t\tdata.sync && self.sync();\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.always(function () {\r\n\t\t\t\t\t\t\tnotifyto && clearTimeout(notifyto);\r\n\t\t\t\t\t\t\tnotify && self.notify({type: 'upload', cnt: -cnt, progress: 100 * cnt});\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\txhr = new XMLHttpRequest(),\r\n\t\t\t\t\tformData = new FormData(),\r\n\t\t\t\t\tfiles = data.input ? data.input.files : data.files,\r\n\t\t\t\t\tcnt = files.length,\r\n\t\t\t\t\tloaded = 5,\r\n\t\t\t\t\tnotify = false,\r\n\t\t\t\t\tstartNotify = function () {\r\n\t\t\t\t\t\treturn setTimeout(function () {\r\n\t\t\t\t\t\t\tnotify = true;\r\n\t\t\t\t\t\t\tself.notify({type: 'upload', cnt: cnt, progress: loaded * cnt});\r\n\t\t\t\t\t\t}, self.options.notifyDelay);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tnotifyto;\r\n\r\n\t\t\t\tif (!cnt) {\r\n\t\t\t\t\treturn dfrd.reject();\r\n\t\t\t\t}\r\n\r\n\t\t\t\txhr.addEventListener('error', function () {\r\n\t\t\t\t\tdfrd.reject('errConnect');\r\n\t\t\t\t}, false);\r\n\r\n\t\t\t\txhr.addEventListener('abort', function () {\r\n\t\t\t\t\tdfrd.reject(['errConnect', 'errAbort']);\r\n\t\t\t\t}, false);\r\n\r\n\t\t\t\txhr.addEventListener('load', function () {\r\n\t\t\t\t\tvar status = xhr.status, data;\r\n\r\n\t\t\t\t\tif (status > 500) {\r\n\t\t\t\t\t\treturn dfrd.reject('errResponse');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (status != 200) {\r\n\t\t\t\t\t\treturn dfrd.reject('errConnect');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (xhr.readyState != 4) {\r\n\t\t\t\t\t\treturn dfrd.reject(['errConnect', 'errTimeout']); // am i right?\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!xhr.responseText) {\r\n\t\t\t\t\t\treturn dfrd.reject(['errResponse', 'errDataEmpty']);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdata = self.parseUploadData(xhr.responseText);\r\n\t\t\t\t\tdata.error ? dfrd.reject(data.error) : dfrd.resolve(data);\r\n\t\t\t\t}, false);\r\n\r\n\t\t\t\txhr.upload.addEventListener('progress', function (e) {\r\n\t\t\t\t\tvar prev = loaded, curr;\r\n\r\n\t\t\t\t\tif (e.lengthComputable) {\r\n\r\n\t\t\t\t\t\tcurr = parseInt(e.loaded * 100 / e.total);\r\n\r\n\t\t\t\t\t\t// to avoid strange bug in safari (not in chrome) with drag&drop.\r\n\t\t\t\t\t\t// bug: macos finder opened in any folder,\r\n\t\t\t\t\t\t// reset safari cache (option+command+e), reload elfinder page,\r\n\t\t\t\t\t\t// drop file from finder\r\n\t\t\t\t\t\t// on first attempt request starts (progress callback called ones) but never ends.\r\n\t\t\t\t\t\t// any next drop - successfull.\r\n\t\t\t\t\t\tif (curr > 0 && !notifyto) {\r\n\t\t\t\t\t\t\tnotifyto = startNotify();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (curr - prev > 4) {\r\n\t\t\t\t\t\t\tloaded = curr;\r\n\t\t\t\t\t\t\tnotify && self.notify({type: 'upload', cnt: 0, progress: (loaded - prev) * cnt});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}, false);\r\n\r\n\r\n\t\t\t\txhr.open('POST', self.uploadURL, true);\r\n\t\t\t\tformData.append('cmd', 'upload');\r\n\t\t\t\tformData.append(self.newAPI ? 'target' : 'current', self.cwd().hash);\r\n\t\t\t\t$.each(self.options.customData, function (key, val) {\r\n\t\t\t\t\tformData.append(key, val);\r\n\t\t\t\t});\r\n\t\t\t\t$.each(self.options.onlyMimes, function (i, mime) {\r\n\t\t\t\t\tformData.append('mimes[' + i + ']', mime);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$.each(files, function (i, file) {\r\n\t\t\t\t\tformData.append('upload[]', file);\r\n\t\t\t\t});\r\n\r\n\t\t\t\txhr.onreadystatechange = function () {\r\n\t\t\t\t\tif (xhr.readyState == 4 && xhr.status == 0) {\r\n\t\t\t\t\t\t// ff bug while send zero sized file\r\n\t\t\t\t\t\t// for safari - send directory\r\n\t\t\t\t\t\tdfrd.reject(['errConnect', 'errAbort']);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\txhr.send(formData);\r\n\r\n\t\t\t\tif (!this.UA.Safari || !data.files) {\r\n\t\t\t\t\tnotifyto = startNotify();\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn dfrd;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\r\n\t\t/**\r\n\t\t * Bind callback to event(s) The callback is executed at most once per event.\r\n\t\t * To bind to multiply events at once, separate events names by space\r\n\t\t *\r\n\t\t * @param  String    event name\r\n\t\t * @param  Function  callback\r\n\t\t * @return elFinder\r\n\t\t */\r\n\t\tone: function (event, callback) {\r\n\t\t\tvar self = this,\r\n\t\t\t\th = $.proxy(callback, function (event) {\r\n\t\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\t\tself.unbind(event.type, h);\r\n\t\t\t\t\t}, 3);\r\n\t\t\t\t\treturn callback.apply(this, arguments);\r\n\t\t\t\t});\r\n\t\t\treturn this.bind(event, h);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Set/get data into/from localStorage\r\n\t\t *\r\n\t\t * @param  String       key\r\n\t\t * @param  String|void  value\r\n\t\t * @return String\r\n\t\t */\r\n\t\tlocalStorage: function (key, val) {\r\n\t\t\tvar s = window.localStorage;\r\n\r\n\t\t\tkey = 'elfinder-' + key + this.id;\r\n\r\n\t\t\tif (val === null) {\r\n\t\t\t\treturn s.removeItem(key);\r\n\t\t\t}\r\n\r\n\t\t\tif (val !== void(0)) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\ts.setItem(key, val);\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\ts.clear();\r\n\t\t\t\t\ts.setItem(key, val);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn s.getItem(key);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get/set cookie\r\n\t\t *\r\n\t\t * @param  String       cookie name\r\n\t\t * @param  String|void  cookie value\r\n\t\t * @return String\r\n\t\t */\r\n\t\tcookie: function (name, value) {\r\n\t\t\tvar d, o, c, i;\r\n\r\n\t\t\tname = 'elfinder-' + name + this.id;\r\n\r\n\t\t\tif (value === void(0)) {\r\n\t\t\t\tif (document.cookie && document.cookie != '') {\r\n\t\t\t\t\tc = document.cookie.split(';');\r\n\t\t\t\t\tname += '=';\r\n\t\t\t\t\tfor (i = 0; i < c.length; i++) {\r\n\t\t\t\t\t\tc[i] = $.trim(c[i]);\r\n\t\t\t\t\t\tif (c[i].substring(0, name.length) == name) {\r\n\t\t\t\t\t\t\treturn decodeURIComponent(c[i].substring(name.length));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\r\n\t\t\to = $.extend({}, this.options.cookie);\r\n\t\t\tif (value === null) {\r\n\t\t\t\tvalue = '';\r\n\t\t\t\to.expires = -1;\r\n\t\t\t}\r\n\t\t\tif (typeof(o.expires) == 'number') {\r\n\t\t\t\td = new Date();\r\n\t\t\t\td.setTime(d.getTime() + (o.expires * 86400000));\r\n\t\t\t\to.expires = d;\r\n\t\t\t}\r\n\t\t\tdocument.cookie = name + '=' + encodeURIComponent(value) + '; expires=' + o.expires.toUTCString() + (o.path ? '; path=' + o.path : '') + (o.domain ? '; domain=' + o.domain : '') + (o.secure ? '; secure' : '');\r\n\t\t\treturn value;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get start directory (by location.hash or last opened directory)\r\n\t\t *\r\n\t\t * @return String\r\n\t\t */\r\n\t\tstartDir: function () {\r\n\t\t\tvar locHash = window.location.hash;\r\n\t\t\tif (locHash && locHash.match(/^#elf_/)) {\r\n\t\t\t\treturn locHash.replace(/^#elf_/, '');\r\n\t\t\t} else {\r\n\t\t\t\treturn this.lastDir();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get/set last opened directory\r\n\t\t *\r\n\t\t * @param  String|undefined  dir hash\r\n\t\t * @return String\r\n\t\t */\r\n\t\tlastDir: function (hash) {\r\n\t\t\treturn this.options.rememberLastDir ? this.storage('lastdir', hash) : '';\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Node for escape html entities in texts\r\n\t\t *\r\n\t\t * @type jQuery\r\n\t\t */\r\n\t\t_node: $('<span/>'),\r\n\r\n\t\t/**\r\n\t\t * Replace not html-safe symbols to html entities\r\n\t\t *\r\n\t\t * @param  String  text to escape\r\n\t\t * @return String\r\n\t\t */\r\n\t\tescape: function (name) {\r\n\t\t\treturn this._node.text(name).html();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Cleanup ajax data.\r\n\t\t * For old api convert data into new api format\r\n\t\t *\r\n\t\t * @param  String  command name\r\n\t\t * @param  Object  data from backend\r\n\t\t * @return Object\r\n\t\t */\r\n\t\tnormalize: function (data) {\r\n\t\t\tvar filter = function (file) {\r\n\r\n\t\t\t\tif (file && file.hash && file.name && file.mime) {\r\n\t\t\t\t\tif (file.mime == 'application/x-empty') {\r\n\t\t\t\t\t\tfile.mime = 'text/plain';\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn file;\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t\treturn file && file.hash && file.name && file.mime ? file : null;\r\n\t\t\t};\r\n\r\n\r\n\t\t\tif (data.files) {\r\n\t\t\t\tdata.files = $.map(data.files, filter);\r\n\t\t\t}\r\n\t\t\tif (data.tree) {\r\n\t\t\t\tdata.tree = $.map(data.tree, filter);\r\n\t\t\t}\r\n\t\t\tif (data.added) {\r\n\t\t\t\tdata.added = $.map(data.added, filter);\r\n\t\t\t}\r\n\t\t\tif (data.changed) {\r\n\t\t\t\tdata.changed = $.map(data.changed, filter);\r\n\t\t\t}\r\n\t\t\tif (data.api) {\r\n\t\t\t\tdata.init = true;\r\n\t\t\t}\r\n\t\t\treturn data;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Update sort options\r\n\t\t *\r\n\t\t * @param {String} sort type\r\n\t\t * @param {String} sort order\r\n\t\t * @param {Boolean} show folder first\r\n\t\t */\r\n\t\tsetSort: function (type, order, stickFolders) {\r\n\t\t\tthis.storage('sortType', (this.sortType = this.sortRules[type] ? type : 'name'));\r\n\t\t\tthis.storage('sortOrder', (this.sortOrder = /asc|desc/.test(order) ? order : 'asc'));\r\n\t\t\tthis.storage('sortStickFolders', (this.sortStickFolders = !!stickFolders) ? 1 : '');\r\n\t\t\tthis.trigger('sortchange');\r\n\t\t},\r\n\r\n\t\t_sortRules: {\r\n\t\t\tname: function (file1, file2) {\r\n\t\t\t\treturn file1.name.toLowerCase().localeCompare(file2.name.toLowerCase());\r\n\t\t\t},\r\n\t\t\tsize: function (file1, file2) {\r\n\t\t\t\tvar size1 = parseInt(file1.size) || 0,\r\n\t\t\t\t\tsize2 = parseInt(file2.size) || 0;\r\n\r\n\t\t\t\treturn size1 == size2 ? 0 : size1 > size2 ? 1 : -1;\r\n\t\t\t\treturn (parseInt(file1.size) || 0) > (parseInt(file2.size) || 0) ? 1 : -1;\r\n\t\t\t},\r\n\t\t\tkind: function (file1, file2) {\r\n\t\t\t\treturn file1.mime.localeCompare(file2.mime);\r\n\t\t\t},\r\n\t\t\tdate: function (file1, file2) {\r\n\t\t\t\tvar date1 = file1.ts || file1.date,\r\n\t\t\t\t\tdate2 = file2.ts || file2.date;\r\n\r\n\t\t\t\treturn date1 == date2 ? 0 : date1 > date2 ? 1 : -1\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Compare files based on elFinder.sort\r\n\t\t *\r\n\t\t * @param  Object  file\r\n\t\t * @param  Object  file\r\n\t\t * @return Number\r\n\t\t */\r\n\t\tcompare: function (file1, file2) {\r\n\t\t\tvar self = this,\r\n\t\t\t\ttype = self.sortType,\r\n\t\t\t\tasc = self.sortOrder == 'asc',\r\n\t\t\t\tstick = self.sortStickFolders,\r\n\t\t\t\trules = self.sortRules,\r\n\t\t\t\tsort = rules[type],\r\n\t\t\t\td1 = file1.mime == 'directory',\r\n\t\t\t\td2 = file2.mime == 'directory',\r\n\t\t\t\tres;\r\n\r\n\t\t\tif (stick) {\r\n\t\t\t\tif (d1 && !d2) {\r\n\t\t\t\t\treturn -1;\r\n\t\t\t\t} else if (!d1 && d2) {\r\n\t\t\t\t\treturn 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tres = asc ? sort(file1, file2) : sort(file2, file1);\r\n\r\n\t\t\treturn type != 'name' && res == 0\r\n\t\t\t\t? res = asc ? rules.name(file1, file2) : rules.name(file2, file1)\r\n\t\t\t\t: res;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Sort files based on config\r\n\t\t *\r\n\t\t * @param  Array  files\r\n\t\t * @return Array\r\n\t\t */\r\n\t\tsortFiles: function (files) {\r\n\t\t\treturn files.sort(this.compare);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Open notification dialog\r\n\t\t * and append/update message for required notification type.\r\n\t\t *\r\n\t\t * @param  Object  options\r\n\t\t * @example\r\n\t\t * this.notify({\r\n\t *    type : 'copy',\r\n\t *    msg : 'Copy files', // not required for known types @see this.notifyType\r\n\t\t *    cnt : 3,\r\n\t\t *    hideCnt : false, // true for not show count\r\n\t\t *    progress : 10 // progress bar percents (use cnt : 0 to update progress bar)\r\n\t\t * })\r\n\t\t * @return elFinder\r\n\t\t */\r\n\t\tnotify: function (opts) {\r\n\t\t\tvar type = opts.type,\r\n\t\t\t\tmsg = this.messages['ntf' + type] ? this.i18n('ntf' + type) : this.i18n('ntfsmth'),\r\n\t\t\t\tndialog = this.ui.notify,\r\n\t\t\t\tnotify = ndialog.children('.elfinder-notify-' + type),\r\n\t\t\t\tntpl = '<div class=\"elfinder-notify elfinder-notify-{type}\"><span class=\"elfinder-dialog-icon elfinder-dialog-icon-{type}\"/><span class=\"elfinder-notify-msg\">{msg}</span> <span class=\"elfinder-notify-cnt\"/><div class=\"elfinder-notify-progressbar\"><div class=\"elfinder-notify-progress\"/></div></div>',\r\n\t\t\t\tdelta = opts.cnt,\r\n\t\t\t\tprogress = opts.progress >= 0 && opts.progress <= 100 ? opts.progress : 0,\r\n\t\t\t\tcnt, total, prc;\r\n\r\n\t\t\tif (!type) {\r\n\t\t\t\treturn this;\r\n\t\t\t}\r\n\r\n\t\t\tif (!notify.length) {\r\n\t\t\t\tnotify = $(ntpl.replace(/\\{type\\}/g, type).replace(/\\{msg\\}/g, msg))\r\n\t\t\t\t\t.appendTo(ndialog)\r\n\t\t\t\t\t.data('cnt', 0);\r\n\r\n\t\t\t\tif (progress) {\r\n\t\t\t\t\tnotify.data({progress: 0, total: 0});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tcnt = delta + parseInt(notify.data('cnt'));\r\n\r\n\t\t\tif (cnt > 0) {\r\n\t\t\t\t!opts.hideCnt && notify.children('.elfinder-notify-cnt').text('(' + cnt + ')');\r\n\t\t\t\tndialog.is(':hidden') && ndialog.elfinderdialog('open');\r\n\t\t\t\tnotify.data('cnt', cnt);\r\n\r\n\t\t\t\tif (progress < 100\r\n\t\t\t\t\t&& (total = notify.data('total')) >= 0\r\n\t\t\t\t\t&& (prc = notify.data('progress')) >= 0) {\r\n\r\n\t\t\t\t\ttotal = delta + parseInt(notify.data('total'));\r\n\t\t\t\t\tprc = progress + prc;\r\n\t\t\t\t\tprogress = parseInt(prc / total);\r\n\t\t\t\t\tnotify.data({progress: prc, total: total});\r\n\r\n\t\t\t\t\tndialog.find('.elfinder-notify-progress')\r\n\t\t\t\t\t\t.animate({\r\n\t\t\t\t\t\t\twidth: (progress < 100 ? progress : 100) + '%'\r\n\t\t\t\t\t\t}, 20);\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\t\t\t\tnotify.remove();\r\n\t\t\t\t!ndialog.children().length && ndialog.elfinderdialog('close');\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Open confirmation dialog\r\n\t\t *\r\n\t\t * @param  Object  options\r\n\t\t * @example\r\n\t\t * this.confirm({\r\n\t *    title : 'Remove files',\r\n\t *    text  : 'Here is question text',\r\n\t *    accept : {  // accept callback - required\r\n\t *      label : 'Continue',\r\n\t *      callback : function(applyToAll) { fm.log('Ok') }\r\n\t *    },\r\n\t *    cancel : { // cancel callback - required\r\n\t *      label : 'Cancel',\r\n\t *      callback : function() { fm.log('Cancel')}\r\n\t *    },\r\n\t *    reject : { // reject callback - optionally\r\n\t *      label : 'No',\r\n\t *      callback : function(applyToAll) { fm.log('No')}\r\n\t *   },\r\n\t *   all : true  // display checkbox \"Apply to all\"\r\n\t * })\r\n\t\t * @return elFinder\r\n\t\t */\r\n\t\tconfirm: function (opts) {\r\n\t\t\tvar complete = false,\r\n\t\t\t\toptions = {\r\n\t\t\t\t\tcssClass: 'elfinder-dialog-confirm',\r\n\t\t\t\t\tmodal: true,\r\n\t\t\t\t\tresizable: false,\r\n\t\t\t\t\ttitle: this.i18n(opts.title || 'confirmReq'),\r\n\t\t\t\t\tbuttons: {},\r\n\t\t\t\t\tclose: function () {\r\n\t\t\t\t\t\t!complete && opts.cancel.callback();\r\n\t\t\t\t\t\t$(this).elfinderdialog('destroy');\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tapply = this.i18n('apllyAll'),\r\n\t\t\t\tlabel, checkbox;\r\n\r\n\r\n\t\t\tif (opts.reject) {\r\n\t\t\t\toptions.buttons[this.i18n(opts.reject.label)] = function () {\r\n\t\t\t\t\topts.reject.callback(!!(checkbox && checkbox.prop('checked')))\r\n\t\t\t\t\tcomplete = true;\r\n\t\t\t\t\t$(this).elfinderdialog('close')\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\toptions.buttons[this.i18n(opts.accept.label)] = function () {\r\n\t\t\t\topts.accept.callback(!!(checkbox && checkbox.prop('checked')))\r\n\t\t\t\tcomplete = true;\r\n\t\t\t\t$(this).elfinderdialog('close')\r\n\t\t\t};\r\n\r\n\t\t\toptions.buttons[this.i18n(opts.cancel.label)] = function () {\r\n\t\t\t\t$(this).elfinderdialog('close')\r\n\t\t\t};\r\n\r\n\t\t\tif (opts.all) {\r\n\t\t\t\tif (opts.reject) {\r\n\t\t\t\t\toptions.width = 370;\r\n\t\t\t\t}\r\n\t\t\t\toptions.create = function () {\r\n\t\t\t\t\tcheckbox = $('<input type=\"checkbox\" />');\r\n\t\t\t\t\t$(this).next().children().before($('<label>' + apply + '</label>').prepend(checkbox));\r\n\t\t\t\t}\r\n\r\n\t\t\t\toptions.open = function () {\r\n\t\t\t\t\tvar pane = $(this).next(),\r\n\t\t\t\t\t\twidth = parseInt(pane.children(':first').outerWidth() + pane.children(':last').outerWidth());\r\n\r\n\t\t\t\t\tif (width > parseInt(pane.width())) {\r\n\t\t\t\t\t\t$(this).closest('.elfinder-dialog').width(width + 30);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn this.dialog('<span class=\"elfinder-dialog-icon elfinder-dialog-icon-confirm\"/>' + this.i18n(opts.text), options);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Create unique file name in required dir\r\n\t\t *\r\n\t\t * @param  String  file name\r\n\t\t * @param  String  parent dir hash\r\n\t\t * @return String\r\n\t\t */\r\n\t\tuniqueName: function (prefix, phash) {\r\n\t\t\tvar i = 0, ext = '', p, name;\r\n\r\n\t\t\tprefix = this.i18n(prefix);\r\n\t\t\tphash = phash || this.cwd().hash;\r\n\r\n\t\t\tif ((p = prefix.indexOf('.txt')) != -1) {\r\n\t\t\t\text = '.txt';\r\n\t\t\t\tprefix = prefix.substr(0, p);\r\n\t\t\t}\r\n\r\n\t\t\tname = prefix + ext;\r\n\r\n\t\t\tif (!this.fileByName(name, phash)) {\r\n\t\t\t\treturn name;\r\n\t\t\t}\r\n\t\t\twhile (i < 10000) {\r\n\t\t\t\tname = prefix + ' ' + (++i) + ext;\r\n\t\t\t\tif (!this.fileByName(name, phash)) {\r\n\t\t\t\t\treturn name;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn prefix + Math.random() + ext;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Return message translated onto current language\r\n\t\t *\r\n\t\t * @param  String|Array  message[s]\r\n\t\t * @return String\r\n\t\t **/\r\n\t\ti18n: function () {\r\n\t\t\tvar self = this,\r\n\t\t\t\tmessages = this.messages,\r\n\t\t\t\tinput = [],\r\n\t\t\t\tignore = [],\r\n\t\t\t\tmessage = function (m) {\r\n\t\t\t\t\tvar file;\r\n\t\t\t\t\tif (m.indexOf('#') === 0) {\r\n\t\t\t\t\t\tif ((file = self.file(m.substr(1)))) {\r\n\t\t\t\t\t\t\treturn file.name;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn m;\r\n\t\t\t\t},\r\n\t\t\t\ti, j, m;\r\n\r\n\t\t\tfor (i = 0; i < arguments.length; i++) {\r\n\t\t\t\tm = arguments[i];\r\n\r\n\t\t\t\tif (typeof m == 'string') {\r\n\t\t\t\t\tinput.push(message(m));\r\n\t\t\t\t} else if ($.isArray(m)) {\r\n\t\t\t\t\tfor (j = 0; j < m.length; j++) {\r\n\t\t\t\t\t\tif (typeof m[j] == 'string') {\r\n\t\t\t\t\t\t\tinput.push(message(m[j]));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (i = 0; i < input.length; i++) {\r\n\t\t\t\t// dont translate placeholders\r\n\t\t\t\tif ($.inArray(i, ignore) !== -1) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tm = input[i];\r\n\t\t\t\t// translate message\r\n\t\t\t\tm = messages[m] || m;\r\n\t\t\t\t// replace placeholders in message\r\n\t\t\t\tm = m.replace(/\\$(\\d+)/g, function (match, placeholder) {\r\n\t\t\t\t\tplaceholder = i + parseInt(placeholder);\r\n\t\t\t\t\tif (placeholder > 0 && input[placeholder]) {\r\n\t\t\t\t\t\tignore.push(placeholder)\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn input[placeholder] || '';\r\n\t\t\t\t});\r\n\r\n\t\t\t\tinput[i] = m;\r\n\t\t\t}\r\n\r\n\t\t\treturn $.map(input, function (m, i) {\r\n\t\t\t\treturn $.inArray(i, ignore) === -1 ? m : null;\r\n\t\t\t}).join('<br>');\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Convert mimetype into css classes\r\n\t\t *\r\n\t\t * @param  String  file mimetype\r\n\t\t * @return String\r\n\t\t */\r\n\t\tmime2class: function (mime) {\r\n\t\t\tvar prefix = 'elfinder-cwd-icon-';\r\n\r\n\t\t\tmime = mime.split('/');\r\n\r\n\t\t\treturn prefix + mime[0] + (mime[0] != 'image' && mime[1] ? ' ' + prefix + mime[1].replace(/(\\.|\\+)/g, '-') : '');\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Return localized kind of file\r\n\t\t *\r\n\t\t * @param  Object|String  file or file mimetype\r\n\t\t * @return String\r\n\t\t */\r\n\t\tmime2kind: function (f) {\r\n\t\t\tvar mime = typeof(f) == 'object' ? f.mime : f, kind;\r\n\r\n\t\t\tif (f.alias) {\r\n\t\t\t\tkind = 'Alias';\r\n\t\t\t} else if (this.kinds[mime]) {\r\n\t\t\t\tkind = this.kinds[mime];\r\n\t\t\t} else {\r\n\t\t\t\tif (mime.indexOf('text') === 0) {\r\n\t\t\t\t\tkind = 'Text';\r\n\t\t\t\t} else if (mime.indexOf('image') === 0) {\r\n\t\t\t\t\tkind = 'Image';\r\n\t\t\t\t} else if (mime.indexOf('audio') === 0) {\r\n\t\t\t\t\tkind = 'Audio';\r\n\t\t\t\t} else if (mime.indexOf('video') === 0) {\r\n\t\t\t\t\tkind = 'Video';\r\n\t\t\t\t} else if (mime.indexOf('application') === 0) {\r\n\t\t\t\t\tkind = 'App';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tkind = mime;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn this.messages['kind' + kind] ? this.i18n('kind' + kind) : mime;\r\n\r\n\t\t\tvar mime = typeof(f) == 'object' ? f.mime : f,\r\n\t\t\t\tkind = this.kinds[mime] || 'unknown';\r\n\r\n\t\t\tif (f.alias) {\r\n\t\t\t\tkind = 'Alias';\r\n\t\t\t} else if (kind == 'unknown') {\r\n\t\t\t\tif (mime.indexOf('text') === 0) {\r\n\t\t\t\t\tkind = 'Text';\r\n\t\t\t\t} else if (mime.indexOf('image') === 0) {\r\n\t\t\t\t\tkind = 'Image';\r\n\t\t\t\t} else if (mime.indexOf('audio') === 0) {\r\n\t\t\t\t\tkind = 'Audio';\r\n\t\t\t\t} else if (mime.indexOf('video') === 0) {\r\n\t\t\t\t\tkind = 'Video';\r\n\t\t\t\t} else if (mime.indexOf('application') === 0) {\r\n\t\t\t\t\tkind = 'Application';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn this.i18n(kind);\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Return localized date\r\n\t\t *\r\n\t\t * @param  Object  file object\r\n\t\t * @return String\r\n\t\t */\r\n\t\tformatDate: function (file, ts) {\r\n\t\t\tvar self = this,\r\n\t\t\t\tts = ts || file.ts,\r\n\t\t\t\ti18 = self.i18,\r\n\t\t\t\tdate, format, output, d, dw, m, y, h, g, i, s;\r\n\r\n\t\t\tif (self.options.clientFormatDate && ts > 0) {\r\n\r\n\t\t\t\tdate = new Date(ts * 1000);\r\n\r\n\t\t\t\th = date[self.getHours]();\r\n\t\t\t\tg = h > 12 ? h - 12 : h;\r\n\t\t\t\ti = date[self.getMinutes]();\r\n\t\t\t\ts = date[self.getSeconds]();\r\n\t\t\t\td = date[self.getDate]();\r\n\t\t\t\tdw = date[self.getDay]();\r\n\t\t\t\tm = date[self.getMonth]() + 1;\r\n\t\t\t\ty = date[self.getFullYear]();\r\n\r\n\t\t\t\tformat = ts >= this.yesterday\r\n\t\t\t\t\t? this.fancyFormat\r\n\t\t\t\t\t: this.dateFormat;\r\n\r\n\t\t\t\toutput = format.replace(/[a-z]/gi, function (val) {\r\n\t\t\t\t\tswitch (val) {\r\n\t\t\t\t\t\tcase 'd':\r\n\t\t\t\t\t\t\treturn d > 9 ? d : '0' + d;\r\n\t\t\t\t\t\tcase 'j':\r\n\t\t\t\t\t\t\treturn d;\r\n\t\t\t\t\t\tcase 'D':\r\n\t\t\t\t\t\t\treturn self.i18n(i18.daysShort[dw]);\r\n\t\t\t\t\t\tcase 'l':\r\n\t\t\t\t\t\t\treturn self.i18n(i18.days[dw]);\r\n\t\t\t\t\t\tcase 'm':\r\n\t\t\t\t\t\t\treturn m > 9 ? m : '0' + m;\r\n\t\t\t\t\t\tcase 'n':\r\n\t\t\t\t\t\t\treturn m;\r\n\t\t\t\t\t\tcase 'M':\r\n\t\t\t\t\t\t\treturn self.i18n(i18.monthsShort[m - 1]);\r\n\t\t\t\t\t\tcase 'F':\r\n\t\t\t\t\t\t\treturn self.i18n(i18.months[m - 1]);\r\n\t\t\t\t\t\tcase 'Y':\r\n\t\t\t\t\t\t\treturn y;\r\n\t\t\t\t\t\tcase 'y':\r\n\t\t\t\t\t\t\treturn ('' + y).substr(2);\r\n\t\t\t\t\t\tcase 'H':\r\n\t\t\t\t\t\t\treturn h > 9 ? h : '0' + h;\r\n\t\t\t\t\t\tcase 'G':\r\n\t\t\t\t\t\t\treturn h;\r\n\t\t\t\t\t\tcase 'g':\r\n\t\t\t\t\t\t\treturn g;\r\n\t\t\t\t\t\tcase 'h':\r\n\t\t\t\t\t\t\treturn g > 9 ? g : '0' + g;\r\n\t\t\t\t\t\tcase 'a':\r\n\t\t\t\t\t\t\treturn h > 12 ? 'pm' : 'am';\r\n\t\t\t\t\t\tcase 'A':\r\n\t\t\t\t\t\t\treturn h > 12 ? 'PM' : 'AM';\r\n\t\t\t\t\t\tcase 'i':\r\n\t\t\t\t\t\t\treturn i > 9 ? i : '0' + i;\r\n\t\t\t\t\t\tcase 's':\r\n\t\t\t\t\t\t\treturn s > 9 ? s : '0' + s;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn val;\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn ts >= this.yesterday\r\n\t\t\t\t\t? output.replace('$1', this.i18n(ts >= this.today ? 'Today' : 'Yesterday'))\r\n\t\t\t\t\t: output;\r\n\t\t\t} else if (file.date) {\r\n\t\t\t\treturn file.date.replace(/([a-z]+)\\s/i, function (a1, a2) {\r\n\t\t\t\t\treturn self.i18n(a2) + ' ';\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\treturn self.i18n('dateUnknown');\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Return css class marks file permissions\r\n\t\t *\r\n\t\t * @param  Object  file\r\n\t\t * @return String\r\n\t\t */\r\n\t\tperms2class: function (o) {\r\n\t\t\tvar c = '';\r\n\r\n\t\t\tif (!o.read && !o.write) {\r\n\t\t\t\tc = 'elfinder-na';\r\n\t\t\t} else if (!o.read) {\r\n\t\t\t\tc = 'elfinder-wo';\r\n\t\t\t} else if (!o.write) {\r\n\t\t\t\tc = 'elfinder-ro';\r\n\t\t\t}\r\n\t\t\treturn c;\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Return localized string with file permissions\r\n\t\t *\r\n\t\t * @param  Object  file\r\n\t\t * @return String\r\n\t\t */\r\n\t\tformatPermissions: function (f) {\r\n\t\t\tvar p = [];\r\n\r\n\t\t\tf.read && p.push(this.i18n('read'));\r\n\t\t\tf.write && p.push(this.i18n('write'));\r\n\r\n\t\t\treturn p.length ? p.join(' ' + this.i18n('and') + ' ') : this.i18n('noaccess');\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Return formated file size\r\n\t\t *\r\n\t\t * @param  Number  file size\r\n\t\t * @return String\r\n\t\t */\r\n\t\tformatSize: function (s) {\r\n\t\t\tvar n = 1, u = 'b';\r\n\r\n\t\t\tif (s == 'unknown') {\r\n\t\t\t\treturn this.i18n('unknown');\r\n\t\t\t}\r\n\r\n\t\t\tif (s > 1073741824) {\r\n\t\t\t\tn = 1073741824;\r\n\t\t\t\tu = 'GB';\r\n\t\t\t} else if (s > 1048576) {\r\n\t\t\t\tn = 1048576;\r\n\t\t\t\tu = 'MB';\r\n\t\t\t} else if (s > 1024) {\r\n\t\t\t\tn = 1024;\r\n\t\t\t\tu = 'KB';\r\n\t\t\t}\r\n\t\t\ts = s / n;\r\n\t\t\treturn (s > 0 ? n >= 1048576 ? s.toFixed(2) : Math.round(s) : 0) + ' ' + u;\r\n\t\t},\r\n\r\n\r\n\t\tnavHash2Id: function (hash) {\r\n\t\t\treturn 'nav-' + hash;\r\n\t\t},\r\n\r\n\t\tnavId2Hash: function (id) {\r\n\t\t\treturn typeof(id) == 'string' ? id.substr(4) : false;\r\n\t\t},\r\n\r\n\t\tlog: function (m) {\r\n\t\t\twindow.console && window.console.log && window.console.log(m);\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tdebug: function (type, m) {\r\n\t\t\tvar d = this.options.debug;\r\n\r\n\t\t\tif (d == 'all' || d === true || ($.isArray(d) && $.inArray(type, d) != -1)) {\r\n\t\t\t\twindow.console && window.console.log && window.console.log('elfinder debug: [' + type + '] [' + this.id + ']', m);\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\ttime: function (l) {\r\n\t\t\twindow.console && window.console.time && window.console.time(l);\r\n\t\t},\r\n\t\ttimeEnd: function (l) {\r\n\t\t\twindow.console && window.console.timeEnd && window.console.timeEnd(l);\r\n\t\t}\r\n\t}","/**\r\n * Application version\r\n *\r\n * @type String\r\n **/\r\nelFinder.prototype.version = '2.x (Nightly: 5b3b866)';","$.fn.elfinder = function (o) {\r\n\r\n\tif (o == 'instance') {\r\n\t\treturn this.getElFinder();\r\n\t}\r\n\r\n\treturn this.each(function () {\r\n\r\n\t\tvar cmd = typeof(o) == 'string' ? o : '';\r\n\t\tif (!this.elfinder) {\r\n\t\t\tnew elFinder(this, typeof(o) == 'object' ? o : {})\r\n\t\t}\r\n\r\n\t\tswitch (cmd) {\r\n\t\t\tcase 'close':\r\n\t\t\tcase 'hide':\r\n\t\t\t\tthis.elfinder.hide();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'open':\r\n\t\t\tcase 'show':\r\n\t\t\t\tthis.elfinder.show();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase'destroy':\r\n\t\t\t\tthis.elfinder.destroy();\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t})\r\n}\r\n\r\n$.fn.getElFinder = function () {\r\n\tvar instance;\r\n\r\n\tthis.each(function () {\r\n\t\tif (this.elfinder) {\r\n\t\t\tinstance = this.elfinder;\r\n\t\t\treturn false;\r\n\t\t}\r\n\t});\r\n\r\n\treturn instance;\r\n}","/**\r\n * Default elFinder config\r\n *\r\n * @type  Object\r\n * @autor Dmitry (dio) Levashov\r\n */\r\nelFinder.prototype._options = {\r\n\t/**\r\n\t * Connector url. Required!\r\n\t *\r\n\t * @type String\r\n\t */\r\n\turl: '',\r\n\r\n\t/**\r\n\t * Ajax request type.\r\n\t *\r\n\t * @type String\r\n\t * @default \"get\"\r\n\t */\r\n\trequestType: 'get',\r\n\r\n\t/**\r\n\t * Transport to send request to backend.\r\n\t * Required for future extensions using websockets/webdav etc.\r\n\t * Must be an object with \"send\" method.\r\n\t * transport.send must return $.Deferred() object\r\n\t *\r\n\t * @type Object\r\n\t * @default null\r\n\t * @example\r\n\t *  transport : {\r\n\t *    init : function(elfinderInstance) { },\r\n\t *    send : function(options) {\r\n\t *      var dfrd = $.Deferred();\r\n\t *      // connect to backend ...\r\n\t *      return dfrd;\r\n\t *    },\r\n\t *    upload : function(data) {\r\n\t *      var dfrd = $.Deferred();\r\n\t *      // upload ...\r\n\t *      return dfrd;\r\n\t *    }\r\n\t *\r\n\t *  }\r\n\t **/\r\n\ttransport: {},\r\n\r\n\t/**\r\n\t * URL to upload file to.\r\n\t * If not set - connector URL will be used\r\n\t *\r\n\t * @type String\r\n\t * @default  ''\r\n\t */\r\n\turlUpload: '',\r\n\r\n\t/**\r\n\t * Allow to drag and drop to upload files\r\n\t *\r\n\t * @type Boolean|String\r\n\t * @default  'auto'\r\n\t */\r\n\tdragUploadAllow: 'auto',\r\n\r\n\t/**\r\n\t * Timeout for upload using iframe\r\n\t *\r\n\t * @type Number\r\n\t * @default  0 - no timeout\r\n\t */\r\n\tiframeTimeout: 0,\r\n\r\n\t/**\r\n\t * Data to append to all requests and to upload files\r\n\t *\r\n\t * @type Object\r\n\t * @default  {}\r\n\t */\r\n\tcustomData: {},\r\n\r\n\t/**\r\n\t * Event listeners to bind on elFinder init\r\n\t *\r\n\t * @type Object\r\n\t * @default  {}\r\n\t */\r\n\thandlers: {},\r\n\r\n\t/**\r\n\t * Interface language\r\n\t *\r\n\t * @type String\r\n\t * @default \"en\"\r\n\t */\r\n\tlang: 'en',\r\n\r\n\t/**\r\n\t * Additional css class for filemanager node.\r\n\t *\r\n\t * @type String\r\n\t */\r\n\tcssClass: '',\r\n\r\n\t/**\r\n\t * Active commands list\r\n\t * If some required commands will be missed here, elFinder will add its\r\n\t *\r\n\t * @type Array\r\n\t */\r\n\tcommands: [\r\n\t\t'open', 'reload', 'home', 'up', 'back', 'forward', 'getfile', 'quicklook',\r\n\t\t'download', 'rm', 'duplicate', 'rename', 'mkdir', 'mkfile', 'upload', 'copy',\r\n\t\t'cut', 'paste', 'edit', 'extract', 'archive', 'search', 'info', 'view', 'help', 'resize', 'sort', 'netmount'\r\n\t],\r\n\r\n\t/**\r\n\t * Commands options.\r\n\t *\r\n\t * @type Object\r\n\t **/\r\n\tcommandsOptions: {\r\n\t\t// \"getfile\" command options.\r\n\t\tgetfile: {\r\n\t\t\tonlyURL: false,\r\n\t\t\t// allow to return multiple files info\r\n\t\t\tmultiple: false,\r\n\t\t\t// allow to return filers info\r\n\t\t\tfolders: false,\r\n\t\t\t// action after callback (\"\"/\"close\"/\"destroy\")\r\n\t\t\toncomplete: ''\r\n\t\t},\r\n\t\t// \"upload\" command options.\r\n\t\tupload: {\r\n\t\t\tui: 'uploadbutton'\r\n\t\t},\r\n\t\t// \"quicklook\" command options.\r\n\t\tquicklook: {\r\n\t\t\tautoplay: true,\r\n\t\t\tjplayer: 'extensions/jplayer'\r\n\t\t},\r\n\t\t// \"quicklook\" command options.\r\n\t\tedit: {\r\n\t\t\t// list of allowed mimetypes to edit\r\n\t\t\t// if empty - any text files can be edited\r\n\t\t\tmimes: [],\r\n\t\t\t// edit files in wysisyg's\r\n\t\t\teditors: [\r\n\t\t\t\t//{\r\n\t\t\t\t//\t/**\r\n\t\t\t\t//\t * files mimetypes allowed to edit in current wysisyg\r\n\t\t\t\t//\t * @type  Array\r\n\t\t\t\t//\t */\r\n\t\t\t\t//\tmimes : ['text/html', 'text/plain'],\r\n\t\t\t\t//\t/**\r\n\t\t\t\t//\t * Called when \"edit\" dialog loaded.\r\n\t\t\t\t//\t * Place to init wysisyg.\r\n\t\t\t\t//\t * Can return wysisyg instance\r\n\t\t\t\t//\t *\r\n\t\t\t\t//\t * @param  DOMElement  textarea node\r\n\t\t\t\t//\t * @return Object\r\n\t\t\t\t//\t */\r\n\t\t\t\t//\tload : function(textarea) {},\r\n\t\t\t\t//\t/**\r\n\t\t\t\t//\t * Called before \"edit\" dialog closed.\r\n\t\t\t\t//\t * Place to destroy wysisyg instance.\r\n\t\t\t\t//\t *\r\n\t\t\t\t//\t * @param  DOMElement  textarea node\r\n\t\t\t\t//\t * @param  Object      wysisyg instance (if was returned by \"load\" callback)\r\n\t\t\t\t//\t * @return void\r\n\t\t\t\t//\t */\r\n\t\t\t\t//\tclose : function(textarea, instance) {},\r\n\t\t\t\t//\t/**\r\n\t\t\t\t//\t * Called before file content send to backend.\r\n\t\t\t\t//\t * Place to update textarea content if needed.\r\n\t\t\t\t//\t *\r\n\t\t\t\t//\t * @param  DOMElement  textarea node\r\n\t\t\t\t//\t * @param  Object      wysisyg instance (if was returned by \"load\" callback)\r\n\t\t\t\t//\t * @return void\r\n\t\t\t\t//\t */\r\n\t\t\t\t//\tsave : function(textarea, editor) {}\r\n\t\t\t\t//\r\n\t\t\t\t//}\r\n\t\t\t]\r\n\t\t},\r\n\t\t// \"info\" command options.\r\n\t\tinfo: {nullUrlDirLinkSelf: true},\r\n\r\n\r\n\t\thelp: {view: ['about', 'shortcuts', 'help']}\r\n\t},\r\n\r\n\t/**\r\n\t * Callback for \"getfile\" commands.\r\n\t * Required to use elFinder with WYSIWYG editors etc..\r\n\t *\r\n\t * @type Function\r\n\t * @default null (command not active)\r\n\t */\r\n\tgetFileCallback: null,\r\n\r\n\t/**\r\n\t * Default directory view. icons/list\r\n\t *\r\n\t * @type String\r\n\t * @default \"icons\"\r\n\t */\r\n\tdefaultView: 'icons',\r\n\r\n\t/**\r\n\t * UI plugins to load.\r\n\t * Current dir ui and dialogs loads always.\r\n\t * Here set not required plugins as folders tree/toolbar/statusbar etc.\r\n\t *\r\n\t * @type Array\r\n\t * @default ['toolbar', 'tree', 'path', 'stat']\r\n\t * @full ['toolbar', 'places', 'tree', 'path', 'stat']\r\n\t */\r\n\tui: ['toolbar', 'tree', 'path', 'stat'],\r\n\r\n\t/**\r\n\t * Some UI plugins options.\r\n\t * @type Object\r\n\t */\r\n\tuiOptions: {\r\n\t\t// toolbar configuration\r\n\t\ttoolbar: [\r\n\t\t\t['back', 'forward'],\r\n\t\t\t['netmount'],\r\n\t\t\t// ['reload'],\r\n\t\t\t// ['home', 'up'],\r\n\t\t\t['mkdir', 'mkfile', 'upload'],\r\n\t\t\t['open', 'download', 'getfile'],\r\n\t\t\t['info'],\r\n\t\t\t['quicklook'],\r\n\t\t\t['copy', 'cut', 'paste'],\r\n\t\t\t['rm'],\r\n\t\t\t['duplicate', 'rename', 'edit', 'resize'],\r\n\t\t\t['extract', 'archive'],\r\n\t\t\t['search'],\r\n\t\t\t['view', 'sort'],\r\n\t\t\t['help']\r\n\t\t],\r\n\t\t// directories tree options\r\n\t\ttree: {\r\n\t\t\t// expand current root on init\r\n\t\t\topenRootOnLoad: true,\r\n\t\t\t// auto load current dir parents\r\n\t\t\tsyncTree: true\r\n\t\t},\r\n\t\t// navbar options\r\n\t\tnavbar: {\r\n\t\t\tminWidth: 150,\r\n\t\t\tmaxWidth: 500\r\n\t\t},\r\n\t\tcwd: {\r\n\t\t\t// display parent folder with \"..\" name :)\r\n\t\t\toldSchool: false\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Display only required files by types\r\n\t *\r\n\t * @type Array\r\n\t * @default []\r\n\t * @example\r\n\t *  onlyMimes : [\"image\"] - display all images\r\n\t *  onlyMimes : [\"image/png\", \"application/x-shockwave-flash\"] - display png and flash\r\n\t */\r\n\tonlyMimes: [],\r\n\r\n\t/**\r\n\t * Custom files sort rules.\r\n\t * All default rules (name/size/kind/date) set in elFinder._sortRules\r\n\t *\r\n\t * @type {Object}\r\n\t * @example\r\n\t * sortRules : {\r\n\t *   name : function(file1, file2) { return file1.name.toLowerCase().localeCompare(file2.name.toLowerCase()); }\r\n\t * }\r\n\t */\r\n\tsortRules: {},\r\n\r\n\t/**\r\n\t * Default sort type.\r\n\t *\r\n\t * @type {String}\r\n\t */\r\n\tsortType: 'name',\r\n\r\n\t/**\r\n\t * Default sort order.\r\n\t *\r\n\t * @type {String}\r\n\t * @default \"asc\"\r\n\t */\r\n\tsortOrder: 'asc',\r\n\r\n\t/**\r\n\t * Display folders first?\r\n\t *\r\n\t * @type {Boolean}\r\n\t * @default true\r\n\t */\r\n\tsortStickFolders: true,\r\n\r\n\t/**\r\n\t * If true - elFinder will formating dates itself,\r\n\t * otherwise - backend date will be used.\r\n\t *\r\n\t * @type Boolean\r\n\t */\r\n\tclientFormatDate: true,\r\n\r\n\t/**\r\n\t * Show UTC dates.\r\n\t * Required set clientFormatDate to true\r\n\t *\r\n\t * @type Boolean\r\n\t */\r\n\tUTCDate: false,\r\n\r\n\t/**\r\n\t * File modification datetime format.\r\n\t * Value from selected language data  is used by default.\r\n\t * Set format here to overwrite it.\r\n\t *\r\n\t * @type String\r\n\t * @default  \"\"\r\n\t */\r\n\tdateFormat: '',\r\n\r\n\t/**\r\n\t * File modification datetime format in form \"Yesterday 12:23:01\".\r\n\t * Value from selected language data is used by default.\r\n\t * Set format here to overwrite it.\r\n\t * Use $1 for \"Today\"/\"Yesterday\" placeholder\r\n\t *\r\n\t * @type String\r\n\t * @default  \"\"\r\n\t * @example \"$1 H:m:i\"\r\n\t */\r\n\tfancyDateFormat: '',\r\n\r\n\t/**\r\n\t * elFinder width\r\n\t *\r\n\t * @type String|Number\r\n\t * @default  \"auto\"\r\n\t */\r\n\twidth: 'auto',\r\n\r\n\t/**\r\n\t * elFinder height\r\n\t *\r\n\t * @type Number\r\n\t * @default  \"auto\"\r\n\t */\r\n\theight: 400,\r\n\r\n\t/**\r\n\t * Make elFinder resizable if jquery ui resizable available\r\n\t *\r\n\t * @type Boolean\r\n\t * @default  true\r\n\t */\r\n\tresizable: true,\r\n\r\n\t/**\r\n\t * Timeout before open notifications dialogs\r\n\t *\r\n\t * @type Number\r\n\t * @default  500 (.5 sec)\r\n\t */\r\n\tnotifyDelay: 500,\r\n\r\n\t/**\r\n\t * Allow shortcuts\r\n\t *\r\n\t * @type Boolean\r\n\t * @default  true\r\n\t */\r\n\tallowShortcuts: true,\r\n\r\n\t/**\r\n\t * Remeber last opened dir to open it after reload or in next session\r\n\t *\r\n\t * @type Boolean\r\n\t * @default  true\r\n\t */\r\n\trememberLastDir: true,\r\n\r\n\t/**\r\n\t * Use browser native history with supported browsers\r\n\t *\r\n\t * @type Boolean\r\n\t * @default  true\r\n\t */\r\n\tuseBrowserHistory: true,\r\n\r\n\t/**\r\n\t * Lazy load config.\r\n\t * How many files display at once?\r\n\t *\r\n\t * @type Number\r\n\t * @default  50\r\n\t */\r\n\tshowFiles: 30,\r\n\r\n\t/**\r\n\t * Lazy load config.\r\n\t * Distance in px to cwd bottom edge to start display files\r\n\t *\r\n\t * @type Number\r\n\t * @default  50\r\n\t */\r\n\tshowThreshold: 50,\r\n\r\n\t/**\r\n\t * Additional rule to valid new file name.\r\n\t * By default not allowed empty names or '..'\r\n\t *\r\n\t * @type false|RegExp|function\r\n\t * @default  false\r\n\t * @example\r\n\t *  disable names with spaces:\r\n\t *  validName : /^[^\\s]$/\r\n\t */\r\n\tvalidName: false,\r\n\r\n\t/**\r\n\t * Sync content interval\r\n\t * @todo - fix in elFinder\r\n\t * @type Number\r\n\t * @default  0 (do not sync)\r\n\t */\r\n\tsync: 0,\r\n\r\n\t/**\r\n\t * How many thumbnails create in one request\r\n\t *\r\n\t * @type Number\r\n\t * @default  5\r\n\t */\r\n\tloadTmbs: 5,\r\n\r\n\t/**\r\n\t * Cookie option for browsersdoes not suppot localStorage\r\n\t *\r\n\t * @type Object\r\n\t */\r\n\tcookie: {\r\n\t\texpires: 30,\r\n\t\tdomain: '',\r\n\t\tpath: '/',\r\n\t\tsecure: false\r\n\t},\r\n\r\n\t/**\r\n\t * Contextmenu config\r\n\t *\r\n\t * @type Object\r\n\t */\r\n\tcontextmenu: {\r\n\t\t// navbarfolder menu\r\n\t\tnavbar: ['open', '|', 'copy', 'cut', 'paste', 'duplicate', '|', 'rm', '|', 'info'],\r\n\t\t// current directory menu\r\n\t\tcwd: ['reload', 'back', '|', 'upload', 'mkdir', 'mkfile', 'paste', '|', 'sort', '|', 'info'],\r\n\t\t// current directory file menu\r\n\t\tfiles: ['getfile', '|', 'open', 'quicklook', '|', 'download', '|', 'copy', 'cut', 'paste', 'duplicate', '|', 'rm', '|', 'edit', 'rename', 'resize', '|', 'archive', 'extract', '|', 'info']\r\n\t},\r\n\r\n\t/**\r\n\t * Debug config\r\n\t *\r\n\t * @type Array|Boolean\r\n\t */\r\n\t// debug : true\r\n\tdebug: ['error', 'warning', 'event-destroy']\r\n}","/**\r\n * @class elFinder.history\r\n * Store visited folders\r\n * and provide \"back\" and \"forward\" methods\r\n *\r\n * @author Dmitry (dio) Levashov\r\n */\r\nelFinder.prototype.history = function (fm) {\r\n\tvar self = this,\r\n\t\t/**\r\n\t\t * Update history on \"open\" event?\r\n\t\t *\r\n\t\t * @type Boolean\r\n\t\t */\r\n\t\tupdate = true,\r\n\t\t/**\r\n\t\t * Directories hashes storage\r\n\t\t *\r\n\t\t * @type Array\r\n\t\t */\r\n\t\thistory = [],\r\n\t\t/**\r\n\t\t * Current directory index in history\r\n\t\t *\r\n\t\t * @type Number\r\n\t\t */\r\n\t\tcurrent,\r\n\t\t/**\r\n\t\t * Clear history\r\n\t\t *\r\n\t\t * @return void\r\n\t\t */\r\n\t\treset = function () {\r\n\t\t\thistory = [fm.cwd().hash];\r\n\t\t\tcurrent = 0;\r\n\t\t\tupdate = true;\r\n\t\t},\r\n\t\t/**\r\n\t\t * Browser native history object\r\n\t\t */\r\n\t\tnativeHistory = (fm.options.useBrowserHistory && window.history && window.history.pushState) ? window.history : null,\r\n\t\t/**\r\n\t\t * Open prev/next folder\r\n\t\t *\r\n\t\t * @Boolen  open next folder?\r\n\t\t * @return jQuery.Deferred\r\n\t\t */\r\n\t\tgo = function (fwd) {\r\n\t\t\tif ((fwd && self.canForward()) || (!fwd && self.canBack())) {\r\n\t\t\t\tupdate = false;\r\n\t\t\t\treturn fm.exec('open', history[fwd ? ++current : --current]).fail(reset);\r\n\t\t\t}\r\n\t\t\treturn $.Deferred().reject();\r\n\t\t};\r\n\r\n\t/**\r\n\t * Return true if there is previous visited directories\r\n\t *\r\n\t * @return Boolen\r\n\t */\r\n\tthis.canBack = function () {\r\n\t\treturn current > 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Return true if can go forward\r\n\t *\r\n\t * @return Boolen\r\n\t */\r\n\tthis.canForward = function () {\r\n\t\treturn current < history.length - 1;\r\n\t}\r\n\r\n\t/**\r\n\t * Go back\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tthis.back = go;\r\n\r\n\t/**\r\n\t * Go forward\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tthis.forward = function () {\r\n\t\treturn go(true);\r\n\t}\r\n\r\n\t// bind to elfinder events\r\n\tfm.open(function (e) {\r\n\t\tvar l = history.length,\r\n\t\t\tcwd = fm.cwd().hash;\r\n\r\n\t\tif (update) {\r\n\t\t\tcurrent >= 0 && l > current + 1 && history.splice(current + 1);\r\n\t\t\thistory[history.length - 1] != cwd && history.push(cwd);\r\n\t\t\tcurrent = history.length - 1;\r\n\t\t}\r\n\t\tupdate = true;\r\n\r\n\t\tif (nativeHistory) {\r\n\t\t\tif (!nativeHistory.state) {\r\n\t\t\t\tnativeHistory.replaceState({thash: cwd}, null, location.pathname + location.search + '#elf_' + cwd);\r\n\t\t\t} else {\r\n\t\t\t\tnativeHistory.state.thash != cwd && nativeHistory.pushState({thash: cwd}, null, location.pathname + location.search + '#elf_' + cwd);\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n\t\t.reload(reset);\r\n\r\n}","/**\r\n * elFinder command prototype\r\n *\r\n * @type  elFinder.command\r\n * @author  Dmitry (dio) Levashov\r\n */\r\nelFinder.prototype.command = function (fm) {\r\n\r\n\t/**\r\n\t * elFinder instance\r\n\t *\r\n\t * @type  elFinder\r\n\t */\r\n\tthis.fm = fm;\r\n\r\n\t/**\r\n\t * Command name, same as class name\r\n\t *\r\n\t * @type  String\r\n\t */\r\n\tthis.name = '';\r\n\r\n\t/**\r\n\t * Short command description\r\n\t *\r\n\t * @type  String\r\n\t */\r\n\tthis.title = '';\r\n\r\n\t/**\r\n\t * Current command state\r\n\t *\r\n\t * @example\r\n\t * this.state = -1; // command disabled\r\n\t * this.state = 0;  // command enabled\r\n\t * this.state = 1;  // command active (for example \"fullscreen\" command while elfinder in fullscreen mode)\r\n\t * @default -1\r\n\t * @type  Number\r\n\t */\r\n\tthis.state = -1;\r\n\r\n\t/**\r\n\t * If true, command can not be disabled by connector.\r\n\t * @see this.update()\r\n\t *\r\n\t * @type  Boolen\r\n\t */\r\n\tthis.alwaysEnabled = false;\r\n\r\n\t/**\r\n\t * If true, this means command was disabled by connector.\r\n\t * @see this.update()\r\n\t *\r\n\t * @type  Boolen\r\n\t */\r\n\tthis._disabled = false;\r\n\r\n\tthis.disableOnSearch = false;\r\n\r\n\tthis.updateOnSelect = true;\r\n\r\n\t/**\r\n\t * elFinder events defaults handlers.\r\n\t * Inside handlers \"this\" is current command object\r\n\t *\r\n\t * @type  Object\r\n\t */\r\n\tthis._handlers = {\r\n\t\tenable: function () {\r\n\t\t\tthis.update(void(0), this.value);\r\n\t\t},\r\n\t\tdisable: function () {\r\n\t\t\tthis.update(-1, this.value);\r\n\t\t},\r\n\t\t'open reload load': function (e) {\r\n\t\t\tthis._disabled = !(this.alwaysEnabled || this.fm.isCommandEnabled(this.name));\r\n\t\t\tthis.update(void(0), this.value)\r\n\t\t\tthis.change();\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * elFinder events handlers.\r\n\t * Inside handlers \"this\" is current command object\r\n\t *\r\n\t * @type  Object\r\n\t */\r\n\tthis.handlers = {}\r\n\r\n\t/**\r\n\t * Shortcuts\r\n\t *\r\n\t * @type  Array\r\n\t */\r\n\tthis.shortcuts = [];\r\n\r\n\t/**\r\n\t * Command options\r\n\t *\r\n\t * @type  Object\r\n\t */\r\n\tthis.options = {ui: 'button'};\r\n\r\n\t/**\r\n\t * Prepare object -\r\n\t * bind events and shortcuts\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tthis.setup = function (name, opts) {\r\n\t\tvar self = this,\r\n\t\t\tfm = this.fm, i, s;\r\n\r\n\t\tthis.name = name;\r\n\t\tthis.title = fm.messages['cmd' + name] ? fm.i18n('cmd' + name) : name,\r\n\t\t\tthis.options = $.extend({}, this.options, opts);\r\n\t\tthis.listeners = [];\r\n\r\n\t\tif (this.updateOnSelect) {\r\n\t\t\tthis._handlers.select = function () {\r\n\t\t\t\tthis.update(void(0), this.value);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t$.each($.extend({}, self._handlers, self.handlers), function (cmd, handler) {\r\n\t\t\tfm.bind(cmd, $.proxy(handler, self));\r\n\t\t});\r\n\r\n\t\tfor (i = 0; i < this.shortcuts.length; i++) {\r\n\t\t\ts = this.shortcuts[i];\r\n\t\t\ts.callback = $.proxy(s.callback || function () {\r\n\t\t\t\tthis.exec()\r\n\t\t\t}, this);\r\n\t\t\t!s.description && (s.description = this.title);\r\n\t\t\tfm.shortcut(s);\r\n\t\t}\r\n\r\n\t\tif (this.disableOnSearch) {\r\n\t\t\tfm.bind('search searchend', function (e) {\r\n\t\t\t\tself._disabled = e.type == 'search';\r\n\t\t\t\tself.update(void(0), self.value);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis.init();\r\n\t}\r\n\r\n\t/**\r\n\t * Command specific init stuffs\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tthis.init = function () {}\r\n\r\n\t/**\r\n\t * Exec command\r\n\t *\r\n\t * @param  Array         target files hashes\r\n\t * @param  Array|Object  command value\r\n\t * @return $.Deferred\r\n\t */\r\n\tthis.exec = function (files, opts) {\r\n\t\treturn $.Deferred().reject();\r\n\t}\r\n\r\n\t/**\r\n\t * Return true if command disabled.\r\n\t *\r\n\t * @return Boolen\r\n\t */\r\n\tthis.disabled = function () {\r\n\t\treturn this.state < 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Return true if command enabled.\r\n\t *\r\n\t * @return Boolen\r\n\t */\r\n\tthis.enabled = function () {\r\n\t\treturn this.state > -1;\r\n\t}\r\n\r\n\t/**\r\n\t * Return true if command active.\r\n\t *\r\n\t * @return Boolen\r\n\t */\r\n\tthis.active = function () {\r\n\t\treturn this.state > 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Return current command state.\r\n\t * Must be overloaded in most commands\r\n\t *\r\n\t * @return Number\r\n\t */\r\n\tthis.getstate = function () {\r\n\t\treturn -1;\r\n\t}\r\n\r\n\t/**\r\n\t * Update command state/value\r\n\t * and rize 'change' event if smth changed\r\n\t *\r\n\t * @param  Number  new state or undefined to auto update state\r\n\t * @param  mixed   new value\r\n\t * @return void\r\n\t */\r\n\tthis.update = function (s, v) {\r\n\t\tvar state = this.state,\r\n\t\t\tvalue = this.value;\r\n\r\n\t\tif (this._disabled) {\r\n\t\t\tthis.state = -1;\r\n\t\t} else {\r\n\t\t\tthis.state = s !== void(0) ? s : this.getstate();\r\n\t\t}\r\n\r\n\t\tthis.value = v;\r\n\r\n\t\tif (state != this.state || value != this.value) {\r\n\t\t\tthis.change();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Bind handler / fire 'change' event.\r\n\t *\r\n\t * @param  Function|undefined  event callback\r\n\t * @return void\r\n\t */\r\n\tthis.change = function (c) {\r\n\t\tvar cmd, i;\r\n\r\n\t\tif (typeof(c) === 'function') {\r\n\t\t\tthis.listeners.push(c);\r\n\t\t} else {\r\n\t\t\tfor (i = 0; i < this.listeners.length; i++) {\r\n\t\t\t\tcmd = this.listeners[i];\r\n\t\t\t\ttry {\r\n\t\t\t\t\tcmd(this.state, this.value);\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tthis.fm.debug('error', e)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * With argument check given files hashes and return list of existed files hashes.\r\n\t * Without argument return selected files hashes.\r\n\t *\r\n\t * @param  Array|String|void  hashes\r\n\t * @return Array\r\n\t */\r\n\tthis.hashes = function (hashes) {\r\n\t\treturn hashes\r\n\t\t\t? $.map($.isArray(hashes) ? hashes : [hashes], function (hash) {\r\n\t\t\treturn fm.file(hash) ? hash : null;\r\n\t\t})\r\n\t\t\t: fm.selected();\r\n\t}\r\n\r\n\t/**\r\n\t * Return only existed files from given fils hashes | selected files\r\n\t *\r\n\t * @param  Array|String|void  hashes\r\n\t * @return Array\r\n\t */\r\n\tthis.files = function (hashes) {\r\n\t\tvar fm = this.fm;\r\n\r\n\t\treturn hashes\r\n\t\t\t? $.map($.isArray(hashes) ? hashes : [hashes], function (hash) {\r\n\t\t\treturn fm.file(hash) || null\r\n\t\t})\r\n\t\t\t: fm.selectedFiles();\r\n\t}\r\n}","/**\r\n * elFinder resources registry.\r\n * Store shared data\r\n *\r\n * @type Object\r\n * @author Dmitry (dio) Levashov\r\n **/\r\nelFinder.prototype.resources = {\r\n\t'class': {\r\n\t\thover: 'ui-state-hover',\r\n\t\tactive: 'ui-state-active',\r\n\t\tdisabled: 'disabled',\r\n\t\tdraggable: 'ui-draggable',\r\n\t\tdroppable: 'ui-droppable',\r\n\t\tadroppable: 'elfinder-droppable-active',\r\n\t\tcwdfile: 'elfinder-cwd-file',\r\n\t\tcwd: 'elfinder-cwd',\r\n\t\ttree: 'elfinder-tree',\r\n\t\ttreeroot: 'elfinder-navbar-root',\r\n\t\tnavdir: 'elfinder-navbar-dir',\r\n\t\tnavdirwrap: 'elfinder-navbar-dir-wrapper',\r\n\t\tnavarrow: 'elfinder-navbar-arrow',\r\n\t\tnavsubtree: 'elfinder-navbar-subtree',\r\n\t\tnavcollapse: 'elfinder-navbar-collapsed',\r\n\t\tnavexpand: 'elfinder-navbar-expanded',\r\n\t\ttreedir: 'elfinder-tree-dir',\r\n\t\tplacedir: 'elfinder-place-dir',\r\n\t\tsearchbtn: 'elfinder-button-search'\r\n\t},\r\n\ttpl: {\r\n\t\tperms: '<span class=\"elfinder-perms\"/>',\r\n\t\tsymlink: '<span class=\"elfinder-symlink\"/>',\r\n\t\tnavicon: '<span class=\"elfinder-nav-icon\"/>',\r\n\t\tnavspinner: '<span class=\"elfinder-navbar-spinner\"/>',\r\n\t\tnavdir: '<div class=\"elfinder-navbar-wrapper\"><span id=\"{id}\" class=\" elfinder-navbar-dir {cssclass}\"><span class=\"elfinder-navbar-arrow\"/><span class=\"elfinder-navbar-icon\"/>{symlink}{permissions}{name}</span><div class=\"elfinder-navbar-subtree\"/></div>'\r\n\r\n\t},\r\n\r\n\tmimes: {\r\n\t\ttext: [\r\n\t\t\t'application/x-empty',\r\n\t\t\t'application/javascript',\r\n\t\t\t'application/json',\r\n\t\t\t'text/html',\r\n\t\t\t'application/xhtml+xml',\r\n\t\t\t'audio/x-mp3-playlist',\r\n\t\t\t'application/x-web-config',\r\n\t\t\t'application/docbook+xml',\r\n\t\t\t'application/x-php',\r\n\t\t\t'application/x-perl',\r\n\t\t\t'application/x-awk',\r\n\t\t\t'application/x-config',\r\n\t\t\t'application/x-csh',\r\n\t\t\t'application/xml'\r\n\t\t]\r\n\t},\r\n\r\n\tmixin: {\r\n\t\tmake: function () {\r\n\t\t\tvar fm = this.fm,\r\n\t\t\t\tcmd = this.name,\r\n\t\t\t\tcwd = fm.getUI('cwd'),\r\n\t\t\t\tdfrd = $.Deferred()\r\n\t\t\t\t\t.fail(function (error) {\r\n\t\t\t\t\t\tcwd.trigger('unselectall');\r\n\t\t\t\t\t\terror && fm.error(error);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.always(function () {\r\n\t\t\t\t\t\tinput.remove();\r\n\t\t\t\t\t\tnode.remove();\r\n\t\t\t\t\t\tfm.enable();\r\n\t\t\t\t\t}),\r\n\t\t\t\tid = 'tmp_' + parseInt(Math.random() * 100000),\r\n\t\t\t\tphash = fm.cwd().hash,\r\n\t\t\t\tdate = new Date(),\r\n\t\t\t\tfile = {\r\n\t\t\t\t\thash: id,\r\n\t\t\t\t\tname: fm.uniqueName(this.prefix),\r\n\t\t\t\t\tmime: this.mime,\r\n\t\t\t\t\tread: true,\r\n\t\t\t\t\twrite: true,\r\n\t\t\t\t\tdate: 'Today ' + date.getHours() + ':' + date.getMinutes()\r\n\t\t\t\t},\r\n\t\t\t\tnode = cwd.trigger('create.' + fm.namespace, file).find('#' + id),\r\n\t\t\t\tinput = $('<input type=\"text\"/>')\r\n\t\t\t\t\t.keydown(function (e) {\r\n\t\t\t\t\t\te.stopImmediatePropagation();\r\n\r\n\t\t\t\t\t\tif (e.keyCode == $.ui.keyCode.ESCAPE) {\r\n\t\t\t\t\t\t\tdfrd.reject();\r\n\t\t\t\t\t\t} else if (e.keyCode == $.ui.keyCode.ENTER) {\r\n\t\t\t\t\t\t\tinput.blur();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.mousedown(function (e) {\r\n\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.blur(function () {\r\n\t\t\t\t\t\tvar name = $.trim(input.val()),\r\n\t\t\t\t\t\t\tparent = input.parent();\r\n\r\n\t\t\t\t\t\tif (parent.length) {\r\n\r\n\t\t\t\t\t\t\tif (!name) {\r\n\t\t\t\t\t\t\t\treturn dfrd.reject('errInvName');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (fm.fileByName(name, phash)) {\r\n\t\t\t\t\t\t\t\treturn dfrd.reject(['errExists', name]);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tparent.html(fm.escape(name));\r\n\r\n\t\t\t\t\t\t\tfm.lockfiles({files: [id]});\r\n\r\n\t\t\t\t\t\t\tfm.request({\r\n\t\t\t\t\t\t\t\tdata: {cmd: cmd, name: name, target: phash},\r\n\t\t\t\t\t\t\t\tnotify: {type: cmd, cnt: 1},\r\n\t\t\t\t\t\t\t\tpreventFail: true,\r\n\t\t\t\t\t\t\t\tsyncOnFail: true\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.fail(function (error) {\r\n\t\t\t\t\t\t\t\t\tdfrd.reject(error);\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.done(function (data) {\r\n\t\t\t\t\t\t\t\t\tdfrd.resolve(data);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\r\n\t\t\tif (this.disabled() || !node.length) {\r\n\t\t\t\treturn dfrd.reject();\r\n\t\t\t}\r\n\r\n\t\t\tfm.disable();\r\n\t\t\tnode.find('.elfinder-cwd-filename').empty('').append(input.val(file.name));\r\n\t\t\tinput.select().focus();\r\n\t\t\tinput[0].setSelectionRange && input[0].setSelectionRange(0, file.name.replace(/\\..+$/, '').length);\r\n\r\n\t\t\treturn dfrd;\r\n\t\t}\r\n\t}\r\n}","/**\r\n * @class dialogelfinder - open elFinder in dialog window\r\n *\r\n * @param  Object  elFinder options with dialog options\r\n * @example\r\n * $(selector).dialogelfinder({\r\n\t *     // some elfinder options\r\n\t *     title          : 'My files', // dialog title, default = \"Files\"\r\n\t *     width          : 850,        // dialog width, default 840\r\n\t *     autoOpen       : false,      // if false - dialog will not be opened after init, default = true\r\n\t *     destroyOnClose : true        // destroy elFinder on close dialog, default = false\r\n\t * })\r\n * @author Dmitry (dio) Levashov\r\n **/\r\n$.fn.dialogelfinder = function (opts) {\r\n\tvar position = 'elfinderPosition',\r\n\t\tdestroy = 'elfinderDestroyOnClose';\r\n\r\n\tthis.not('.elfinder').each(function () {\r\n\r\n\r\n\t\tvar doc = $(document),\r\n\t\t\ttoolbar = $('<div class=\" dialogelfinder-drag\">' + (opts.title || 'Files') + '</div>'),\r\n\t\t\tbutton = $('<a href=\"#\" class=\"dialogelfinder-drag-close \"><span class=\"ui-icon ui-icon-closethick\"/></a>')\r\n\t\t\t\t.appendTo(toolbar)\r\n\t\t\t\t.click(function (e) {\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\tnode.dialogelfinder('close');\r\n\t\t\t\t}),\r\n\t\t\tnode = $(this).addClass('dialogelfinder')\r\n\t\t\t\t.css('position', 'absolute')\r\n\t\t\t\t.hide()\r\n\t\t\t\t.appendTo('body')\r\n\t\t\t\t.draggable({\r\n\t\t\t\t\thandle: '.dialogelfinder-drag',\r\n\t\t\t\t\tcontainment: 'window'\r\n\t\t\t\t})\r\n\t\t\t\t.elfinder(opts)\r\n\t\t\t\t.prepend(toolbar),\r\n\t\t\telfinder = node.elfinder('instance');\r\n\r\n\r\n\t\tnode.width(parseInt(node.width()) || 840) // fix width if set to \"auto\"\r\n\t\t\t.data(destroy, !!opts.destroyOnClose)\r\n\t\t\t.find('.elfinder-toolbar').removeClass('');\r\n\r\n\t\topts.position && node.data(position, opts.position);\r\n\r\n\t\topts.autoOpen !== false && $(this).dialogelfinder('open');\r\n\r\n\t});\r\n\r\n\tif (opts == 'open') {\r\n\t\tvar node = $(this),\r\n\t\t\tpos = node.data(position) || {\r\n\t\t\t\t\ttop: parseInt($(document).scrollTop() + ($(window).height() < node.height() ? 2 : ($(window).height() - node.height()) / 2)),\r\n\t\t\t\t\tleft: parseInt($(document).scrollLeft() + ($(window).width() < node.width() ? 2 : ($(window).width() - node.width()) / 2))\r\n\t\t\t\t},\r\n\t\t\tzindex = 100;\r\n\r\n\t\tif (node.is(':hidden')) {\r\n\r\n\t\t\t$('body').find(':visible').each(function () {\r\n\t\t\t\tvar $this = $(this), z;\r\n\r\n\t\t\t\tif (this !== node[0] && $this.css('position') == 'absolute' && (z = parseInt($this.zIndex())) > zindex) {\r\n\t\t\t\t\tzindex = z + 1;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tnode.zIndex(zindex).css(pos).show().trigger('resize')\r\n\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\t// fix resize icon position and make elfinder active\r\n\t\t\t\tnode.trigger('resize').mousedown();\r\n\t\t\t}, 200);\r\n\t\t}\r\n\t} else if (opts == 'close') {\r\n\t\tvar node = $(this);\r\n\r\n\t\tif (node.is(':visible')) {\r\n\t\t\t!!node.data(destroy)\r\n\t\t\t\t? node.elfinder('destroy').remove()\r\n\t\t\t\t: node.elfinder('close');\r\n\t\t}\r\n\t} else if (opts == 'instance') {\r\n\t\treturn $(this).getElFinder();\r\n\t}\r\n\r\n\treturn this;\r\n}","/**\r\n * English translation\r\n * @author Troex Nevelin <troex@fury.scancode.ru>\r\n * @version 2013-07-03\r\n */\r\nif (elFinder && elFinder.prototype && typeof(elFinder.prototype.i18) == 'object') {\r\n\telFinder.prototype.i18.en = {\r\n\t\ttranslator: 'Troex Nevelin &lt;troex@fury.scancode.ru&gt;',\r\n\t\tlanguage: 'English',\r\n\t\tdirection: 'ltr',\r\n\t\tdateFormat: 'M d, Y h:i A', // Mar 13, 2012 05:27 PM\r\n\t\tfancyDateFormat: '$1 h:i A', // will produce smth like: Today 12:25 PM\r\n\t\tmessages: {\r\n\t\t\t/********************************** errors **********************************/\r\n\t\t\t'error': 'Error',\r\n\t\t\t'errUnknown': 'Unknown error.',\r\n\t\t\t'errUnknownCmd': 'Unknown command.',\r\n\t\t\t'errJqui': 'Invalid jQuery UI configuration. Selectable, draggable and droppable components must be included.',\r\n\t\t\t'errNode': 'elFinder requires DOM Element to be created.',\r\n\t\t\t'errURL': 'Invalid elFinder configuration! URL option is not set.',\r\n\t\t\t'errAccess': 'Access denied.',\r\n\t\t\t'errConnect': 'Unable to connect to backend.',\r\n\t\t\t'errAbort': 'Connection aborted.',\r\n\t\t\t'errTimeout': 'Connection timeout.',\r\n\t\t\t'errNotFound': 'Backend not found.',\r\n\t\t\t'errResponse': 'Invalid backend response.',\r\n\t\t\t'errConf': 'Invalid backend configuration.',\r\n\t\t\t'errJSON': 'PHP JSON module not installed.',\r\n\t\t\t'errNoVolumes': 'Readable volumes not available.',\r\n\t\t\t'errCmdParams': 'Invalid parameters for command \"$1\".',\r\n\t\t\t'errDataNotJSON': 'Data is not JSON.',\r\n\t\t\t'errDataEmpty': 'Data is empty.',\r\n\t\t\t'errCmdReq': 'Backend request requires command name.',\r\n\t\t\t'errOpen': 'Unable to open \"$1\".',\r\n\t\t\t'errNotFolder': 'Object is not a folder.',\r\n\t\t\t'errNotFile': 'Object is not a file.',\r\n\t\t\t'errRead': 'Unable to read \"$1\".',\r\n\t\t\t'errWrite': 'Unable to write into \"$1\".',\r\n\t\t\t'errPerm': 'Permission denied.',\r\n\t\t\t'errLocked': '\"$1\" is locked and can not be renamed, moved or removed.',\r\n\t\t\t'errExists': 'File named \"$1\" already exists.',\r\n\t\t\t'errInvName': 'Invalid file name.',\r\n\t\t\t'errFolderNotFound': 'Folder not found.',\r\n\t\t\t'errFileNotFound': 'File not found.',\r\n\t\t\t'errTrgFolderNotFound': 'Target folder \"$1\" not found.',\r\n\t\t\t'errPopup': 'Browser prevented opening popup window. To open file enable it in browser options.',\r\n\t\t\t'errMkdir': 'Unable to create folder \"$1\".',\r\n\t\t\t'errMkfile': 'Unable to create file \"$1\".',\r\n\t\t\t'errRename': 'Unable to rename \"$1\".',\r\n\t\t\t'errCopyFrom': 'Copying files from volume \"$1\" not allowed.',\r\n\t\t\t'errCopyTo': 'Copying files to volume \"$1\" not allowed.',\r\n\t\t\t'errUpload': 'Upload error.',  // old name - errUploadCommon\r\n\t\t\t'errUploadFile': 'Unable to upload \"$1\".', // old name - errUpload\r\n\t\t\t'errUploadNoFiles': 'No files found for upload.',\r\n\t\t\t'errUploadTotalSize': 'Data exceeds the maximum allowed size.', // old name - errMaxSize\r\n\t\t\t'errUploadFileSize': 'File exceeds maximum allowed size.', //  old name - errFileMaxSize\r\n\t\t\t'errUploadMime': 'File type not allowed.',\r\n\t\t\t'errUploadTransfer': '\"$1\" transfer error.',\r\n\t\t\t'errNotReplace': 'Object \"$1\" already exists at this location and can not be replaced by object with another type.', // new\r\n\t\t\t'errReplace': 'Unable to replace \"$1\".',\r\n\t\t\t'errSave': 'Unable to save \"$1\".',\r\n\t\t\t'errCopy': 'Unable to copy \"$1\".',\r\n\t\t\t'errMove': 'Unable to move \"$1\".',\r\n\t\t\t'errCopyInItself': 'Unable to copy \"$1\" into itself.',\r\n\t\t\t'errRm': 'Unable to remove \"$1\".',\r\n\t\t\t'errRmSrc': 'Unable remove source file(s).',\r\n\t\t\t'errExtract': 'Unable to extract files from \"$1\".',\r\n\t\t\t'errArchive': 'Unable to create archive.',\r\n\t\t\t'errArcType': 'Unsupported archive type.',\r\n\t\t\t'errNoArchive': 'File is not archive or has unsupported archive type.',\r\n\t\t\t'errCmdNoSupport': 'Backend does not support this command.',\r\n\t\t\t'errReplByChild': 'The folder $1 cant be replaced by an item it contains.',\r\n\t\t\t'errArcSymlinks': 'For security reason denied to unpack archives contains symlinks or files with not allowed names.', // edited 24.06.2012\r\n\t\t\t'errArcMaxSize': 'Archive files exceeds maximum allowed size.',\r\n\t\t\t'errResize': 'Unable to resize \"$1\".',\r\n\t\t\t'errResizeDegree': 'Invalid rotate degree.',  // added 7.3.2013\r\n\t\t\t'errResizeRotate': 'Image dose not rotated.',  // added 7.3.2013\r\n\t\t\t'errResizeSize': 'Invalid image size.',  // added 7.3.2013\r\n\t\t\t'errResizeNoChange': 'Image size not changed.',  // added 7.3.2013\r\n\t\t\t'errUsupportType': 'Unsupported file type.',\r\n\t\t\t'errNotUTF8Content': 'File \"$1\" is not in UTF-8 and cannot be edited.',  // added 9.11.2011\r\n\t\t\t'errNetMount': 'Unable to mount \"$1\".', // added 17.04.2012\r\n\t\t\t'errNetMountNoDriver': 'Unsupported protocol.',     // added 17.04.2012\r\n\t\t\t'errNetMountFailed': 'Mount failed.',         // added 17.04.2012\r\n\t\t\t'errNetMountHostReq': 'Host required.', // added 18.04.2012\r\n\t\t\t'errSessionExpires': 'Your session has expired due to inactivity.',\r\n\t\t\t'errCreatingTempDir': 'Unable to create temporary directory: \"$1\"',\r\n\t\t\t'errFtpDownloadFile': 'Unable to download file from FTP: \"$1\"',\r\n\t\t\t'errFtpUploadFile': 'Unable to upload file to FTP: \"$1\"',\r\n\t\t\t'errFtpMkdir': 'Unable to create remote directory on FTP: \"$1\"',\r\n\t\t\t'errArchiveExec': 'Error while archiving files: \"$1\"',\r\n\t\t\t'errExtractExec': 'Error while extracting files: \"$1\"',\r\n\r\n\t\t\t/******************************* commands names ********************************/\r\n\t\t\t'cmdarchive': 'Create archive',\r\n\t\t\t'cmdback': 'Back',\r\n\t\t\t'cmdcopy': 'Copy',\r\n\t\t\t'cmdcut': 'Cut',\r\n\t\t\t'cmddownload': 'Download',\r\n\t\t\t'cmdduplicate': 'Duplicate',\r\n\t\t\t'cmdedit': 'Edit file',\r\n\t\t\t'cmdextract': 'Extract files from archive',\r\n\t\t\t'cmdforward': 'Forward',\r\n\t\t\t'cmdgetfile': 'Select files',\r\n\t\t\t'cmdhelp': 'About this software',\r\n\t\t\t'cmdhome': 'Home',\r\n\t\t\t'cmdinfo': 'Get info',\r\n\t\t\t'cmdmkdir': 'New folder',\r\n\t\t\t'cmdmkfile': 'New text file',\r\n//\t\t\t'cmdopen'      : 'Open',\r\n\t\t\t'cmdpaste': 'Paste',\r\n\t\t\t'cmdquicklook': 'Preview',\r\n\t\t\t'cmdreload': 'Reload',\r\n\t\t\t'cmdrename': 'Rename',\r\n\t\t\t'cmdrm': 'Delete',\r\n\t\t\t'cmdsearch': 'Find files',\r\n\t\t\t'cmdup': 'Go to parent directory',\r\n\t\t\t'cmdupload': 'Upload files',\r\n\t\t\t'cmdview': 'View',\r\n\t\t\t'cmdresize': 'Resize & Rotate',\r\n\t\t\t'cmdsort': 'Sort',\r\n\t\t\t'cmdnetmount': 'Mount network volume', // added 18.04.2012\r\n\r\n\t\t\t/*********************************** buttons ***********************************/\r\n\t\t\t'btnClose': 'Close',\r\n\t\t\t'btnSave': 'Save',\r\n\t\t\t'btnRm': 'Remove',\r\n\t\t\t'btnApply': 'Apply',\r\n\t\t\t'btnCancel': 'Cancel',\r\n\t\t\t'btnNo': 'No',\r\n\t\t\t'btnYes': 'Yes',\r\n\t\t\t'btnMount': 'Mount',  // added 18.04.2012\r\n\t\t\t/******************************** notifications ********************************/\r\n\t\t\t'ntfopen': 'Open folder',\r\n\t\t\t'ntffile': 'Open file',\r\n\t\t\t'ntfreload': 'Reload folder content',\r\n\t\t\t'ntfmkdir': 'Creating directory',\r\n\t\t\t'ntfmkfile': 'Creating files',\r\n\t\t\t'ntfrm': 'Delete files',\r\n\t\t\t'ntfcopy': 'Copy files',\r\n\t\t\t'ntfmove': 'Move files',\r\n\t\t\t'ntfprepare': 'Prepare to copy files',\r\n\t\t\t'ntfrename': 'Rename files',\r\n\t\t\t'ntfupload': 'Uploading files',\r\n\t\t\t'ntfdownload': 'Downloading files',\r\n\t\t\t'ntfsave': 'Save files',\r\n\t\t\t'ntfarchive': 'Creating archive',\r\n\t\t\t'ntfextract': 'Extracting files from archive',\r\n\t\t\t'ntfsearch': 'Searching files',\r\n\t\t\t'ntfresize': 'Resizing images',\r\n\t\t\t'ntfsmth': 'Doing something',\r\n\t\t\t'ntfloadimg': 'Loading image',\r\n\t\t\t'ntfnetmount': 'Mounting network volume', // added 18.04.2012\r\n\t\t\t'ntfdim': 'Acquiring image dimension', // added 20.05.2013\r\n\r\n\t\t\t/************************************ dates **********************************/\r\n\t\t\t'dateUnknown': 'unknown',\r\n\t\t\t'Today': 'Today',\r\n\t\t\t'Yesterday': 'Yesterday',\r\n\t\t\t'Jan': 'Jan',\r\n\t\t\t'Feb': 'Feb',\r\n\t\t\t'Mar': 'Mar',\r\n\t\t\t'Apr': 'Apr',\r\n\t\t\t'May': 'May',\r\n\t\t\t'Jun': 'Jun',\r\n\t\t\t'Jul': 'Jul',\r\n\t\t\t'Aug': 'Aug',\r\n\t\t\t'Sep': 'Sep',\r\n\t\t\t'Oct': 'Oct',\r\n\t\t\t'Nov': 'Nov',\r\n\t\t\t'Dec': 'Dec',\r\n\r\n\t\t\t/******************************** sort variants ********************************/\r\n\t\t\t'sortname': 'by name',\r\n\t\t\t'sortkind': 'by kind',\r\n\t\t\t'sortsize': 'by size',\r\n\t\t\t'sortdate': 'by date',\r\n\t\t\t'sortFoldersFirst': 'Folders first',\r\n\r\n\t\t\t/********************************** messages **********************************/\r\n\t\t\t'confirmReq': 'Confirmation required',\r\n\t\t\t'confirmRm': 'Are you sure you want to remove files?<br/>This cannot be undone!',\r\n\t\t\t'confirmRepl': 'Replace old file with new one?',\r\n\t\t\t'apllyAll': 'Apply to all',\r\n\t\t\t'name': 'Name',\r\n\t\t\t'size': 'Size',\r\n\t\t\t'perms': 'Permissions',\r\n\t\t\t'modify': 'Modified',\r\n\t\t\t'kind': 'Kind',\r\n\t\t\t'read': 'read',\r\n\t\t\t'write': 'write',\r\n\t\t\t'noaccess': 'no access',\r\n\t\t\t'and': 'and',\r\n\t\t\t'unknown': 'unknown',\r\n\t\t\t'selectall': 'Select all files',\r\n\t\t\t'selectfiles': 'Select file(s)',\r\n\t\t\t'selectffile': 'Select first file',\r\n\t\t\t'selectlfile': 'Select last file',\r\n\t\t\t'viewlist': 'List view',\r\n\t\t\t'viewicons': 'Icons view',\r\n\t\t\t'places': 'Places',\r\n\t\t\t'calc': 'Calculate',\r\n\t\t\t'path': 'Path',\r\n\t\t\t'aliasfor': 'Alias for',\r\n\t\t\t'locked': 'Locked',\r\n\t\t\t'dim': 'Dimensions',\r\n\t\t\t'files': 'Files',\r\n\t\t\t'folders': 'Folders',\r\n\t\t\t'items': 'Items',\r\n\t\t\t'yes': 'yes',\r\n\t\t\t'no': 'no',\r\n\t\t\t'link': 'Link',\r\n\t\t\t'searcresult': 'Search results',\r\n\t\t\t'selected': 'selected items',\r\n\t\t\t'about': 'About',\r\n\t\t\t'shortcuts': 'Shortcuts',\r\n\t\t\t'help': 'Help',\r\n\t\t\t'webfm': 'Web file manager',\r\n\t\t\t'ver': 'Version',\r\n\t\t\t'protocolver': 'protocol version',\r\n\t\t\t'homepage': 'Project home',\r\n\t\t\t'docs': 'Documentation',\r\n\t\t\t'github': 'Fork us on Github',\r\n\t\t\t'twitter': 'Follow us on twitter',\r\n\t\t\t'facebook': 'Join us on facebook',\r\n\t\t\t'team': 'Team',\r\n\t\t\t'chiefdev': 'chief developer',\r\n\t\t\t'developer': 'developer',\r\n\t\t\t'contributor': 'contributor',\r\n\t\t\t'maintainer': 'maintainer',\r\n\t\t\t'translator': 'translator',\r\n\t\t\t'icons': 'Icons',\r\n\t\t\t'dontforget': 'and don\\'t forget to take your towel',\r\n\t\t\t'shortcutsof': 'Shortcuts disabled',\r\n\t\t\t'dropFiles': 'Drop files here',\r\n\t\t\t'or': 'or',\r\n\t\t\t'selectForUpload': 'Select files to upload',\r\n\t\t\t'moveFiles': 'Move files',\r\n\t\t\t'copyFiles': 'Copy files',\r\n\t\t\t'rmFromPlaces': 'Remove from places',\r\n\t\t\t'aspectRatio': 'Aspect ratio',\r\n\t\t\t'scale': 'Scale',\r\n\t\t\t'width': 'Width',\r\n\t\t\t'height': 'Height',\r\n\t\t\t'resize': 'Resize',\r\n\t\t\t'crop': 'Crop',\r\n\t\t\t'rotate': 'Rotate',\r\n\t\t\t'rotate-cw': 'Rotate 90 degrees CW',\r\n\t\t\t'rotate-ccw': 'Rotate 90 degrees CCW',\r\n\t\t\t'degree': '',\r\n\t\t\t'netMountDialogTitle': 'Mount network volume', // added 18.04.2012\r\n\t\t\t'protocol': 'Protocol', // added 18.04.2012\r\n\t\t\t'host': 'Host', // added 18.04.2012\r\n\t\t\t'port': 'Port', // added 18.04.2012\r\n\t\t\t'user': 'User', // added 18.04.2012\r\n\t\t\t'pass': 'Password', // added 18.04.2012\r\n\r\n\t\t\t/********************************** mimetypes **********************************/\r\n\t\t\t'kindUnknown': 'Unknown',\r\n\t\t\t'kindFolder': 'Folder',\r\n\t\t\t'kindAlias': 'Alias',\r\n\t\t\t'kindAliasBroken': 'Broken alias',\r\n\t\t\t// applications\r\n\t\t\t'kindApp': 'Application',\r\n\t\t\t'kindPostscript': 'Postscript document',\r\n\t\t\t'kindMsOffice': 'Microsoft Office document',\r\n\t\t\t'kindMsWord': 'Microsoft Word document',\r\n\t\t\t'kindMsExcel': 'Microsoft Excel document',\r\n\t\t\t'kindMsPP': 'Microsoft Powerpoint presentation',\r\n\t\t\t'kindOO': 'Open Office document',\r\n\t\t\t'kindAppFlash': 'Flash application',\r\n\t\t\t'kindPDF': 'Portable Document Format (PDF)',\r\n\t\t\t'kindTorrent': 'Bittorrent file',\r\n\t\t\t'kind7z': '7z archive',\r\n\t\t\t'kindTAR': 'TAR archive',\r\n\t\t\t'kindGZIP': 'GZIP archive',\r\n\t\t\t'kindBZIP': 'BZIP archive',\r\n\t\t\t'kindZIP': 'ZIP archive',\r\n\t\t\t'kindRAR': 'RAR archive',\r\n\t\t\t'kindJAR': 'Java JAR file',\r\n\t\t\t'kindTTF': 'True Type font',\r\n\t\t\t'kindOTF': 'Open Type font',\r\n\t\t\t'kindRPM': 'RPM package',\r\n\t\t\t// texts\r\n\t\t\t'kindText': 'Text document',\r\n\t\t\t'kindTextPlain': 'Plain text',\r\n\t\t\t'kindPHP': 'PHP source',\r\n\t\t\t'kindCSS': 'Cascading style sheet',\r\n\t\t\t'kindHTML': 'HTML document',\r\n\t\t\t'kindJS': 'Javascript source',\r\n\t\t\t'kindRTF': 'Rich Text Format',\r\n\t\t\t'kindC': 'C source',\r\n\t\t\t'kindCHeader': 'C header source',\r\n\t\t\t'kindCPP': 'C++ source',\r\n\t\t\t'kindCPPHeader': 'C++ header source',\r\n\t\t\t'kindShell': 'Unix shell script',\r\n\t\t\t'kindPython': 'Python source',\r\n\t\t\t'kindJava': 'Java source',\r\n\t\t\t'kindRuby': 'Ruby source',\r\n\t\t\t'kindPerl': 'Perl script',\r\n\t\t\t'kindSQL': 'SQL source',\r\n\t\t\t'kindXML': 'XML document',\r\n\t\t\t'kindAWK': 'AWK source',\r\n\t\t\t'kindCSV': 'Comma separated values',\r\n\t\t\t'kindDOCBOOK': 'Docbook XML document',\r\n\t\t\t// images\r\n\t\t\t'kindImage': 'Image',\r\n\t\t\t'kindBMP': 'BMP image',\r\n\t\t\t'kindJPEG': 'JPEG image',\r\n\t\t\t'kindGIF': 'GIF Image',\r\n\t\t\t'kindPNG': 'PNG Image',\r\n\t\t\t'kindTIFF': 'TIFF image',\r\n\t\t\t'kindTGA': 'TGA image',\r\n\t\t\t'kindPSD': 'Adobe Photoshop image',\r\n\t\t\t'kindXBITMAP': 'X bitmap image',\r\n\t\t\t'kindPXM': 'Pixelmator image',\r\n\t\t\t// media\r\n\t\t\t'kindAudio': 'Audio media',\r\n\t\t\t'kindAudioMPEG': 'MPEG audio',\r\n\t\t\t'kindAudioMPEG4': 'MPEG-4 audio',\r\n\t\t\t'kindAudioMIDI': 'MIDI audio',\r\n\t\t\t'kindAudioOGG': 'Ogg Vorbis audio',\r\n\t\t\t'kindAudioWAV': 'WAV audio',\r\n\t\t\t'AudioPlaylist': 'MP3 playlist',\r\n\t\t\t'kindVideo': 'Video media',\r\n\t\t\t'kindVideoDV': 'DV movie',\r\n\t\t\t'kindVideoMPEG': 'MPEG movie',\r\n\t\t\t'kindVideoMPEG4': 'MPEG-4 movie',\r\n\t\t\t'kindVideoAVI': 'AVI movie',\r\n\t\t\t'kindVideoMOV': 'Quick Time movie',\r\n\t\t\t'kindVideoWM': 'Windows Media movie',\r\n\t\t\t'kindVideoFlash': 'Flash movie',\r\n\t\t\t'kindVideoMKV': 'Matroska movie',\r\n\t\t\t'kindVideoOGG': 'Ogg movie'\r\n\t\t}\r\n\t}\r\n}","/**\r\n * @class  elFinder toolbar button widget.\r\n * If command has variants - create menu\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\n$.fn.elfinderbutton = function (cmd) {\r\n\treturn this.each(function () {\r\n//\t\t\r\n\t\tvar c = 'class',\r\n\t\t\tfm = cmd.fm,\r\n\t\t\tdisabled = fm.res(c, 'disabled'),\r\n\t\t\tactive = fm.res(c, 'active'),\r\n\t\t\thover = fm.res(c, 'hover'),\r\n\t\t\titem = 'elfinder-button-menu-item',\r\n\t\t\tselected = 'elfinder-button-menu-item-selected',\r\n\t\t\tmenu,\r\n\t\t\tbutton = $(this).addClass('btn')\r\n\t\t\t\t.attr('title', cmd.title)\r\n\t\t\t\t.append('<span class=\"elfinder-button-icon elfinder-button-icon-' + cmd.name + '\"/>')\r\n\t\t\t\t.hover(function (e) {\r\n\t\t\t\t\t!button.is('.' + disabled) && button[e.type == 'mouseleave' ? 'removeClass' : 'addClass'](hover)\r\n\t\t\t\t\t/**button.toggleClass(hover);*/\r\n\t\t\t\t})\r\n\t\t\t\t.click(function (e) {\r\n\t\t\t\t\tif (!button.is('.' + disabled)) {\r\n\t\t\t\t\t\tif (menu && cmd.variants.length > 1) {\r\n\t\t\t\t\t\t\t// close other menus\r\n\t\t\t\t\t\t\tmenu.is(':hidden') && cmd.fm.getUI().click();\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t\tmenu.slideToggle(100);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcmd.exec();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.css('cursor', 'pointer'),\r\n\t\t\thideMenu = function () {\r\n\t\t\t\tmenu.hide();\r\n\t\t\t};\r\n\r\n\t\t// if command has variants create menu\r\n\t\tif ($.isArray(cmd.variants)) {\r\n\t\t\tbutton.addClass('elfinder-menubutton');\r\n\r\n\t\t\tmenu = $('<div class=\"ui-widget ui-panel-body elfinder-button-menu \"/>')\r\n\t\t\t\t.hide()\r\n\t\t\t\t.appendTo(button)\r\n\t\t\t\t.zIndex(12 + button.zIndex())\r\n\t\t\t\t.delegate('.' + item, 'hover', function () {\r\n\t\t\t\t\t$(this).toggleClass(hover)\r\n\t\t\t\t})\r\n\t\t\t\t.delegate('.' + item, 'click', function (e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\tbutton.removeClass(hover);\r\n\t\t\t\t\tcmd.exec(cmd.fm.selected(), $(this).data('value'));\r\n\t\t\t\t});\r\n\r\n\t\t\tcmd.fm.bind('disable select', hideMenu).getUI().click(hideMenu);\r\n\r\n\t\t\tcmd.change(function () {\r\n\t\t\t\tmenu.html('');\r\n\t\t\t\t$.each(cmd.variants, function (i, variant) {\r\n\t\t\t\t\tmenu.append($('<div class=\"' + item + '\">' + variant[1] + '</div>').data('value', variant[0]).addClass(variant[0] == cmd.value ? selected : ''));\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tcmd.change(function () {\r\n\t\t\tif (cmd.disabled()) {\r\n\t\t\t\tbutton.removeClass(active + ' ' + hover).addClass(disabled);\r\n\t\t\t} else {\r\n\t\t\t\tbutton.removeClass(disabled);\r\n\t\t\t\tbutton[cmd.active() ? 'addClass' : 'removeClass'](active);\r\n\t\t\t}\r\n\t\t})\r\n\t\t\t.change();\r\n\t});\r\n}","/**\r\n * @class  elFinder contextmenu\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\n$.fn.elfindercontextmenu = function (fm) {\r\n\r\n\treturn this.each(function () {\r\n\t\tvar menu = $(this).addClass('ui-helper-reset ui-widget ui-state-default  elfinder-contextmenu elfinder-contextmenu-' + fm.direction)\r\n\t\t\t\t.hide()\r\n\t\t\t\t.appendTo('body')\r\n\t\t\t\t.delegate('.elfinder-contextmenu-item', 'mouseenter mouseleave', function () {\r\n\t\t\t\t\t$(this).toggleClass('ui-state-hover')\r\n\t\t\t\t}),\r\n\t\t\tsubpos = fm.direction == 'ltr' ? 'left' : 'right',\r\n\t\t\ttypes = $.extend({}, fm.options.contextmenu),\r\n\t\t\ttpl = '<div class=\"elfinder-contextmenu-item\"><span class=\"elfinder-button-icon {icon} elfinder-contextmenu-icon\"/><span>{label}</span></div>',\r\n\t\t\titem = function (label, icon, callback) {\r\n\t\t\t\treturn $(tpl.replace('{icon}', icon ? 'elfinder-button-icon-' + icon : '').replace('{label}', label))\r\n\t\t\t\t\t.click(function (e) {\r\n\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\tcallback();\r\n\t\t\t\t\t})\r\n\t\t\t},\r\n\r\n\t\t\topen = function (x, y) {\r\n\t\t\t\tvar win = $(window),\r\n\t\t\t\t\twidth = menu.outerWidth(),\r\n\t\t\t\t\theight = menu.outerHeight(),\r\n\t\t\t\t\twwidth = win.width(),\r\n\t\t\t\t\twheight = win.height(),\r\n\t\t\t\t\tscrolltop = win.scrollTop(),\r\n\t\t\t\t\tscrollleft = win.scrollLeft(),\r\n\t\t\t\t\tcss = {\r\n\t\t\t\t\t\ttop: (y + height < wheight ? y : y - height > 0 ? y - height : y) + scrolltop,\r\n\t\t\t\t\t\tleft: (x + width < wwidth ? x : x - width) + scrollleft,\r\n\t\t\t\t\t\t'z-index': 100 + fm.getUI('workzone').zIndex()\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\tmenu.css(css)\r\n\t\t\t\t\t.show();\r\n\r\n\t\t\t\tcss = {'z-index': css['z-index'] + 10};\r\n\t\t\t\tcss[subpos] = parseInt(menu.width());\r\n\t\t\t\tmenu.find('.elfinder-contextmenu-sub').css(css);\r\n\t\t\t},\r\n\r\n\t\t\tclose = function () {\r\n\t\t\t\tmenu.hide().empty();\r\n\t\t\t},\r\n\r\n\t\t\tcreate = function (type, targets) {\r\n\t\t\t\tvar sep = false;\r\n\r\n\r\n\t\t\t\t$.each(types[type] || [], function (i, name) {\r\n\t\t\t\t\tvar cmd, node, submenu;\r\n\r\n\t\t\t\t\tif (name == '|' && sep) {\r\n\t\t\t\t\t\tmenu.append('<div class=\"elfinder-contextmenu-separator\"/>');\r\n\t\t\t\t\t\tsep = false;\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcmd = fm.command(name);\r\n\r\n\t\t\t\t\tif (cmd && cmd.getstate(targets) != -1) {\r\n\t\t\t\t\t\tif (cmd.variants) {\r\n\t\t\t\t\t\t\tif (!cmd.variants.length) {\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tnode = item(cmd.title, cmd.name, function () {\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\tsubmenu = $('<div class=\" elfinder-contextmenu-sub\"/>')\r\n\t\t\t\t\t\t\t\t.appendTo(node.append('<span class=\"elfinder-contextmenu-arrow\"/>'));\r\n\r\n\t\t\t\t\t\t\tnode.addClass('elfinder-contextmenu-group')\r\n\t\t\t\t\t\t\t\t.hover(function () {\r\n\t\t\t\t\t\t\t\t\tsubmenu.toggle()\r\n\t\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t\t$.each(cmd.variants, function (i, variant) {\r\n\t\t\t\t\t\t\t\tsubmenu.append(\r\n\t\t\t\t\t\t\t\t\t$('<div class=\"elfinder-contextmenu-item\"><span>' + variant[1] + '</span></div>')\r\n\t\t\t\t\t\t\t\t\t\t.click(function (e) {\r\n\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t\t\t\t\t\tclose();\r\n\t\t\t\t\t\t\t\t\t\t\tcmd.exec(targets, variant[0]);\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tnode = item(cmd.title, cmd.name, function () {\r\n\t\t\t\t\t\t\t\tclose();\r\n\t\t\t\t\t\t\t\tcmd.exec(targets);\r\n\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tmenu.append(node)\r\n\t\t\t\t\t\tsep = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\r\n\t\t\tcreateFromRaw = function (raw) {\r\n\t\t\t\t$.each(raw, function (i, data) {\r\n\t\t\t\t\tvar node;\r\n\r\n\t\t\t\t\tif (data.label && typeof data.callback == 'function') {\r\n\t\t\t\t\t\tnode = item(data.label, data.icon, function () {\r\n\t\t\t\t\t\t\tclose();\r\n\t\t\t\t\t\t\tdata.callback();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tmenu.append(node);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t};\r\n\r\n\t\tfm.one('load', function () {\r\n\t\t\tfm.bind('contextmenu', function (e) {\r\n\t\t\t\tvar data = e.data;\r\n\r\n\t\t\t\tclose();\r\n\r\n\t\t\t\tif (data.type && data.targets) {\r\n\t\t\t\t\tcreate(data.type, data.targets);\r\n\t\t\t\t} else if (data.raw) {\r\n\t\t\t\t\tcreateFromRaw(data.raw);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmenu.children().length && open(data.x, data.y);\r\n\t\t\t})\r\n\t\t\t\t.one('destroy', function () {\r\n\t\t\t\t\tmenu.remove();\r\n\t\t\t\t})\r\n\t\t\t\t.bind('disable select', close)\r\n\t\t\t\t.getUI().click(close);\r\n\t\t});\r\n\t});\r\n}","/**\r\n * elFinder current working directory ui.\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\n$.fn.elfindercwd = function (fm, options) {\r\n\r\n\tthis.not('.elfinder-cwd').each(function () {\r\n\t\t// fm.time('cwdLoad');\r\n\r\n\t\tvar\r\n\t\t\tlist = fm.viewType == 'list',\r\n\r\n\t\t\tundef = 'undefined',\r\n\t\t\t/**\r\n\t\t\t * Select event full name\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t **/\r\n\t\t\tevtSelect = 'select.' + fm.namespace,\r\n\r\n\t\t\t/**\r\n\t\t\t * Unselect event full name\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t **/\r\n\t\t\tevtUnselect = 'unselect.' + fm.namespace,\r\n\r\n\t\t\t/**\r\n\t\t\t * Disable event full name\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t **/\r\n\t\t\tevtDisable = 'disable.' + fm.namespace,\r\n\r\n\t\t\t/**\r\n\t\t\t * Disable event full name\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t **/\r\n\t\t\tevtEnable = 'enable.' + fm.namespace,\r\n\r\n\t\t\tc = 'class',\r\n\t\t\t/**\r\n\t\t\t * File css class\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t **/\r\n\t\t\tclFile = fm.res(c, 'cwdfile'),\r\n\r\n\t\t\t/**\r\n\t\t\t * Selected css class\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t **/\r\n\t\t\tfileSelector = '.' + clFile,\r\n\r\n\t\t\t/**\r\n\t\t\t * Selected css class\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t **/\r\n\t\t\tclSelected = 'ui-selected',\r\n\r\n\t\t\t/**\r\n\t\t\t * Disabled css class\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t **/\r\n\t\t\tclDisabled = fm.res(c, 'disabled'),\r\n\r\n\t\t\t/**\r\n\t\t\t * Draggable css class\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t **/\r\n\t\t\tclDraggable = fm.res(c, 'draggable'),\r\n\r\n\t\t\t/**\r\n\t\t\t * Droppable css class\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t **/\r\n\t\t\tclDroppable = fm.res(c, 'droppable'),\r\n\r\n\t\t\t/**\r\n\t\t\t * Hover css class\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t **/\r\n\t\t\tclHover = fm.res(c, 'hover'),\r\n\r\n\t\t\t/**\r\n\t\t\t * Hover css class\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t **/\r\n\t\t\tclDropActive = fm.res(c, 'adroppable'),\r\n\r\n\t\t\t/**\r\n\t\t\t * Css class for temporary nodes (for mkdir/mkfile) commands\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t **/\r\n\t\t\tclTmp = clFile + '-tmp',\r\n\r\n\t\t\t/**\r\n\t\t\t * Number of thumbnails to load in one request (new api only)\r\n\t\t\t *\r\n\t\t\t * @type Number\r\n\t\t\t **/\r\n\t\t\ttmbNum = fm.options.loadTmbs > 0 ? fm.options.loadTmbs : 5,\r\n\r\n\t\t\t/**\r\n\t\t\t * Current search query.\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t */\r\n\t\t\tquery = '',\r\n\r\n\t\t\tlastSearch = [],\r\n\r\n\t\t\t/**\r\n\t\t\t * File templates\r\n\t\t\t *\r\n\t\t\t * @type Object\r\n\t\t\t **/\r\n\t\t\ttemplates = {\r\n\t\t\t\ticon: '<div id=\"{hash}\" class=\"' + clFile + ' {permsclass} {dirclass} \" title=\"{tooltip}\"><div class=\"elfinder-cwd-file-wrapper \"><div class=\"elfinder-cwd-icon {mime} \" unselectable=\"on\" {style}/>{marker}</div><div class=\"elfinder-cwd-filename\" title=\"{name}\">{name}</div></div>',\r\n\t\t\t\trow: '<tr id=\"{hash}\" class=\"' + clFile + ' {permsclass} {dirclass}\" title=\"{tooltip}\"><td><div class=\"elfinder-cwd-file-wrapper\"><span class=\"elfinder-cwd-icon {mime}\"/>{marker}<span class=\"elfinder-cwd-filename\">{name}</span></div></td><td>{perms}</td><td>{date}</td><td>{size}</td><td>{kind}</td></tr>'\r\n\t\t\t},\r\n\r\n\t\t\tpermsTpl = fm.res('tpl', 'perms'),\r\n\r\n\t\t\tsymlinkTpl = fm.res('tpl', 'symlink'),\r\n\r\n\t\t\t/**\r\n\t\t\t * Template placeholders replacement rules\r\n\t\t\t *\r\n\t\t\t * @type Object\r\n\t\t\t **/\r\n\t\t\treplacement = {\r\n\t\t\t\tpermsclass: function (f) {\r\n\t\t\t\t\treturn fm.perms2class(f);\r\n\t\t\t\t},\r\n\t\t\t\tperms: function (f) {\r\n\t\t\t\t\treturn fm.formatPermissions(f);\r\n\t\t\t\t},\r\n\t\t\t\tdirclass: function (f) {\r\n\t\t\t\t\treturn f.mime == 'directory' ? 'directory' : '';\r\n\t\t\t\t},\r\n\t\t\t\tmime: function (f) {\r\n\t\t\t\t\treturn fm.mime2class(f.mime);\r\n\t\t\t\t},\r\n\t\t\t\tsize: function (f) {\r\n\t\t\t\t\treturn fm.formatSize(f.size);\r\n\t\t\t\t},\r\n\t\t\t\tdate: function (f) {\r\n\t\t\t\t\treturn fm.formatDate(f);\r\n\t\t\t\t},\r\n\t\t\t\tkind: function (f) {\r\n\t\t\t\t\treturn fm.mime2kind(f);\r\n\t\t\t\t},\r\n\t\t\t\tmarker: function (f) {\r\n\t\t\t\t\treturn (f.alias || f.mime == 'symlink-broken' ? symlinkTpl : '') + (!f.read || !f.write ? permsTpl : '');\r\n\t\t\t\t},\r\n\t\t\t\ttooltip: function (f) {\r\n\t\t\t\t\tvar title = fm.formatDate(f) + (f.size > 0 ? ' (' + fm.formatSize(f.size) + ')' : '');\r\n\t\t\t\t\treturn f.tooltip ? fm.escape(f.tooltip).replace(/\"/g, '&quot;').replace(/\\r/g, '&#13;') + '&#13;' + title : title;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Return file html\r\n\t\t\t *\r\n\t\t\t * @param  Object  file info\r\n\t\t\t * @return String\r\n\t\t\t **/\r\n\t\t\titemhtml = function (f) {\r\n\t\t\t\tf.name = fm.escape(f.name);\r\n\t\t\t\treturn templates[list ? 'row' : 'icon']\r\n\t\t\t\t\t.replace(/\\{([a-z]+)\\}/g, function (s, e) {\r\n\t\t\t\t\t\treturn replacement[e] ? replacement[e](f) : (f[e] ? f[e] : '');\r\n\t\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Flag. Required for msie to avoid unselect files on dragstart\r\n\t\t\t *\r\n\t\t\t * @type Boolean\r\n\t\t\t **/\r\n\t\t\tselectLock = false,\r\n\r\n\t\t\t/**\r\n\t\t\t * Move selection to prev/next file\r\n\t\t\t *\r\n\t\t\t * @param String  move direction\r\n\t\t\t * @param Boolean append to current selection\r\n\t\t\t * @return void\r\n\t\t\t * @rise select\r\n\t\t\t */\r\n\t\t\tselect = function (keyCode, append) {\r\n\t\t\t\tvar code = $.ui.keyCode,\r\n\t\t\t\t\tprev = keyCode == code.LEFT || keyCode == code.UP,\r\n\t\t\t\t\tsel = cwd.find('[id].' + clSelected),\r\n\t\t\t\t\tselector = prev ? 'first:' : 'last',\r\n\t\t\t\t\ts, n, sib, top, left;\r\n\r\n\t\t\t\tfunction sibling(n, direction) {\r\n\t\t\t\t\treturn n[direction + 'All']('[id]:not(.' + clDisabled + '):not(.elfinder-cwd-parent):first');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (sel.length) {\r\n\t\t\t\t\ts = sel.filter(prev ? ':first' : ':last');\r\n\t\t\t\t\tsib = sibling(s, prev ? 'prev' : 'next');\r\n\r\n\t\t\t\t\tif (!sib.length) {\r\n\t\t\t\t\t\t// there is no sibling on required side - do not move selection\r\n\t\t\t\t\t\tn = s;\r\n\t\t\t\t\t} else if (list || keyCode == code.LEFT || keyCode == code.RIGHT) {\r\n\t\t\t\t\t\t// find real prevoius file\r\n\t\t\t\t\t\tn = sib;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// find up/down side file in icons view\r\n\t\t\t\t\t\ttop = s.position().top;\r\n\t\t\t\t\t\tleft = s.position().left;\r\n\r\n\t\t\t\t\t\tn = s;\r\n\t\t\t\t\t\tif (prev) {\r\n\t\t\t\t\t\t\tdo {\r\n\t\t\t\t\t\t\t\tn = n.prev('[id]');\r\n\t\t\t\t\t\t\t} while (n.length && !(n.position().top < top && n.position().left <= left));\r\n\r\n\t\t\t\t\t\t\tif (n.is('.' + clDisabled)) {\r\n\t\t\t\t\t\t\t\tn = sibling(n, 'next');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tdo {\r\n\t\t\t\t\t\t\t\tn = n.next('[id]');\r\n\t\t\t\t\t\t\t} while (n.length && !(n.position().top > top && n.position().left >= left));\r\n\r\n\t\t\t\t\t\t\tif (n.is('.' + clDisabled)) {\r\n\t\t\t\t\t\t\t\tn = sibling(n, 'prev');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t// there is row before last one - select last file\r\n\t\t\t\t\t\t\tif (!n.length) {\r\n\t\t\t\t\t\t\t\tsib = cwd.find('[id]:not(.' + clDisabled + '):last');\r\n\t\t\t\t\t\t\t\tif (sib.position().top > top) {\r\n\t\t\t\t\t\t\t\t\tn = sib;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// !append && unselectAll();\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// there are no selected file - select first/last one\r\n\t\t\t\t\tn = cwd.find('[id]:not(.' + clDisabled + '):not(.elfinder-cwd-parent):' + (prev ? 'last' : 'first'));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (n && n.length && !n.is('.elfinder-cwd-parent')) {\r\n\t\t\t\t\tif (append) {\r\n\t\t\t\t\t\t// append new files to selected\r\n\t\t\t\t\t\tn = s.add(s[prev ? 'prevUntil' : 'nextUntil']('#' + n.attr('id'))).add(n);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// unselect selected files\r\n\t\t\t\t\t\tsel.trigger(evtUnselect);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// select file(s)\r\n\t\t\t\t\tn.trigger(evtSelect);\r\n\t\t\t\t\t// set its visible\r\n\t\t\t\t\tscrollToView(n.filter(prev ? ':first' : ':last'));\r\n\t\t\t\t\t// update cache/view\r\n\t\t\t\t\ttrigger();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tselectedFiles = [],\r\n\r\n\t\t\tselectFile = function (hash) {\r\n\t\t\t\tcwd.find('#' + hash).trigger(evtSelect);\r\n\t\t\t},\r\n\r\n\t\t\tselectAll = function () {\r\n\t\t\t\tvar phash = fm.cwd().hash;\r\n\r\n\t\t\t\tcwd.find('[id]:not(.' + clSelected + '):not(.elfinder-cwd-parent)').trigger(evtSelect);\r\n\t\t\t\tselectedFiles = $.map(fm.files(), function (f) {\r\n\t\t\t\t\treturn f.phash == phash ? f.hash : null;\r\n\t\t\t\t});\r\n\t\t\t\ttrigger();\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Unselect all files\r\n\t\t\t *\r\n\t\t\t * @return void\r\n\t\t\t */\r\n\t\t\tunselectAll = function () {\r\n\t\t\t\tselectedFiles = [];\r\n\t\t\t\tcwd.find('[id].' + clSelected).trigger(evtUnselect);\r\n\t\t\t\ttrigger();\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Return selected files hashes list\r\n\t\t\t *\r\n\t\t\t * @return Array\r\n\t\t\t */\r\n\t\t\tselected = function () {\r\n\t\t\t\treturn selectedFiles;\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Fire elfinder \"select\" event and pass selected files to it\r\n\t\t\t *\r\n\t\t\t * @return void\r\n\t\t\t */\r\n\t\t\ttrigger = function () {\r\n\t\t\t\tfm.trigger('select', {selected: selectedFiles});\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Scroll file to set it visible\r\n\t\t\t *\r\n\t\t\t * @param DOMElement  file/dir node\r\n\t\t\t * @return void\r\n\t\t\t */\r\n\t\t\tscrollToView = function (o) {\r\n\t\t\t\tvar ftop = o.position().top,\r\n\t\t\t\t\tfheight = o.outerHeight(true),\r\n\t\t\t\t\twtop = wrapper.scrollTop(),\r\n\t\t\t\t\twheight = wrapper.innerHeight();\r\n\r\n\t\t\t\tif (ftop + fheight > wtop + wheight) {\r\n\t\t\t\t\twrapper.scrollTop(parseInt(ftop + fheight - wheight));\r\n\t\t\t\t} else if (ftop < wtop) {\r\n\t\t\t\t\twrapper.scrollTop(ftop);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Files we get from server but not show yet\r\n\t\t\t *\r\n\t\t\t * @type Array\r\n\t\t\t **/\r\n\t\t\tbuffer = [],\r\n\r\n\t\t\t/**\r\n\t\t\t * Return index of elements with required hash in buffer\r\n\t\t\t *\r\n\t\t\t * @param String  file hash\r\n\t\t\t * @return Number\r\n\t\t\t */\r\n\t\t\tindex = function (hash) {\r\n\t\t\t\tvar l = buffer.length;\r\n\r\n\t\t\t\twhile (l--) {\r\n\t\t\t\t\tif (buffer[l].hash == hash) {\r\n\t\t\t\t\t\treturn l;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn -1;\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Scroll event name\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t **/\r\n\t\t\tscrollEvent = 'scroll.' + fm.namespace,\r\n\r\n\t\t\t/**\r\n\t\t\t * Cwd scroll event handler.\r\n\t\t\t * Lazy load - append to cwd not shown files\r\n\t\t\t *\r\n\t\t\t * @return void\r\n\t\t\t */\r\n\t\t\trender = function () {\r\n\t\t\t\tvar html = [],\r\n\t\t\t\t\tdirs = false,\r\n\t\t\t\t\tltmb = [],\r\n\t\t\t\t\tatmb = {},\r\n\t\t\t\t\tlast = cwd.find('[id]:last'),\r\n\t\t\t\t\ttop = !last.length,\r\n\t\t\t\t\tplace = list ? cwd.children('table').children('tbody') : cwd,\r\n\t\t\t\t\tfiles;\r\n\r\n\t\t\t\tif (!buffer.length) {\r\n\t\t\t\t\treturn wrapper.unbind(scrollEvent);\r\n\t\t\t\t}\r\n\r\n\t\t\t\twhile ((!last.length || last.position().top <= wrapper.height() + wrapper.scrollTop() + fm.options.showThreshold)\r\n\t\t\t\t&& (files = buffer.splice(0, fm.options.showFiles)).length) {\r\n\r\n\t\t\t\t\thtml = $.map(files, function (f) {\r\n\t\t\t\t\t\tif (f.hash && f.name) {\r\n\t\t\t\t\t\t\tif (f.mime == 'directory') {\r\n\t\t\t\t\t\t\t\tdirs = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (f.tmb) {\r\n\t\t\t\t\t\t\t\tf.tmb === 1 ? ltmb.push(f.hash) : (atmb[f.hash] = f.tmb);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn itemhtml(f);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tplace.append(html.join(''));\r\n\t\t\t\t\tlast = cwd.find('[id]:last');\r\n\t\t\t\t\t// scroll top on dir load to avoid scroll after page reload\r\n\t\t\t\t\ttop && cwd.scrollTop(0);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// load/attach thumbnails\r\n\t\t\t\tattachThumbnails(atmb);\r\n\t\t\t\tltmb.length && loadThumbnails(ltmb);\r\n\r\n\t\t\t\t// make directory droppable\r\n\t\t\t\tdirs && makeDroppable();\r\n\r\n\t\t\t\tif (selectedFiles.length) {\r\n\t\t\t\t\tplace.find('[id]:not(.' + clSelected + '):not(.elfinder-cwd-parent)').each(function () {\r\n\t\t\t\t\t\tvar id = this.id;\r\n\r\n\t\t\t\t\t\t$.inArray(id, selectedFiles) !== -1 && $(this).trigger(evtSelect);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Droppable options for cwd.\r\n\t\t\t * Do not add class on childs file over\r\n\t\t\t *\r\n\t\t\t * @type Object\r\n\t\t\t */\r\n\t\t\tdroppable = $.extend({}, fm.droppable, {\r\n\t\t\t\tover: function (e, ui) {\r\n\t\t\t\t\tvar hash = fm.cwd().hash;\r\n\t\t\t\t\t$.each(ui.helper.data('files'), function (i, h) {\r\n\t\t\t\t\t\tif (fm.file(h).phash == hash) {\r\n\t\t\t\t\t\t\tcwd.removeClass(clDropActive);\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\r\n\t\t\t/**\r\n\t\t\t * Make directory droppable\r\n\t\t\t *\r\n\t\t\t * @return void\r\n\t\t\t */\r\n\t\t\tmakeDroppable = function () {\r\n\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\tcwd.find('.directory:not(.' + clDroppable + ',.elfinder-na,.elfinder-ro)').droppable(fm.droppable);\r\n\t\t\t\t}, 20);\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Preload required thumbnails and on load add css to files.\r\n\t\t\t * Return false if required file is not visible yet (in buffer) -\r\n\t\t\t * required for old api to stop loading thumbnails.\r\n\t\t\t *\r\n\t\t\t * @param  Object  file hash -> thumbnail map\r\n\t\t\t * @return Boolean\r\n\t\t\t */\r\n\t\t\tattachThumbnails = function (images) {\r\n\t\t\t\tvar url = fm.option('tmbUrl'),\r\n\t\t\t\t\tret = true,\r\n\t\t\t\t\tndx;\r\n\r\n\t\t\t\t$.each(images, function (hash, tmb) {\r\n\t\t\t\t\tvar node = cwd.find('#' + hash);\r\n\r\n\t\t\t\t\tif (node.length) {\r\n\r\n\t\t\t\t\t\t(function (node, tmb) {\r\n\t\t\t\t\t\t\t$('<img/>')\r\n\t\t\t\t\t\t\t\t.load(function () {\r\n\t\t\t\t\t\t\t\t\tnode.find('.elfinder-cwd-icon').css('background', \"url('\" + tmb + \"') center center no-repeat\");\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.attr('src', tmb);\r\n\t\t\t\t\t\t})(node, url + tmb);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tret = false;\r\n\t\t\t\t\t\tif ((ndx = index(hash)) != -1) {\r\n\t\t\t\t\t\t\tbuffer[ndx].tmb = tmb;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\treturn ret;\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Load thumbnails from backend.\r\n\t\t\t *\r\n\t\t\t * @param  Array|Boolean  files hashes list for new api | true for old api\r\n\t\t\t * @return void\r\n\t\t\t */\r\n\t\t\tloadThumbnails = function (files) {\r\n\t\t\t\tvar tmbs = [];\r\n\r\n\t\t\t\tif (fm.oldAPI) {\r\n\t\t\t\t\tfm.request({\r\n\t\t\t\t\t\tdata: {cmd: 'tmb', current: fm.cwd().hash},\r\n\t\t\t\t\t\tpreventFail: true\r\n\t\t\t\t\t})\r\n\t\t\t\t\t\t.done(function (data) {\r\n\t\t\t\t\t\t\tif (attachThumbnails(data.images || []) && data.tmb) {\r\n\t\t\t\t\t\t\t\tloadThumbnails();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttmbs = tmbs = files.splice(0, tmbNum);\r\n\t\t\t\tif (tmbs.length) {\r\n\t\t\t\t\tfm.request({\r\n\t\t\t\t\t\tdata: {cmd: 'tmb', targets: tmbs},\r\n\t\t\t\t\t\tpreventFail: true\r\n\t\t\t\t\t})\r\n\t\t\t\t\t\t.done(function (data) {\r\n\t\t\t\t\t\t\tif (attachThumbnails(data.images || [])) {\r\n\t\t\t\t\t\t\t\tloadThumbnails(files);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Add new files to cwd/buffer\r\n\t\t\t *\r\n\t\t\t * @param  Array  new files\r\n\t\t\t * @return void\r\n\t\t\t */\r\n\t\t\tadd = function (files) {\r\n\t\t\t\tvar place = list ? cwd.find('tbody') : cwd,\r\n\t\t\t\t\tl = files.length,\r\n\t\t\t\t\tltmb = [],\r\n\t\t\t\t\tatmb = {},\r\n\t\t\t\t\tdirs = false,\r\n\t\t\t\t\tfindNode = function (file) {\r\n\t\t\t\t\t\tvar pointer = cwd.find('[id]:first'), file2;\r\n\r\n\t\t\t\t\t\twhile (pointer.length) {\r\n\t\t\t\t\t\t\tfile2 = fm.file(pointer.attr('id'));\r\n\t\t\t\t\t\t\tif (!pointer.is('.elfinder-cwd-parent') && file2 && fm.compare(file, file2) < 0) {\r\n\t\t\t\t\t\t\t\treturn pointer;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tpointer = pointer.next('[id]');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfindIndex = function (file) {\r\n\t\t\t\t\t\tvar l = buffer.length, i;\r\n\r\n\t\t\t\t\t\tfor (i = 0; i < l; i++) {\r\n\t\t\t\t\t\t\tif (fm.compare(file, buffer[i]) < 0) {\r\n\t\t\t\t\t\t\t\treturn i;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn l || -1;\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfile, hash, node, ndx;\r\n\r\n\r\n\t\t\t\twhile (l--) {\r\n\t\t\t\t\tfile = files[l];\r\n\t\t\t\t\thash = file.hash;\r\n\r\n\t\t\t\t\tif (cwd.find('#' + hash).length) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ((node = findNode(file)) && node.length) {\r\n\t\t\t\t\t\tnode.before(itemhtml(file));\r\n\t\t\t\t\t} else if ((ndx = findIndex(file)) >= 0) {\r\n\t\t\t\t\t\tbuffer.splice(ndx, 0, file);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tplace.append(itemhtml(file));\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (cwd.find('#' + hash).length) {\r\n\t\t\t\t\t\tif (file.mime == 'directory') {\r\n\t\t\t\t\t\t\tdirs = true;\r\n\t\t\t\t\t\t} else if (file.tmb) {\r\n\t\t\t\t\t\t\tfile.tmb === 1 ? ltmb.push(hash) : (atmb[hash] = file.tmb);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tattachThumbnails(atmb);\r\n\t\t\t\tltmb.length && loadThumbnails(ltmb);\r\n\t\t\t\tdirs && makeDroppable();\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Remove files from cwd/buffer\r\n\t\t\t *\r\n\t\t\t * @param  Array  files hashes\r\n\t\t\t * @return void\r\n\t\t\t */\r\n\t\t\tremove = function (files) {\r\n\t\t\t\tvar l = files.length, hash, n, ndx;\r\n\r\n\t\t\t\twhile (l--) {\r\n\t\t\t\t\thash = files[l];\r\n\t\t\t\t\tif ((n = cwd.find('#' + hash)).length) {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tn.detach();\r\n\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\tfm.debug('error', e);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if ((ndx = index(hash)) != -1) {\r\n\t\t\t\t\t\tbuffer.splice(ndx, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tmsg = {\r\n\t\t\t\tname: fm.i18n('name'),\r\n\t\t\t\tperm: fm.i18n('perms'),\r\n\t\t\t\tmod: fm.i18n('modify'),\r\n\t\t\t\tsize: fm.i18n('size'),\r\n\t\t\t\tkind: fm.i18n('kind')\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Update directory content\r\n\t\t\t *\r\n\t\t\t * @param  Array  files\r\n\t\t\t * @return void\r\n\t\t\t */\r\n\t\t\tcontent = function (files, any) {\r\n\t\t\t\tvar phash = fm.cwd().hash;\r\n\t\t\t\t// console.log(files)\r\n\r\n\t\t\t\tunselectAll();\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// to avoid problem with draggable\r\n\t\t\t\t\tcwd.children('table,' + fileSelector).remove();\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tcwd.html('');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcwd.removeClass('elfinder-cwd-view-icons elfinder-cwd-view-list')\r\n\t\t\t\t\t.addClass('elfinder-cwd-view-' + (list ? 'list' : 'icons'));\r\n\r\n\t\t\t\twrapper[list ? 'addClass' : 'removeClass']('elfinder-cwd-wrapper-list');\r\n\r\n\t\t\t\tlist && cwd.html('<table><thead><tr class=\"ui-state-default\"><td >' + msg.name + '</td><td>' + msg.perm + '</td><td>' + msg.mod + '</td><td>' + msg.size + '</td><td>' + msg.kind + '</td></tr></thead><tbody/></table>');\r\n\r\n\t\t\t\tbuffer = $.map(files, function (f) {\r\n\t\t\t\t\treturn any || f.phash == phash ? f : null;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tbuffer = fm.sortFiles(buffer);\r\n\r\n\t\t\t\twrapper.bind(scrollEvent, render).trigger(scrollEvent);\r\n\r\n\t\t\t\tphash = fm.cwd().phash;\r\n\r\n\t\t\t\tif (options.oldSchool && phash && !query) {\r\n\t\t\t\t\tvar parent = $.extend(true, {}, fm.file(phash), {name: '..', mime: 'directory'});\r\n\t\t\t\t\tparent = $(itemhtml(parent))\r\n\t\t\t\t\t\t.addClass('elfinder-cwd-parent')\r\n\t\t\t\t\t\t.bind('mousedown click mouseup touchstart touchmove touchend dblclick mouseenter', function (e) {\r\n\t\t\t\t\t\t\t//.bind('mousedown click mouseup dblclick mouseenter', function(e) {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.dblclick(function () {\r\n\t\t\t\t\t\t\tfm.exec('open', this.id);\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t(list ? cwd.find('tbody') : cwd).prepend(parent);\r\n\t\t\t\t}\r\n\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * CWD node itself\r\n\t\t\t *\r\n\t\t\t * @type JQuery\r\n\t\t\t **/\r\n\t\t\tcwd = $(this)\r\n\t\t\t\t.addClass('ui-helper-clearfix elfinder-cwd')\r\n\t\t\t\t.attr('unselectable', 'on')\r\n\t\t\t\t// fix ui.selectable bugs and add shift+click support\r\n\t\t\t\t.delegate(fileSelector, 'click.' + fm.namespace, function (e) {\r\n\t\t\t\t\tvar p = this.id ? $(this) : $(this).parents('[id]:first'),\r\n\t\t\t\t\t\tprev = p.prevAll('.' + clSelected + ':first'),\r\n\t\t\t\t\t\tnext = p.nextAll('.' + clSelected + ':first'),\r\n\t\t\t\t\t\tpl = prev.length,\r\n\t\t\t\t\t\tnl = next.length,\r\n\t\t\t\t\t\tsib;\r\n\r\n\t\t\t\t\te.stopImmediatePropagation();\r\n\r\n\t\t\t\t\tif (e.shiftKey && (pl || nl)) {\r\n\t\t\t\t\t\tsib = pl ? p.prevUntil('#' + prev.attr('id')) : p.nextUntil('#' + next.attr('id'));\r\n\t\t\t\t\t\tsib.add(p).trigger(evtSelect);\r\n\t\t\t\t\t} else if (e.ctrlKey || e.metaKey) {\r\n\t\t\t\t\t\tp.trigger(p.is('.' + clSelected) ? evtUnselect : evtSelect);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif ($(this).data('touching') && p.is('.' + clSelected)) {\r\n\t\t\t\t\t\t\t$(this).data('touching', null);\r\n\t\t\t\t\t\t\tfm.dblclick({file: this.id});\r\n\t\t\t\t\t\t\tunselectAll();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tunselectAll();\r\n\t\t\t\t\t\t\tp.trigger(evtSelect);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttrigger();\r\n\t\t\t\t})\r\n\t\t\t\t// call fm.open()\r\n\t\t\t\t.delegate(fileSelector, 'dblclick.' + fm.namespace, function (e) {\r\n\t\t\t\t\tfm.dblclick({file: this.id});\r\n\t\t\t\t})\r\n\t\t\t\t// for touch device\r\n\t\t\t\t.delegate(fileSelector, 'touchstart.' + fm.namespace, function (e) {\r\n\t\t\t\t\t$(this).data('touching', true);\r\n\t\t\t\t\tvar p = this.id ? $(this) : $(this).parents('[id]:first'),\r\n\t\t\t\t\t\tsel = p.prevAll('.' + clSelected + ':first').length +\r\n\t\t\t\t\t\t\tp.nextAll('.' + clSelected + ':first').length;\r\n\t\t\t\t\t$(this).data('longtap', setTimeout(function () {\r\n\t\t\t\t\t\t// long tap\r\n\t\t\t\t\t\tp.trigger(p.is('.' + clSelected) ? evtUnselect : evtSelect);\r\n\t\t\t\t\t\ttrigger();\r\n\t\t\t\t\t\tif (sel == 0 && p.is('.' + clSelected)) {\r\n\t\t\t\t\t\t\tp.trigger('click');\r\n\t\t\t\t\t\t\ttrigger();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, 500));\r\n\t\t\t\t})\r\n\t\t\t\t.delegate(fileSelector, 'touchmove.' + fm.namespace + ' touchend.' + fm.namespace, function (e) {\r\n\t\t\t\t\tclearTimeout($(this).data('longtap'));\r\n\t\t\t\t})\r\n\t\t\t\t// attach draggable\r\n\t\t\t\t.delegate(fileSelector, 'mouseenter.' + fm.namespace, function (e) {\r\n\t\t\t\t\tvar $this = $(this),\r\n\t\t\t\t\t\ttarget = list ? $this : $this.children();\r\n\r\n\t\t\t\t\tif (!$this.is('.' + clTmp) && !target.is('.' + clDraggable + ',.' + clDisabled)) {\r\n\t\t\t\t\t\ttarget.draggable(fm.draggable);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t// add hover class to selected file\r\n\t\t\t\t.delegate(fileSelector, evtSelect, function (e) {\r\n\t\t\t\t\tvar $this = $(this),\r\n\t\t\t\t\t\tid = $this.attr('id');\r\n\r\n\t\t\t\t\tif (!selectLock && !$this.is('.' + clDisabled)) {\r\n\t\t\t\t\t\t$this.addClass(clSelected).children().addClass(clHover);\r\n\t\t\t\t\t\tif ($.inArray(id, selectedFiles) === -1) {\r\n\t\t\t\t\t\t\tselectedFiles.push(id);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t// remove hover class from unselected file\r\n\t\t\t\t.delegate(fileSelector, evtUnselect, function (e) {\r\n\t\t\t\t\tvar $this = $(this),\r\n\t\t\t\t\t\tid = $this.attr('id'),\r\n\t\t\t\t\t\tndx;\r\n\r\n\t\t\t\t\tif (!selectLock) {\r\n\t\t\t\t\t\t$(this).removeClass(clSelected).children().removeClass(clHover);\r\n\t\t\t\t\t\tndx = $.inArray(id, selectedFiles);\r\n\t\t\t\t\t\tif (ndx !== -1) {\r\n\t\t\t\t\t\t\tselectedFiles.splice(ndx, 1);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t})\r\n\t\t\t\t// disable files wich removing or moving\r\n\t\t\t\t.delegate(fileSelector, evtDisable, function () {\r\n\t\t\t\t\tvar $this = $(this).removeClass(clSelected).addClass(clDisabled),\r\n\t\t\t\t\t\ttarget = (list ? $this : $this.children()).removeClass(clHover);\r\n\r\n\t\t\t\t\t$this.is('.' + clDroppable) && $this.droppable('disable');\r\n\t\t\t\t\ttarget.is('.' + clDraggable) && target.draggable('disable');\r\n\t\t\t\t\t!list && target.removeClass(clDisabled);\r\n\t\t\t\t})\r\n\t\t\t\t// if any files was not removed/moved - unlock its\r\n\t\t\t\t.delegate(fileSelector, evtEnable, function () {\r\n\t\t\t\t\tvar $this = $(this).removeClass(clDisabled),\r\n\t\t\t\t\t\ttarget = list ? $this : $this.children();\r\n\r\n\t\t\t\t\t$this.is('.' + clDroppable) && $this.droppable('enable');\r\n\t\t\t\t\ttarget.is('.' + clDraggable) && target.draggable('enable');\r\n\t\t\t\t})\r\n\t\t\t\t.delegate(fileSelector, 'scrolltoview', function () {\r\n\t\t\t\t\tscrollToView($(this));\r\n\t\t\t\t})\r\n\t\t\t\t.delegate(fileSelector, 'mouseenter.' + fm.namespace + ' mouseleave.' + fm.namespace, function (e) {\r\n\t\t\t\t\tfm.trigger('hover', {hash: $(this).attr('id'), type: e.type});\r\n\t\t\t\t\t$(this).toggleClass('ui-state-hover');\r\n\t\t\t\t})\r\n\t\t\t\t.bind('contextmenu.' + fm.namespace, function (e) {\r\n\t\t\t\t\tvar file = $(e.target).closest('.' + clFile);\r\n\r\n\t\t\t\t\tif (file.length) {\r\n\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tif (!file.is('.' + clDisabled)) {\r\n\t\t\t\t\t\t\tif (!file.is('.' + clSelected)) {\r\n\t\t\t\t\t\t\t\t// cwd.trigger('unselectall');\r\n\t\t\t\t\t\t\t\tunselectAll();\r\n\t\t\t\t\t\t\t\tfile.trigger(evtSelect);\r\n\t\t\t\t\t\t\t\ttrigger();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tfm.trigger('contextmenu', {\r\n\t\t\t\t\t\t\t\t'type': 'files',\r\n\t\t\t\t\t\t\t\t'targets': fm.selected(),\r\n\t\t\t\t\t\t\t\t'x': e.clientX,\r\n\t\t\t\t\t\t\t\t'y': e.clientY\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// e.preventDefault();\r\n\r\n\r\n\t\t\t\t})\r\n\t\t\t\t// unselect all on cwd click\r\n\t\t\t\t.bind('click.' + fm.namespace, function (e) {\r\n\t\t\t\t\t!e.shiftKey && !e.ctrlKey && !e.metaKey && unselectAll();\r\n\t\t\t\t})\r\n\r\n\t\t\t\t// make files selectable\r\n\t\t\t\t.selectable({\r\n\t\t\t\t\tfilter: fileSelector,\r\n\t\t\t\t\tstop: trigger,\r\n\t\t\t\t\tdelay: 250,\r\n\t\t\t\t\tselected: function (e, ui) {\r\n\t\t\t\t\t\t$(ui.selected).trigger(evtSelect);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tunselected: function (e, ui) {\r\n\t\t\t\t\t\t$(ui.unselected).trigger(evtUnselect);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t// make cwd itself droppable for folders from nav panel\r\n\t\t\t\t.droppable(droppable)\r\n\t\t\t\t// prepend fake file/dir\r\n\t\t\t\t.bind('create.' + fm.namespace, function (e, file) {\r\n\t\t\t\t\tvar parent = list ? cwd.find('tbody') : cwd,\r\n\t\t\t\t\t\tp = parent.find('.elfinder-cwd-parent'),\r\n\t\t\t\t\t\tfile = $(itemhtml(file)).addClass(clTmp);\r\n\r\n\t\t\t\t\tunselectAll();\r\n\r\n\t\t\t\t\tif (p.length) {\r\n\t\t\t\t\t\tp.after(file);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tparent.prepend(file);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcwd.scrollTop(0);\r\n\t\t\t\t})\r\n\t\t\t\t// unselect all selected files\r\n\t\t\t\t.bind('unselectall', unselectAll)\r\n\t\t\t\t.bind('selectfile', function (e, id) {\r\n\t\t\t\t\tcwd.find('#' + id).trigger(evtSelect);\r\n\t\t\t\t\ttrigger();\r\n\t\t\t\t}),\r\n\t\t\twrapper = $('<div class=\"elfinder-cwd-wrapper\"/>')\r\n\t\t\t\t.bind('contextmenu', function (e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tfm.trigger('contextmenu', {\r\n\t\t\t\t\t\t'type': 'cwd',\r\n\t\t\t\t\t\t'targets': [fm.cwd().hash],\r\n\t\t\t\t\t\t'x': e.clientX,\r\n\t\t\t\t\t\t'y': e.clientY\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t}),\r\n\r\n\t\t\tresize = function () {\r\n\t\t\t\tvar h = 0;\r\n\r\n\t\t\t\twrapper.siblings('.elfinder-panel:visible').each(function () {\r\n\t\t\t\t\th += $(this).outerHeight(true);\r\n\t\t\t\t});\r\n\r\n\t\t\t\twrapper.height(wz.height() - h);\r\n\t\t\t},\r\n\r\n\t\t// elfinder node\r\n\t\t\tparent = $(this).parent().resize(resize),\r\n\t\t// workzone node\r\n\t\t\twz = parent.children('.elfinder-workzone').append(wrapper.append(this))\r\n\t\t\t;\r\n\r\n\r\n\t\tif (fm.dragUpload) {\r\n\t\t\twrapper[0].addEventListener('dragenter', function (e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\r\n\t\t\t\twrapper.addClass(clDropActive);\r\n\t\t\t}, false);\r\n\r\n\t\t\twrapper[0].addEventListener('dragleave', function (e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t\te.target == cwd[0] && wrapper.removeClass(clDropActive);\r\n\t\t\t}, false);\r\n\r\n\t\t\twrapper[0].addEventListener('dragover', function (e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t}, false);\r\n\r\n\t\t\twrapper[0].addEventListener('drop', function (e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\twrapper.removeClass(clDropActive);\r\n\r\n\t\t\t\te.dataTransfer && e.dataTransfer.files && e.dataTransfer.files.length && fm.exec('upload', {files: e.dataTransfer.files})//fm.upload({files : e.dataTransfer.files});\r\n\t\t\t}, false);\r\n\t\t}\r\n\r\n\t\tfm\r\n\t\t\t.bind('open', function (e) {\r\n\t\t\t\tcontent(e.data.files);\r\n\t\t\t})\r\n\t\t\t.bind('search', function (e) {\r\n\t\t\t\tlastSearch = e.data.files;\r\n\t\t\t\tcontent(lastSearch, true);\r\n\t\t\t})\r\n\t\t\t.bind('searchend', function () {\r\n\t\t\t\tlastSearch = [];\r\n\t\t\t\tif (query) {\r\n\t\t\t\t\tquery = '';\r\n\t\t\t\t\tcontent(fm.files());\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.bind('searchstart', function (e) {\r\n\t\t\t\tquery = e.data.query;\r\n\t\t\t})\r\n\t\t\t.bind('sortchange', function () {\r\n\t\t\t\tcontent(query ? lastSearch : fm.files(), !!query);\r\n\t\t\t})\r\n\t\t\t.bind('viewchange', function () {\r\n\t\t\t\tvar sel = fm.selected(),\r\n\t\t\t\t\tl = fm.storage('view') == 'list';\r\n\r\n\t\t\t\tif (l != list) {\r\n\t\t\t\t\tlist = l;\r\n\t\t\t\t\tcontent(fm.files());\r\n\r\n\t\t\t\t\t$.each(sel, function (i, h) {\r\n\t\t\t\t\t\tselectFile(h);\r\n\t\t\t\t\t});\r\n\t\t\t\t\ttrigger();\r\n\t\t\t\t}\r\n\t\t\t\tresize();\r\n\t\t\t})\r\n\t\t\t.add(function (e) {\r\n\t\t\t\tvar phash = fm.cwd().hash,\r\n\t\t\t\t\tfiles = query\r\n\t\t\t\t\t\t? $.map(e.data.added || [], function (f) {\r\n\t\t\t\t\t\treturn f.name.indexOf(query) === -1 ? null : f;\r\n\t\t\t\t\t})\r\n\t\t\t\t\t\t: $.map(e.data.added || [], function (f) {\r\n\t\t\t\t\t\treturn f.phash == phash ? f : null;\r\n\t\t\t\t\t})\r\n\t\t\t\t\t;\r\n\t\t\t\tadd(files);\r\n\t\t\t})\r\n\t\t\t.change(function (e) {\r\n\t\t\t\tvar phash = fm.cwd().hash,\r\n\t\t\t\t\tsel = fm.selected(),\r\n\t\t\t\t\tfiles;\r\n\r\n\t\t\t\tif (query) {\r\n\t\t\t\t\t$.each(e.data.changed || [], function (i, file) {\r\n\t\t\t\t\t\tremove([file.hash]);\r\n\t\t\t\t\t\tif (file.name.indexOf(query) !== -1) {\r\n\t\t\t\t\t\t\tadd([file]);\r\n\t\t\t\t\t\t\t$.inArray(file.hash, sel) !== -1 && selectFile(file.hash);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$.each($.map(e.data.changed || [], function (f) {\r\n\t\t\t\t\t\treturn f.phash == phash ? f : null;\r\n\t\t\t\t\t}), function (i, file) {\r\n\t\t\t\t\t\tremove([file.hash]);\r\n\t\t\t\t\t\tadd([file]);\r\n\t\t\t\t\t\t$.inArray(file.hash, sel) !== -1 && selectFile(file.hash);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttrigger();\r\n\t\t\t})\r\n\t\t\t.remove(function (e) {\r\n\t\t\t\tremove(e.data.removed || []);\r\n\t\t\t\ttrigger();\r\n\t\t\t})\r\n\t\t\t// fix cwd height if it less then wrapper\r\n\t\t\t.bind('open add search searchend', function () {\r\n\t\t\t\tcwd.css('height', 'auto');\r\n\r\n\t\t\t\tif (cwd.outerHeight(true) < wrapper.height()) {\r\n\t\t\t\t\tcwd.height(wrapper.height() - (cwd.outerHeight(true) - cwd.height()) - 2);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t// select dragged file if no selected, disable selectable\r\n\t\t\t.dragstart(function (e) {\r\n\t\t\t\tvar target = $(e.data.target),\r\n\t\t\t\t\toe = e.data.originalEvent;\r\n\r\n\t\t\t\tif (target.is(fileSelector)) {\r\n\r\n\t\t\t\t\tif (!target.is('.' + clSelected)) {\r\n\t\t\t\t\t\t!(oe.ctrlKey || oe.metaKey || oe.shiftKey) && unselectAll();\r\n\t\t\t\t\t\ttarget.trigger(evtSelect);\r\n\t\t\t\t\t\ttrigger();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcwd.droppable('disable');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcwd.selectable('disable').removeClass(clDisabled);\r\n\t\t\t\tselectLock = true;\r\n\t\t\t})\r\n\t\t\t// enable selectable\r\n\t\t\t.dragstop(function () {\r\n\t\t\t\tcwd.selectable('enable').droppable('enable');\r\n\t\t\t\tselectLock = false;\r\n\t\t\t})\r\n\t\t\t.bind('lockfiles unlockfiles', function (e) {\r\n\t\t\t\tvar event = e.type == 'lockfiles' ? evtDisable : evtEnable,\r\n\t\t\t\t\tfiles = e.data.files || [],\r\n\t\t\t\t\tl = files.length;\r\n\r\n\t\t\t\twhile (l--) {\r\n\t\t\t\t\tcwd.find('#' + files[l]).trigger(event);\r\n\t\t\t\t}\r\n\t\t\t\ttrigger();\r\n\t\t\t})\r\n\t\t\t// select new files after some actions\r\n\t\t\t.bind('mkdir mkfile duplicate upload rename archive extract', function (e) {\r\n\t\t\t\tvar phash = fm.cwd().hash, files;\r\n\r\n\t\t\t\tunselectAll();\r\n\r\n\t\t\t\t$.each(e.data.added || [], function (i, file) {\r\n\t\t\t\t\tfile && file.phash == phash && selectFile(file.hash);\r\n\t\t\t\t});\r\n\t\t\t\ttrigger();\r\n\t\t\t})\r\n\t\t\t.shortcut({\r\n\t\t\t\tpattern: 'ctrl+a',\r\n\t\t\t\tdescription: 'selectall',\r\n\t\t\t\tcallback: selectAll\r\n\t\t\t})\r\n\t\t\t.shortcut({\r\n\t\t\t\tpattern: 'left right up down shift+left shift+right shift+up shift+down',\r\n\t\t\t\tdescription: 'selectfiles',\r\n\t\t\t\ttype: 'keydown', //fm.UA.Firefox || fm.UA.Opera ? 'keypress' : 'keydown',\r\n\t\t\t\tcallback: function (e) {\r\n\t\t\t\t\tselect(e.keyCode, e.shiftKey);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.shortcut({\r\n\t\t\t\tpattern: 'home',\r\n\t\t\t\tdescription: 'selectffile',\r\n\t\t\t\tcallback: function (e) {\r\n\t\t\t\t\tunselectAll();\r\n\t\t\t\t\tscrollToView(cwd.find('[id]:first').trigger(evtSelect));\r\n\t\t\t\t\ttrigger();\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.shortcut({\r\n\t\t\t\tpattern: 'end',\r\n\t\t\t\tdescription: 'selectlfile',\r\n\t\t\t\tcallback: function (e) {\r\n\t\t\t\t\tunselectAll();\r\n\t\t\t\t\tscrollToView(cwd.find('[id]:last').trigger(evtSelect));\r\n\t\t\t\t\ttrigger();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t});\r\n\treturn this;\r\n}","/**\r\n * @class  elFinder dialog\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\n$.fn.elfinderdialog = function (opts) {\r\n\tvar dialog;\r\n\r\n\tif (typeof(opts) == 'string' && (dialog = this.closest('.ui-dialog')).length) {\r\n\t\tif (opts == 'open') {\r\n\t\t\tdialog.css('display') == 'none' && dialog.fadeIn(120, function () {\r\n\t\t\t\tdialog.trigger('open');\r\n\t\t\t});\r\n\t\t} else if (opts == 'close') {\r\n\t\t\tdialog.css('display') != 'none' && dialog.hide().trigger('close');\r\n\t\t} else if (opts == 'destroy') {\r\n\t\t\tdialog.hide().remove();\r\n\t\t} else if (opts == 'toTop') {\r\n\t\t\tdialog.trigger('totop');\r\n\t\t}\r\n\t}\r\n\r\n\topts = $.extend({}, $.fn.elfinderdialog.defaults, opts);\r\n\r\n\tthis.filter(':not(.ui-dialog-content)').each(function () {\r\n\t\tvar self = $(this).addClass('ui-dialog-content panel-body'),\r\n\t\t\tparent = self.parent(),\r\n\t\t\tclactive = 'elfinder-dialog-active',\r\n\t\t\tcldialog = 'elfinder-dialog',\r\n\t\t\tclnotify = 'elfinder-dialog-notify',\r\n\t\t\tclhover = 'ui-state-hover',\r\n\t\t\tid = parseInt(Math.random() * 1000000),\r\n\t\t\toverlay = parent.children('.elfinder-overlay'),\r\n\t\t\tbuttonset = $('<div />'),\r\n\t\t\tbuttonpane = $('<div class=\"panel-footer\"/>')\r\n\t\t\t\t.append(buttonset),\r\n\r\n\t\t\tdialog = $('<div class=\"ui-dialog panel ui-draggable std42-dialog ' + cldialog + ' ' + opts.cssClass + '\"/>')\r\n\t\t\t\t.hide()\r\n\t\t\t\t.append(self)\r\n\t\t\t\t.appendTo(parent)\r\n\t\t\t\t.draggable({\r\n\t\t\t\t\thandle: '.panel-heading',\r\n\t\t\t\t\tcontainment: 'document'\r\n\t\t\t\t})\r\n\t\t\t\t.css({\r\n\t\t\t\t\twidth: opts.width,\r\n\t\t\t\t\theight: opts.height,\r\n\t\t\t\t\tbackgoundColor: '#fff',\r\n\t\t\t\t\tposition: 'absolute'\r\n\t\t\t\t})\r\n\t\t\t\t.mousedown(function (e) {\r\n\t\t\t\t\te.stopPropagation();\r\n\r\n\t\t\t\t\t$(document).mousedown();\r\n\r\n\t\t\t\t\tif (!dialog.is('.' + clactive)) {\r\n\t\t\t\t\t\tparent.find('.' + cldialog + ':visible').removeClass(clactive);\r\n\t\t\t\t\t\tdialog.addClass(clactive).zIndex(maxZIndex() + 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.bind('open', function () {\r\n\t\t\t\t\tdialog.trigger('totop');\r\n\t\t\t\t\ttypeof(opts.open) == 'function' && $.proxy(opts.open, self[0])();\r\n\r\n\t\t\t\t\tif (!dialog.is('.' + clnotify)) {\r\n\r\n\t\t\t\t\t\tparent.find('.' + cldialog + ':visible').not('.' + clnotify).each(function () {\r\n\t\t\t\t\t\t\tvar d = $(this),\r\n\t\t\t\t\t\t\t\ttop = parseInt(d.css('top')),\r\n\t\t\t\t\t\t\t\tleft = parseInt(d.css('left')),\r\n\t\t\t\t\t\t\t\t_top = parseInt(dialog.css('top')),\r\n\t\t\t\t\t\t\t\t_left = parseInt(dialog.css('left'))\r\n\t\t\t\t\t\t\t\t;\r\n\r\n\t\t\t\t\t\t\tif (d[0] != dialog[0] && (top == _top || left == _left)) {\r\n\t\t\t\t\t\t\t\tdialog.css({\r\n\t\t\t\t\t\t\t\t\ttop: (top + 10) + 'px',\r\n\t\t\t\t\t\t\t\t\tleft: (left + 10) + 'px'\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.bind('close', function () {\r\n\t\t\t\t\tvar dialogs = parent.find('.elfinder-dialog:visible'),\r\n\t\t\t\t\t\tz = maxZIndex();\r\n\r\n\t\t\t\t\t$(this).data('modal') && overlay.elfinderoverlay('hide');\r\n\r\n\t\t\t\t\t// get focus to next dialog\r\n\t\t\t\t\tif (dialogs.length) {\r\n\t\t\t\t\t\tdialogs.each(function () {\r\n\t\t\t\t\t\t\tvar d = $(this);\r\n\t\t\t\t\t\t\tif (d.zIndex() >= z) {\r\n\t\t\t\t\t\t\t\td.trigger('totop');\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// return focus to parent\r\n\t\t\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\t\t\tparent.mousedown().click();\r\n\t\t\t\t\t\t}, 10);\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (typeof(opts.close) == 'function') {\r\n\t\t\t\t\t\t$.proxy(opts.close, self[0])();\r\n\t\t\t\t\t} else if (opts.destroyOnClose) {\r\n\t\t\t\t\t\tdialog.hide().remove();\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.bind('totop', function () {\r\n\t\t\t\t\t$(this).mousedown().find('.btn:first').focus();\r\n\t\t\t\t\t$(this).data('modal') && overlay.elfinderoverlay('show');\r\n\t\t\t\t\toverlay.zIndex($(this).zIndex());\r\n\t\t\t\t})\r\n\t\t\t\t.data({modal: opts.modal}),\r\n\t\t\tmaxZIndex = function () {\r\n\t\t\t\tvar z = parent.zIndex() + 10;\r\n\t\t\t\tparent.find('.' + cldialog + ':visible').each(function () {\r\n\t\t\t\t\tvar _z;\r\n\t\t\t\t\tif (this != dialog[0]) {\r\n\t\t\t\t\t\t_z = $(this).zIndex();\r\n\t\t\t\t\t\tif (_z > z) {\r\n\t\t\t\t\t\t\tz = _z;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\treturn z;\r\n\t\t\t},\r\n\t\t\ttop\r\n\t\t\t;\r\n\r\n\t\tif (!opts.position) {\r\n\t\t\ttop = parseInt((parent.height() - dialog.outerHeight()) / 2 - 42);\r\n\t\t\topts.position = {\r\n\t\t\t\ttop: (top > 0 ? top : 0) + 'px',\r\n\t\t\t\tleft: parseInt((parent.width() - dialog.outerWidth()) / 2) + 'px'\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tdialog.css(opts.position);\r\n\r\n\t\tif (opts.closeOnEscape) {\r\n\t\t\t$(document).bind('keyup.' + id, function (e) {\r\n\t\t\t\tif (e.keyCode == $.ui.keyCode.ESCAPE && dialog.is('.' + clactive)) {\r\n\t\t\t\t\tself.elfinderdialog('close');\r\n\t\t\t\t\t$(document).unbind('keyup.' + id);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t\tdialog.prepend(\r\n\t\t\t$('<div class=\"panel-heading\">' + opts.title + '</div>')\r\n\t\t\t\t.prepend($('<i class=\"fa fa-times pull-right\"></i>')\r\n\t\t\t\t\t.css('cursor', 'pointer')\r\n\t\t\t\t\t.mousedown(function (e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tself.elfinderdialog('close');\r\n\t\t\t\t\t}))\r\n\t\t);\r\n\r\n\t\t$.each(opts.buttons, function (name, cb) {\r\n\t\t\tvar button = $('<button type=\"button\" class=\"btn btn-default\">' + name + '</button>')\r\n\t\t\t\t.click($.proxy(cb, self[0]))\r\n\t\t\t\t.keydown(function (e) {\r\n\t\t\t\t\tvar next;\r\n\r\n\t\t\t\t\tif (e.keyCode == $.ui.keyCode.ENTER) {\r\n\t\t\t\t\t\t$(this).click();\r\n\t\t\t\t\t} else if (e.keyCode == $.ui.keyCode.TAB) {\r\n\t\t\t\t\t\tnext = $(this).next('.btn');\r\n\t\t\t\t\t\tnext.length ? next.focus() : $(this).parent().children('.btn:first').focus()\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\tbuttonset.append(button);\r\n\t\t})\r\n\r\n\t\tbuttonset.children().length && dialog.append(buttonpane);\r\n\t\tif (opts.resizable && $.fn.resizable) {\r\n\t\t\tdialog.resizable({\r\n\t\t\t\tminWidth: opts.minWidth,\r\n\t\t\t\tminHeight: opts.minHeight,\r\n\t\t\t\talsoResize: this,\r\n\t\t\t\tstop: function (event, ui) {\r\n\t\t\t\t\t$(this).trigger('resize', [ui]);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\ttypeof(opts.create) == 'function' && $.proxy(opts.create, this)();\r\n\r\n\t\topts.autoOpen && self.elfinderdialog('open');\r\n\r\n\t});\r\n\r\n\treturn this;\r\n}\r\n\r\n$.fn.elfinderdialog.defaults = {\r\n\tcssClass: '',\r\n\ttitle: '',\r\n\tmodal: false,\r\n\tresizable: true,\r\n\tautoOpen: true,\r\n\tcloseOnEscape: true,\r\n\tdestroyOnClose: false,\r\n\tbuttons: {},\r\n\tposition: null,\r\n\twidth: 320,\r\n\theight: 'auto',\r\n\tminWidth: 200,\r\n\tminHeight: 110\r\n}","/**\r\n * @class elfindernav - elFinder container for diretories tree and places\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\n$.fn.elfindernavbar = function (fm, opts) {\r\n\r\n\tthis.not('.elfinder-navbar').each(function () {\r\n\t\tvar nav = $(this).addClass('ui-state-default elfinder-navbar'),\r\n\t\t\tparent = nav.parent()\r\n\t\t\t\t.resize(function () {\r\n\t\t\t\t\tnav.height(wz.height() - delta);\r\n\t\t\t\t}),\r\n\t\t\twz = parent.children('.elfinder-workzone').append(nav),\r\n\t\t\tdelta = nav.outerHeight() - nav.height(),\r\n\t\t\tltr = fm.direction == 'ltr',\r\n\t\t\thandle;\r\n\r\n\r\n\t\tif ($.fn.resizable) {\r\n\t\t\thandle = nav.resizable({\r\n\t\t\t\thandles: ltr ? 'e' : 'w',\r\n\t\t\t\tminWidth: opts.minWidth || 150,\r\n\t\t\t\tmaxWidth: opts.maxWidth || 500\r\n\t\t\t})\r\n\t\t\t\t.bind('resize scroll', function () {\r\n\t\t\t\t\tvar offset = (fm.UA.Opera && nav.scrollLeft()) ? 20 : 2;\r\n\t\t\t\t\thandle.css({\r\n\t\t\t\t\t\ttop: parseInt(nav.scrollTop()) + 'px',\r\n\t\t\t\t\t\tleft: ltr ? 'auto' : parseInt(nav.scrollLeft() + offset),\r\n\t\t\t\t\t\tright: ltr ? parseInt(nav.scrollLeft() - offset) * -1 : 'auto'\r\n\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.find('.ui-resizable-handle').zIndex(nav.zIndex() + 10);\r\n\r\n\t\t\tif (!ltr) {\r\n\t\t\t\tnav.resize(function () {\r\n\t\t\t\t\tnav.css('left', null).css('right', 0);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tfm.one('open', function () {\r\n\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\tnav.trigger('resize');\r\n\t\t\t\t}, 150);\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\treturn this;\r\n};","$.fn.elfinderoverlay = function (opts) {\r\n\r\n\tthis.filter(':not(.elfinder-overlay)').each(function () {\r\n\t\topts = $.extend({}, opts);\r\n\t\t$(this).addClass('ui-widget-overlay elfinder-overlay')\r\n\t\t\t.hide()\r\n\t\t\t.mousedown(function (e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t})\r\n\t\t\t.data({\r\n\t\t\t\tcnt: 0,\r\n\t\t\t\tshow: typeof(opts.show) == 'function' ? opts.show : function () {\r\n\t\t\t\t},\r\n\t\t\t\thide: typeof(opts.hide) == 'function' ? opts.hide : function () {\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t});\r\n\r\n\tif (opts == 'show') {\r\n\t\tvar o = this.eq(0),\r\n\t\t\tcnt = o.data('cnt') + 1,\r\n\t\t\tshow = o.data('show');\r\n\r\n\t\to.data('cnt', cnt);\r\n\r\n\t\tif (o.is(':hidden')) {\r\n\t\t\to.zIndex(o.parent().zIndex() + 1);\r\n\t\t\to.show();\r\n\t\t\tshow();\r\n\t\t}\r\n\t}\r\n\r\n\tif (opts == 'hide') {\r\n\t\tvar o = this.eq(0),\r\n\t\t\tcnt = o.data('cnt') - 1,\r\n\t\t\thide = o.data('hide');\r\n\r\n\t\to.data('cnt', cnt);\r\n\r\n\t\tif (cnt == 0 && o.is(':visible')) {\r\n\t\t\to.hide();\r\n\t\t\thide();\r\n\t\t}\r\n\t}\r\n\r\n\treturn this;\r\n}","$.fn.elfinderpanel = function (fm) {\r\n\r\n\treturn this.each(function () {\r\n\t\tvar panel = $(this).addClass('elfinder-panel ui-state-default '),\r\n\t\t\tmargin = 'margin-' + (fm.direction == 'ltr' ? 'left' : 'right');\r\n\r\n\t\tfm.one('load', function (e) {\r\n\t\t\tvar navbar = fm.getUI('navbar');\r\n\r\n\t\t\tpanel.css(margin, parseInt(navbar.outerWidth(true)));\r\n\t\t\tnavbar.bind('resize', function () {\r\n\t\t\t\tpanel.is(':visible') && panel.css(margin, parseInt(navbar.outerWidth(true)))\r\n\t\t\t})\r\n\t\t})\r\n\t})\r\n}","/**\r\n * @class elFinder ui\r\n * Display current folder path in statusbar.\r\n * Click on folder name in path - open folder\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\n$.fn.elfinderpath = function (fm) {\r\n\treturn this.each(function () {\r\n\t\tvar path = $(this).addClass('elfinder-path').html('&nbsp;')\r\n\t\t\t.delegate('a', 'click', function (e) {\r\n\t\t\t\tvar hash = $(this).attr('href').substr(1);\r\n\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\thash != fm.cwd().hash && fm.exec('open', hash);\r\n\t\t\t})\r\n\t\t\t.prependTo(fm.getUI('statusbar').show())\r\n\r\n\t\tfm.bind('open searchend', function () {\r\n\t\t\tvar dirs = [];\r\n\r\n\t\t\t$.each(fm.parents(fm.cwd().hash), function (i, hash) {\r\n\t\t\t\tdirs.push('<a href=\"#' + hash + '\">' + fm.escape(fm.file(hash).name) + '</a>');\r\n\t\t\t});\r\n\r\n\t\t\tpath.html(dirs.join(fm.option('separator')));\r\n\t\t})\r\n\t\t\t.bind('search', function () {\r\n\t\t\t\tpath.html(fm.i18n('searcresult'));\r\n\t\t\t});\r\n\t});\r\n}","/**\r\n * @class elFinder places/favorites ui\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\n$.fn.elfinderplaces = function (fm, opts) {\r\n\treturn this.each(function () {\r\n\t\tvar dirs = [],\r\n\t\t\tc = 'class',\r\n\t\t\tnavdir = fm.res(c, 'navdir'),\r\n\t\t\tcollapsed = fm.res(c, 'navcollapse'),\r\n\t\t\texpanded = fm.res(c, 'navexpand'),\r\n\t\t\thover = fm.res(c, 'hover'),\r\n\t\t\tclroot = fm.res(c, 'treeroot'),\r\n\t\t\ttpl = fm.res('tpl', 'navdir'),\r\n\t\t\tptpl = fm.res('tpl', 'perms'),\r\n\t\t\tspinner = $(fm.res('tpl', 'navspinner')),\r\n\t\t\t/**\r\n\t\t\t * Convert places dir node into dir hash\r\n\t\t\t *\r\n\t\t\t * @param  String  directory id\r\n\t\t\t * @return String\r\n\t\t\t **/\r\n\t\t\tid2hash = function (id) {\r\n\t\t\t\treturn id.substr(6);\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * Convert places dir node into dir hash\r\n\t\t\t *\r\n\t\t\t * @param  String  directory id\r\n\t\t\t * @return String\r\n\t\t\t **/\r\n\t\t\thash2id = function (hash) {\r\n\t\t\t\treturn 'place-' + hash;\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Save current places state\r\n\t\t\t *\r\n\t\t\t * @return void\r\n\t\t\t **/\r\n\t\t\tsave = function () {\r\n\t\t\t\tfm.storage('places', dirs.join(','));\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * Return node for given dir object\r\n\t\t\t *\r\n\t\t\t * @param  Object  directory object\r\n\t\t\t * @return jQuery\r\n\t\t\t **/\r\n\t\t\tcreate = function (dir) {\r\n\t\t\t\treturn $(tpl.replace(/\\{id\\}/, hash2id(dir.hash))\r\n\t\t\t\t\t.replace(/\\{name\\}/, fm.escape(dir.name))\r\n\t\t\t\t\t.replace(/\\{cssclass\\}/, fm.perms2class(dir))\r\n\t\t\t\t\t.replace(/\\{permissions\\}/, !dir.read || !dir.write ? ptpl : '')\r\n\t\t\t\t\t.replace(/\\{symlink\\}/, ''));\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * Add new node into places\r\n\t\t\t *\r\n\t\t\t * @param  Object  directory object\r\n\t\t\t * @return void\r\n\t\t\t **/\r\n\t\t\tadd = function (dir) {\r\n\t\t\t\tvar node = create(dir);\r\n\r\n\t\t\t\tif (subtree.children().length) {\r\n\t\t\t\t\t$.each(subtree.children(), function () {\r\n\t\t\t\t\t\tvar current = $(this);\r\n\r\n\t\t\t\t\t\tif (dir.name.localeCompare(current.children('.' + navdir).text()) < 0) {\r\n\t\t\t\t\t\t\treturn !node.insertBefore(current);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdirs.push(dir.hash);\r\n\t\t\t\t!node.parent().length && subtree.append(node);\r\n\t\t\t\troot.addClass(collapsed);\r\n\t\t\t\tnode.draggable({\r\n\t\t\t\t\tappendTo: 'body',\r\n\t\t\t\t\trevert: false,\r\n\t\t\t\t\thelper: function () {\r\n\t\t\t\t\t\tvar dir = $(this);\r\n\r\n\t\t\t\t\t\tdir.children().removeClass('ui-state-hover');\r\n\r\n\t\t\t\t\t\treturn $('<div class=\"elfinder-place-drag elfinder-' + fm.direction + '\"/>')\r\n\t\t\t\t\t\t\t.append(dir.clone())\r\n\t\t\t\t\t\t\t.data('hash', id2hash(dir.children(':first').attr('id')));\r\n\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstart: function () {\r\n\t\t\t\t\t\t$(this).hide();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tstop: function (e, ui) {\r\n\t\t\t\t\t\tvar top = places.offset().top,\r\n\t\t\t\t\t\t\tleft = places.offset().left,\r\n\t\t\t\t\t\t\twidth = places.width(),\r\n\t\t\t\t\t\t\theight = places.height(),\r\n\t\t\t\t\t\t\tx = e.clientX,\r\n\t\t\t\t\t\t\ty = e.clientY;\r\n\r\n\t\t\t\t\t\tif (x > left && x < left + width && y > top && y < y + height) {\r\n\t\t\t\t\t\t\t$(this).show();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tremove(ui.helper.data('hash'));\r\n\t\t\t\t\t\t\tsave();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * Remove dir from places\r\n\t\t\t *\r\n\t\t\t * @param  String  directory id\r\n\t\t\t * @return void\r\n\t\t\t **/\r\n\t\t\tremove = function (hash) {\r\n\t\t\t\tvar ndx = $.inArray(hash, dirs);\r\n\r\n\t\t\t\tif (ndx !== -1) {\r\n\t\t\t\t\tdirs.splice(ndx, 1);\r\n\t\t\t\t\tsubtree.find('#' + hash2id(hash)).parent().remove();\r\n\t\t\t\t\t!subtree.children().length && root.removeClass(collapsed + ' ' + expanded);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * Remove all dir from places\r\n\t\t\t *\r\n\t\t\t * @return void\r\n\t\t\t **/\r\n\t\t\tclear = function () {\r\n\t\t\t\tsubtree.empty();\r\n\t\t\t\troot.removeClass(collapsed + ' ' + expanded);\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * Node - wrapper for places root\r\n\t\t\t *\r\n\t\t\t * @type jQuery\r\n\t\t\t **/\r\n\t\t\twrapper = create({\r\n\t\t\t\thash: 'root-' + fm.namespace,\r\n\t\t\t\tname: fm.i18n(opts.name, 'places'),\r\n\t\t\t\tread: true,\r\n\t\t\t\twrite: true\r\n\t\t\t}),\r\n\t\t\t/**\r\n\t\t\t * Places root node\r\n\t\t\t *\r\n\t\t\t * @type jQuery\r\n\t\t\t **/\r\n\t\t\troot = wrapper.children('.' + navdir)\r\n\t\t\t\t.addClass(clroot)\r\n\t\t\t\t.click(function () {\r\n\t\t\t\t\tif (root.is('.' + collapsed)) {\r\n\t\t\t\t\t\tplaces.toggleClass(expanded);\r\n\t\t\t\t\t\tsubtree.slideToggle();\r\n\t\t\t\t\t\tfm.storage('placesState', places.is('.' + expanded) ? 1 : 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t/**\r\n\t\t\t * Container for dirs\r\n\t\t\t *\r\n\t\t\t * @type jQuery\r\n\t\t\t **/\r\n\t\t\tsubtree = wrapper.children('.' + fm.res(c, 'navsubtree')),\r\n\t\t\t/**\r\n\t\t\t * Main places container\r\n\t\t\t *\r\n\t\t\t * @type jQuery\r\n\t\t\t **/\r\n\t\t\tplaces = $(this).addClass(fm.res(c, 'tree') + ' elfinder-places ')\r\n\t\t\t\t.hide()\r\n\t\t\t\t.append(wrapper)\r\n\t\t\t\t.appendTo(fm.getUI('navbar'))\r\n\t\t\t\t.delegate('.' + navdir, 'hover', function () {\r\n\t\t\t\t\t$(this).toggleClass('ui-state-hover');\r\n\t\t\t\t})\r\n\t\t\t\t.delegate('.' + navdir, 'click', function (e) {\r\n\t\t\t\t\tfm.exec('open', $(this).attr('id').substr(6));\r\n\t\t\t\t})\r\n\t\t\t\t.delegate('.' + navdir + ':not(.' + clroot + ')', 'contextmenu', function (e) {\r\n\t\t\t\t\tvar hash = $(this).attr('id').substr(6);\r\n\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\tfm.trigger('contextmenu', {\r\n\t\t\t\t\t\traw: [{\r\n\t\t\t\t\t\t\tlabel: fm.i18n('rmFromPlaces'),\r\n\t\t\t\t\t\t\ticon: 'rm',\r\n\t\t\t\t\t\t\tcallback: function () {\r\n\t\t\t\t\t\t\t\tremove(hash);\r\n\t\t\t\t\t\t\t\tsave();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}],\r\n\t\t\t\t\t\t'x': e.clientX,\r\n\t\t\t\t\t\t'y': e.clientY\r\n\t\t\t\t\t})\r\n\r\n\t\t\t\t})\r\n\t\t\t\t.droppable({\r\n\t\t\t\t\ttolerance: 'pointer',\r\n\t\t\t\t\taccept: '.elfinder-cwd-file-wrapper,.elfinder-tree-dir,.elfinder-cwd-file',\r\n\t\t\t\t\thoverClass: fm.res('class', 'adroppable'),\r\n\t\t\t\t\tdrop: function (e, ui) {\r\n\t\t\t\t\t\tvar resolve = true;\r\n\r\n\t\t\t\t\t\t$.each(ui.helper.data('files'), function (i, hash) {\r\n\t\t\t\t\t\t\tvar dir = fm.file(hash);\r\n\r\n\t\t\t\t\t\t\tif (dir && dir.mime == 'directory' && $.inArray(dir.hash, dirs) === -1) {\r\n\t\t\t\t\t\t\t\tadd(dir);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tresolve = false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tsave();\r\n\t\t\t\t\t\tresolve && ui.helper.hide();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\r\n\t\t// on fm load - show places and load files from backend\r\n\t\tfm.one('load', function () {\r\n\t\t\tif (fm.oldAPI) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tplaces.show().parent().show();\r\n\r\n\t\t\tdirs = $.map(fm.storage('places').split(','), function (hash) {\r\n\t\t\t\treturn hash || null\r\n\t\t\t});\r\n\r\n\t\t\tif (dirs.length) {\r\n\t\t\t\troot.prepend(spinner);\r\n\r\n\t\t\t\tfm.request({\r\n\t\t\t\t\tdata: {cmd: 'info', targets: dirs},\r\n\t\t\t\t\tpreventDefault: true\r\n\t\t\t\t})\r\n\t\t\t\t\t.done(function (data) {\r\n\t\t\t\t\t\tdirs = [];\r\n\t\t\t\t\t\t$.each(data.files, function (i, file) {\r\n\t\t\t\t\t\t\tfile.mime == 'directory' && add(file);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tsave();\r\n\t\t\t\t\t\tif (fm.storage('placesState') > 0) {\r\n\t\t\t\t\t\t\troot.click();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.always(function () {\r\n\t\t\t\t\t\tspinner.remove();\r\n\t\t\t\t\t})\r\n\t\t\t}\r\n\r\n\r\n\t\t\tfm.remove(function (e) {\r\n\t\t\t\t$.each(e.data.removed, function (i, hash) {\r\n\t\t\t\t\tremove(hash);\r\n\t\t\t\t});\r\n\t\t\t\tsave();\r\n\t\t\t})\r\n\t\t\t\t.change(function (e) {\r\n\t\t\t\t\t$.each(e.data.changed, function (i, file) {\r\n\t\t\t\t\t\tif ($.inArray(file.hash, dirs) !== -1) {\r\n\t\t\t\t\t\t\tremove(file.hash);\r\n\t\t\t\t\t\t\tfile.mime == 'directory' && add(file);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tsave();\r\n\t\t\t\t})\r\n\t\t\t\t.bind('sync', function () {\r\n\t\t\t\t\tif (dirs.length) {\r\n\t\t\t\t\t\troot.prepend(spinner);\r\n\r\n\t\t\t\t\t\tfm.request({\r\n\t\t\t\t\t\t\tdata: {cmd: 'info', targets: dirs},\r\n\t\t\t\t\t\t\tpreventDefault: true\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.done(function (data) {\r\n\t\t\t\t\t\t\t\t$.each(data.files || [], function (i, file) {\r\n\t\t\t\t\t\t\t\t\tif ($.inArray(file.hash, dirs) === -1) {\r\n\t\t\t\t\t\t\t\t\t\tremove(file.hash);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tsave();\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.always(function () {\r\n\t\t\t\t\t\t\t\tspinner.remove();\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t})\r\n\t});\r\n}","/**\r\n * @class  elFinder toolbar search button widget.\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\n$.fn.elfindersearchbutton = function (cmd) {\r\n\treturn this.each(function () {\r\n\t\tvar result = false,\r\n\t\t\tbutton = $(this)\r\n\t\t\t\t.hide()\r\n\t\t\t\t.addClass('pane-heading-controls hidden-sm hidden-xs form-inline col-sm-auto ' + cmd.fm.res('class', 'searchbtn') + ''),\r\n\t\t\tform = $('<div class=\"input-group input-group-sm\" />').appendTo(button),\r\n\t\t\tsearch = function () {\r\n\t\t\t\tvar val = $.trim(input.val());\r\n\t\t\t\tif (val) {\r\n\t\t\t\t\tcmd.exec(val).done(function () {\r\n\t\t\t\t\t\tresult = true;\r\n\t\t\t\t\t\tinput.focus();\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcmd.fm.trigger('searchend')\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tabort = function () {\r\n\t\t\t\tinput.val('');\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\tresult = false;\r\n\t\t\t\t\tcmd.fm.trigger('searchend');\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tinput = $('<input type=\"text\" class=\"form-control no-margin-b\" placeholder=\"Search...\" />')\r\n\t\t\t\t.appendTo(form)\r\n\t\t\t\t// to avoid fm shortcuts on arrows\r\n\t\t\t\t.keypress(function (e) {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t})\r\n\t\t\t\t.keydown(function (e) {\r\n\t\t\t\t\te.stopPropagation();\r\n\r\n\t\t\t\t\te.keyCode == 13 && search();\r\n\r\n\t\t\t\t\tif (e.keyCode == 27) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tabort();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t$('<span class=\"input-group-btn\"><button class=\"btn\" title=\"' + cmd.title + '\"><i class=\"fa fa-search\" /></button></span>')\r\n\t\t\t.appendTo(form)\r\n\t\t\t.click(search);\r\n\r\n\t\t// wait when button will be added to DOM\r\n\t\tsetTimeout(function () {\r\n\t\t\tbutton.parent().detach();\r\n\t\t\tcmd.fm.getUI('toolbar').prepend(button.show());\r\n\t\t}, 200);\r\n\r\n\t\tcmd.fm\r\n\t\t\t.error(function () {\r\n\t\t\t\tinput.unbind('keydown');\r\n\t\t\t})\r\n\t\t\t.select(function () {\r\n\t\t\t\tinput.blur();\r\n\t\t\t})\r\n\t\t\t.bind('searchend', function () {\r\n\t\t\t\tinput.val('');\r\n\t\t\t})\r\n\t\t\t.viewchange(abort)\r\n\t\t\t.shortcut({\r\n\t\t\t\tpattern: 'ctrl+f f3',\r\n\t\t\t\tdescription: cmd.title,\r\n\t\t\t\tcallback: function () {\r\n\t\t\t\t\tinput.select().focus();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t});\r\n}","/**\r\n * @class  elFinder toolbar button menu with sort variants.\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\n$.fn.elfindersortbutton = function (cmd) {\r\n\r\n\treturn this.each(function () {\r\n\t\tvar fm = cmd.fm,\r\n\t\t\tname = cmd.name,\r\n\t\t\tc = 'class',\r\n\t\t\tdisabled = fm.res(c, 'disabled'),\r\n\t\t\thover = fm.res(c, 'hover'),\r\n\t\t\titem = 'elfinder-button-menu-item',\r\n\t\t\tselected = item + '-selected',\r\n\t\t\tasc = selected + '-asc',\r\n\t\t\tdesc = selected + '-desc',\r\n\t\t\tbutton = $(this).addClass('elfinder-menubutton btn elfiner-button-' + name)\r\n\t\t\t\t.attr('title', cmd.title)\r\n\t\t\t\t.append('<span class=\"elfinder-button-icon elfinder-button-icon-' + name + '\"/>')\r\n\t\t\t\t.hover(function (e) {\r\n\t\t\t\t\t!button.is('.' + disabled) && button.toggleClass(hover);\r\n\t\t\t\t})\r\n\t\t\t\t.click(function (e) {\r\n\t\t\t\t\tif (!button.is('.' + disabled)) {\r\n\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\tmenu.is(':hidden') && cmd.fm.getUI().click();\r\n\t\t\t\t\t\tmenu.slideToggle(100);\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\tmenu = $('<div class=\"ui-widget ui-panel-body elfinder-button-menu \"/>')\r\n\t\t\t\t.hide()\r\n\t\t\t\t.appendTo(button)\r\n\t\t\t\t.zIndex(12 + button.zIndex())\r\n\t\t\t\t.delegate('.' + item, 'hover', function () {\r\n\t\t\t\t\t$(this).toggleClass(hover)\r\n\t\t\t\t})\r\n\t\t\t\t.delegate('.' + item, 'click', function (e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\thide();\r\n\t\t\t\t}),\r\n\t\t\tupdate = function () {\r\n\t\t\t\tmenu.children(':not(:last)').removeClass(selected + ' ' + asc + ' ' + desc)\r\n\t\t\t\t\t.filter('[rel=\"' + fm.sortType + '\"]')\r\n\t\t\t\t\t.addClass(selected + ' ' + (fm.sortOrder == 'asc' ? asc : desc));\r\n\r\n\t\t\t\tmenu.children(':last').toggleClass(selected, fm.sortStickFolders);\r\n\t\t\t},\r\n\t\t\thide = function () {\r\n\t\t\t\tmenu.hide();\r\n\t\t\t};\r\n\r\n\r\n\t\t$.each(fm.sortRules, function (name, value) {\r\n\t\t\tmenu.append($('<div class=\"' + item + '\" rel=\"' + name + '\"><span class=\"ui-icon ui-icon-arrowthick-1-n\"/><span class=\"ui-icon ui-icon-arrowthick-1-s\"/>' + fm.i18n('sort' + name) + '</div>').data('type', name));\r\n\t\t});\r\n\r\n\t\tmenu.children().click(function (e) {\r\n\t\t\tvar type = $(this).attr('rel');\r\n\r\n\t\t\tcmd.exec([], {\r\n\t\t\t\ttype: type,\r\n\t\t\t\torder: type == fm.sortType ? fm.sortOrder == 'asc' ? 'desc' : 'asc' : fm.sortOrder,\r\n\t\t\t\tstick: fm.sortStickFolders\r\n\t\t\t});\r\n\t\t})\r\n\r\n\t\t$('<div class=\"' + item + ' ' + item + '-separated\"><span class=\"ui-icon ui-icon-check\"/>' + fm.i18n('sortFoldersFirst') + '</div>')\r\n\t\t\t.appendTo(menu)\r\n\t\t\t.click(function () {\r\n\t\t\t\tcmd.exec([], {type: fm.sortType, order: fm.sortOrder, stick: !fm.sortStickFolders});\r\n\t\t\t});\r\n\r\n\t\tfm.bind('disable select', hide).getUI().click(hide);\r\n\r\n\t\tfm.bind('sortchange', update)\r\n\r\n\t\tif (menu.children().length > 1) {\r\n\t\t\tcmd.change(function () {\r\n\t\t\t\tbutton.toggleClass(disabled, cmd.disabled());\r\n\t\t\t\tupdate();\r\n\t\t\t})\r\n\t\t\t\t.change();\r\n\r\n\t\t} else {\r\n\t\t\tbutton.addClass(disabled);\r\n\t\t}\r\n\t});\r\n}","/**\r\n * @class elFinder ui\r\n * Display number of files/selected files and its size in statusbar\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\n$.fn.elfinderstat = function (fm) {\r\n\treturn this.each(function () {\r\n\t\tvar size = $(this).addClass('elfinder-stat-size'),\r\n\t\t\tsel = $('<div class=\"elfinder-stat-selected\"/>'),\r\n\t\t\ttitlesize = fm.i18n('size').toLowerCase(),\r\n\t\t\ttitleitems = fm.i18n('items').toLowerCase(),\r\n\t\t\ttitlesel = fm.i18n('selected'),\r\n\t\t\tsetstat = function (files, cwd) {\r\n\t\t\t\tvar c = 0,\r\n\t\t\t\t\ts = 0;\r\n\r\n\t\t\t\t$.each(files, function (i, file) {\r\n\t\t\t\t\tif (!cwd || file.phash == cwd) {\r\n\t\t\t\t\t\tc++;\r\n\t\t\t\t\t\ts += parseInt(file.size) || 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\tsize.html(titleitems + ': ' + c + ', ' + titlesize + ': ' + fm.formatSize(s));\r\n\t\t\t};\r\n\r\n\t\tfm.getUI('statusbar').prepend(size).append(sel).show();\r\n\r\n\t\tfm\r\n\t\t\t.bind('open reload add remove change searchend', function () {\r\n\t\t\t\tsetstat(fm.files(), fm.cwd().hash)\r\n\t\t\t})\r\n\t\t\t.search(function (e) {\r\n\t\t\t\tsetstat(e.data.files);\r\n\t\t\t})\r\n\t\t\t.select(function () {\r\n\t\t\t\tvar s = 0,\r\n\t\t\t\t\tc = 0,\r\n\t\t\t\t\tfiles = fm.selectedFiles();\r\n\r\n\t\t\t\tif (files.length == 1) {\r\n\t\t\t\t\ts = files[0].size;\r\n\t\t\t\t\tsel.html(fm.escape(files[0].name) + (s > 0 ? ', ' + fm.formatSize(s) : ''));\r\n\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$.each(files, function (i, file) {\r\n\t\t\t\t\tc++;\r\n\t\t\t\t\ts += parseInt(file.size) || 0;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tsel.html(c ? titlesel + ': ' + c + ', ' + titlesize + ': ' + fm.formatSize(s) : '&nbsp;');\r\n\t\t\t});\r\n\t})\r\n}","/**\r\n * @class  elFinder toolbar\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\n$.fn.elfindertoolbar = function (fm, opts) {\r\n\tthis.not('.elfinder-toolbar').each(function () {\r\n\t\tvar commands = fm._commands,\r\n\t\t\tself = $(this).addClass('elfinder-toolbar panel-heading'),\r\n\t\t\tpanels = opts || [],\r\n\t\t\tl = panels.length,\r\n\t\t\ti, cmd, panel, button;\r\n\r\n\t\tself.prev().length && self.parent().prepend(this);\r\n\r\n\t\twhile (l--) {\r\n\t\t\tif (panels[l]) {\r\n\t\t\t\tpanel = $('<div class=\"btn-group\"/>');\r\n\t\t\t\ti = panels[l].length;\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tif ((cmd = commands[panels[l][i]])) {\r\n\t\t\t\t\t\tbutton = 'elfinder' + cmd.options.ui;\r\n\t\t\t\t\t\t$.fn[button] && panel.prepend($('<div/>')[button](cmd));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tpanel.children().length && self.prepend(panel);\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tself.children().length && self.show();\r\n\t});\r\n\r\n\treturn this;\r\n}","/**\r\n * @class  elFinder folders tree\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\n$.fn.elfindertree = function (fm, opts) {\r\n\tvar treeclass = fm.res('class', 'tree');\r\n\r\n\tthis.not('.' + treeclass).each(function () {\r\n\r\n\t\tvar c = 'class',\r\n\r\n\t\t\t/**\r\n\t\t\t * Root directory class name\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t */\r\n\t\t\troot = fm.res(c, 'treeroot'),\r\n\r\n\t\t\t/**\r\n\t\t\t * Open root dir if not opened yet\r\n\t\t\t *\r\n\t\t\t * @type Boolean\r\n\t\t\t */\r\n\t\t\topenRoot = opts.openRootOnLoad,\r\n\r\n\t\t\t/**\r\n\t\t\t * Subtree class name\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t */\r\n\t\t\tsubtree = fm.res(c, 'navsubtree'),\r\n\r\n\t\t\t/**\r\n\t\t\t * Directory class name\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t */\r\n\t\t\tnavdir = fm.res(c, 'treedir'),\r\n\r\n\t\t\t/**\r\n\t\t\t * Collapsed arrow class name\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t */\r\n\t\t\tcollapsed = fm.res(c, 'navcollapse'),\r\n\r\n\t\t\t/**\r\n\t\t\t * Expanded arrow class name\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t */\r\n\t\t\texpanded = fm.res(c, 'navexpand'),\r\n\r\n\t\t\t/**\r\n\t\t\t * Class name to mark arrow for directory with already loaded children\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t */\r\n\t\t\tloaded = 'elfinder-subtree-loaded',\r\n\r\n\t\t\t/**\r\n\t\t\t * Arraw class name\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t */\r\n\t\t\tarrow = fm.res(c, 'navarrow'),\r\n\r\n\t\t\t/**\r\n\t\t\t * Current directory class name\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t */\r\n\t\t\tactive = fm.res(c, 'active'),\r\n\r\n\t\t\t/**\r\n\t\t\t * Droppable dirs dropover class\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t */\r\n\t\t\tdropover = fm.res(c, 'adroppable'),\r\n\r\n\t\t\t/**\r\n\t\t\t * Hover class name\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t */\r\n\t\t\thover = fm.res(c, 'hover'),\r\n\r\n\t\t\t/**\r\n\t\t\t * Disabled dir class name\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t */\r\n\t\t\tdisabled = fm.res(c, 'disabled'),\r\n\r\n\t\t\t/**\r\n\t\t\t * Draggable dir class name\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t */\r\n\t\t\tdraggable = fm.res(c, 'draggable'),\r\n\r\n\t\t\t/**\r\n\t\t\t * Droppable dir  class name\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t */\r\n\t\t\tdroppable = fm.res(c, 'droppable'),\r\n\r\n\t\t\tinsideNavbar = function (x) {\r\n\t\t\t\tvar left = navbar.offset().left;\r\n\r\n\t\t\t\treturn left <= x && x <= left + navbar.width();\r\n\t\t\t},\r\n\r\n\t\t\tdrop = fm.droppable.drop,\r\n\r\n\t\t\t/**\r\n\t\t\t * Droppable options\r\n\t\t\t *\r\n\t\t\t * @type Object\r\n\t\t\t */\r\n\t\t\tdroppableopts = $.extend(true, {}, fm.droppable, {\r\n\t\t\t\t// show subfolders on dropover\r\n\t\t\t\tover: function (e) {\r\n\t\t\t\t\tvar link = $(this),\r\n\t\t\t\t\t\tcl = hover + ' ' + dropover;\r\n\r\n\t\t\t\t\tif (insideNavbar(e.clientX)) {\r\n\t\t\t\t\t\tlink.addClass(cl)\r\n\t\t\t\t\t\tif (link.is('.' + collapsed + ':not(.' + expanded + ')')) {\r\n\t\t\t\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\t\t\t\tlink.is('.' + dropover) && link.children('.' + arrow).click();\r\n\t\t\t\t\t\t\t}, 500);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlink.removeClass(cl);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tout: function () {\r\n\t\t\t\t\t$(this).removeClass(hover + ' ' + dropover);\r\n\t\t\t\t},\r\n\t\t\t\tdrop: function (e, ui) {\r\n\t\t\t\t\tinsideNavbar(e.clientX) && drop.call(this, e, ui);\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\r\n\t\t\tspinner = $(fm.res('tpl', 'navspinner')),\r\n\r\n\t\t\t/**\r\n\t\t\t * Directory html template\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t */\r\n\t\t\ttpl = fm.res('tpl', 'navdir'),\r\n\r\n\t\t\t/**\r\n\t\t\t * Permissions marker html template\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t */\r\n\t\t\tptpl = fm.res('tpl', 'perms'),\r\n\r\n\t\t\t/**\r\n\t\t\t * Symlink marker html template\r\n\t\t\t *\r\n\t\t\t * @type String\r\n\t\t\t */\r\n\t\t\tstpl = fm.res('tpl', 'symlink'),\r\n\r\n\t\t\t/**\r\n\t\t\t * Html template replacement methods\r\n\t\t\t *\r\n\t\t\t * @type Object\r\n\t\t\t */\r\n\t\t\treplace = {\r\n\t\t\t\tid: function (dir) {\r\n\t\t\t\t\treturn fm.navHash2Id(dir.hash)\r\n\t\t\t\t},\r\n\t\t\t\tcssclass: function (dir) {\r\n\t\t\t\t\treturn (dir.phash ? '' : root) + ' ' + navdir + ' ' + fm.perms2class(dir) + ' ' + (dir.dirs && !dir.link ? collapsed : '');\r\n\t\t\t\t},\r\n\t\t\t\tpermissions: function (dir) {\r\n\t\t\t\t\treturn !dir.read || !dir.write ? ptpl : '';\r\n\t\t\t\t},\r\n\t\t\t\tsymlink: function (dir) {\r\n\t\t\t\t\treturn dir.alias ? stpl : '';\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Return html for given dir\r\n\t\t\t *\r\n\t\t\t * @param  Object  directory\r\n\t\t\t * @return String\r\n\t\t\t */\r\n\t\t\titemhtml = function (dir) {\r\n\t\t\t\tdir.name = fm.escape(dir.i18 || dir.name);\r\n\r\n\t\t\t\treturn tpl.replace(/(?:\\{([a-z]+)\\})/ig, function (m, key) {\r\n\t\t\t\t\treturn dir[key] || (replace[key] ? replace[key](dir) : '');\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Return only dirs from files list\r\n\t\t\t *\r\n\t\t\t * @param  Array  files list\r\n\t\t\t * @return Array\r\n\t\t\t */\r\n\t\t\tfilter = function (files) {\r\n\t\t\t\treturn $.map(files || [], function (f) {\r\n\t\t\t\t\treturn f.mime == 'directory' ? f : null\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Find parent subtree for required directory\r\n\t\t\t *\r\n\t\t\t * @param  String  dir hash\r\n\t\t\t * @return jQuery\r\n\t\t\t */\r\n\t\t\tfindSubtree = function (hash) {\r\n\t\t\t\treturn hash ? tree.find('#' + fm.navHash2Id(hash)).next('.' + subtree) : tree;\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Find directory (wrapper) in required node\r\n\t\t\t * before which we can insert new directory\r\n\t\t\t *\r\n\t\t\t * @param  jQuery  parent directory\r\n\t\t\t * @param  Object  new directory\r\n\t\t\t * @return jQuery\r\n\t\t\t */\r\n\t\t\tfindSibling = function (subtree, dir) {\r\n\t\t\t\tvar node = subtree.children(':first'),\r\n\t\t\t\t\tinfo;\r\n\r\n\t\t\t\twhile (node.length) {\r\n\t\t\t\t\tinfo = fm.file(fm.navId2Hash(node.children('[id]').attr('id')));\r\n\r\n\t\t\t\t\tif ((info = fm.file(fm.navId2Hash(node.children('[id]').attr('id'))))\r\n\t\t\t\t\t\t&& dir.name.toLowerCase().localeCompare(info.name.toLowerCase()) < 0) {\r\n\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tnode = node.next();\r\n\t\t\t\t}\r\n\t\t\t\treturn $('');\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Add new dirs in tree\r\n\t\t\t *\r\n\t\t\t * @param  Array  dirs list\r\n\t\t\t * @return void\r\n\t\t\t */\r\n\t\t\tupdateTree = function (dirs) {\r\n\t\t\t\tvar length = dirs.length,\r\n\t\t\t\t\torphans = [],\r\n\t\t\t\t\ti = dirs.length,\r\n\t\t\t\t\tdir, html, parent, sibling;\r\n\r\n\t\t\t\tvar firstVol = true; // check for netmount volume\r\n\t\t\t\twhile (i--) {\r\n\t\t\t\t\tdir = dirs[i];\r\n\r\n\t\t\t\t\tif (tree.find('#' + fm.navHash2Id(dir.hash)).length) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ((parent = findSubtree(dir.phash)).length) {\r\n\t\t\t\t\t\thtml = itemhtml(dir);\r\n\t\t\t\t\t\tif (dir.phash && (sibling = findSibling(parent, dir)).length) {\r\n\t\t\t\t\t\t\tsibling.before(html);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tparent[firstVol || dir.phash ? 'append' : 'prepend'](html);\r\n\t\t\t\t\t\t\tfirstVol = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\torphans.push(dir);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (orphans.length && orphans.length < length) {\r\n\t\t\t\t\treturn updateTree(orphans);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\tupdateDroppable();\r\n\t\t\t\t}, 10);\r\n\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Mark current directory as active\r\n\t\t\t * If current directory is not in tree - load it and its parents\r\n\t\t\t *\r\n\t\t\t * @param {Boolean} do not recursive call\r\n\t\t\t * @return void\r\n\t\t\t */\r\n\t\t\tsync = function (stopRec) {\r\n\t\t\t\tvar cwd = fm.cwd().hash,\r\n\t\t\t\t\tcurrent = tree.find('#' + fm.navHash2Id(cwd)),\r\n\t\t\t\t\trootNode, dir;\r\n\r\n\t\t\t\tif (openRoot) {\r\n\t\t\t\t\trootNode = tree.find('#' + fm.navHash2Id(fm.root()));\r\n\t\t\t\t\trootNode.is('.' + loaded) && rootNode.addClass(expanded).next('.' + subtree).show();\r\n\t\t\t\t\topenRoot = false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!current.is('.' + active)) {\r\n\t\t\t\t\ttree.find('.' + navdir + '.' + active).removeClass(active);\r\n\t\t\t\t\tcurrent.addClass(active);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (opts.syncTree) {\r\n\t\t\t\t\tif (current.length) {\r\n\t\t\t\t\t\treturn current.parentsUntil('.' + root).filter('.' + subtree).show().prev('.' + navdir).addClass(expanded);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (fm.newAPI) {\r\n\t\t\t\t\t\tdir = fm.file(cwd);\r\n\t\t\t\t\t\tif (dir && dir.phash && tree.find('#' + fm.navHash2Id(dir.phash)).length) {\r\n\t\t\t\t\t\t\tupdateTree([dir]);\r\n\t\t\t\t\t\t\treturn sync();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfm.request({\r\n\t\t\t\t\t\t\tdata: {cmd: 'parents', target: cwd},\r\n\t\t\t\t\t\t\tpreventFail: true\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.done(function (data) {\r\n\t\t\t\t\t\t\t\tvar dirs = filter(data.tree);\r\n\t\t\t\t\t\t\t\tupdateTree(dirs);\r\n\t\t\t\t\t\t\t\tupdateArrows(dirs, loaded);\r\n\t\t\t\t\t\t\t\tcwd == fm.cwd().hash && sync(true);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Make writable and not root dirs droppable\r\n\t\t\t *\r\n\t\t\t * @return void\r\n\t\t\t */\r\n\t\t\tupdateDroppable = function () {\r\n\t\t\t\ttree.find('.' + navdir + ':not(.' + droppable + ',.elfinder-ro,.elfinder-na)').droppable(droppableopts);\r\n\t\t\t},\r\n\r\n\t\t\t/**\r\n\t\t\t * Check required folders for subfolders and update arrow classes\r\n\t\t\t *\r\n\t\t\t * @param  Array  folders to check\r\n\t\t\t * @param  String css class\r\n\t\t\t * @return void\r\n\t\t\t */\r\n\t\t\tupdateArrows = function (dirs, cls) {\r\n\t\t\t\tvar sel = cls == loaded\r\n\t\t\t\t\t? '.' + collapsed + ':not(.' + loaded + ')'\r\n\t\t\t\t\t: ':not(.' + collapsed + ')';\r\n\r\n\r\n\t\t\t\t//tree.find('.'+subtree+':has(*)').prev(':not(.'+collapsed+')').addClass(collapsed)\r\n\r\n\t\t\t\t$.each(dirs, function (i, dir) {\r\n\t\t\t\t\ttree.find('#' + fm.navHash2Id(dir.phash) + sel)\r\n\t\t\t\t\t\t.filter(function () {\r\n\t\t\t\t\t\t\treturn $(this).next('.' + subtree).children().length > 0\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.addClass(cls);\r\n\t\t\t\t})\r\n\t\t\t},\r\n\r\n\r\n\t\t\t/**\r\n\t\t\t * Navigation tree\r\n\t\t\t *\r\n\t\t\t * @type JQuery\r\n\t\t\t */\r\n\t\t\ttree = $(this).addClass(treeclass)\r\n\t\t\t\t// make dirs draggable and toggle hover class\r\n\t\t\t\t.delegate('.' + navdir, 'hover', function (e) {\r\n\t\t\t\t\tvar link = $(this),\r\n\t\t\t\t\t\tenter = e.type == 'mouseenter';\r\n\r\n\t\t\t\t\tif (!link.is('.' + dropover + ' ,.' + disabled)) {\r\n\t\t\t\t\t\tenter && !link.is('.' + root + ',.' + draggable + ',.elfinder-na,.elfinder-wo') && link.draggable(fm.draggable);\r\n\t\t\t\t\t\tlink.toggleClass(hover, enter);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t// add/remove dropover css class\r\n\t\t\t\t.delegate('.' + navdir, 'dropover dropout drop', function (e) {\r\n\t\t\t\t\t$(this)[e.type == 'dropover' ? 'addClass' : 'removeClass'](dropover + ' ' + hover);\r\n\t\t\t\t})\r\n\t\t\t\t// open dir or open subfolders in tree\r\n\t\t\t\t.delegate('.' + navdir, 'click', function (e) {\r\n\t\t\t\t\tvar link = $(this),\r\n\t\t\t\t\t\thash = fm.navId2Hash(link.attr('id')),\r\n\t\t\t\t\t\tfile = fm.file(hash);\r\n\r\n\t\t\t\t\tfm.trigger('searchend');\r\n\r\n\t\t\t\t\tif (hash != fm.cwd().hash && !link.is('.' + disabled)) {\r\n\t\t\t\t\t\tfm.exec('open', file.thash || hash);\r\n\t\t\t\t\t} else if (link.is('.' + collapsed)) {\r\n\t\t\t\t\t\tlink.children('.' + arrow).click();\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t// toggle subfolders in tree\r\n\t\t\t\t.delegate('.' + navdir + '.' + collapsed + ' .' + arrow, 'click', function (e) {\r\n\t\t\t\t\tvar arrow = $(this),\r\n\t\t\t\t\t\tlink = arrow.parent('.' + navdir),\r\n\t\t\t\t\t\tstree = link.next('.' + subtree);\r\n\r\n\t\t\t\t\te.stopPropagation();\r\n\r\n\t\t\t\t\tif (link.is('.' + loaded)) {\r\n\t\t\t\t\t\tlink.toggleClass(expanded);\r\n\t\t\t\t\t\tstree.slideToggle()\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tspinner.insertBefore(arrow);\r\n\t\t\t\t\t\tlink.removeClass(collapsed);\r\n\r\n\t\t\t\t\t\tfm.request({cmd: 'tree', target: fm.navId2Hash(link.attr('id'))})\r\n\t\t\t\t\t\t\t.done(function (data) {\r\n\t\t\t\t\t\t\t\tupdateTree(filter(data.tree));\r\n\r\n\t\t\t\t\t\t\t\tif (stree.children().length) {\r\n\t\t\t\t\t\t\t\t\tlink.addClass(collapsed + ' ' + expanded);\r\n\t\t\t\t\t\t\t\t\tstree.slideDown();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tsync();\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.always(function (data) {\r\n\t\t\t\t\t\t\t\tspinner.remove();\r\n\t\t\t\t\t\t\t\tlink.addClass(loaded);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.delegate('.' + navdir, 'contextmenu', function (e) {\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\tfm.trigger('contextmenu', {\r\n\t\t\t\t\t\t'type': 'navbar',\r\n\t\t\t\t\t\t'targets': [fm.navId2Hash($(this).attr('id'))],\r\n\t\t\t\t\t\t'x': e.clientX,\r\n\t\t\t\t\t\t'y': e.clientY\r\n\t\t\t\t\t});\r\n\t\t\t\t}),\r\n\t\t// move tree into navbar\r\n\t\t\tnavbar = fm.getUI('navbar').append(tree).show()\r\n\r\n\t\t\t;\r\n\r\n\t\tfm.open(function (e) {\r\n\t\t\tvar data = e.data,\r\n\t\t\t\tdirs = filter(data.files);\r\n\r\n\t\t\tdata.init && tree.empty();\r\n\r\n\t\t\tif (dirs.length) {\r\n\t\t\t\tupdateTree(dirs);\r\n\t\t\t\tupdateArrows(dirs, loaded);\r\n\t\t\t}\r\n\t\t\tsync();\r\n\t\t})\r\n\t\t\t// add new dirs\r\n\t\t\t.add(function (e) {\r\n\t\t\t\tvar dirs = filter(e.data.added);\r\n\r\n\t\t\t\tif (dirs.length) {\r\n\t\t\t\t\tupdateTree(dirs);\r\n\t\t\t\t\tupdateArrows(dirs, collapsed);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t// update changed dirs\r\n\t\t\t.change(function (e) {\r\n\t\t\t\tvar dirs = filter(e.data.changed),\r\n\t\t\t\t\tl = dirs.length,\r\n\t\t\t\t\tdir, node, tmp, realParent, reqParent, realSibling, reqSibling, isExpanded, isLoaded;\r\n\r\n\t\t\t\twhile (l--) {\r\n\t\t\t\t\tdir = dirs[l];\r\n\t\t\t\t\tif ((node = tree.find('#' + fm.navHash2Id(dir.hash))).length) {\r\n\t\t\t\t\t\tif (dir.phash) {\r\n\t\t\t\t\t\t\trealParent = node.closest('.' + subtree);\r\n\t\t\t\t\t\t\treqParent = findSubtree(dir.phash);\r\n\t\t\t\t\t\t\trealSibling = node.parent().next();\r\n\t\t\t\t\t\t\treqSibling = findSibling(reqParent, dir);\r\n\r\n\t\t\t\t\t\t\tif (!reqParent.length) {\r\n\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (reqParent[0] !== realParent[0] || realSibling.get(0) !== reqSibling.get(0)) {\r\n\t\t\t\t\t\t\t\treqSibling.length ? reqSibling.before(node) : reqParent.append(node);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tisExpanded = node.is('.' + expanded);\r\n\t\t\t\t\t\tisLoaded = node.is('.' + loaded);\r\n\t\t\t\t\t\ttmp = $(itemhtml(dir));\r\n\t\t\t\t\t\tnode.replaceWith(tmp.children('.' + navdir));\r\n\r\n\t\t\t\t\t\tif (dir.dirs\r\n\t\t\t\t\t\t\t&& (isExpanded || isLoaded)\r\n\t\t\t\t\t\t\t&& (node = tree.find('#' + fm.navHash2Id(dir.hash)))\r\n\t\t\t\t\t\t\t&& node.next('.' + subtree).children().length) {\r\n\t\t\t\t\t\t\tisExpanded && node.addClass(expanded);\r\n\t\t\t\t\t\t\tisLoaded && node.addClass(loaded);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsync();\r\n\t\t\t\tupdateDroppable();\r\n\t\t\t})\r\n\t\t\t// remove dirs\r\n\t\t\t.remove(function (e) {\r\n\t\t\t\tvar dirs = e.data.removed,\r\n\t\t\t\t\tl = dirs.length,\r\n\t\t\t\t\tnode, stree;\r\n\r\n\t\t\t\twhile (l--) {\r\n\t\t\t\t\tif ((node = tree.find('#' + fm.navHash2Id(dirs[l]))).length) {\r\n\t\t\t\t\t\tstree = node.closest('.' + subtree);\r\n\t\t\t\t\t\tnode.parent().detach();\r\n\t\t\t\t\t\tif (!stree.children().length) {\r\n\t\t\t\t\t\t\tstree.hide().prev('.' + navdir).removeClass(collapsed + ' ' + expanded + ' ' + loaded);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t// add/remove active class for current dir\r\n\t\t\t.bind('search searchend', function (e) {\r\n\t\t\t\ttree.find('#' + fm.navHash2Id(fm.cwd().hash))[e.type == 'search' ? 'removeClass' : 'addClass'](active);\r\n\t\t\t})\r\n\t\t\t// lock/unlock dirs while moving\r\n\t\t\t.bind('lockfiles unlockfiles', function (e) {\r\n\t\t\t\tvar lock = e.type == 'lockfiles',\r\n\t\t\t\t\tact = lock ? 'disable' : 'enable',\r\n\t\t\t\t\tdirs = $.map(e.data.files || [], function (h) {\r\n\t\t\t\t\t\tvar dir = fm.file(h);\r\n\t\t\t\t\t\treturn dir && dir.mime == 'directory' ? h : null;\r\n\t\t\t\t\t})\r\n\r\n\t\t\t\t$.each(dirs, function (i, hash) {\r\n\t\t\t\t\tvar dir = tree.find('#' + fm.navHash2Id(hash));\r\n\r\n\t\t\t\t\tif (dir.length) {\r\n\t\t\t\t\t\tdir.is('.' + draggable) && dir.draggable(act);\r\n\t\t\t\t\t\tdir.is('.' + droppable) && dir.droppable(active);\r\n\t\t\t\t\t\tdir[lock ? 'addClass' : 'removeClass'](disabled);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t})\r\n\r\n\t});\r\n\r\n\treturn this;\r\n}","/**\r\n * @class  elFinder toolbar's button tor upload file\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\n$.fn.elfinderuploadbutton = function (cmd) {\r\n\treturn this.each(function () {\r\n\t\tvar button = $(this).elfinderbutton(cmd)\r\n\t\t\t\t.unbind('click'),\r\n\t\t\tform = $('<form/>').appendTo(button),\r\n\t\t\tinput = $('<input type=\"file\" multiple=\"true\"/>')\r\n\t\t\t\t.change(function () {\r\n\t\t\t\t\tvar _input = $(this);\r\n\t\t\t\t\tif (_input.val()) {\r\n\t\t\t\t\t\tcmd.exec({input: _input.remove()[0]});\r\n\t\t\t\t\t\tinput.clone(true).appendTo(form);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\tform.append(input.clone(true));\r\n\r\n\t\tcmd.change(function () {\r\n\t\t\tform[cmd.disabled() ? 'hide' : 'show']();\r\n\t\t})\r\n\t\t\t.change();\r\n\t});\r\n}","/**\r\n * @class  elFinder toolbar button to switch current directory view.\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\n$.fn.elfinderviewbutton = function (cmd) {\r\n\treturn this.each(function () {\r\n\t\tvar button = $(this).elfinderbutton(cmd),\r\n\t\t\ticon = button.children('.elfinder-button-icon');\r\n\r\n\t\tcmd.change(function () {\r\n\t\t\tvar icons = cmd.value == 'icons';\r\n\r\n\t\t\ticon.toggleClass('elfinder-button-icon-view-list', icons);\r\n\t\t\tbutton.attr('title', cmd.fm.i18n(icons ? 'viewlist' : 'viewicons'));\r\n\t\t});\r\n\t});\r\n}","/**\r\n * @class elfinderworkzone - elFinder container for nav and current directory\r\n * @author Dmitry (dio) Levashov\r\n **/\r\n$.fn.elfinderworkzone = function (fm) {\r\n\tvar cl = 'elfinder-workzone';\r\n\r\n\tthis.not('.' + cl).each(function () {\r\n\t\tvar wz = $(this).addClass(cl),\r\n\t\t\twdelta = wz.outerHeight(true) - wz.height(),\r\n\t\t\tparent = wz.parent();\r\n\r\n\t\tparent.add(window).bind('resize', function () {\r\n\t\t\tvar height = parent.height();\r\n\r\n\t\t\tparent.children(':visible:not(.' + cl + ')').each(function () {\r\n\t\t\t\tvar ch = $(this);\r\n\r\n\t\t\t\tif (ch.css('position') != 'absolute') {\r\n\t\t\t\t\theight -= ch.outerHeight(true);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\twz.height(height - wdelta);\r\n\t\t});\r\n\t});\r\n\treturn this;\r\n}","/**\r\n * @class  elFinder command \"archive\"\r\n * Archive selected files\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\nelFinder.prototype.commands.archive = function () {\r\n\tvar self = this,\r\n\t\tfm = self.fm,\r\n\t\tmimes = [];\r\n\r\n\tthis.variants = [];\r\n\r\n\tthis.disableOnSearch = true;\r\n\r\n\t/**\r\n\t * Update mimes on open/reload\r\n\t *\r\n\t * @return void\r\n\t **/\r\n\tfm.bind('open reload', function () {\r\n\t\tself.variants = [];\r\n\t\t$.each((mimes = fm.option('archivers')['create'] || []), function (i, mime) {\r\n\t\t\tself.variants.push([mime, fm.mime2kind(mime)])\r\n\t\t});\r\n\t\tself.change();\r\n\t});\r\n\r\n\tthis.getstate = function () {\r\n\t\treturn !this._disabled && mimes.length && fm.selected().length && fm.cwd().write ? 0 : -1;\r\n\t}\r\n\r\n\tthis.exec = function (hashes, type) {\r\n\t\tvar files = this.files(hashes),\r\n\t\t\tcnt = files.length,\r\n\t\t\tmime = type || mimes[0],\r\n\t\t\tcwd = fm.cwd(),\r\n\t\t\terror = ['errArchive', 'errPerm', 'errCreatingTempDir', 'errFtpDownloadFile', 'errFtpUploadFile', 'errFtpMkdir', 'errArchiveExec', 'errExtractExec', 'errRm'],\r\n\t\t\tdfrd = $.Deferred().fail(function (error) {\r\n\t\t\t\terror && fm.error(error);\r\n\t\t\t}),\r\n\t\t\ti;\r\n\r\n\t\tif (!(this.enabled() && cnt && mimes.length && $.inArray(mime, mimes) !== -1)) {\r\n\t\t\treturn dfrd.reject();\r\n\t\t}\r\n\r\n\t\tif (!cwd.write) {\r\n\t\t\treturn dfrd.reject(error);\r\n\t\t}\r\n\r\n\t\tfor (i = 0; i < cnt; i++) {\r\n\t\t\tif (!files[i].read) {\r\n\t\t\t\treturn dfrd.reject(error);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn fm.request({\r\n\t\t\tdata: {cmd: 'archive', targets: this.hashes(hashes), type: mime},\r\n\t\t\tnotify: {type: 'archive', cnt: 1},\r\n\t\t\tsyncOnFail: true\r\n\t\t});\r\n\t}\r\n\r\n}","/**\r\n * @class  elFinder command \"back\"\r\n * Open last visited folder\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\nelFinder.prototype.commands.back = function () {\r\n\tthis.alwaysEnabled = true;\r\n\tthis.updateOnSelect = false;\r\n\tthis.shortcuts = [{\r\n\t\tpattern: 'ctrl+left backspace'\r\n\t}];\r\n\r\n\tthis.getstate = function () {\r\n\t\treturn this.fm.history.canBack() ? 0 : -1;\r\n\t}\r\n\r\n\tthis.exec = function () {\r\n\t\treturn this.fm.history.back();\r\n\t}\r\n\r\n}","/**\r\n * @class elFinder command \"copy\".\r\n * Put files in filemanager clipboard.\r\n *\r\n * @type  elFinder.command\r\n * @author  Dmitry (dio) Levashov\r\n */\r\nelFinder.prototype.commands.copy = function () {\r\n\r\n\tthis.shortcuts = [{\r\n\t\tpattern: 'ctrl+c ctrl+insert'\r\n\t}];\r\n\r\n\tthis.getstate = function (sel) {\r\n\t\tvar sel = this.files(sel),\r\n\t\t\tcnt = sel.length;\r\n\r\n\t\treturn cnt && $.map(sel, function (f) {\r\n\t\t\treturn f.phash && f.read ? f : null\r\n\t\t}).length == cnt ? 0 : -1;\r\n\t}\r\n\r\n\tthis.exec = function (hashes) {\r\n\t\tvar fm = this.fm,\r\n\t\t\tdfrd = $.Deferred()\r\n\t\t\t\t.fail(function (error) {\r\n\t\t\t\t\tfm.error(error);\r\n\t\t\t\t});\r\n\r\n\t\t$.each(this.files(hashes), function (i, file) {\r\n\t\t\tif (!(file.read && file.phash)) {\r\n\t\t\t\treturn !dfrd.reject(['errCopy', file.name, 'errPerm']);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn dfrd.state() == 'rejected' ? dfrd : dfrd.resolve(fm.clipboard(this.hashes(hashes)));\r\n\t}\r\n}","/**\r\n * @class elFinder command \"copy\".\r\n * Put files in filemanager clipboard.\r\n *\r\n * @type  elFinder.command\r\n * @author  Dmitry (dio) Levashov\r\n */\r\nelFinder.prototype.commands.cut = function () {\r\n\r\n\tthis.shortcuts = [{\r\n\t\tpattern: 'ctrl+x shift+insert'\r\n\t}];\r\n\r\n\tthis.getstate = function (sel) {\r\n\t\tvar sel = this.files(sel),\r\n\t\t\tcnt = sel.length;\r\n\r\n\t\treturn cnt && $.map(sel, function (f) {\r\n\t\t\treturn f.phash && f.read && !f.locked ? f : null\r\n\t\t}).length == cnt ? 0 : -1;\r\n\t}\r\n\r\n\tthis.exec = function (hashes) {\r\n\t\tvar fm = this.fm,\r\n\t\t\tdfrd = $.Deferred()\r\n\t\t\t\t.fail(function (error) {\r\n\t\t\t\t\tfm.error(error);\r\n\t\t\t\t});\r\n\r\n\t\t$.each(this.files(hashes), function (i, file) {\r\n\t\t\tif (!(file.read && file.phash)) {\r\n\t\t\t\treturn !dfrd.reject(['errCopy', file.name, 'errPerm']);\r\n\t\t\t}\r\n\t\t\tif (file.locked) {\r\n\t\t\t\treturn !dfrd.reject(['errLocked', file.name]);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn dfrd.state() == 'rejected' ? dfrd : dfrd.resolve(fm.clipboard(this.hashes(hashes), true));\r\n\t}\r\n\r\n}","/**\r\n * @class elFinder command \"download\".\r\n * Download selected files.\r\n * Only for new api\r\n *\r\n * @author Dmitry (dio) Levashov, dio@std42.ru\r\n **/\r\nelFinder.prototype.commands.download = function () {\r\n\tvar self = this,\r\n\t\tfm = this.fm,\r\n\t\tfilter = function (hashes) {\r\n\t\t\treturn $.map(self.files(hashes), function (f) {\r\n\t\t\t\treturn f.mime == 'directory' ? null : f\r\n\t\t\t});\r\n\t\t};\r\n\r\n\tthis.shortcuts = [{\r\n\t\tpattern: 'shift+enter'\r\n\t}];\r\n\r\n\tthis.getstate = function () {\r\n\t\tvar sel = this.fm.selected(),\r\n\t\t\tcnt = sel.length;\r\n\r\n\t\treturn !this._disabled && cnt && (!fm.UA.IE || cnt == 1) && cnt == filter(sel).length ? 0 : -1;\r\n\t}\r\n\r\n\tthis.exec = function (hashes) {\r\n\t\tvar fm = this.fm,\r\n\t\t\tbase = fm.options.url,\r\n\t\t\tfiles = filter(hashes),\r\n\t\t\tdfrd = $.Deferred(),\r\n\t\t\tiframes = '',\r\n\t\t\tcdata = '',\r\n\t\t\ti, url;\r\n\r\n\t\tif (this.disabled()) {\r\n\t\t\treturn dfrd.reject();\r\n\t\t}\r\n\r\n\t\tif (fm.oldAPI) {\r\n\t\t\tfm.error('errCmdNoSupport');\r\n\t\t\treturn dfrd.reject();\r\n\t\t}\r\n\r\n\t\tcdata = $.param(fm.options.customData || {});\r\n\t\tif (cdata) {\r\n\t\t\tcdata = '&' + cdata;\r\n\t\t}\r\n\r\n\t\tbase += base.indexOf('?') === -1 ? '?' : '&';\r\n\r\n\t\tfor (i = 0; i < files.length; i++) {\r\n\t\t\tiframes += '<iframe class=\"downloader\" id=\"downloader-' + files[i].hash + '\" style=\"display:none\" src=\"' + base + 'cmd=file&target=' + files[i].hash + '&download=1' + cdata + '\"/>';\r\n\t\t}\r\n\t\t$(iframes)\r\n\t\t\t.appendTo('body')\r\n\t\t\t.ready(function () {\r\n\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\t$(iframes).each(function () {\r\n\t\t\t\t\t\t$('#' + $(this).attr('id')).remove();\r\n\t\t\t\t\t});\r\n\t\t\t\t}, fm.UA.Firefox ? (20000 + (10000 * i)) : 1000); // give mozilla 20 sec + 10 sec for each file to be saved\r\n\t\t\t});\r\n\t\tfm.trigger('download', {files: files});\r\n\t\treturn dfrd.resolve(hashes);\r\n\t}\r\n\r\n}","/**\r\n * @class elFinder command \"duplicate\"\r\n * Create file/folder copy with suffix \"copy Number\"\r\n *\r\n * @type  elFinder.command\r\n * @author  Dmitry (dio) Levashov\r\n */\r\nelFinder.prototype.commands.duplicate = function () {\r\n\tvar fm = this.fm;\r\n\r\n\tthis.getstate = function (sel) {\r\n\t\tvar sel = this.files(sel),\r\n\t\t\tcnt = sel.length;\r\n\r\n\t\treturn !this._disabled && cnt && fm.cwd().write && $.map(sel, function (f) {\r\n\t\t\treturn f.phash && f.read ? f : null\r\n\t\t}).length == cnt ? 0 : -1;\r\n\t}\r\n\r\n\tthis.exec = function (hashes) {\r\n\t\tvar fm = this.fm,\r\n\t\t\tfiles = this.files(hashes),\r\n\t\t\tcnt = files.length,\r\n\t\t\tdfrd = $.Deferred()\r\n\t\t\t\t.fail(function (error) {\r\n\t\t\t\t\terror && fm.error(error);\r\n\t\t\t\t}),\r\n\t\t\targs = [];\r\n\r\n\t\tif (!cnt || this._disabled) {\r\n\t\t\treturn dfrd.reject();\r\n\t\t}\r\n\r\n\t\t$.each(files, function (i, file) {\r\n\t\t\tif (!file.read || !fm.file(file.phash).write) {\r\n\t\t\t\treturn !dfrd.reject(['errCopy', file.name, 'errPerm']);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif (dfrd.state() == 'rejected') {\r\n\t\t\treturn dfrd;\r\n\t\t}\r\n\r\n\t\treturn fm.request({\r\n\t\t\tdata: {cmd: 'duplicate', targets: this.hashes(hashes)},\r\n\t\t\tnotify: {type: 'copy', cnt: cnt}\r\n\t\t});\r\n\t}\r\n}","/**\r\n * @class elFinder command \"edit\".\r\n * Edit text file in dialog window\r\n *\r\n * @author Dmitry (dio) Levashov, dio@std42.ru\r\n **/\r\nelFinder.prototype.commands.edit = function () {\r\n\tvar self = this,\r\n\t\tfm = this.fm,\r\n\t\tmimes = fm.res('mimes', 'text') || [],\r\n\r\n\t\t/**\r\n\t\t * Return files acceptable to edit\r\n\t\t *\r\n\t\t * @param  Array  files hashes\r\n\t\t * @return Array\r\n\t\t **/\r\n\t\tfilter = function (files) {\r\n\t\t\treturn $.map(files, function (file) {\r\n\t\t\t\treturn (file.mime.indexOf('text/') === 0 || $.inArray(file.mime, mimes) !== -1)\r\n\t\t\t\t&& file.mime.indexOf('text/rtf')\r\n\t\t\t\t&& (!self.onlyMimes.length || $.inArray(file.mime, self.onlyMimes) !== -1)\r\n\t\t\t\t&& file.read && file.write ? file : null;\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Open dialog with textarea to edit file\r\n\t\t *\r\n\t\t * @param  String  id       dialog id\r\n\t\t * @param  Object  file     file object\r\n\t\t * @param  String  content  file content\r\n\t\t * @return $.Deferred\r\n\t\t **/\r\n\t\tdialog = function (id, file, content) {\r\n\t\t\tvar dfrd = $.Deferred(),\r\n\t\t\t\tta = $('<textarea class=\"elfinder-file-edit\" rows=\"20\" id=\"' + id + '-ta\">' + fm.escape(content) + '</textarea>'),\r\n\t\t\t\tsave = function () {\r\n\t\t\t\t\tta.editor && ta.editor.save(ta[0], ta.editor.instance);\r\n\t\t\t\t\tdfrd.resolve(ta.getContent());\r\n\t\t\t\t\t$('body').trigger('show_message', [__('Saved')])\r\n\t\t\t\t},\r\n\t\t\t\tcancel = function () {\r\n\t\t\t\t\tdfrd.reject();\r\n\t\t\t\t\tta.elfinderdialog('close');\r\n\t\t\t\t},\r\n\t\t\t\topts = {\r\n\t\t\t\t\ttitle: file.name,\r\n\t\t\t\t\twidth: self.options.dialogWidth || '90%',\r\n\t\t\t\t\tbuttons: {},\r\n\t\t\t\t\tclose: function () {\r\n\t\t\t\t\t\tta.editor && ta.editor.close(ta[0], ta.editor.instance);\r\n\t\t\t\t\t\t$(this).elfinderdialog('destroy');\r\n\t\t\t\t\t\tCMS.filters.switchOff(id+'-ta');\r\n\t\t\t\t\t},\r\n\t\t\t\t\topen: function () {\r\n\t\t\t\t\t\tfm.disable();\r\n\t\t\t\t\t\tta.focus();\r\n\t\t\t\t\t\tta[0].setSelectionRange && ta[0].setSelectionRange(0, 0);\r\n\t\t\t\t\t\tta.editor && ta.editor.load(ta[0]);\r\n\r\n\t\t\t\t\t\tCMS.filters.switchOn(id+'-ta', 'ace', {mime: file.mime});\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\tta.getContent = function () {\r\n\t\t\t\treturn ta.val()\r\n\t\t\t}\r\n\r\n\t\t\t$.each(self.options.editors || [], function (i, editor) {\r\n\t\t\t\tif ($.inArray(file.mime, editor.mimes || []) !== -1\r\n\t\t\t\t\t&& typeof editor.load == 'function'\r\n\t\t\t\t\t&& typeof editor.save == 'function') {\r\n\t\t\t\t\tta.editor = {\r\n\t\t\t\t\t\tload: editor.load,\r\n\t\t\t\t\t\tsave: editor.save,\r\n\t\t\t\t\t\tclose: typeof editor.close == 'function' ? editor.close : function () {\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tinstance: null\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tif (!ta.editor) {\r\n\t\t\t\tta.keydown(function (e) {\r\n\t\t\t\t\tvar code = e.keyCode,\r\n\t\t\t\t\t\tvalue, start;\r\n\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\tif (code == 9) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t// insert tab on tab press\r\n\t\t\t\t\t\tif (this.setSelectionRange) {\r\n\t\t\t\t\t\t\tvalue = this.value;\r\n\t\t\t\t\t\t\tstart = this.selectionStart;\r\n\t\t\t\t\t\t\tthis.value = value.substr(0, start) + \"\\t\" + value.substr(this.selectionEnd);\r\n\t\t\t\t\t\t\tstart += 1;\r\n\t\t\t\t\t\t\tthis.setSelectionRange(start, start);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (e.ctrlKey || e.metaKey) {\r\n\t\t\t\t\t\t// close on ctrl+w/q\r\n\t\t\t\t\t\tif (code == 81 || code == 87) {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\tcancel();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (code == 83) {\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\tsave();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\r\n\t\t\topts.buttons[fm.i18n('Save')] = save;\r\n\t\t\topts.buttons[fm.i18n('Close')] = cancel;\r\n\r\n\t\t\tfm.dialog(ta, opts).attr('id', id).addClass('elfinder-dialog-editor').parent().on('resize', function(e, ui) {\r\n\t\t\t\tCMS.filters.exec(id+'-ta', 'changeHeight', $(this).find('.panel-body').height());\r\n\t\t\t});\r\n\r\n\t\t\treturn dfrd.promise();\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Get file content and\r\n\t\t * open dialog with textarea to edit file content\r\n\t\t *\r\n\t\t * @param  String  file hash\r\n\t\t * @return jQuery.Deferred\r\n\t\t **/\r\n\t\tedit = function (file) {\r\n\t\t\tvar hash = file.hash,\r\n\t\t\t\topts = fm.options,\r\n\t\t\t\tdfrd = $.Deferred(),\r\n\t\t\t\tdata = {cmd: 'file', target: hash},\r\n\t\t\t\turl = fm.url(hash) || fm.options.url,\r\n\t\t\t\tid = 'edit-' + fm.namespace + '-' + file.hash,\r\n\t\t\t\td = fm.getUI().find('#' + id),\r\n\t\t\t\terror;\r\n\r\n\r\n\t\t\tif (d.length) {\r\n\t\t\t\td.elfinderdialog('toTop');\r\n\t\t\t\treturn dfrd.resolve();\r\n\t\t\t}\r\n\r\n\t\t\tif (!file.read || !file.write) {\r\n\t\t\t\terror = ['errOpen', file.name, 'errPerm']\r\n\t\t\t\tfm.error(error)\r\n\t\t\t\treturn dfrd.reject(error);\r\n\t\t\t}\r\n\r\n\t\t\tfm.request({\r\n\t\t\t\tdata: {cmd: 'get', target: hash},\r\n\t\t\t\tnotify: {type: 'openfile', cnt: 1},\r\n\t\t\t\tsyncOnFail: true\r\n\t\t\t})\r\n\t\t\t\t.done(function (data) {\r\n\t\t\t\t\tdialog(id, file, data.content)\r\n\t\t\t\t\t\t.done(function (content) {\r\n\t\t\t\t\t\t\tfm.request({\r\n\t\t\t\t\t\t\t\toptions: {type: 'post'},\r\n\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\tcmd: 'put',\r\n\t\t\t\t\t\t\t\t\ttarget: hash,\r\n\t\t\t\t\t\t\t\t\tcontent: content\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tnotify: {type: 'save', cnt: 1},\r\n\t\t\t\t\t\t\t\tsyncOnFail: true\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.fail(function (error) {\r\n\t\t\t\t\t\t\t\t\tdfrd.reject(error);\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.done(function (data) {\r\n\t\t\t\t\t\t\t\t\tdata.changed && data.changed.length && fm.change(data);\r\n\t\t\t\t\t\t\t\t\tdfrd.resolve(data);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t\t.fail(function (error) {\r\n\t\t\t\t\tdfrd.reject(error);\r\n\t\t\t\t})\r\n\r\n\t\t\treturn dfrd.promise();\r\n\t\t};\r\n\r\n\r\n\tthis.shortcuts = [{\r\n\t\tpattern: 'ctrl+e'\r\n\t}];\r\n\r\n\tthis.init = function () {\r\n\t\tthis.onlyMimes = this.options.mimes || []\r\n\t}\r\n\r\n\tthis.getstate = function (sel) {\r\n\t\tvar sel = this.files(sel),\r\n\t\t\tcnt = sel.length;\r\n\r\n\t\treturn !this._disabled && cnt && filter(sel).length == cnt ? 0 : -1;\r\n\t}\r\n\r\n\tthis.exec = function (hashes) {\r\n\t\tvar files = filter(this.files(hashes)),\r\n\t\t\tlist = [],\r\n\t\t\tfile;\r\n\r\n\t\tif (this.disabled()) {\r\n\t\t\treturn $.Deferred().reject();\r\n\t\t}\r\n\r\n\t\twhile ((file = files.shift())) {\r\n\t\t\tlist.push(edit(file));\r\n\t\t}\r\n\r\n\t\treturn list.length\r\n\t\t\t? $.when.apply(null, list)\r\n\t\t\t: $.Deferred().reject();\r\n\t}\r\n}","/**\r\n * @class  elFinder command \"extract\"\r\n * Extract files from archive\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\nelFinder.prototype.commands.extract = function () {\r\n\tvar self = this,\r\n\t\tfm = self.fm,\r\n\t\tmimes = [],\r\n\t\tfilter = function (files) {\r\n\t\t\treturn $.map(files, function (file) {\r\n\t\t\t\treturn file.read && $.inArray(file.mime, mimes) !== -1 ? file : null\r\n\r\n\t\t\t})\r\n\t\t};\r\n\r\n\tthis.disableOnSearch = true;\r\n\r\n\t// Update mimes list on open/reload\r\n\tfm.bind('open reload', function () {\r\n\t\tmimes = fm.option('archivers')['extract'] || [];\r\n\t\tself.change();\r\n\t});\r\n\r\n\tthis.getstate = function (sel) {\r\n\t\tvar sel = this.files(sel),\r\n\t\t\tcnt = sel.length;\r\n\r\n\t\treturn !this._disabled && cnt && this.fm.cwd().write && filter(sel).length == cnt ? 0 : -1;\r\n\t}\r\n\r\n\tthis.exec = function (hashes) {\r\n\t\tvar files = this.files(hashes),\r\n\t\t\tdfrd = $.Deferred(),\r\n\t\t\tcnt = files.length,\r\n\t\t\ti, error,\r\n\t\t\tdecision;\r\n\r\n\t\tvar overwriteAll = false;\r\n\t\tvar omitAll = false;\r\n\r\n\t\tvar names = $.map(fm.files(hashes), function (file) {\r\n\t\t\treturn file.name;\r\n\t\t});\r\n\t\tvar map = {};\r\n\t\t$.map(fm.files(hashes), function (file) {\r\n\t\t\tmap[file.name] = file;\r\n\t\t});\r\n\r\n\t\tvar decide = function (decision) {\r\n\t\t\tswitch (decision) {\r\n\t\t\t\tcase 'overwrite_all' :\r\n\t\t\t\t\toverwriteAll = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'omit_all':\r\n\t\t\t\t\tomitAll = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvar unpack = function (file) {\r\n\t\t\tif (!(file.read && fm.file(file.phash).write)) {\r\n\t\t\t\terror = ['errExtract', file.name, 'errPerm'];\r\n\t\t\t\tfm.error(error);\r\n\t\t\t\tdfrd.reject(error);\r\n\t\t\t} else if ($.inArray(file.mime, mimes) === -1) {\r\n\t\t\t\terror = ['errExtract', file.name, 'errNoArchive'];\r\n\t\t\t\tfm.error(error);\r\n\t\t\t\tdfrd.reject(error);\r\n\t\t\t} else {\r\n\t\t\t\tfm.request({\r\n\t\t\t\t\tdata: {cmd: 'extract', target: file.hash},\r\n\t\t\t\t\tnotify: {type: 'extract', cnt: 1},\r\n\t\t\t\t\tsyncOnFail: true\r\n\t\t\t\t})\r\n\t\t\t\t\t.fail(function (error) {\r\n\t\t\t\t\t\tif (dfrd.state() != 'rejected') {\r\n\t\t\t\t\t\t\tdfrd.reject(error);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.done(function () {\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tvar confirm = function (files, index) {\r\n\t\t\tvar file = files[index];\r\n\t\t\tvar name = file.name.replace(/\\.((tar\\.(gz|bz|bz2|z|lzo))|cpio\\.gz|ps\\.gz|xcf\\.(gz|bz2)|[a-z0-9]{1,4})$/ig, '');\r\n\t\t\tvar existed = ($.inArray(name, names) >= 0);\r\n\t\t\tif (existed && map[name].mime != 'directory') {\r\n\t\t\t\tfm.confirm(\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttitle: fm.i18n('ntfextract'),\r\n\t\t\t\t\t\ttext: fm.i18n(['errExists', name, 'confirmRepl']),\r\n\t\t\t\t\t\taccept: {\r\n\t\t\t\t\t\t\tlabel: 'btnYes',\r\n\t\t\t\t\t\t\tcallback: function (all) {\r\n\t\t\t\t\t\t\t\tdecision = all ? 'overwrite_all' : 'overwrite';\r\n\t\t\t\t\t\t\t\tdecide(decision);\r\n\t\t\t\t\t\t\t\tif (!overwriteAll && !omitAll) {\r\n\t\t\t\t\t\t\t\t\tif ('overwrite' == decision) {\r\n\t\t\t\t\t\t\t\t\t\tunpack(file);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tif ((index + 1) < cnt) {\r\n\t\t\t\t\t\t\t\t\t\tconfirm(files, index + 1);\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tdfrd.resolve();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else if (overwriteAll) {\r\n\t\t\t\t\t\t\t\t\tfor (i = 0; i < cnt; i++) {\r\n\t\t\t\t\t\t\t\t\t\tunpack(files[i]);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tdfrd.resolve();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\treject: {\r\n\t\t\t\t\t\t\tlabel: 'btnNo',\r\n\t\t\t\t\t\t\tcallback: function (all) {\r\n\t\t\t\t\t\t\t\tdecision = all ? 'omit_all' : 'omit';\r\n\t\t\t\t\t\t\t\tdecide(decision);\r\n\t\t\t\t\t\t\t\tif (!overwriteAll && !omitAll && (index + 1) < cnt) {\r\n\t\t\t\t\t\t\t\t\tconfirm(files, index + 1);\r\n\t\t\t\t\t\t\t\t} else if (omitAll) {\r\n\t\t\t\t\t\t\t\t\tdfrd.resolve();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tcancel: {\r\n\t\t\t\t\t\t\tlabel: 'btnCancel',\r\n\t\t\t\t\t\t\tcallback: function () {\r\n\t\t\t\t\t\t\t\tdfrd.resolve();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tall: (cnt > 1)\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tunpack(file);\r\n\t\t\t\tif ((index + 1) < cnt) {\r\n\t\t\t\t\tconfirm(files, index + 1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdfrd.resolve();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tif (!(this.enabled() && cnt && mimes.length)) {\r\n\t\t\treturn dfrd.reject();\r\n\t\t}\r\n\r\n\t\tif (cnt > 0) {\r\n\t\t\tconfirm(files, 0);\r\n\t\t}\r\n\r\n\t\treturn dfrd;\r\n\t}\r\n\r\n}","/**\r\n * @class  elFinder command \"forward\"\r\n * Open next visited folder\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\nelFinder.prototype.commands.forward = function () {\r\n\tthis.alwaysEnabled = true;\r\n\tthis.updateOnSelect = true;\r\n\tthis.shortcuts = [{\r\n\t\tpattern: 'ctrl+right'\r\n\t}];\r\n\r\n\tthis.getstate = function () {\r\n\t\treturn this.fm.history.canForward() ? 0 : -1;\r\n\t}\r\n\r\n\tthis.exec = function () {\r\n\t\treturn this.fm.history.forward();\r\n\t}\r\n}","/**\r\n * @class elFinder command \"getfile\".\r\n * Return selected files info into outer callback.\r\n * For use elFinder with wysiwyg editors etc.\r\n *\r\n * @author Dmitry (dio) Levashov, dio@std42.ru\r\n **/\r\nelFinder.prototype.commands.getfile = function () {\r\n\tvar self = this,\r\n\t\tfm = this.fm,\r\n\t\tfilter = function (files) {\r\n\t\t\tvar o = self.options;\r\n\r\n\t\t\tfiles = $.map(files, function (file) {\r\n\t\t\t\treturn file.mime != 'directory' || o.folders ? file : null;\r\n\t\t\t});\r\n\r\n\t\t\treturn o.multiple || files.length == 1 ? files : [];\r\n\t\t};\r\n\r\n\tthis.alwaysEnabled = true;\r\n\tthis.callback = fm.options.getFileCallback;\r\n\tthis._disabled = typeof(this.callback) == 'function';\r\n\r\n\tthis.getstate = function (sel) {\r\n\t\tvar sel = this.files(sel),\r\n\t\t\tcnt = sel.length;\r\n\r\n\t\treturn this.callback && cnt && filter(sel).length == cnt ? 0 : -1;\r\n\t}\r\n\r\n\tthis.exec = function (hashes) {\r\n\t\tvar fm = this.fm,\r\n\t\t\topts = this.options,\r\n\t\t\tfiles = this.files(hashes),\r\n\t\t\tcnt = files.length,\r\n\t\t\turl = fm.option('url'),\r\n\t\t\ttmb = fm.option('tmbUrl'),\r\n\t\t\tdfrd = $.Deferred()\r\n\t\t\t\t.done(function (data) {\r\n\t\t\t\t\tfm.trigger('getfile', {files: data});\r\n\t\t\t\t\tself.callback(data, fm);\r\n\r\n\t\t\t\t\tif (opts.oncomplete == 'close') {\r\n\t\t\t\t\t\tfm.hide();\r\n\t\t\t\t\t} else if (opts.oncomplete == 'destroy') {\r\n\t\t\t\t\t\tfm.destroy();\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\tresult = function (file) {\r\n\t\t\t\treturn opts.onlyURL\r\n\t\t\t\t\t? opts.multiple ? $.map(files, function (f) {\r\n\t\t\t\t\treturn f.url;\r\n\t\t\t\t}) : files[0].url\r\n\t\t\t\t\t: opts.multiple ? files : files[0];\r\n\t\t\t},\r\n\t\t\treq = [],\r\n\t\t\ti, file, dim;\r\n\r\n\t\tif (this.getstate() == -1) {\r\n\t\t\treturn dfrd.reject();\r\n\t\t}\r\n\r\n\t\tfor (i = 0; i < cnt; i++) {\r\n\t\t\tfile = files[i];\r\n\t\t\tif (file.mime == 'directory' && !opts.folders) {\r\n\t\t\t\treturn dfrd.reject();\r\n\t\t\t}\r\n\t\t\tfile.baseUrl = url;\r\n\t\t\tfile.url = fm.url(file.hash);\r\n\t\t\tfile.path = fm.path(file.hash);\r\n\t\t\tif (file.tmb && file.tmb != 1) {\r\n\t\t\t\tfile.tmb = tmb + file.tmb;\r\n\t\t\t}\r\n\t\t\tif (!file.width && !file.height) {\r\n\t\t\t\tif (file.dim) {\r\n\t\t\t\t\tdim = file.dim.split('x');\r\n\t\t\t\t\tfile.width = dim[0];\r\n\t\t\t\t\tfile.height = dim[1];\r\n\t\t\t\t} else if (file.mime.indexOf('image') !== -1) {\r\n\t\t\t\t\treq.push(fm.request({\r\n\t\t\t\t\t\tdata: {cmd: 'dim', target: file.hash},\r\n\t\t\t\t\t\tnotify: {type: 'dim', cnt: 1, hideCnt: true},\r\n\t\t\t\t\t\tpreventDefault: true\r\n\t\t\t\t\t})\r\n\t\t\t\t\t\t.done(function (data) {\r\n\t\t\t\t\t\t\tif (data.dim) {\r\n\t\t\t\t\t\t\t\tvar dim = data.dim.split('x');\r\n\t\t\t\t\t\t\t\tvar rfile = fm.file(this.hash);\r\n\t\t\t\t\t\t\t\trfile.width = this.width = dim[0];\r\n\t\t\t\t\t\t\t\trfile.height = this.height = dim[1];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}.bind(file)));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (req.length) {\r\n\t\t\t$.when.apply(null, req).always(function () {\r\n\t\t\t\tdfrd.resolve(result(files));\r\n\t\t\t})\r\n\t\t\treturn dfrd;\r\n\t\t}\r\n\r\n\t\treturn dfrd.resolve(result(files));\r\n\t}\r\n\r\n}","/**\r\n * @class  elFinder command \"help\"\r\n * \"About\" dialog\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\nelFinder.prototype.commands.help = function () {\r\n\tvar fm = this.fm,\r\n\t\tself = this,\r\n\t\tlinktpl = '<div class=\"elfinder-help-link\"> <a href=\"{url}\">{link}</a></div>',\r\n\t\tlinktpltgt = '<div class=\"elfinder-help-link\"> <a href=\"{url}\" target=\"_blank\">{link}</a></div>',\r\n\t\tatpl = '<div class=\"elfinder-help-team\"><div>{author}</div>{work}</div>',\r\n\t\turl = /\\{url\\}/,\r\n\t\tlink = /\\{link\\}/,\r\n\t\tauthor = /\\{author\\}/,\r\n\t\twork = /\\{work\\}/,\r\n\t\tr = 'replace',\r\n\t\tprim = 'ui-priority-primary',\r\n\t\tsec = 'ui-priority-secondary',\r\n\t\tlic = 'elfinder-help-license',\r\n\t\ttab = '<li class=\"ui-state-default\"><a href=\"#{id}\">{title}</a></li>',\r\n\t\thtml = ['<div class=\"ui-tabs ui-widget ui-panel-body  elfinder-help\">',\r\n\t\t\t'<ul class=\"ui-tabs-nav ui-helper-reset ui-helper-clearfix  \">'],\r\n\t\tstpl = '<div class=\"elfinder-help-shortcut\"><div class=\"elfinder-help-shortcut-pattern\">{pattern}</div> {descrip}</div>',\r\n\t\tsep = '<div class=\"elfinder-help-separator\"/>',\r\n\r\n\r\n\t\tabout = function () {\r\n\t\t\thtml.push('<div id=\"about\" class=\"ui-tabs-panel ui-panel-body\"><div class=\"elfinder-help-logo\"/>')\r\n\t\t\thtml.push('<h3>elFinder</h3>');\r\n\t\t\thtml.push('<div class=\"' + prim + '\">' + fm.i18n('webfm') + '</div>');\r\n\t\t\thtml.push('<div class=\"' + sec + '\">' + fm.i18n('ver') + ': ' + fm.version + ', ' + fm.i18n('protocolver') + ': <span id=\"apiver\"></span></div>');\r\n\t\t\thtml.push('<div class=\"' + sec + '\">jQuery/jQuery UI: ' + $().jquery + '/' + $.ui.version + '</div>');\r\n\r\n\t\t\thtml.push(sep);\r\n\r\n\t\t\thtml.push(linktpltgt[r](url, 'http://elfinder.org/')[r](link, fm.i18n('homepage')));\r\n\t\t\thtml.push(linktpltgt[r](url, 'https://github.com/Studio-42/elFinder/wiki')[r](link, fm.i18n('docs')));\r\n\t\t\thtml.push(linktpltgt[r](url, 'https://github.com/Studio-42/elFinder')[r](link, fm.i18n('github')));\r\n\t\t\thtml.push(linktpltgt[r](url, 'http://twitter.com/elrte_elfinder')[r](link, fm.i18n('twitter')));\r\n\r\n\t\t\thtml.push(sep);\r\n\r\n\t\t\thtml.push('<div class=\"' + prim + '\">' + fm.i18n('team') + '</div>');\r\n\r\n\t\t\thtml.push(atpl[r](author, 'Dmitry \"dio\" Levashov &lt;dio@std42.ru&gt;')[r](work, fm.i18n('chiefdev')));\r\n\t\t\thtml.push(atpl[r](author, 'Troex Nevelin &lt;troex@fury.scancode.ru&gt;')[r](work, fm.i18n('maintainer')));\r\n\t\t\thtml.push(atpl[r](author, 'Alexey Sukhotin &lt;strogg@yandex.ru&gt;')[r](work, fm.i18n('contributor')));\r\n\t\t\thtml.push(atpl[r](author, 'Naoki Sawada &lt;hypweb@gmail.com&gt;')[r](work, fm.i18n('contributor')));\r\n\r\n\t\t\tfm.i18[fm.lang].translator && html.push(atpl[r](author, fm.i18[fm.lang].translator)[r](work, fm.i18n('translator') + ' (' + fm.i18[fm.lang].language + ')'));\r\n\r\n\t\t\thtml.push(sep);\r\n\t\t\thtml.push('<div class=\"' + lic + '\">' + fm.i18n('icons') + ': Pixelmixer, <a href=\"http://p.yusukekamiyamane.com\" target=\"_blank\">Fugue</a></div>');\r\n\r\n\t\t\thtml.push(sep);\r\n\t\t\thtml.push('<div class=\"' + lic + '\">Licence: BSD Licence</div>');\r\n\t\t\thtml.push('<div class=\"' + lic + '\">Copyright  2009-2011, Studio 42</div>');\r\n\t\t\thtml.push('<div class=\"' + lic + '\"> ' + fm.i18n('dontforget') + ' </div>');\r\n\t\t\thtml.push('</div>');\r\n\t\t},\r\n\t\tshortcuts = function () {\r\n\t\t\tvar sh = fm.shortcuts();\r\n\t\t\t// shortcuts tab\r\n\t\t\thtml.push('<div id=\"shortcuts\" class=\"ui-tabs-panel ui-panel-body\">');\r\n\r\n\t\t\tif (sh.length) {\r\n\t\t\t\thtml.push('<div class=\"ui-panel-body elfinder-help-shortcuts\">');\r\n\t\t\t\t$.each(sh, function (i, s) {\r\n\t\t\t\t\thtml.push(stpl.replace(/\\{pattern\\}/, s[0]).replace(/\\{descrip\\}/, s[1]));\r\n\t\t\t\t});\r\n\r\n\t\t\t\thtml.push('</div>');\r\n\t\t\t} else {\r\n\t\t\t\thtml.push('<div class=\"elfinder-help-disabled\">' + fm.i18n('shortcutsof') + '</div>')\r\n\t\t\t}\r\n\r\n\r\n\t\t\thtml.push('</div>')\r\n\r\n\t\t},\r\n\t\thelp = function () {\r\n\t\t\t// help tab\r\n\t\t\thtml.push('<div id=\"help\" class=\"ui-tabs-panel ui-panel-body\">');\r\n\t\t\thtml.push('<a href=\"http://elfinder.org/forum/\" target=\"_blank\" class=\"elfinder-dont-panic\"><span>DON\\'T PANIC</span></a>');\r\n\t\t\thtml.push('</div>');\r\n\t\t\t// end help\r\n\t\t},\r\n\t\tcontent;\r\n\r\n\tthis.alwaysEnabled = true;\r\n\tthis.updateOnSelect = false;\r\n\tthis.state = 0;\r\n\r\n\tthis.shortcuts = [{\r\n\t\tpattern: 'f1',\r\n\t\tdescription: this.title\r\n\t}];\r\n\r\n\tsetTimeout(function () {\r\n\t\tvar parts = self.options.view || ['about', 'shortcuts', 'help'];\r\n\r\n\t\t$.each(parts, function (i, title) {\r\n\t\t\thtml.push(tab[r](/\\{id\\}/, title)[r](/\\{title\\}/, fm.i18n(title)));\r\n\t\t});\r\n\r\n\t\thtml.push('</ul>');\r\n\r\n\t\t$.inArray('about', parts) !== -1 && about();\r\n\t\t$.inArray('shortcuts', parts) !== -1 && shortcuts();\r\n\t\t$.inArray('help', parts) !== -1 && help();\r\n\r\n\t\thtml.push('</div>');\r\n\t\tcontent = $(html.join(''));\r\n\r\n\t\tfm.one('load', function setapi() {\r\n\t\t\tcontent.find('#apiver').text(fm.api);\r\n\t\t});\r\n\r\n\t\tcontent.find('.ui-tabs-nav li')\r\n\t\t\t.hover(function () {\r\n\t\t\t\t$(this).toggleClass('ui-state-hover')\r\n\t\t\t})\r\n\t\t\t.children()\r\n\t\t\t.click(function (e) {\r\n\t\t\t\tvar link = $(this);\r\n\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\te.stopPropagation();\r\n\r\n\t\t\t\tif (!link.is('.ui-tabs-selected')) {\r\n\t\t\t\t\tlink.parent().addClass('ui-tabs-selected ui-state-active').siblings().removeClass('ui-tabs-selected').removeClass('ui-state-active');\r\n\t\t\t\t\tcontent.find('.ui-tabs-panel').hide().filter(link.attr('href')).show();\r\n\t\t\t\t}\r\n\r\n\t\t\t})\r\n\t\t\t.filter(':first').click();\r\n\r\n\t}, 200)\r\n\r\n\tthis.getstate = function () {\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tthis.exec = function () {\r\n\t\tif (!this.dialog) {\r\n\t\t\tthis.dialog = this.fm.dialog(content, {\r\n\t\t\t\ttitle: this.title,\r\n\t\t\t\twidth: 530,\r\n\t\t\t\tautoOpen: false,\r\n\t\t\t\tdestroyOnClose: false\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis.dialog.elfinderdialog('open').find('.ui-tabs-nav li a:first').click();\r\n\t}\r\n}","elFinder.prototype.commands.home = function () {\r\n\tthis.title = 'Home';\r\n\tthis.alwaysEnabled = true;\r\n\tthis.updateOnSelect = false;\r\n\tthis.shortcuts = [{\r\n\t\tpattern: 'ctrl+home ctrl+shift+up',\r\n\t\tdescription: 'Home'\r\n\t}];\r\n\r\n\tthis.getstate = function () {\r\n\t\tvar root = this.fm.root(),\r\n\t\t\tcwd = this.fm.cwd().hash;\r\n\r\n\t\treturn root && cwd && root != cwd ? 0 : -1;\r\n\t}\r\n\r\n\tthis.exec = function () {\r\n\t\treturn this.fm.exec('open', this.fm.root());\r\n\t}\r\n}","/**\r\n * @class elFinder command \"info\".\r\n * Display dialog with file properties.\r\n *\r\n * @author Dmitry (dio) Levashov, dio@std42.ru\r\n **/\r\nelFinder.prototype.commands.info = function () {\r\n\tvar m = 'msg',\r\n\t\tfm = this.fm,\r\n\t\tspclass = 'elfinder-info-spinner',\r\n\t\tmsg = {\r\n\t\t\tcalc: fm.i18n('calc'),\r\n\t\t\tsize: fm.i18n('size'),\r\n\t\t\tunknown: fm.i18n('unknown'),\r\n\t\t\tpath: fm.i18n('path'),\r\n\t\t\taliasfor: fm.i18n('aliasfor'),\r\n\t\t\tmodify: fm.i18n('modify'),\r\n\t\t\tperms: fm.i18n('perms'),\r\n\t\t\tlocked: fm.i18n('locked'),\r\n\t\t\tdim: fm.i18n('dim'),\r\n\t\t\tkind: fm.i18n('kind'),\r\n\t\t\tfiles: fm.i18n('files'),\r\n\t\t\tfolders: fm.i18n('folders'),\r\n\t\t\titems: fm.i18n('items'),\r\n\t\t\tyes: fm.i18n('yes'),\r\n\t\t\tno: fm.i18n('no'),\r\n\t\t\tlink: fm.i18n('link')\r\n\t\t};\r\n\r\n\tthis.tpl = {\r\n\t\tmain: '<div class=\"ui-helper-clearfix elfinder-info-title\"><span class=\"elfinder-cwd-icon {class} \"/>{title}</div><table class=\"elfinder-info-tb\">{content}</table>',\r\n\t\titemTitle: '<strong>{name}</strong><span class=\"elfinder-info-kind\">{kind}</span>',\r\n\t\tgroupTitle: '<strong>{items}: {num}</strong>',\r\n\t\trow: '<tr><td>{label} : </td><td>{value}</td></tr>',\r\n\t\tspinner: '<span>{text}</span> <span class=\"' + spclass + '\"/>'\r\n\t}\r\n\r\n\tthis.alwaysEnabled = true;\r\n\tthis.updateOnSelect = false;\r\n\tthis.shortcuts = [{\r\n\t\tpattern: 'ctrl+i'\r\n\t}];\r\n\r\n\tthis.init = function () {\r\n\t\t$.each(msg, function (k, v) {\r\n\t\t\tmsg[k] = fm.i18n(v);\r\n\t\t});\r\n\t}\r\n\r\n\tthis.getstate = function () {\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tthis.exec = function (hashes) {\r\n\t\tvar files = this.files(hashes);\r\n\t\tif (!files.length) {\r\n\t\t\tfiles = this.files([this.fm.cwd().hash]);\r\n\t\t}\r\n\t\tvar self = this,\r\n\t\t\tfm = this.fm,\r\n\t\t\to = this.options,\r\n\t\t\ttpl = this.tpl,\r\n\t\t\trow = tpl.row,\r\n\t\t\tcnt = files.length,\r\n\t\t\tcontent = [],\r\n\t\t\tview = tpl.main,\r\n\t\t\tl = '{label}',\r\n\t\t\tv = '{value}',\r\n\t\t\topts = {\r\n\t\t\t\ttitle: this.title,\r\n\t\t\t\twidth: 'auto',\r\n\t\t\t\tclose: function () {\r\n\t\t\t\t\t$(this).elfinderdialog('destroy');\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tcount = [],\r\n\t\t\treplSpinner = function (msg) {\r\n\t\t\t\tdialog.find('.' + spclass).parent().text(msg);\r\n\t\t\t},\r\n\t\t\tid = fm.namespace + '-info-' + $.map(files, function (f) {\r\n\t\t\t\t\treturn f.hash\r\n\t\t\t\t}).join('-'),\r\n\t\t\tdialog = fm.getUI().find('#' + id),\r\n\t\t\tsize, tmb, file, title, dcnt;\r\n\r\n\t\tif (!cnt) {\r\n\t\t\treturn $.Deferred().reject();\r\n\t\t}\r\n\r\n\t\tif (dialog.length) {\r\n\t\t\tdialog.elfinderdialog('toTop');\r\n\t\t\treturn $.Deferred().resolve();\r\n\t\t}\r\n\r\n\r\n\t\tif (cnt == 1) {\r\n\t\t\tfile = files[0];\r\n\r\n\t\t\tview = view.replace('{class}', fm.mime2class(file.mime));\r\n\t\t\ttitle = tpl.itemTitle.replace('{name}', fm.escape(file.i18 || file.name)).replace('{kind}', fm.mime2kind(file));\r\n\r\n\t\t\tif (file.tmb) {\r\n\t\t\t\ttmb = fm.option('tmbUrl') + file.tmb;\r\n\t\t\t}\r\n\r\n\t\t\tif (!file.read) {\r\n\t\t\t\tsize = msg.unknown;\r\n\t\t\t} else if (file.mime != 'directory' || file.alias) {\r\n\t\t\t\tsize = fm.formatSize(file.size);\r\n\t\t\t} else {\r\n\t\t\t\tsize = tpl.spinner.replace('{text}', msg.calc);\r\n\t\t\t\tcount.push(file.hash);\r\n\t\t\t}\r\n\r\n\t\t\tcontent.push(row.replace(l, msg.size).replace(v, size));\r\n\t\t\tfile.alias && content.push(row.replace(l, msg.aliasfor).replace(v, file.alias));\r\n\t\t\tcontent.push(row.replace(l, msg.path).replace(v, fm.escape(fm.path(file.hash, true))));\r\n\t\t\tif (file.read) {\r\n\t\t\t\tvar href;\r\n\t\t\t\tif (o.nullUrlDirLinkSelf && file.mime == 'directory' && file.url === null) {\r\n\t\t\t\t\tvar loc = window.location;\r\n\t\t\t\t\thref = loc.pathname + loc.search + '#elf_' + file.hash;\r\n\t\t\t\t} else {\r\n\t\t\t\t\thref = fm.url(file.hash);\r\n\t\t\t\t}\r\n\t\t\t\tcontent.push(row.replace(l, msg.link).replace(v, '<a href=\"' + href + '\" target=\"_blank\">' + file.name + '</a>'));\r\n\t\t\t}\r\n\r\n\t\t\tif (file.dim) { // old api\r\n\t\t\t\tcontent.push(row.replace(l, msg.dim).replace(v, file.dim));\r\n\t\t\t} else if (file.mime.indexOf('image') !== -1) {\r\n\t\t\t\tif (file.width && file.height) {\r\n\t\t\t\t\tcontent.push(row.replace(l, msg.dim).replace(v, file.width + 'x' + file.height));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcontent.push(row.replace(l, msg.dim).replace(v, tpl.spinner.replace('{text}', msg.calc)));\r\n\t\t\t\t\tfm.request({\r\n\t\t\t\t\t\tdata: {cmd: 'dim', target: file.hash},\r\n\t\t\t\t\t\tpreventDefault: true\r\n\t\t\t\t\t})\r\n\t\t\t\t\t\t.fail(function () {\r\n\t\t\t\t\t\t\treplSpinner(msg.unknown);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.done(function (data) {\r\n\t\t\t\t\t\t\treplSpinner(data.dim || msg.unknown);\r\n\t\t\t\t\t\t\tif (data.dim) {\r\n\t\t\t\t\t\t\t\tvar dim = data.dim.split('x');\r\n\t\t\t\t\t\t\t\tvar rfile = fm.file(file.hash);\r\n\t\t\t\t\t\t\t\trfile.width = dim[0];\r\n\t\t\t\t\t\t\t\trfile.height = dim[1];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\r\n\t\t\tcontent.push(row.replace(l, msg.modify).replace(v, fm.formatDate(file)));\r\n\t\t\tcontent.push(row.replace(l, msg.perms).replace(v, fm.formatPermissions(file)));\r\n\t\t\tcontent.push(row.replace(l, msg.locked).replace(v, file.locked ? msg.yes : msg.no));\r\n\t\t} else {\r\n\t\t\tview = view.replace('{class}', 'elfinder-cwd-icon-group');\r\n\t\t\ttitle = tpl.groupTitle.replace('{items}', msg.items).replace('{num}', cnt);\r\n\t\t\tdcnt = $.map(files, function (f) {\r\n\t\t\t\treturn f.mime == 'directory' ? 1 : null\r\n\t\t\t}).length;\r\n\t\t\tif (!dcnt) {\r\n\t\t\t\tsize = 0;\r\n\t\t\t\t$.each(files, function (h, f) {\r\n\t\t\t\t\tvar s = parseInt(f.size);\r\n\r\n\t\t\t\t\tif (s >= 0 && size >= 0) {\r\n\t\t\t\t\t\tsize += s;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsize = 'unknown';\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tcontent.push(row.replace(l, msg.kind).replace(v, msg.files));\r\n\t\t\t\tcontent.push(row.replace(l, msg.size).replace(v, fm.formatSize(size)));\r\n\t\t\t} else {\r\n\t\t\t\tcontent.push(row.replace(l, msg.kind).replace(v, dcnt == cnt ? msg.folders : msg.folders + ' ' + dcnt + ', ' + msg.files + ' ' + (cnt - dcnt)))\r\n\t\t\t\tcontent.push(row.replace(l, msg.size).replace(v, tpl.spinner.replace('{text}', msg.calc)));\r\n\t\t\t\tcount = $.map(files, function (f) {\r\n\t\t\t\t\treturn f.hash\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tview = view.replace('{title}', title).replace('{content}', content.join(''));\r\n\r\n\t\tdialog = fm.dialog(view, opts);\r\n\t\tdialog.attr('id', id)\r\n\r\n\t\t// load thumbnail\r\n\t\tif (tmb) {\r\n\t\t\t$('<img/>')\r\n\t\t\t\t.load(function () {\r\n\t\t\t\t\tdialog.find('.elfinder-cwd-icon').css('background', 'url(\"' + tmb + '\") center center no-repeat');\r\n\t\t\t\t})\r\n\t\t\t\t.attr('src', tmb);\r\n\t\t}\r\n\r\n\t\t// send request to count total size\r\n\t\tif (count.length) {\r\n\t\t\tfm.request({\r\n\t\t\t\tdata: {cmd: 'size', targets: count},\r\n\t\t\t\tpreventDefault: true\r\n\t\t\t})\r\n\t\t\t\t.fail(function () {\r\n\t\t\t\t\treplSpinner(msg.unknown);\r\n\t\t\t\t})\r\n\t\t\t\t.done(function (data) {\r\n\t\t\t\t\tvar size = parseInt(data.size);\r\n\t\t\t\t\treplSpinner(size >= 0 ? fm.formatSize(size) : msg.unknown);\r\n\t\t\t\t});\r\n\t\t}\r\n\t}\r\n}","/**\r\n * @class  elFinder command \"mkdir\"\r\n * Create new folder\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\nelFinder.prototype.commands.mkdir = function () {\r\n\tthis.disableOnSearch = true;\r\n\tthis.updateOnSelect = false;\r\n\tthis.mime = 'directory';\r\n\tthis.prefix = 'untitled folder';\r\n\tthis.exec = $.proxy(this.fm.res('mixin', 'make'), this);\r\n\r\n\tthis.shortcuts = [{\r\n\t\tpattern: 'ctrl+shift+n'\r\n\t}];\r\n\r\n\tthis.getstate = function () {\r\n\t\treturn !this._disabled && this.fm.cwd().write ? 0 : -1;\r\n\t}\r\n}","/**\r\n * @class  elFinder command \"mkfile\"\r\n * Create new empty file\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\nelFinder.prototype.commands.mkfile = function () {\r\n\tthis.disableOnSearch = true;\r\n\tthis.updateOnSelect = false;\r\n\tthis.mime = 'text/plain';\r\n\tthis.prefix = 'untitled file.txt';\r\n\tthis.exec = $.proxy(this.fm.res('mixin', 'make'), this);\r\n\r\n\tthis.getstate = function () {\r\n\t\treturn !this._disabled && this.fm.cwd().write ? 0 : -1;\r\n\t}\r\n}","/**\r\n * @class  elFinder command \"netmount\"\r\n * Mount network volume with user credentials.\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\nelFinder.prototype.commands.netmount = function () {\r\n\tvar self = this;\r\n\r\n\tthis.alwaysEnabled = true;\r\n\tthis.updateOnSelect = false;\r\n\r\n\tthis.drivers = [];\r\n\r\n\tthis.handlers = {\r\n\t\tload: function () {\r\n\t\t\tthis.drivers = this.fm.netDrivers;\r\n\t\t}\r\n\t}\r\n\r\n\tthis.getstate = function () {\r\n\t\treturn this.drivers.length ? 0 : -1;\r\n\t}\r\n\r\n\tthis.exec = function () {\r\n\t\tvar fm = self.fm,\r\n\t\t\tdfrd = $.Deferred(),\r\n\t\t\tcreate = function () {\r\n\t\t\t\tvar inputs = {\r\n\t\t\t\t\t\tprotocol: $('<select/>'),\r\n\t\t\t\t\t\thost: $('<input type=\"text\"/>'),\r\n\t\t\t\t\t\tport: $('<input type=\"text\"/>'),\r\n\t\t\t\t\t\tpath: $('<input type=\"text\" value=\"/\"/>'),\r\n\t\t\t\t\t\tuser: $('<input type=\"text\"/>'),\r\n\t\t\t\t\t\tpass: $('<input type=\"password\"/>')\r\n\t\t\t\t\t},\r\n\t\t\t\t\topts = {\r\n\t\t\t\t\t\ttitle: fm.i18n('netMountDialogTitle'),\r\n\t\t\t\t\t\tresizable: false,\r\n\t\t\t\t\t\tmodal: true,\r\n\t\t\t\t\t\tdestroyOnClose: true,\r\n\t\t\t\t\t\tclose: function () {\r\n\t\t\t\t\t\t\tdelete self.dialog;\r\n\t\t\t\t\t\t\tdfrd.state() == 'pending' && dfrd.reject();\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tbuttons: {}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcontent = $('<table class=\"elfinder-info-tb elfinder-netmount-tb\"/>');\r\n\r\n\t\t\t\t$.each(self.drivers, function (i, protocol) {\r\n\t\t\t\t\tinputs.protocol.append('<option value=\"' + protocol + '\">' + fm.i18n(protocol) + '</option>');\r\n\t\t\t\t});\r\n\r\n\r\n\t\t\t\t$.each(inputs, function (name, input) {\r\n\t\t\t\t\tname != 'protocol' && input.addClass('');\r\n\t\t\t\t\tcontent.append($('<tr/>').append($('<td>' + fm.i18n(name) + '</td>')).append($('<td/>').append(input)));\r\n\t\t\t\t});\r\n\r\n\t\t\t\topts.buttons[fm.i18n('btnMount')] = function () {\r\n\t\t\t\t\tvar data = {cmd: 'netmount'};\r\n\r\n\t\t\t\t\t$.each(inputs, function (name, input) {\r\n\t\t\t\t\t\tvar val = $.trim(input.val());\r\n\r\n\t\t\t\t\t\tif (val) {\r\n\t\t\t\t\t\t\tdata[name] = val;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (!data.host) {\r\n\t\t\t\t\t\treturn self.fm.trigger('error', {error: 'errNetMountHostReq'});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tself.fm.request({data: data, notify: {type: 'netmount', cnt: 1}})\r\n\t\t\t\t\t\t.done(function () {\r\n\t\t\t\t\t\t\tdfrd.resolve();\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.fail(function (error) {\r\n\t\t\t\t\t\t\tdfrd.reject(error);\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\tself.dialog.elfinderdialog('close');\r\n\t\t\t\t}\r\n\r\n\t\t\t\topts.buttons[fm.i18n('btnCancel')] = function () {\r\n\t\t\t\t\tself.dialog.elfinderdialog('close');\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn fm.dialog(content, opts);\r\n\t\t\t}\r\n\t\t\t;\r\n\r\n\t\tif (!self.dialog) {\r\n\t\t\tself.dialog = create()\r\n\t\t}\r\n\r\n\t\treturn dfrd.promise();\r\n\t}\r\n\r\n}","/**\r\n * @class  elFinder command \"open\"\r\n * Enter folder or open files in new windows\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\nelFinder.prototype.commands.open = function () {\r\n\tthis.alwaysEnabled = true;\r\n\r\n\tthis._handlers = {\r\n\t\t'select enable disable reload': function (e) {\r\n\t\t\tthis.update(e.type == 'disable' ? -1 : void(0));\r\n\t\t}\r\n\t}\r\n\r\n\tthis.shortcuts = [{\r\n\t\tpattern: 'ctrl+down numpad_enter' + (this.fm.OS != 'mac' && ' enter')\r\n\t}];\r\n\r\n\tthis.getstate = function (sel) {\r\n\t\tvar sel = this.files(sel),\r\n\t\t\tcnt = sel.length;\r\n\r\n\t\treturn cnt == 1\r\n\t\t\t? 0\r\n\t\t\t: cnt ? ($.map(sel, function (file) {\r\n\t\t\treturn file.mime == 'directory' ? null : file\r\n\t\t}).length == cnt ? 0 : -1) : -1\r\n\t}\r\n\r\n\tthis.exec = function (hashes) {\r\n\t\tvar fm = this.fm,\r\n\t\t\tdfrd = $.Deferred().fail(function (error) {\r\n\t\t\t\terror && fm.error(error);\r\n\t\t\t}),\r\n\t\t\tfiles = this.files(hashes),\r\n\t\t\tcnt = files.length,\r\n\t\t\tfile, url, s, w;\r\n\r\n\t\tif (!cnt) {\r\n\t\t\treturn dfrd.reject();\r\n\t\t}\r\n\r\n\t\t// open folder\r\n\t\tif (cnt == 1 && (file = files[0]) && file.mime == 'directory') {\r\n\t\t\treturn file && !file.read\r\n\t\t\t\t? dfrd.reject(['errOpen', file.name, 'errPerm'])\r\n\t\t\t\t: fm.request({\r\n\t\t\t\tdata: {cmd: 'open', target: file.thash || file.hash},\r\n\t\t\t\tnotify: {type: 'open', cnt: 1, hideCnt: true},\r\n\t\t\t\tsyncOnFail: true\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfiles = $.map(files, function (file) {\r\n\t\t\treturn file.mime != 'directory' ? file : null\r\n\t\t});\r\n\r\n\t\t// nothing to open or files and folders selected - do nothing\r\n\t\tif (cnt != files.length) {\r\n\t\t\treturn dfrd.reject();\r\n\t\t}\r\n\r\n\t\t// open files\r\n\t\tcnt = files.length;\r\n\t\twhile (cnt--) {\r\n\t\t\tfile = files[cnt];\r\n\r\n\t\t\tif (!file.read) {\r\n\t\t\t\treturn dfrd.reject(['errOpen', file.name, 'errPerm']);\r\n\t\t\t}\r\n\r\n\t\t\tif (!(url = fm.url(/*file.thash || */file.hash))) {\r\n\t\t\t\turl = fm.options.url;\r\n\t\t\t\turl = url + (url.indexOf('?') === -1 ? '?' : '&')\r\n\t\t\t\t+ (fm.oldAPI ? 'cmd=open&current=' + file.phash : 'cmd=file')\r\n\t\t\t\t+ '&target=' + file.hash;\r\n\t\t\t}\r\n\r\n\t\t\t// set window size for image if set\r\n\t\t\tif (file.dim) {\r\n\t\t\t\ts = file.dim.split('x');\r\n\t\t\t\tw = 'width=' + (parseInt(s[0]) + 20) + ',height=' + (parseInt(s[1]) + 20);\r\n\t\t\t} else {\r\n\t\t\t\tw = 'width=' + parseInt(2 * $(window).width() / 3) + ',height=' + parseInt(2 * $(window).height() / 3);\r\n\t\t\t}\r\n\r\n\t\t\tvar wnd = window.open('', 'new_window', w + ',top=50,left=50,scrollbars=yes,resizable=yes');\r\n\t\t\tif (!wnd) {\r\n\t\t\t\treturn dfrd.reject('errPopup');\r\n\t\t\t}\r\n\r\n\t\t\tvar form = document.createElement(\"form\");\r\n\t\t\tform.action = fm.options.url;\r\n\t\t\tform.method = 'POST';\r\n\t\t\tform.target = 'new_window';\r\n\t\t\tform.style.display = 'none';\r\n\t\t\tvar params = $.extend({}, fm.options.customData, {\r\n\t\t\t\tcmd: 'file',\r\n\t\t\t\ttarget: file.hash\r\n\t\t\t});\r\n\t\t\t$.each(params, function (key, val) {\r\n\t\t\t\tvar input = document.createElement(\"input\");\r\n\t\t\t\tinput.name = key;\r\n\t\t\t\tinput.value = val;\r\n\t\t\t\tform.appendChild(input);\r\n\t\t\t});\r\n\r\n\t\t\tdocument.body.appendChild(form);\r\n\t\t\tform.submit();\r\n\t\t}\r\n\t\treturn dfrd.resolve(hashes);\r\n\t}\r\n\r\n}","/**\r\n * @class  elFinder command \"paste\"\r\n * Paste filesfrom clipboard into directory.\r\n * If files pasted in its parent directory - files duplicates will created\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\nelFinder.prototype.commands.paste = function () {\r\n\r\n\tthis.updateOnSelect = false;\r\n\r\n\tthis.handlers = {\r\n\t\tchangeclipboard: function () {\r\n\t\t\tthis.update();\r\n\t\t}\r\n\t}\r\n\r\n\tthis.shortcuts = [{\r\n\t\tpattern: 'ctrl+v shift+insert'\r\n\t}];\r\n\r\n\tthis.getstate = function (dst) {\r\n\t\tif (this._disabled) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\tif (dst) {\r\n\t\t\tif ($.isArray(dst)) {\r\n\t\t\t\tif (dst.length != 1) {\r\n\t\t\t\t\treturn -1;\r\n\t\t\t\t}\r\n\t\t\t\tdst = this.fm.file(dst[0]);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tdst = this.fm.cwd();\r\n\t\t}\r\n\r\n\t\treturn this.fm.clipboard().length && dst.mime == 'directory' && dst.write ? 0 : -1;\r\n\t}\r\n\r\n\tthis.exec = function (dst) {\r\n\t\tvar self = this,\r\n\t\t\tfm = self.fm,\r\n\t\t\tdst = dst ? this.files(dst)[0] : fm.cwd(),\r\n\t\t\tfiles = fm.clipboard(),\r\n\t\t\tcnt = files.length,\r\n\t\t\tcut = cnt ? files[0].cut : false,\r\n\t\t\terror = cut ? 'errMove' : 'errCopy',\r\n\t\t\tfpaste = [],\r\n\t\t\tfcopy = [],\r\n\t\t\tdfrd = $.Deferred()\r\n\t\t\t\t.fail(function (error) {\r\n\t\t\t\t\terror && fm.error(error);\r\n\t\t\t\t}),\r\n\t\t\tcopy = function (files) {\r\n\t\t\t\treturn files.length && fm._commands.duplicate\r\n\t\t\t\t\t? fm.exec('duplicate', files)\r\n\t\t\t\t\t: $.Deferred().resolve();\r\n\t\t\t},\r\n\t\t\tpaste = function (files) {\r\n\t\t\t\tvar dfrd = $.Deferred(),\r\n\t\t\t\t\texisted = [],\r\n\t\t\t\t\tintersect = function (files, names) {\r\n\t\t\t\t\t\tvar ret = [],\r\n\t\t\t\t\t\t\ti = files.length;\r\n\r\n\t\t\t\t\t\twhile (i--) {\r\n\t\t\t\t\t\t\t$.inArray(files[i].name, names) !== -1 && ret.unshift(i);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn ret;\r\n\t\t\t\t\t},\r\n\t\t\t\t\tconfirm = function (ndx) {\r\n\t\t\t\t\t\tvar i = existed[ndx],\r\n\t\t\t\t\t\t\tfile = files[i],\r\n\t\t\t\t\t\t\tlast = ndx == existed.length - 1;\r\n\r\n\t\t\t\t\t\tif (!file) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tfm.confirm({\r\n\t\t\t\t\t\t\ttitle: fm.i18n(cut ? 'moveFiles' : 'copyFiles'),\r\n\t\t\t\t\t\t\ttext: fm.i18n(['errExists', file.name, 'confirmRepl']),\r\n\t\t\t\t\t\t\tall: !last,\r\n\t\t\t\t\t\t\taccept: {\r\n\t\t\t\t\t\t\t\tlabel: 'btnYes',\r\n\t\t\t\t\t\t\t\tcallback: function (all) {\r\n\t\t\t\t\t\t\t\t\t!last && !all\r\n\t\t\t\t\t\t\t\t\t\t? confirm(++ndx)\r\n\t\t\t\t\t\t\t\t\t\t: paste(files);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\treject: {\r\n\t\t\t\t\t\t\t\tlabel: 'btnNo',\r\n\t\t\t\t\t\t\t\tcallback: function (all) {\r\n\t\t\t\t\t\t\t\t\tvar i;\r\n\r\n\t\t\t\t\t\t\t\t\tif (all) {\r\n\t\t\t\t\t\t\t\t\t\ti = existed.length;\r\n\t\t\t\t\t\t\t\t\t\twhile (ndx < i--) {\r\n\t\t\t\t\t\t\t\t\t\t\tfiles[existed[i]].remove = true\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tfiles[existed[ndx]].remove = true;\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t!last && !all\r\n\t\t\t\t\t\t\t\t\t\t? confirm(++ndx)\r\n\t\t\t\t\t\t\t\t\t\t: paste(files);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcancel: {\r\n\t\t\t\t\t\t\t\tlabel: 'btnCancel',\r\n\t\t\t\t\t\t\t\tcallback: function () {\r\n\t\t\t\t\t\t\t\t\tdfrd.resolve();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t},\r\n\t\t\t\t\tvalid = function (names) {\r\n\t\t\t\t\t\texisted = intersect(files, names);\r\n\t\t\t\t\t\texisted.length ? confirm(0) : paste(files);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tpaste = function (files) {\r\n\t\t\t\t\t\tvar files = $.map(files, function (file) {\r\n\t\t\t\t\t\t\t\treturn !file.remove ? file : null\r\n\t\t\t\t\t\t\t}),\r\n\t\t\t\t\t\t\tcnt = files.length,\r\n\t\t\t\t\t\t\tgroups = {},\r\n\t\t\t\t\t\t\targs = [],\r\n\t\t\t\t\t\t\tsrc;\r\n\r\n\t\t\t\t\t\tif (!cnt) {\r\n\t\t\t\t\t\t\treturn dfrd.resolve();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tsrc = files[0].phash;\r\n\t\t\t\t\t\tfiles = $.map(files, function (f) {\r\n\t\t\t\t\t\t\treturn f.hash\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tfm.request({\r\n\t\t\t\t\t\t\tdata: {cmd: 'paste', dst: dst.hash, targets: files, cut: cut ? 1 : 0, src: src},\r\n\t\t\t\t\t\t\tnotify: {type: cut ? 'move' : 'copy', cnt: cnt}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.always(function () {\r\n\t\t\t\t\t\t\t\tdfrd.resolve();\r\n\t\t\t\t\t\t\t\tfm.unlockfiles({files: files});\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\t;\r\n\r\n\t\t\t\tif (self._disabled || !files.length) {\r\n\t\t\t\t\treturn dfrd.resolve();\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tif (fm.oldAPI) {\r\n\t\t\t\t\tpaste(files);\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tif (!fm.option('copyOverwrite')) {\r\n\t\t\t\t\t\tpaste(files);\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tdst.hash == fm.cwd().hash\r\n\t\t\t\t\t\t\t? valid($.map(fm.files(), function (file) {\r\n\t\t\t\t\t\t\treturn file.phash == dst.hash ? file.name : null\r\n\t\t\t\t\t\t}))\r\n\t\t\t\t\t\t\t: fm.request({\r\n\t\t\t\t\t\t\tdata: {cmd: 'ls', target: dst.hash},\r\n\t\t\t\t\t\t\tnotify: {type: 'prepare', cnt: 1, hideCnt: true},\r\n\t\t\t\t\t\t\tpreventFail: true\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.always(function (data) {\r\n\t\t\t\t\t\t\t\tvalid(data.list || [])\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn dfrd;\r\n\t\t\t},\r\n\t\t\tparents, fparents;\r\n\r\n\r\n\t\tif (!cnt || !dst || dst.mime != 'directory') {\r\n\t\t\treturn dfrd.reject();\r\n\t\t}\r\n\r\n\t\tif (!dst.write) {\r\n\t\t\treturn dfrd.reject([error, files[0].name, 'errPerm']);\r\n\t\t}\r\n\r\n\t\tparents = fm.parents(dst.hash);\r\n\r\n\t\t$.each(files, function (i, file) {\r\n\t\t\tif (!file.read) {\r\n\t\t\t\treturn !dfrd.reject([error, files[0].name, 'errPerm']);\r\n\t\t\t}\r\n\r\n\t\t\tif (cut && file.locked) {\r\n\t\t\t\treturn !dfrd.reject(['errLocked', file.name]);\r\n\t\t\t}\r\n\r\n\t\t\tif ($.inArray(file.hash, parents) !== -1) {\r\n\t\t\t\treturn !dfrd.reject(['errCopyInItself', file.name]);\r\n\t\t\t}\r\n\r\n\t\t\tfparents = fm.parents(file.hash);\r\n\t\t\tfparents.pop();\r\n\t\t\tif ($.inArray(dst.hash, fparents) !== -1) {\r\n\r\n\t\t\t\tif ($.map(fparents, function (h) {\r\n\t\t\t\t\t\tvar d = fm.file(h);\r\n\t\t\t\t\t\treturn d.phash == dst.hash && d.name == file.name ? d : null\r\n\t\t\t\t\t}).length) {\r\n\t\t\t\t\treturn !dfrd.reject(['errReplByChild', file.name]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (file.phash == dst.hash) {\r\n\t\t\t\tfcopy.push(file.hash);\r\n\t\t\t} else {\r\n\t\t\t\tfpaste.push({\r\n\t\t\t\t\thash: file.hash,\r\n\t\t\t\t\tphash: file.phash,\r\n\t\t\t\t\tname: file.name\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif (dfrd.state() == 'rejected') {\r\n\t\t\treturn dfrd;\r\n\t\t}\r\n\r\n\t\treturn $.when(\r\n\t\t\tcopy(fcopy),\r\n\t\t\tpaste(fpaste)\r\n\t\t).always(function () {\r\n\t\t\t\tcut && fm.clipboard([]);\r\n\t\t\t});\r\n\t}\r\n\r\n}","/**\r\n * @class  elFinder command \"quicklook\"\r\n * Fast preview for some files types\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\nelFinder.prototype.commands.quicklook = function () {\r\n\tvar self = this,\r\n\t\tfm = self.fm,\r\n\r\n\t\t/**\r\n\t\t * window closed state\r\n\t\t *\r\n\t\t * @type Number\r\n\t\t **/\r\n\t\tclosed = 0,\r\n\r\n\t\t/**\r\n\t\t * window animated state\r\n\t\t *\r\n\t\t * @type Number\r\n\t\t **/\r\n\t\tanimated = 1,\r\n\r\n\t\t/**\r\n\t\t * window opened state\r\n\t\t *\r\n\t\t * @type Number\r\n\t\t **/\r\n\t\topened = 2,\r\n\r\n\t\t/**\r\n\t\t * window state\r\n\t\t *\r\n\t\t * @type Number\r\n\t\t **/\r\n\t\tstate = closed,\r\n\r\n\t\t/**\r\n\t\t * next/prev event name (requied to cwd catch it)\r\n\t\t *\r\n\t\t * @type Number\r\n\t\t **/\r\n\t\t// keydown    = fm.UA.Firefox || fm.UA.Opera ? 'keypress' : 'keydown',\r\n\r\n\t\t/**\r\n\t\t * navbar icon class\r\n\t\t *\r\n\t\t * @type Number\r\n\t\t **/\r\n\t\tnavicon = 'fa',\r\n\r\n\t\t/**\r\n\t\t * navbar \"fullscreen\" icon class\r\n\t\t *\r\n\t\t * @type Number\r\n\t\t **/\r\n\t\tfullscreen = 'elfinder-quicklook-fullscreen',\r\n\r\n\t\t/**\r\n\t\t * Triger keydown/keypress event with left/right arrow key code\r\n\t\t *\r\n\t\t * @param  Number  left/right arrow key code\r\n\t\t * @return void\r\n\t\t **/\r\n\t\tnavtrigger = function (code) {\r\n\t\t\t$(document).trigger($.Event('keydown', {\r\n\t\t\t\tkeyCode: code,\r\n\t\t\t\tctrlKey: false,\r\n\t\t\t\tshiftKey: false,\r\n\t\t\t\taltKey: false,\r\n\t\t\t\tmetaKey: false\r\n\t\t\t}));\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Return css for closed window\r\n\t\t *\r\n\t\t * @param  jQuery  file node in cwd\r\n\t\t * @return void\r\n\t\t **/\r\n\t\tclosedCss = function (node) {\r\n\t\t\treturn {\r\n\t\t\t\topacity: 0,\r\n\t\t\t\twidth: 20,//node.width(),\r\n\t\t\t\theight: fm.view == 'list' ? 1 : 20,\r\n\t\t\t\ttop: node.offset().top + 'px',\r\n\t\t\t\tleft: node.offset().left + 'px'\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Return css for opened window\r\n\t\t *\r\n\t\t * @return void\r\n\t\t **/\r\n\t\topenedCss = function () {\r\n\t\t\tvar win = $(window);\r\n\t\t\treturn {\r\n\t\t\t\topacity: 1,\r\n\t\t\t\twidth: width,\r\n\t\t\t\theight: height,\r\n\t\t\t\ttop: parseInt((win.height() - height) / 2 + win.scrollTop()),\r\n\t\t\t\tleft: parseInt((win.width() - width) / 2 + win.scrollLeft())\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tsupport = function (codec) {\r\n\t\t\tvar media = document.createElement(codec.substr(0, codec.indexOf('/'))),\r\n\t\t\t\tvalue = false;\r\n\r\n\t\t\ttry {\r\n\t\t\t\tvalue = media.canPlayType && media.canPlayType(codec);\r\n\t\t\t} catch (e) {\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn value && value !== '' && value != 'no';\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * Opened window width (from config)\r\n\t\t *\r\n\t\t * @type Number\r\n\t\t **/\r\n\t\twidth,\r\n\r\n\t\t/**\r\n\t\t * Opened window height (from config)\r\n\t\t *\r\n\t\t * @type Number\r\n\t\t **/\r\n\t\theight,\r\n\r\n\t\t/**\r\n\t\t * elFinder node\r\n\t\t *\r\n\t\t * @type jQuery\r\n\t\t **/\r\n\t\tparent,\r\n\r\n\t\t/**\r\n\t\t * elFinder current directory node\r\n\t\t *\r\n\t\t * @type jQuery\r\n\t\t **/\r\n\t\tcwd,\r\n\t\ttitle = $('<span class=\"panel-title elfinder-quicklook-title\"/>'),\r\n\t\ticon = $('<div/>'),\r\n\t\tinfo = $('<div class=\"elfinder-quicklook-info\"/>'),//.hide(),\r\n\t\tfsicon = $('<button class=\"btn btn-default btn-xs\"><div class=\"' + navicon + ' fa-expand\"/></button>')\r\n\t\t\t.on('click', function (e) {\r\n\t\t\t\tvar win = self.window,\r\n\t\t\t\t\tfull = win.is('.' + fullscreen),\r\n\t\t\t\t\tscroll = 'scroll.' + fm.namespace,\r\n\t\t\t\t\t$window = $(window);\r\n\r\n\t\t\t\te.stopPropagation();\r\n\r\n\t\t\t\tif (full) {\r\n\t\t\t\t\twin\r\n\t\t\t\t\t\t.css(win.data('position'))\r\n\t\t\t\t\t\t.unbind('mousemove');\r\n\r\n\t\t\t\t\t$window\r\n\t\t\t\t\t\t.unbind(scroll)\r\n\t\t\t\t\t\t.trigger(self.resize)\r\n\t\t\t\t\t\t.unbind(self.resize);\r\n\r\n\t\t\t\t\tnavbar\r\n\t\t\t\t\t\t.unbind('mouseenter')\r\n\t\t\t\t\t\t.unbind('mousemove');\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\twin.data('position', {\r\n\t\t\t\t\t\tleft: win.css('left'),\r\n\t\t\t\t\t\ttop: win.css('top'),\r\n\t\t\t\t\t\twidth: win.width(),\r\n\t\t\t\t\t\theight: win.height()\r\n\t\t\t\t\t})\r\n\t\t\t\t\t\t.css({\r\n\t\t\t\t\t\t\twidth: '100%',\r\n\t\t\t\t\t\t\theight: '100%'\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$(window)\r\n\t\t\t\t\t\t.bind(scroll, function () {\r\n\t\t\t\t\t\t\twin.css({\r\n\t\t\t\t\t\t\t\tleft: parseInt($(window).scrollLeft()) + 'px',\r\n\t\t\t\t\t\t\t\ttop: parseInt($(window).scrollTop()) + 'px'\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.bind(self.resize, function (e) {\r\n\t\t\t\t\t\t\tself.preview.trigger('changesize');\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.trigger(scroll)\r\n\t\t\t\t\t\t.trigger(self.resize);\r\n\r\n\t\t\t\t\twin\r\n\t\t\t\t\t\t.bind('mousemove', function (e) {\r\n\t\t\t\t\t\t\tnavbar.stop(true, true).show().delay(3000).fadeOut('slow');\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.mousemove();\r\n\r\n\t\t\t\t\tnavbar\r\n\t\t\t\t\t\t.mouseenter(function () {\r\n\t\t\t\t\t\t\tnavbar.stop(true, true).show();\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.mousemove(function (e) {\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tnavbar.attr('style', '').draggable(full ? 'destroy' : {});\r\n\t\t\t\twin.toggleClass(fullscreen);\r\n\t\t\t\t$(this).toggleClass('fa-compress');\r\n\t\t\t\t$.fn.resizable && parent.add(win).resizable(full ? 'enable' : 'disable').removeClass('disabled');\r\n\t\t\t}),\r\n\r\n\t\t$btn = $('<button class=\"btn btn-default btn-xs\" />'),\r\n\r\n\t\tnavbar = $('<div class=\"elfinder-quicklook-navbar panel-heading-controls\"/>')\r\n\t\t\t.append($btn.clone().append('<div class=\"' + navicon + ' fa-arrow-left\"/>').on('click', function () {\r\n\t\t\t\tnavtrigger(37);\r\n\t\t\t}))\r\n\t\t\t.append(fsicon)\r\n\t\t\t.append($btn.clone().append('<div class=\"' + navicon + ' fa-arrow-right\"/>').on('click', function () {\r\n\t\t\t\tnavtrigger(39);\r\n\t\t\t}))\r\n\t\t\t.append($btn.clone().append('<span class=\"fa fa-times elfinder-quicklook-close\"/>').on('click', function (e) {\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t\tself.window.trigger('close');\r\n\t\t\t}));\r\n\r\n\tthis.resize = 'resize.' + fm.namespace;\r\n\tthis.info = $('<div class=\"elfinder-quicklook-info-wrapper\"/>')\r\n\t\t.append(icon)\r\n\t\t.append(info);\r\n\r\n\tthis.preview = $('<div class=\"elfinder-quicklook-preview panel-body\"/>')\r\n\t\t// clean info/icon\r\n\t\t.bind('change', function (e) {\r\n\t\t\tself.info.attr('style', '').hide();\r\n\t\t\ticon.removeAttr('class').attr('style', '');\r\n\t\t\tinfo.html('');\r\n\t\t})\r\n\t\t// update info/icon\r\n\t\t.bind('update', function (e) {\r\n\t\t\tvar fm = self.fm,\r\n\t\t\t\tpreview = self.preview,\r\n\t\t\t\tfile = e.file,\r\n\t\t\t\ttpl = '<div class=\"elfinder-quicklook-info-data\">{value}</div>',\r\n\t\t\t\ttmb;\r\n\r\n\t\t\tif (file) {\r\n\t\t\t\t!file.read && e.stopImmediatePropagation();\r\n\t\t\t\tself.window.data('hash', file.hash);\r\n\t\t\t\tself.preview.unbind('changesize').trigger('change').children().remove();\r\n\t\t\t\ttitle.html(fm.escape(file.name));\r\n\r\n\t\t\t\tinfo.html(\r\n\t\t\t\t\ttpl.replace(/\\{value\\}/, file.name)\r\n\t\t\t\t\t+ tpl.replace(/\\{value\\}/, fm.mime2kind(file))\r\n\t\t\t\t\t+ (file.mime == 'directory' ? '' : tpl.replace(/\\{value\\}/, fm.formatSize(file.size)))\r\n\t\t\t\t\t+ tpl.replace(/\\{value\\}/, fm.i18n('modify') + ': ' + fm.formatDate(file))\r\n\t\t\t\t)\r\n\t\t\t\ticon.addClass('elfinder-cwd-icon  ' + fm.mime2class(file.mime));\r\n\r\n\t\t\t\tif (file.tmb) {\r\n\t\t\t\t\t$('<img/>')\r\n\t\t\t\t\t\t.hide()\r\n\t\t\t\t\t\t.appendTo(self.preview)\r\n\t\t\t\t\t\t.load(function () {\r\n\t\t\t\t\t\t\ticon.css('background', 'url(\"' + tmb + '\") center center no-repeat');\r\n\t\t\t\t\t\t\t$(this).remove();\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.attr('src', (tmb = fm.tmb(file.hash)));\r\n\t\t\t\t}\r\n\t\t\t\tself.info.delay(100).fadeIn(10);\r\n\t\t\t} else {\r\n\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\r\n\tthis.window = $('<div class=\"ui-helper-reset ui-widget panel elfinder-quicklook\" style=\"position:absolute\"/>')\r\n\t\t.click(function (e) {\r\n\t\t\te.stopPropagation();\r\n\t\t})\r\n\t\t.append(\r\n\t\t\t$('<div class=\"panel-heading elfinder-quicklook-titlebar\"/>')\r\n\t\t\t\t.append(title)\r\n\t\t\t\t.append($('<div class=\"btn-group\" />').append(navbar))\r\n\t\t)\r\n\t\t.append(this.preview)\r\n\t\t.append(self.info.hide())\r\n\t\t.draggable({handle: 'div.elfinder-quicklook-titlebar'})\r\n\t\t.bind('open', function (e) {\r\n\t\t\tvar win = self.window,\r\n\t\t\t\tfile = self.value,\r\n\t\t\t\tnode;\r\n\r\n\t\t\tif (self.closed() && file && (node = cwd.find('#' + file.hash)).length) {\r\n\t\t\t\tnavbar.attr('style', '');\r\n\t\t\t\tstate = animated;\r\n\t\t\t\tnode.trigger('scrolltoview');\r\n\t\t\t\twin.css(closedCss(node))\r\n\t\t\t\t\t.show()\r\n\t\t\t\t\t.animate(openedCss(), 550, function () {\r\n\t\t\t\t\t\tstate = opened;\r\n\t\t\t\t\t\tself.update(1, self.value);\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t})\r\n\t\t.bind('close', function (e) {\r\n\t\t\tvar win = self.window,\r\n\t\t\t\tpreview = self.preview.trigger('change'),\r\n\t\t\t\tfile = self.value,\r\n\t\t\t\tnode = cwd.find('#' + win.data('hash')),\r\n\t\t\t\tclose = function () {\r\n\t\t\t\t\tstate = closed;\r\n\t\t\t\t\twin.hide();\r\n\t\t\t\t\tpreview.children().remove();\r\n\t\t\t\t\tself.update(0, self.value);\r\n\r\n\t\t\t\t};\r\n\r\n\t\t\tif (self.opened()) {\r\n\t\t\t\tstate = animated;\r\n\t\t\t\twin.is('.' + fullscreen) && fsicon.mousedown()\r\n\t\t\t\tnode.length\r\n\t\t\t\t\t? win.animate(closedCss(node), 500, close)\r\n\t\t\t\t\t: close();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t/**\r\n\t * This command cannot be disable by backend\r\n\t *\r\n\t * @type Boolean\r\n\t **/\r\n\tthis.alwaysEnabled = true;\r\n\r\n\t/**\r\n\t * Selected file\r\n\t *\r\n\t * @type Object\r\n\t **/\r\n\tthis.value = null;\r\n\r\n\tthis.handlers = {\r\n\t\t// save selected file\r\n\t\tselect: function () {\r\n\t\t\tthis.update(void(0), this.fm.selectedFiles()[0]);\r\n\t\t},\r\n\t\terror: function () {\r\n\t\t\tself.window.is(':visible') && self.window.data('hash', '').trigger('close');\r\n\t\t},\r\n\t\t'searchshow searchhide': function () {\r\n\t\t\tthis.opened() && this.window.trigger('close');\r\n\t\t},\r\n\t\tdblclick: function (e) {\r\n\t\t\te.preventDefault();\r\n\t\t\tthis.exec();\r\n\t\t}\r\n\t}\r\n\r\n\tthis.shortcuts = [{\r\n\t\tpattern: 'space'\r\n\t}];\r\n\r\n\tthis.support = {\r\n\t\taudio: {\r\n\t\t\togg: support('audio/ogg; codecs=\"vorbis\"'),\r\n\t\t\tmp3: support('audio/mpeg;'),\r\n\t\t\twav: support('audio/wav; codecs=\"1\"'),\r\n\t\t\tm4a: support('audio/x-m4a;') || support('audio/aac;')\r\n\t\t},\r\n\t\tvideo: {\r\n\t\t\togg: support('video/ogg; codecs=\"theora\"'),\r\n\t\t\twebm: support('video/webm; codecs=\"vp8, vorbis\"'),\r\n\t\t\tmp4: support('video/mp4; codecs=\"avc1.42E01E\"') || support('video/mp4; codecs=\"avc1.42E01E, mp4a.40.2\"')\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Return true if quickLoock window is visible and not animated\r\n\t *\r\n\t * @return Boolean\r\n\t **/\r\n\tthis.closed = function () {\r\n\t\treturn state == closed;\r\n\t}\r\n\r\n\t/**\r\n\t * Return true if quickLoock window is hidden\r\n\t *\r\n\t * @return Boolean\r\n\t **/\r\n\tthis.opened = function () {\r\n\t\treturn state == opened;\r\n\t}\r\n\r\n\t/**\r\n\t * Init command.\r\n\t * Add default plugins and init other plugins\r\n\t *\r\n\t * @return Object\r\n\t **/\r\n\tthis.init = function () {\r\n\t\tvar o = this.options,\r\n\t\t\twin = this.window,\r\n\t\t\tpreview = this.preview,\r\n\t\t\ti, p;\r\n\r\n\t\twidth = o.width > 0 ? parseInt(o.width) : 800;\r\n\t\theight = o.height > 0 ? parseInt(o.height) : 500;\r\n\r\n\t\tfm.one('load', function () {\r\n\t\t\tparent = fm.getUI();\r\n\t\t\tcwd = fm.getUI('cwd');\r\n\r\n\t\t\twin.appendTo('body');\r\n\r\n\t\t\t// close window on escape\r\n\t\t\t$(document).keydown(function (e) {\r\n\t\t\t\te.keyCode == 27 && self.opened() && win.trigger('close')\r\n\t\t\t})\r\n\r\n\t\t\tif ($.fn.resizable) {\r\n\t\t\t\twin.resizable({\r\n\t\t\t\t\thandles: 'se',\r\n\t\t\t\t\tminWidth: 350,\r\n\t\t\t\t\tminHeight: 120,\r\n\t\t\t\t\tresize: function () {\r\n\t\t\t\t\t\t// use another event to avoid recursion in fullscreen mode\r\n\t\t\t\t\t\t// may be there is clever solution, but i cant find it :(\r\n\t\t\t\t\t\tpreview.trigger('changesize');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tself.change(function () {\r\n\t\t\t\tif (self.opened()) {\r\n\t\t\t\t\tself.value ? preview.trigger($.Event('update', {file: self.value})) : win.trigger('close');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$.each(fm.commands.quicklook.plugins || [], function (i, plugin) {\r\n\t\t\t\tif (typeof(plugin) == 'function') {\r\n\t\t\t\t\tnew plugin(self)\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tpreview.bind('update', function () {\r\n\t\t\t\tself.info.show();\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t}\r\n\r\n\tthis.getstate = function () {\r\n\t\treturn this.fm.selected().length == 1 ? state == opened ? 1 : 0 : -1;\r\n\t}\r\n\r\n\tthis.exec = function () {\r\n\t\tthis.enabled() && this.window.trigger(this.opened() ? 'close' : 'open');\r\n\t}\r\n\r\n\tthis.hideinfo = function () {\r\n\t\tthis.info.stop(true).hide();\r\n\t}\r\n}\r\n\r\nelFinder.prototype.commands.quicklook.plugins = [];","/**\r\n * HTML5 audio preview plugin\r\n *\r\n * @param elFinder.commands.quicklook\r\n **/\r\nelFinder.prototype.commands.quicklook.plugins.push(function (ql) {\r\n\tvar preview = ql.preview,\r\n\t\tautoplay = !!ql.options['autoplay'],\r\n\t\tmimes = {\r\n\t\t\t'audio/mpeg': 'mp3',\r\n\t\t\t'audio/mpeg3': 'mp3',\r\n\t\t\t'audio/mp3': 'mp3',\r\n\t\t\t'audio/x-mpeg3': 'mp3',\r\n\t\t\t'audio/x-mp3': 'mp3',\r\n\t\t\t'audio/x-wav': 'wav',\r\n\t\t\t'audio/wav': 'wav',\r\n\t\t\t'audio/x-m4a': 'm4a',\r\n\t\t\t'audio/aac': 'm4a',\r\n\t\t\t'audio/mp4': 'm4a',\r\n\t\t\t'audio/x-mp4': 'm4a',\r\n\t\t\t'audio/ogg': 'ogg'\r\n\t\t},\r\n\t\tnode;\r\n\r\n\tpreview.bind('update', function (e) {\r\n\t\tvar file = e.file,\r\n\t\t\ttype = mimes[file.mime];\r\n\r\n\t\tif (ql.support.audio[type]) {\r\n\t\t\te.stopImmediatePropagation();\r\n\r\n\t\t\tnode = $('<audio class=\"elfinder-quicklook-preview-audio\" controls preload=\"auto\" autobuffer><source src=\"' + ql.fm.url(file.hash) + '\" /></audio>')\r\n\t\t\t\t.appendTo(preview);\r\n\t\t\tautoplay && node[0].play();\r\n\t\t}\r\n\t}).bind('change', function () {\r\n\t\tif (node && node.parent().length) {\r\n\t\t\tnode[0].pause();\r\n\t\t\tnode.remove();\r\n\t\t\tnode = null;\r\n\t\t}\r\n\t});\r\n});","/**\r\n * Flash preview plugin\r\n *\r\n * @param elFinder.commands.quicklook\r\n **/\r\nelFinder.prototype.commands.quicklook.plugins.push(function (ql) {\r\n\tvar fm = ql.fm,\r\n\t\tmime = 'application/x-shockwave-flash',\r\n\t\tpreview = ql.preview,\r\n\t\tactive = false;\r\n\r\n\t$.each(navigator.plugins, function (i, plugins) {\r\n\t\t$.each(plugins, function (i, plugin) {\r\n\t\t\tif (plugin.type == mime) {\r\n\t\t\t\treturn !(active = true);\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\r\n\tactive && preview.bind('update', function (e) {\r\n\t\tvar file = e.file,\r\n\t\t\tnode;\r\n\r\n\t\tif (file.mime == mime) {\r\n\t\t\te.stopImmediatePropagation();\r\n\t\t\tql.hideinfo();\r\n\t\t\tpreview.append((node = $('<embed class=\"elfinder-quicklook-preview-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\" src=\"' + fm.url(file.hash) + '\" quality=\"high\" type=\"application/x-shockwave-flash\" />')));\r\n\t\t}\r\n\t});\r\n});","/**\r\n * Images preview plugin\r\n *\r\n * @param elFinder.commands.quicklook\r\n **/\r\nelFinder.prototype.commands.quicklook.plugins.push(function (ql) {\r\n\tvar mimes = ['image/jpeg', 'image/png', 'image/gif'],\r\n\t\tpreview = ql.preview;\r\n\r\n\t// what kind of images we can display\r\n\t$.each(navigator.mimeTypes, function (i, o) {\r\n\t\tvar mime = o.type;\r\n\r\n\t\tif (mime.indexOf('image/') === 0 && $.inArray(mime, mimes)) {\r\n\t\t\tmimes.push(mime);\r\n\t\t}\r\n\t});\r\n\r\n\tpreview.bind('update', function (e) {\r\n\t\tvar file = e.file,\r\n\t\t\timg;\r\n\r\n\t\tif ($.inArray(file.mime, mimes) !== -1) {\r\n\t\t\t// this is our file - stop event propagation\r\n\t\t\te.stopImmediatePropagation();\r\n\r\n\t\t\timg = $('<img/>')\r\n\t\t\t\t.hide()\r\n\t\t\t\t.appendTo(preview)\r\n\t\t\t\t.load(function () {\r\n\t\t\t\t\t// timeout - because of strange safari bug -\r\n\t\t\t\t\t// sometimes cant get image height 0_o\r\n\t\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\t\tvar prop = (img.width() / img.height()).toFixed(2);\r\n\t\t\t\t\t\tpreview.bind('changesize', function () {\r\n\t\t\t\t\t\t\tvar pw = parseInt(preview.width()),\r\n\t\t\t\t\t\t\t\tph = parseInt(preview.height()),\r\n\t\t\t\t\t\t\t\tw, h;\r\n\r\n\t\t\t\t\t\t\tif (prop < (pw / ph).toFixed(2)) {\r\n\t\t\t\t\t\t\t\th = ph;\r\n\t\t\t\t\t\t\t\tw = Math.floor(h * prop);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tw = pw;\r\n\t\t\t\t\t\t\t\th = Math.floor(w / prop);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\timg.width(w).height(h).css('margin-top', h < ph ? Math.floor((ph - h) / 2) : 0);\r\n\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.trigger('changesize');\r\n\r\n\t\t\t\t\t\t// hide info/icon\r\n\t\t\t\t\t\tql.hideinfo();\r\n\t\t\t\t\t\t//show image\r\n\t\t\t\t\t\timg.fadeIn(100);\r\n\t\t\t\t\t}, 1)\r\n\t\t\t\t})\r\n\t\t\t\t.attr('src', ql.fm.url(file.hash));\r\n\t\t}\r\n\r\n\t});\r\n});","/**\r\n * PDF preview plugin\r\n *\r\n * @param elFinder.commands.quicklook\r\n **/\r\nelFinder.prototype.commands.quicklook.plugins.push(function (ql) {\r\n\tvar fm = ql.fm,\r\n\t\tmime = 'application/pdf',\r\n\t\tpreview = ql.preview,\r\n\t\tactive = false;\r\n\r\n\tif ((fm.UA.Safari && fm.OS == 'mac') || fm.UA.IE) {\r\n\t\tactive = true;\r\n\t} else {\r\n\t\t$.each(navigator.plugins, function (i, plugins) {\r\n\t\t\t$.each(plugins, function (i, plugin) {\r\n\t\t\t\tif (plugin.type == mime) {\r\n\t\t\t\t\treturn !(active = true);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tactive && preview.bind('update', function (e) {\r\n\t\tvar file = e.file, node;\r\n\r\n\t\tif (file.mime == mime) {\r\n\t\t\te.stopImmediatePropagation();\r\n\t\t\tpreview.one('change', function () {\r\n\t\t\t\tnode.unbind('load').remove();\r\n\t\t\t});\r\n\r\n\t\t\tnode = $('<iframe class=\"elfinder-quicklook-preview-pdf\"/>')\r\n\t\t\t\t.hide()\r\n\t\t\t\t.appendTo(preview)\r\n\t\t\t\t.load(function () {\r\n\t\t\t\t\tql.hideinfo();\r\n\t\t\t\t\tnode.show();\r\n\t\t\t\t})\r\n\t\t\t\t.attr('src', fm.url(file.hash));\r\n\t\t}\r\n\t})\r\n});","/**\r\n * Texts preview plugin\r\n *\r\n * @param elFinder.commands.quicklook\r\n **/\r\nelFinder.prototype.commands.quicklook.plugins.push(function (ql) {\r\n\tvar fm = ql.fm,\r\n\t\tmimes = fm.res('mimes', 'text'),\r\n\t\tpreview = ql.preview;\r\n\r\n\tpreview.bind('update', function (e) {\r\n\t\tvar file = e.file,\r\n\t\t\tmime = file.mime,\r\n\t\t\tjqxhr;\r\n\r\n\t\tif (mime.indexOf('text/') === 0 || $.inArray(mime, mimes) !== -1) {\r\n\t\t\te.stopImmediatePropagation();\r\n\r\n\t\t\t// stop loading on change file if not loadin yet\r\n\t\t\tpreview.one('change', function () {\r\n\t\t\t\tjqxhr.state() == 'pending' && jqxhr.reject();\r\n\t\t\t});\r\n\r\n\t\t\tjqxhr = fm.request({\r\n\t\t\t\tdata: {cmd: 'get', target: file.hash},\r\n\t\t\t\tpreventDefault: true\r\n\t\t\t})\r\n\t\t\t\t.done(function (data) {\r\n\t\t\t\t\tql.hideinfo();\r\n\t\t\t\t\t$('<div class=\"elfinder-quicklook-preview-text-wrapper\">' +\r\n\t\t\t\t\t\t'<textarea id=\"elfinder-quicklook-preview-text\" data-readonly=\"on\" data-height=\"200\">' + fm.escape(data.content) + '</textarea>' +\r\n\t\t\t\t\t'</div>')\r\n\t\t\t\t\t\t.appendTo(preview);\r\n\r\n\t\t\t\t\t$('#elfinder-quicklook-preview-text').on('filter:switch:on', function (e, editor) {\r\n\t\t\t\t\t\t$('.elfinder-quicklook-preview-text-wrapper').setHeightFor('#elfinder-quicklook-preview-textDiv', {\r\n\t\t\t\t\t\t\tupdateOnResize: true,\r\n\t\t\t\t\t\t\toffset: 0,\r\n\t\t\t\t\t\t\tminHeight: 200,\r\n\t\t\t\t\t\t\tonCalculate: function (a, h) {\r\n\t\t\t\t\t\t\t\tCMS.filters.exec('elfinder-quicklook-preview-text', 'changeHeight', h);\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tonResize: function (a, h) {\r\n\t\t\t\t\t\t\t\tCMS.filters.exec('elfinder-quicklook-preview-text', 'changeHeight', h);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tCMS.filters.switchOn('elfinder-quicklook-preview-text', 'ace', {mime: mime});\r\n\t\t\t\t});\r\n\t\t}\r\n\r\n\t\t$(window)\r\n\t\t\t.on(ql.resize, function () {\r\n\t\t\t\t$('.elfinder-quicklook-preview-text-wrapper').trigger('resize');\r\n\t\t\t});\r\n\t});\r\n});","/**\r\n * HTML5 video preview plugin\r\n *\r\n * @param elFinder.commands.quicklook\r\n **/\r\nelFinder.prototype.commands.quicklook.plugins.push(function (ql) {\r\n\tvar preview = ql.preview,\r\n\t\tautoplay = !!ql.options['autoplay'],\r\n\t\tmimes = {\r\n\t\t\t'video/mp4': 'mp4',\r\n\t\t\t'video/x-m4v': 'mp4',\r\n\t\t\t'application/mp4': 'mp4',\r\n\t\t\t'video/ogg': 'ogg',\r\n\t\t\t'application/ogg': 'ogg',\r\n\t\t\t'video/webm': 'webm'\r\n\t\t},\r\n\t\tnode;\r\n\r\n\tpreview.bind('update', function (e) {\r\n\t\tvar file = e.file,\r\n\t\t\ttype = mimes[file.mime];\r\n\r\n\t\tif (ql.support.video[type]) {\r\n\t\t\te.stopImmediatePropagation();\r\n\r\n\t\t\tql.hideinfo();\r\n\t\t\tnode = $('<video class=\"elfinder-quicklook-preview-video\" controls preload=\"auto\" autobuffer><source src=\"' + ql.fm.url(file.hash) + '\" /></video>').appendTo(preview);\r\n\t\t\tautoplay && node[0].play();\r\n\r\n\t\t}\r\n\t}).bind('change', function () {\r\n\t\tif (node && node.parent().length) {\r\n\t\t\tnode[0].pause();\r\n\t\t\tnode.remove();\r\n\t\t\tnode = null;\r\n\t\t}\r\n\t});\r\n});","/**\r\n * Audio/video preview plugin using browser plugins\r\n *\r\n * @param elFinder.commands.quicklook\r\n **/\r\nelFinder.prototype.commands.quicklook.plugins.push(function (ql) {\r\n\tvar preview = ql.preview,\r\n\t\tmimes = [],\r\n\t\tnode;\r\n\r\n\t$.each(navigator.plugins, function (i, plugins) {\r\n\t\t$.each(plugins, function (i, plugin) {\r\n\t\t\t(plugin.type.indexOf('audio/') === 0 || plugin.type.indexOf('video/') === 0) && mimes.push(plugin.type);\r\n\t\t});\r\n\t});\r\n\r\n\tpreview.bind('update', function (e) {\r\n\t\tvar file = e.file,\r\n\t\t\tmime = file.mime,\r\n\t\t\tvideo;\r\n\r\n\t\tif ($.inArray(file.mime, mimes) !== -1) {\r\n\t\t\te.stopImmediatePropagation();\r\n\t\t\t(video = mime.indexOf('video/') === 0) && ql.hideinfo();\r\n\t\t\tnode = $('<embed src=\"' + ql.fm.url(file.hash) + '\" type=\"' + mime + '\" class=\"elfinder-quicklook-preview-' + (video ? 'video' : 'audio') + '\"/>')\r\n\t\t\t\t.appendTo(preview);\r\n\t\t}\r\n\t}).bind('change', function () {\r\n\t\tif (node && node.parent().length) {\r\n\t\t\tnode.remove();\r\n\t\t\tnode = null;\r\n\t\t}\r\n\t});\r\n});","/**\r\n * @class  elFinder command \"reload\"\r\n * Sync files and folders\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\nelFinder.prototype.commands.reload = function () {\r\n\r\n\tthis.alwaysEnabled = true;\r\n\tthis.updateOnSelect = true;\r\n\r\n\tthis.shortcuts = [{\r\n\t\tpattern: 'ctrl+shift+r f5'\r\n\t}];\r\n\r\n\tthis.getstate = function () {\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tthis.exec = function () {\r\n\t\tvar fm = this.fm,\r\n\t\t\tdfrd = fm.sync(),\r\n\t\t\ttimeout = setTimeout(function () {\r\n\t\t\t\tfm.notify({type: 'reload', cnt: 1, hideCnt: true});\r\n\t\t\t\tdfrd.always(function () {\r\n\t\t\t\t\tfm.notify({type: 'reload', cnt: -1});\r\n\t\t\t\t});\r\n\t\t\t}, fm.notifyDelay);\r\n\r\n\t\treturn dfrd.always(function () {\r\n\t\t\tclearTimeout(timeout);\r\n\t\t\tfm.trigger('reload');\r\n\t\t});\r\n\t}\r\n}","/**\r\n * @class elFinder command \"rename\".\r\n * Rename selected file.\r\n *\r\n * @author Dmitry (dio) Levashov, dio@std42.ru\r\n **/\r\nelFinder.prototype.commands.rename = function () {\r\n\r\n\tthis.shortcuts = [{\r\n\t\tpattern: 'f2' + (this.fm.OS == 'mac' ? ' enter' : '')\r\n\t}];\r\n\r\n\tthis.getstate = function () {\r\n\t\tvar sel = this.fm.selectedFiles();\r\n\r\n\t\treturn !this._disabled && sel.length == 1 && sel[0].phash && !sel[0].locked ? 0 : -1;\r\n\t}\r\n\r\n\tthis.exec = function () {\r\n\t\tvar fm = this.fm,\r\n\t\t\tcwd = fm.getUI('cwd'),\r\n\t\t\tsel = fm.selected(),\r\n\t\t\tcnt = sel.length,\r\n\t\t\tfile = fm.file(sel.shift()),\r\n\t\t\tfilename = '.elfinder-cwd-filename',\r\n\t\t\tdfrd = $.Deferred()\r\n\t\t\t\t.fail(function (error) {\r\n\t\t\t\t\tvar parent = input.parent(),\r\n\t\t\t\t\t\tname = fm.escape(file.name);\r\n\r\n\r\n\t\t\t\t\tif (parent.length) {\r\n\t\t\t\t\t\tinput.remove();\r\n\t\t\t\t\t\tparent.html(name);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcwd.find('#' + file.hash).find(filename).html(name);\r\n\t\t\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\t\t\tcwd.find('#' + file.hash).click();\r\n\t\t\t\t\t\t}, 50);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\terror && fm.error(error);\r\n\t\t\t\t})\r\n\t\t\t\t.always(function () {\r\n\t\t\t\t\tfm.enable();\r\n\t\t\t\t}),\r\n\t\t\tinput = $('<input type=\"text\"/>')\r\n\t\t\t\t.keydown(function (e) {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t\t\tif (e.keyCode == $.ui.keyCode.ESCAPE) {\r\n\t\t\t\t\t\tdfrd.reject();\r\n\t\t\t\t\t} else if (e.keyCode == $.ui.keyCode.ENTER) {\r\n\t\t\t\t\t\tinput.blur();\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.mousedown(function (e) {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t})\r\n\t\t\t\t.dblclick(function (e) {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t})\r\n\t\t\t\t.blur(function () {\r\n\t\t\t\t\tvar name = $.trim(input.val()),\r\n\t\t\t\t\t\tparent = input.parent();\r\n\r\n\t\t\t\t\tif (parent.length) {\r\n\t\t\t\t\t\tif (input[0].setSelectionRange) {\r\n\t\t\t\t\t\t\tinput[0].setSelectionRange(0, 0)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (name == file.name) {\r\n\t\t\t\t\t\t\treturn dfrd.reject();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (!name) {\r\n\t\t\t\t\t\t\treturn dfrd.reject('errInvName');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (fm.fileByName(name, file.phash)) {\r\n\t\t\t\t\t\t\treturn dfrd.reject(['errExists', name]);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tparent.html(fm.escape(name));\r\n\t\t\t\t\t\tfm.lockfiles({files: [file.hash]});\r\n\t\t\t\t\t\tfm.request({\r\n\t\t\t\t\t\t\tdata: {cmd: 'rename', target: file.hash, name: name},\r\n\t\t\t\t\t\t\tnotify: {type: 'rename', cnt: 1}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.fail(function (error) {\r\n\t\t\t\t\t\t\t\tdfrd.reject();\r\n\t\t\t\t\t\t\t\tfm.sync();\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.done(function (data) {\r\n\t\t\t\t\t\t\t\tdfrd.resolve(data);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.always(function () {\r\n\t\t\t\t\t\t\t\tfm.unlockfiles({files: [file.hash]})\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\tnode = cwd.find('#' + file.hash).find(filename).empty().append(input.val(file.name)),\r\n\t\t\tname = input.val().replace(/\\.((tar\\.(gz|bz|bz2|z|lzo))|cpio\\.gz|ps\\.gz|xcf\\.(gz|bz2)|[a-z0-9]{1,4})$/ig, '')\r\n\t\t\t;\r\n\r\n\t\tif (this.disabled()) {\r\n\t\t\treturn dfrd.reject();\r\n\t\t}\r\n\r\n\t\tif (!file || cnt > 1 || !node.length) {\r\n\t\t\treturn dfrd.reject('errCmdParams', this.title);\r\n\t\t}\r\n\r\n\t\tif (file.locked) {\r\n\t\t\treturn dfrd.reject(['errLocked', file.name]);\r\n\t\t}\r\n\r\n\t\tfm.one('select', function () {\r\n\t\t\tinput.parent().length && file && $.inArray(file.hash, fm.selected()) === -1 && input.blur();\r\n\t\t})\r\n\r\n\t\tinput.select().focus();\r\n\r\n\t\tinput[0].setSelectionRange && input[0].setSelectionRange(0, name.length);\r\n\r\n\t\treturn dfrd;\r\n\t}\r\n\r\n}","/**\r\n * @class  elFinder command \"resize\"\r\n * Open dialog to resize image\r\n *\r\n * @author Dmitry (dio) Levashov\r\n * @author Alexey Sukhotin\r\n * @author Naoki Sawada\r\n * @author Sergio Jovani\r\n **/\r\nelFinder.prototype.commands.resize = function () {\r\n\r\n\tthis.updateOnSelect = false;\r\n\r\n\tthis.getstate = function () {\r\n\t\tvar sel = this.fm.selectedFiles();\r\n\t\treturn !this._disabled && sel.length == 1 && sel[0].read && sel[0].write && sel[0].mime.indexOf('image/') !== -1 ? 0 : -1;\r\n\t};\r\n\r\n\tthis.exec = function (hashes) {\r\n\t\tvar fm = this.fm,\r\n\t\t\tfiles = this.files(hashes),\r\n\t\t\tdfrd = $.Deferred(),\r\n\r\n\t\t\topen = function (file, id) {\r\n\t\t\t\tvar dialog = $('<div class=\"elfinder-dialog-resize\"/>'),\r\n\t\t\t\t\tinput = '<input type=\"text\" size=\"5\"/>',\r\n\t\t\t\t\trow = '<div class=\"elfinder-resize-row\"/>',\r\n\t\t\t\t\tlabel = '<div class=\"elfinder-resize-label\"/>',\r\n\t\t\t\t\tcontrol = $('<div class=\"elfinder-resize-control\"/>'),\r\n\t\t\t\t\tpreview = $('<div class=\"elfinder-resize-preview\"/>'),\r\n\t\t\t\t\tspinner = $('<div class=\"elfinder-resize-spinner\">' + fm.i18n('ntfloadimg') + '</div>'),\r\n\t\t\t\t\trhandle = $('<div class=\"elfinder-resize-handle\"/>'),\r\n\t\t\t\t\trhandlec = $('<div class=\"elfinder-resize-handle\"/>'),\r\n\t\t\t\t\tuiresize = $('<div class=\"elfinder-resize-uiresize\"/>'),\r\n\t\t\t\t\tuicrop = $('<div class=\"elfinder-resize-uicrop\"/>'),\r\n\t\t\t\t\tuibuttonset = '<div class=\"ui-panel-body btn-group\"/>',\r\n\t\t\t\t\tuibutton = '<button class=\"btn btn-default btn-xs\"/>',\r\n\t\t\t\t\tuiseparator = '',\r\n\t\t\t\t\tuirotate = $('<div class=\"elfinder-resize-rotate\"/>'),\r\n\t\t\t\t\tuideg270 = $(uibutton).attr('title', fm.i18n('rotate-cw')).append($('<span class=\"fa fa-rotate-left\"/>')\r\n\t\t\t\t\t\t.click(function () {\r\n\t\t\t\t\t\t\trdegree = rdegree - 90;\r\n\t\t\t\t\t\t\trotate.update(rdegree);\r\n\t\t\t\t\t\t})),\r\n\t\t\t\t\tuideg90 = $(uibutton).attr('title', fm.i18n('rotate-ccw')).append($('<span class=\"fa fa-rotate-right\"/>')\r\n\t\t\t\t\t\t.click(function () {\r\n\t\t\t\t\t\t\trdegree = rdegree + 90;\r\n\t\t\t\t\t\t\trotate.update(rdegree);\r\n\t\t\t\t\t\t})),\r\n\r\n\t\t\t\t\tuiprop = $('<span />'),\r\n\t\t\t\t\treset = $('<button class=\"btn btn-danger btn-xs elfinder-resize-reset\"><i class=\"fa fa-undo\"/></button>'),\r\n\t\t\t\t\tuitype = $('<div class=\"elfinder-resize-type\"/>')\r\n\t\t\t\t\t\t.append('<label for=\"' + id + '-resize\">' + fm.i18n('resize') + '</label>')\r\n\t\t\t\t\t\t.append('<label for=\"' + id + '-crop\">' + fm.i18n('crop') + '</label>')\r\n\t\t\t\t\t\t.append('<label for=\"' + id + '-rotate\">' + fm.i18n('rotate') + '</label>')\r\n\t\t\t\t\t\t.append('<input type=\"radio\" name=\"type\" id=\"' + id + '-resize\" value=\"resize\" checked=\"checked\" />')\r\n\t\t\t\t\t\t.append('<input type=\"radio\" name=\"type\" id=\"' + id + '-crop\" value=\"crop\" />')\r\n\t\t\t\t\t\t.append('<input type=\"radio\" name=\"type\" id=\"' + id + '-rotate\" value=\"rotate\" />'),\r\n\t\t\t\t\ttype = $('input', uitype).attr('disabled', 'disabled')\r\n\t\t\t\t\t\t.change(function () {\r\n\t\t\t\t\t\t\tvar val = $('input:checked', uitype).val();\r\n\r\n\t\t\t\t\t\t\tresetView();\r\n\t\t\t\t\t\t\tresizable(true);\r\n\t\t\t\t\t\t\tcroppable(true);\r\n\t\t\t\t\t\t\trotateable(true);\r\n\r\n\t\t\t\t\t\t\tif (val == 'resize') {\r\n\t\t\t\t\t\t\t\tuiresize.show();\r\n\t\t\t\t\t\t\t\tuirotate.hide();\r\n\t\t\t\t\t\t\t\tuicrop.hide();\r\n\t\t\t\t\t\t\t\tresizable();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if (val == 'crop') {\r\n\t\t\t\t\t\t\t\tuirotate.hide();\r\n\t\t\t\t\t\t\t\tuiresize.hide();\r\n\t\t\t\t\t\t\t\tuicrop.show();\r\n\t\t\t\t\t\t\t\tcroppable();\r\n\t\t\t\t\t\t\t} else if (val == 'rotate') {\r\n\t\t\t\t\t\t\t\tuiresize.hide();\r\n\t\t\t\t\t\t\t\tuicrop.hide();\r\n\t\t\t\t\t\t\t\tuirotate.show();\r\n\t\t\t\t\t\t\t\trotateable();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\tconstr = $('<input type=\"checkbox\" checked=\"checked\"/>')\r\n\t\t\t\t\t\t.change(function () {\r\n\t\t\t\t\t\t\tcratio = !!constr.prop('checked');\r\n\t\t\t\t\t\t\tresize.fixHeight();\r\n\t\t\t\t\t\t\tresizable(true);\r\n\t\t\t\t\t\t\tresizable();\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\twidth = $(input)\r\n\t\t\t\t\t\t.change(function () {\r\n\t\t\t\t\t\t\tvar w = parseInt(width.val()),\r\n\t\t\t\t\t\t\t\th = parseInt(cratio ? Math.round(w / ratio) : height.val());\r\n\r\n\t\t\t\t\t\t\tif (w > 0 && h > 0) {\r\n\t\t\t\t\t\t\t\tresize.updateView(w, h);\r\n\t\t\t\t\t\t\t\theight.val(h);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\theight = $(input)\r\n\t\t\t\t\t\t.change(function () {\r\n\t\t\t\t\t\t\tvar h = parseInt(height.val()),\r\n\t\t\t\t\t\t\t\tw = parseInt(cratio ? Math.round(h * ratio) : width.val());\r\n\r\n\t\t\t\t\t\t\tif (w > 0 && h > 0) {\r\n\t\t\t\t\t\t\t\tresize.updateView(w, h);\r\n\t\t\t\t\t\t\t\twidth.val(w);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\tpointX = $(input).change(function () {\r\n\t\t\t\t\t\tcrop.updateView();\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tpointY = $(input).change(function () {\r\n\t\t\t\t\t\tcrop.updateView();\r\n\t\t\t\t\t}),\r\n\t\t\t\t\toffsetX = $(input).change(function () {\r\n\t\t\t\t\t\tcrop.updateView();\r\n\t\t\t\t\t}),\r\n\t\t\t\t\toffsetY = $(input).change(function () {\r\n\t\t\t\t\t\tcrop.updateView();\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tdegree = $('<input type=\"text\" size=\"3\" maxlength=\"3\" value=\"0\" />')\r\n\t\t\t\t\t\t.change(function () {\r\n\t\t\t\t\t\t\trotate.update();\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\tuidegslider = $('<div class=\"elfinder-resize-rotate-slider\"/>')\r\n\t\t\t\t\t\t.slider({\r\n\t\t\t\t\t\t\tmin: 0,\r\n\t\t\t\t\t\t\tmax: 359,\r\n\t\t\t\t\t\t\tvalue: degree.val(),\r\n\t\t\t\t\t\t\tanimate: true,\r\n\t\t\t\t\t\t\tchange: function (event, ui) {\r\n\t\t\t\t\t\t\t\tif (ui.value != uidegslider.slider('value')) {\r\n\t\t\t\t\t\t\t\t\trotate.update(ui.value);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tslide: function (event, ui) {\r\n\t\t\t\t\t\t\t\trotate.update(ui.value, false);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\tratio = 1,\r\n\t\t\t\t\tprop = 1,\r\n\t\t\t\t\towidth = 0,\r\n\t\t\t\t\toheight = 0,\r\n\t\t\t\t\tcratio = true,\r\n\t\t\t\t\tpwidth = 0,\r\n\t\t\t\t\tpheight = 0,\r\n\t\t\t\t\trwidth = 0,\r\n\t\t\t\t\trheight = 0,\r\n\t\t\t\t\trdegree = 0,\r\n\t\t\t\t\timg = $('<img/>')\r\n\t\t\t\t\t\t.load(function () {\r\n\t\t\t\t\t\t\tspinner.remove();\r\n\r\n\t\t\t\t\t\t\towidth = img.width();\r\n\t\t\t\t\t\t\toheight = img.height();\r\n\t\t\t\t\t\t\tratio = owidth / oheight;\r\n\t\t\t\t\t\t\tresize.updateView(owidth, oheight);\r\n\r\n\t\t\t\t\t\t\trhandle.append(img.show()).show();\r\n\t\t\t\t\t\t\twidth.val(owidth);\r\n\t\t\t\t\t\t\theight.val(oheight);\r\n\r\n\t\t\t\t\t\t\tvar r_scale = Math.min(pwidth, pheight) / Math.sqrt(Math.pow(owidth, 2) + Math.pow(oheight, 2));\r\n\t\t\t\t\t\t\trwidth = owidth * r_scale;\r\n\t\t\t\t\t\t\trheight = oheight * r_scale;\r\n\r\n\t\t\t\t\t\t\ttype.button('enable');\r\n\t\t\t\t\t\t\tcontrol.find('input,select').removeAttr('disabled')\r\n\t\t\t\t\t\t\t\t.filter(':text').keydown(function (e) {\r\n\t\t\t\t\t\t\t\t\tvar c = e.keyCode, i;\r\n\r\n\t\t\t\t\t\t\t\t\te.stopPropagation();\r\n\r\n\t\t\t\t\t\t\t\t\tif ((c >= 37 && c <= 40)\r\n\t\t\t\t\t\t\t\t\t\t|| c == $.ui.keyCode.BACKSPACE\r\n\t\t\t\t\t\t\t\t\t\t|| c == $.ui.keyCode.DELETE\r\n\t\t\t\t\t\t\t\t\t\t|| (c == 65 && (e.ctrlKey || e.metaKey))\r\n\t\t\t\t\t\t\t\t\t\t|| c == 27) {\r\n\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tif (c == 9) {\r\n\t\t\t\t\t\t\t\t\t\ti = $(this).parent()[e.shiftKey ? 'prev' : 'next']('.elfinder-resize-row').children(':text');\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (i.length) {\r\n\t\t\t\t\t\t\t\t\t\t\ti.focus();\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t$(this).parent().parent().find(':text:' + (e.shiftKey ? 'last' : 'first')).focus();\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tif (c == 13) {\r\n\t\t\t\t\t\t\t\t\t\tfm.confirm({\r\n\t\t\t\t\t\t\t\t\t\t\ttitle: $('input:checked', uitype).val(),\r\n\t\t\t\t\t\t\t\t\t\t\ttext: 'confirmReq',\r\n\t\t\t\t\t\t\t\t\t\t\taccept: {\r\n\t\t\t\t\t\t\t\t\t\t\t\tlabel: 'btnApply',\r\n\t\t\t\t\t\t\t\t\t\t\t\tcallback: function () {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsave();\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\tcancel: {\r\n\t\t\t\t\t\t\t\t\t\t\t\tlabel: 'btnCancel',\r\n\t\t\t\t\t\t\t\t\t\t\t\tcallback: function () {\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tif (!((c >= 48 && c <= 57) || (c >= 96 && c <= 105))) {\r\n\t\t\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.filter(':first').focus();\r\n\r\n\t\t\t\t\t\t\tresizable();\r\n\r\n\t\t\t\t\t\t\treset.click(resetView);\r\n\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.error(function () {\r\n\t\t\t\t\t\t\tspinner.text('Unable to load image').css('background', 'transparent');\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\tbasec = $('<div/>'),\r\n\t\t\t\t\timgc = $('<img/>'),\r\n\t\t\t\t\tcoverc = $('<div/>'),\r\n\t\t\t\t\timgr = $('<img/>'),\r\n\t\t\t\t\tresetView = function (e) {\r\n\t\t\t\t\t\twidth.val(owidth);\r\n\t\t\t\t\t\theight.val(oheight);\r\n\t\t\t\t\t\tresize.updateView(owidth, oheight);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tresize = {\r\n\t\t\t\t\t\tupdate: function () {\r\n\t\t\t\t\t\t\twidth.val(Math.round(img.width() / prop));\r\n\t\t\t\t\t\t\theight.val(Math.round(img.height() / prop));\r\n\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\tupdateView: function (w, h) {\r\n\t\t\t\t\t\t\tif (w > pwidth || h > pheight) {\r\n\t\t\t\t\t\t\t\tif (w / pwidth > h / pheight) {\r\n\t\t\t\t\t\t\t\t\tprop = pwidth / w;\r\n\t\t\t\t\t\t\t\t\timg.width(pwidth).height(Math.ceil(h * prop));\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tprop = pheight / h;\r\n\t\t\t\t\t\t\t\t\timg.height(pheight).width(Math.ceil(w * prop));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\timg.width(w).height(h);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tprop = img.width() / w;\r\n\t\t\t\t\t\t\tuiprop.text('1 : ' + (1 / prop).toFixed(2));\r\n\t\t\t\t\t\t\tresize.updateHandle();\r\n\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\tupdateHandle: function () {\r\n\t\t\t\t\t\t\trhandle.width(img.width()).height(img.height());\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfixWidth: function () {\r\n\t\t\t\t\t\t\tvar w, h;\r\n\t\t\t\t\t\t\tif (cratio) {\r\n\t\t\t\t\t\t\t\th = height.val();\r\n\t\t\t\t\t\t\t\th = Math.round(h * ratio);\r\n\t\t\t\t\t\t\t\tresize.updateView(w, h);\r\n\t\t\t\t\t\t\t\twidth.val(w);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfixHeight: function () {\r\n\t\t\t\t\t\t\tvar w, h;\r\n\t\t\t\t\t\t\tif (cratio) {\r\n\t\t\t\t\t\t\t\tw = width.val();\r\n\t\t\t\t\t\t\t\th = Math.round(w / ratio);\r\n\t\t\t\t\t\t\t\tresize.updateView(w, h);\r\n\t\t\t\t\t\t\t\theight.val(h);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcrop = {\r\n\t\t\t\t\t\tupdate: function () {\r\n\t\t\t\t\t\t\toffsetX.val(Math.round((rhandlec.data('w') || rhandlec.width()) / prop));\r\n\t\t\t\t\t\t\toffsetY.val(Math.round((rhandlec.data('h') || rhandlec.height()) / prop));\r\n\t\t\t\t\t\t\tpointX.val(Math.round(((rhandlec.data('x') || rhandlec.offset().left) - imgc.offset().left) / prop));\r\n\t\t\t\t\t\t\tpointY.val(Math.round(((rhandlec.data('y') || rhandlec.offset().top) - imgc.offset().top) / prop));\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tupdateView: function () {\r\n\t\t\t\t\t\t\tvar x = parseInt(pointX.val()) * prop + imgc.offset().left;\r\n\t\t\t\t\t\t\tvar y = parseInt(pointY.val()) * prop + imgc.offset().top;\r\n\t\t\t\t\t\t\tvar w = offsetX.val() * prop;\r\n\t\t\t\t\t\t\tvar h = offsetY.val() * prop;\r\n\t\t\t\t\t\t\trhandlec.data({x: x, y: y, w: w, h: h});\r\n\t\t\t\t\t\t\trhandlec.width(Math.round(w));\r\n\t\t\t\t\t\t\trhandlec.height(Math.round(h));\r\n\t\t\t\t\t\t\tcoverc.width(rhandlec.width());\r\n\t\t\t\t\t\t\tcoverc.height(rhandlec.height());\r\n\t\t\t\t\t\t\trhandlec.offset({left: Math.round(x), top: Math.round(y)});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tresize_update: function () {\r\n\t\t\t\t\t\t\trhandlec.data({w: null, h: null});\r\n\t\t\t\t\t\t\tcrop.update();\r\n\t\t\t\t\t\t\tcoverc.width(rhandlec.width());\r\n\t\t\t\t\t\t\tcoverc.height(rhandlec.height());\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tdrag_update: function () {\r\n\t\t\t\t\t\t\trhandlec.data({x: null, y: null});\r\n\t\t\t\t\t\t\tcrop.update();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\trotate = {\r\n\t\t\t\t\t\tmouseStartAngle: 0,\r\n\t\t\t\t\t\timageStartAngle: 0,\r\n\t\t\t\t\t\timageBeingRotated: false,\r\n\r\n\t\t\t\t\t\tupdate: function (value, animate) {\r\n\t\t\t\t\t\t\tif (typeof value == 'undefined') {\r\n\t\t\t\t\t\t\t\trdegree = value = parseInt(degree.val());\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (typeof animate == 'undefined') {\r\n\t\t\t\t\t\t\t\tanimate = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (!animate || fm.UA.Opera || fm.UA.ltIE8) {\r\n\t\t\t\t\t\t\t\timgr.rotate(value);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\timgr.animate({rotate: value + 'deg'});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tvalue = value % 360;\r\n\t\t\t\t\t\t\tif (value < 0) {\r\n\t\t\t\t\t\t\t\tvalue += 360;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tdegree.val(parseInt(value));\r\n\r\n\t\t\t\t\t\t\tuidegslider.slider('value', degree.val());\r\n\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\texecute: function (e) {\r\n\r\n\t\t\t\t\t\t\tif (!rotate.imageBeingRotated) return;\r\n\r\n\t\t\t\t\t\t\tvar imageCentre = rotate.getCenter(imgr);\r\n\t\t\t\t\t\t\tvar mouseXFromCentre = e.pageX - imageCentre[0];\r\n\t\t\t\t\t\t\tvar mouseYFromCentre = e.pageY - imageCentre[1];\r\n\t\t\t\t\t\t\tvar mouseAngle = Math.atan2(mouseYFromCentre, mouseXFromCentre);\r\n\r\n\t\t\t\t\t\t\tvar rotateAngle = mouseAngle - rotate.mouseStartAngle + rotate.imageStartAngle;\r\n\t\t\t\t\t\t\trotateAngle = Math.round(parseFloat(rotateAngle) * 180 / Math.PI);\r\n\r\n\t\t\t\t\t\t\tif (e.shiftKey) {\r\n\t\t\t\t\t\t\t\trotateAngle = Math.round((rotateAngle + 6) / 15) * 15;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\timgr.rotate(rotateAngle);\r\n\r\n\t\t\t\t\t\t\trotateAngle = rotateAngle % 360;\r\n\t\t\t\t\t\t\tif (rotateAngle < 0) {\r\n\t\t\t\t\t\t\t\trotateAngle += 360;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tdegree.val(rotateAngle);\r\n\r\n\t\t\t\t\t\t\tuidegslider.slider('value', degree.val());\r\n\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\tstart: function (e) {\r\n\r\n\t\t\t\t\t\t\trotate.imageBeingRotated = true;\r\n\r\n\t\t\t\t\t\t\tvar imageCentre = rotate.getCenter(imgr);\r\n\t\t\t\t\t\t\tvar mouseStartXFromCentre = e.pageX - imageCentre[0];\r\n\t\t\t\t\t\t\tvar mouseStartYFromCentre = e.pageY - imageCentre[1];\r\n\t\t\t\t\t\t\trotate.mouseStartAngle = Math.atan2(mouseStartYFromCentre, mouseStartXFromCentre);\r\n\r\n\t\t\t\t\t\t\trotate.imageStartAngle = parseFloat(imgr.rotate()) * Math.PI / 180.0;\r\n\r\n\t\t\t\t\t\t\t$(document).mousemove(rotate.execute);\r\n\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\tstop: function (e) {\r\n\r\n\t\t\t\t\t\t\tif (!rotate.imageBeingRotated) return;\r\n\r\n\t\t\t\t\t\t\t$(document).unbind('mousemove', rotate.execute);\r\n\r\n\t\t\t\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\t\t\t\trotate.imageBeingRotated = false;\r\n\t\t\t\t\t\t\t}, 10);\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t},\r\n\r\n\t\t\t\t\t\tgetCenter: function (image) {\r\n\r\n\t\t\t\t\t\t\tvar currentRotation = imgr.rotate();\r\n\t\t\t\t\t\t\timgr.rotate(0);\r\n\r\n\t\t\t\t\t\t\tvar imageOffset = imgr.offset();\r\n\t\t\t\t\t\t\tvar imageCentreX = imageOffset.left + imgr.width() / 2;\r\n\t\t\t\t\t\t\tvar imageCentreY = imageOffset.top + imgr.height() / 2;\r\n\r\n\t\t\t\t\t\t\timgr.rotate(currentRotation);\r\n\r\n\t\t\t\t\t\t\treturn Array(imageCentreX, imageCentreY);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tresizable = function (destroy) {\r\n\t\t\t\t\t\tif ($.fn.resizable) {\r\n\t\t\t\t\t\t\tif (destroy) {\r\n\t\t\t\t\t\t\t\trhandle.filter(':ui-resizable').resizable('destroy');\r\n\t\t\t\t\t\t\t\trhandle.hide();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\trhandle.show();\r\n\t\t\t\t\t\t\t\trhandle.resizable({\r\n\t\t\t\t\t\t\t\t\talsoResize: img,\r\n\t\t\t\t\t\t\t\t\taspectRatio: cratio,\r\n\t\t\t\t\t\t\t\t\tresize: resize.update,\r\n\t\t\t\t\t\t\t\t\tstop: resize.fixHeight\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcroppable = function (destroy) {\r\n\t\t\t\t\t\tif ($.fn.draggable && $.fn.resizable) {\r\n\t\t\t\t\t\t\tif (destroy) {\r\n\t\t\t\t\t\t\t\trhandlec.filter(':ui-resizable').resizable('destroy');\r\n\t\t\t\t\t\t\t\trhandlec.filter(':ui-draggable').draggable('destroy');\r\n\t\t\t\t\t\t\t\tbasec.hide();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\timgc\r\n\t\t\t\t\t\t\t\t\t.width(img.width())\r\n\t\t\t\t\t\t\t\t\t.height(img.height());\r\n\r\n\t\t\t\t\t\t\t\tcoverc\r\n\t\t\t\t\t\t\t\t\t.width(img.width())\r\n\t\t\t\t\t\t\t\t\t.height(img.height());\r\n\r\n\t\t\t\t\t\t\t\trhandlec\r\n\t\t\t\t\t\t\t\t\t.width(imgc.width())\r\n\t\t\t\t\t\t\t\t\t.height(imgc.height())\r\n\t\t\t\t\t\t\t\t\t.offset(imgc.offset())\r\n\t\t\t\t\t\t\t\t\t.resizable({\r\n\t\t\t\t\t\t\t\t\t\tcontainment: basec,\r\n\t\t\t\t\t\t\t\t\t\tresize: crop.resize_update,\r\n\t\t\t\t\t\t\t\t\t\thandles: 'all'\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t.draggable({\r\n\t\t\t\t\t\t\t\t\t\thandle: coverc,\r\n\t\t\t\t\t\t\t\t\t\tcontainment: imgc,\r\n\t\t\t\t\t\t\t\t\t\tdrag: crop.drag_update\r\n\t\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\tbasec.show()\r\n\t\t\t\t\t\t\t\t\t.width(img.width())\r\n\t\t\t\t\t\t\t\t\t.height(img.height());\r\n\r\n\t\t\t\t\t\t\t\tcrop.update();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\trotateable = function (destroy) {\r\n\t\t\t\t\t\tif ($.fn.draggable && $.fn.resizable) {\r\n\t\t\t\t\t\t\tif (destroy) {\r\n\t\t\t\t\t\t\t\timgr.hide();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\timgr.show()\r\n\t\t\t\t\t\t\t\t\t.width(rwidth)\r\n\t\t\t\t\t\t\t\t\t.height(rheight)\r\n\t\t\t\t\t\t\t\t\t.css('margin-top', (pheight - rheight) / 2 + 'px')\r\n\t\t\t\t\t\t\t\t\t.css('margin-left', (pwidth - rwidth) / 2 + 'px');\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsave = function () {\r\n\t\t\t\t\t\tvar w, h, x, y, d;\r\n\t\t\t\t\t\tvar mode = $('input:checked', uitype).val();\r\n\r\n\t\t\t\t\t\tif (mode == 'resize') {\r\n\t\t\t\t\t\t\tw = parseInt(width.val()) || 0;\r\n\t\t\t\t\t\t\th = parseInt(height.val()) || 0;\r\n\t\t\t\t\t\t} else if (mode == 'crop') {\r\n\t\t\t\t\t\t\tw = parseInt(offsetX.val()) || 0;\r\n\t\t\t\t\t\t\th = parseInt(offsetY.val()) || 0;\r\n\t\t\t\t\t\t\tx = parseInt(pointX.val()) || 0;\r\n\t\t\t\t\t\t\ty = parseInt(pointY.val()) || 0;\r\n\t\t\t\t\t\t} else if (mode == 'rotate') {\r\n\t\t\t\t\t\t\tw = owidth;\r\n\t\t\t\t\t\t\th = oheight;\r\n\t\t\t\t\t\t\td = parseInt(degree.val()) || 0;\r\n\t\t\t\t\t\t\tif (d < 0 || d > 360) {\r\n\t\t\t\t\t\t\t\treturn fm.error('Invalid rotate degree');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (d == 0 || d == 360) {\r\n\t\t\t\t\t\t\t\treturn fm.error('Image dose not rotated');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (mode != 'rotate') {\r\n\r\n\t\t\t\t\t\t\tif (w <= 0 || h <= 0) {\r\n\t\t\t\t\t\t\t\treturn fm.error('Invalid image size');\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (w == owidth && h == oheight) {\r\n\t\t\t\t\t\t\t\treturn fm.error('Image size not changed');\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tdialog.elfinderdialog('close');\r\n\r\n\t\t\t\t\t\tfm.request({\r\n\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\tcmd: 'resize',\r\n\t\t\t\t\t\t\t\ttarget: file.hash,\r\n\t\t\t\t\t\t\t\twidth: w,\r\n\t\t\t\t\t\t\t\theight: h,\r\n\t\t\t\t\t\t\t\tx: x,\r\n\t\t\t\t\t\t\t\ty: y,\r\n\t\t\t\t\t\t\t\tdegree: d,\r\n\t\t\t\t\t\t\t\tmode: mode\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tnotify: {type: 'resize', cnt: 1}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.fail(function (error) {\r\n\t\t\t\t\t\t\t\tdfrd.reject(error);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.done(function () {\r\n\t\t\t\t\t\t\t\tdfrd.resolve();\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t},\r\n\t\t\t\t\tbuttons = {},\r\n\t\t\t\t\thline = 'elfinder-resize-handle-hline',\r\n\t\t\t\t\tvline = 'elfinder-resize-handle-vline',\r\n\t\t\t\t\trpoint = 'elfinder-resize-handle-point',\r\n\t\t\t\t\tsrc = fm.url(file.hash)\r\n\t\t\t\t\t;\r\n\r\n\t\t\t\timgr.mousedown(rotate.start);\r\n\t\t\t\t$(document).mouseup(rotate.stop);\r\n\r\n\t\t\t\tuiresize.append($(row).append($(label).text(fm.i18n('width'))).append(width).append(reset))\r\n\t\t\t\t\t.append($(row).append($(label).text(fm.i18n('height'))).append(height))\r\n\t\t\t\t\t.append($(row).append($('<label />').text(fm.i18n('aspectRatio')).prepend(constr)))\r\n\t\t\t\t\t.append($(row).append(fm.i18n('scale') + ' ').append(uiprop));\r\n\r\n\t\t\t\tuicrop.append($(row).append($(label).text('X')).append(pointX))\r\n\t\t\t\t\t.append($(row).append($(label).text('Y')).append(pointY))\r\n\t\t\t\t\t.append($(row).append($(label).text(fm.i18n('width'))).append(offsetX))\r\n\t\t\t\t\t.append($(row).append($(label).text(fm.i18n('height'))).append(offsetY));\r\n\r\n\t\t\t\tuirotate.append($(row)\r\n\t\t\t\t\t\t.append($(label).text(fm.i18n('rotate')))\r\n\t\t\t\t\t\t.append($('<div style=\"float:left; width: 130px;\">')\r\n\t\t\t\t\t\t\t.append($('<div style=\"float:left;\">')\r\n\t\t\t\t\t\t\t\t.append(degree)\r\n\t\t\t\t\t\t\t\t.append($('<span/>').text(fm.i18n('degree')))\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t.append($(uibuttonset).append(uideg270).append($(uiseparator)).append(uideg90))\r\n\t\t\t\t\t)\r\n\t\t\t\t\t\t.append(uidegslider)\r\n\t\t\t\t);\r\n\r\n\r\n\t\t\t\tdialog.append(uitype);\r\n\r\n\t\t\t\tcontrol.append($(row))\r\n\t\t\t\t\t.append(uiresize)\r\n\t\t\t\t\t.append(uicrop.hide())\r\n\t\t\t\t\t.append(uirotate.hide())\r\n\t\t\t\t\t.append(uirotate.hide())\r\n\t\t\t\t\t.find('input,select').attr('disabled', 'disabled');\r\n\r\n\t\t\t\trhandle.append('<div class=\"' + hline + ' ' + hline + '-top\"/>')\r\n\t\t\t\t\t.append('<div class=\"' + hline + ' ' + hline + '-bottom\"/>')\r\n\t\t\t\t\t.append('<div class=\"' + vline + ' ' + vline + '-left\"/>')\r\n\t\t\t\t\t.append('<div class=\"' + vline + ' ' + vline + '-right\"/>')\r\n\t\t\t\t\t.append('<div class=\"' + rpoint + ' ' + rpoint + '-e\"/>')\r\n\t\t\t\t\t.append('<div class=\"' + rpoint + ' ' + rpoint + '-se\"/>')\r\n\t\t\t\t\t.append('<div class=\"' + rpoint + ' ' + rpoint + '-s\"/>');\r\n\r\n\t\t\t\tpreview.append(spinner).append(rhandle.hide()).append(img.hide());\r\n\r\n\t\t\t\trhandlec.css('position', 'absolute')\r\n\t\t\t\t\t.append('<div class=\"' + hline + ' ' + hline + '-top\"/>')\r\n\t\t\t\t\t.append('<div class=\"' + hline + ' ' + hline + '-bottom\"/>')\r\n\t\t\t\t\t.append('<div class=\"' + vline + ' ' + vline + '-left\"/>')\r\n\t\t\t\t\t.append('<div class=\"' + vline + ' ' + vline + '-right\"/>')\r\n\t\t\t\t\t.append('<div class=\"' + rpoint + ' ' + rpoint + '-n\"/>')\r\n\t\t\t\t\t.append('<div class=\"' + rpoint + ' ' + rpoint + '-e\"/>')\r\n\t\t\t\t\t.append('<div class=\"' + rpoint + ' ' + rpoint + '-s\"/>')\r\n\t\t\t\t\t.append('<div class=\"' + rpoint + ' ' + rpoint + '-w\"/>')\r\n\t\t\t\t\t.append('<div class=\"' + rpoint + ' ' + rpoint + '-ne\"/>')\r\n\t\t\t\t\t.append('<div class=\"' + rpoint + ' ' + rpoint + '-se\"/>')\r\n\t\t\t\t\t.append('<div class=\"' + rpoint + ' ' + rpoint + '-sw\"/>')\r\n\t\t\t\t\t.append('<div class=\"' + rpoint + ' ' + rpoint + '-nw\"/>');\r\n\r\n\t\t\t\tpreview.append(basec.css('position', 'absolute').hide().append(imgc).append(rhandlec.append(coverc)));\r\n\r\n\t\t\t\tpreview.append(imgr.hide());\r\n\r\n\t\t\t\tpreview.css('overflow', 'hidden');\r\n\r\n\t\t\t\tdialog.append(preview).append(control);\r\n\r\n\t\t\t\tbuttons[fm.i18n('btnApply')] = save;\r\n\t\t\t\tbuttons[fm.i18n('btnCancel')] = function () {\r\n\t\t\t\t\tdialog.elfinderdialog('close');\r\n\t\t\t\t};\r\n\r\n\t\t\t\tfm.dialog(dialog, {\r\n\t\t\t\t\ttitle: file.name,\r\n\t\t\t\t\twidth: 650,\r\n\t\t\t\t\tresizable: false,\r\n\t\t\t\t\tdestroyOnClose: true,\r\n\t\t\t\t\tbuttons: buttons,\r\n\t\t\t\t\topen: function () {\r\n\t\t\t\t\t\tpreview.zIndex(1 + $(this).parent().zIndex());\r\n\t\t\t\t\t}\r\n\t\t\t\t}).attr('id', id);\r\n\r\n\t\t\t\t// for IE < 9 dialog mising at open second+ time.\r\n\t\t\t\tif (fm.UA.ltIE8) {\r\n\t\t\t\t\t$('.elfinder-dialog').css('filter', '');\r\n\t\t\t\t}\r\n\r\n\t\t\t\treset.css('left', width.position().left + width.width() + 12);\r\n\r\n\t\t\t\tcoverc.css({'opacity': 0.2, 'background-color': '#fff', 'position': 'absolute'}),\r\n\t\t\t\t\trhandlec.css('cursor', 'move');\r\n\t\t\t\trhandlec.find('.elfinder-resize-handle-point').css({\r\n\t\t\t\t\t'background-color': '#fff',\r\n\t\t\t\t\t'opacity': 0.5,\r\n\t\t\t\t\t'border-color': '#000'\r\n\t\t\t\t});\r\n\r\n\t\t\t\timgr.css('cursor', 'pointer');\r\n\r\n\t\t\t\tuitype.buttonset();\r\n\r\n\t\t\t\tpwidth = preview.width() - (rhandle.outerWidth() - rhandle.width());\r\n\t\t\t\tpheight = preview.height() - (rhandle.outerHeight() - rhandle.height());\r\n\r\n\t\t\t\timg.attr('src', src + (src.indexOf('?') === -1 ? '?' : '&') + '_=' + Math.random());\r\n\t\t\t\timgc.attr('src', img.attr('src'));\r\n\t\t\t\timgr.attr('src', img.attr('src'));\r\n\r\n\t\t\t},\r\n\r\n\t\t\tid, dialog\r\n\t\t\t;\r\n\r\n\r\n\t\tif (!files.length || files[0].mime.indexOf('image/') === -1) {\r\n\t\t\treturn dfrd.reject();\r\n\t\t}\r\n\r\n\t\tid = 'resize-' + fm.namespace + '-' + files[0].hash;\r\n\t\tdialog = fm.getUI().find('#' + id);\r\n\r\n\t\tif (dialog.length) {\r\n\t\t\tdialog.elfinderdialog('toTop');\r\n\t\t\treturn dfrd.resolve();\r\n\t\t}\r\n\r\n\t\topen(files[0], id);\r\n\r\n\t\treturn dfrd;\r\n\t};\r\n\r\n};\r\n\r\n(function ($) {\r\n\r\n\tvar findProperty = function (styleObject, styleArgs) {\r\n\t\tvar i = 0;\r\n\t\tfor (i in styleArgs) {\r\n\t\t\tif (typeof styleObject[styleArgs[i]] != 'undefined')\r\n\t\t\t\treturn styleArgs[i];\r\n\t\t}\r\n\t\tstyleObject[styleArgs[i]] = '';\r\n\t\treturn styleArgs[i];\r\n\t};\r\n\r\n\t$.cssHooks.rotate = {\r\n\t\tget: function (elem, computed, extra) {\r\n\t\t\treturn $(elem).rotate();\r\n\t\t},\r\n\t\tset: function (elem, value) {\r\n\t\t\t$(elem).rotate(value);\r\n\t\t\treturn value;\r\n\t\t}\r\n\t};\r\n\t$.cssHooks.transform = {\r\n\t\tget: function (elem, computed, extra) {\r\n\t\t\tvar name = findProperty(elem.style,\r\n\t\t\t\t['WebkitTransform', 'MozTransform', 'OTransform', 'msTransform', 'transform']);\r\n\t\t\treturn elem.style[name];\r\n\t\t},\r\n\t\tset: function (elem, value) {\r\n\t\t\tvar name = findProperty(elem.style,\r\n\t\t\t\t['WebkitTransform', 'MozTransform', 'OTransform', 'msTransform', 'transform']);\r\n\t\t\telem.style[name] = value;\r\n\t\t\treturn value;\r\n\t\t}\r\n\t};\r\n\r\n\t$.fn.rotate = function (val) {\r\n\t\tif (typeof val == 'undefined') {\r\n\t\t\tif (!!window.opera) {\r\n\t\t\t\tvar r = this.css('transform').match(/rotate\\((.*?)\\)/);\r\n\t\t\t\treturn ( r && r[1]) ?\r\n\t\t\t\t\tMath.round(parseFloat(r[1]) * 180 / Math.PI) : 0;\r\n\t\t\t} else {\r\n\t\t\t\tvar r = this.css('transform').match(/rotate\\((.*?)\\)/);\r\n\t\t\t\treturn ( r && r[1]) ? parseInt(r[1]) : 0;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.css('transform',\r\n\t\t\tthis.css('transform').replace(/none|rotate\\(.*?\\)/, '') + 'rotate(' + parseInt(val) + 'deg)');\r\n\t\treturn this;\r\n\t};\r\n\r\n\t$.fx.step.rotate = function (fx) {\r\n\t\tif (fx.state == 0) {\r\n\t\t\tfx.start = $(fx.elem).rotate();\r\n\t\t\tfx.now = fx.start;\r\n\t\t}\r\n\t\t$(fx.elem).rotate(fx.now);\r\n\t};\r\n\r\n\tif (typeof window.addEventListener == \"undefined\" && typeof document.getElementsByClassName == \"undefined\") { // IE & IE<9\r\n\t\tvar GetAbsoluteXY = function (element) {\r\n\t\t\tvar pnode = element;\r\n\t\t\tvar x = pnode.offsetLeft;\r\n\t\t\tvar y = pnode.offsetTop;\r\n\r\n\t\t\twhile (pnode.offsetParent) {\r\n\t\t\t\tpnode = pnode.offsetParent;\r\n\t\t\t\tif (pnode != document.body && pnode.currentStyle['position'] != 'static') {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (pnode != document.body && pnode != document.documentElement) {\r\n\t\t\t\t\tx -= pnode.scrollLeft;\r\n\t\t\t\t\ty -= pnode.scrollTop;\r\n\t\t\t\t}\r\n\t\t\t\tx += pnode.offsetLeft;\r\n\t\t\t\ty += pnode.offsetTop;\r\n\t\t\t}\r\n\r\n\t\t\treturn {x: x, y: y};\r\n\t\t};\r\n\r\n\t\tvar StaticToAbsolute = function (element) {\r\n\t\t\tif (element.currentStyle['position'] != 'static') {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar xy = GetAbsoluteXY(element);\r\n\t\t\telement.style.position = 'absolute';\r\n\t\t\telement.style.left = xy.x + 'px';\r\n\t\t\telement.style.top = xy.y + 'px';\r\n\t\t};\r\n\r\n\t\tvar IETransform = function (element, transform) {\r\n\r\n\t\t\tvar r;\r\n\t\t\tvar m11 = 1;\r\n\t\t\tvar m12 = 1;\r\n\t\t\tvar m21 = 1;\r\n\t\t\tvar m22 = 1;\r\n\r\n\t\t\tif (typeof element.style['msTransform'] != 'undefined') {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\tStaticToAbsolute(element);\r\n\r\n\t\t\tr = transform.match(/rotate\\((.*?)\\)/);\r\n\t\t\tvar rotate = ( r && r[1]) ? parseInt(r[1]) : 0;\r\n\r\n\t\t\trotate = rotate % 360;\r\n\t\t\tif (rotate < 0) rotate = 360 + rotate;\r\n\r\n\t\t\tvar radian = rotate * Math.PI / 180;\r\n\t\t\tvar cosX = Math.cos(radian);\r\n\t\t\tvar sinY = Math.sin(radian);\r\n\r\n\t\t\tm11 *= cosX;\r\n\t\t\tm12 *= -sinY;\r\n\t\t\tm21 *= sinY;\r\n\t\t\tm22 *= cosX;\r\n\r\n\t\t\telement.style.filter = (element.style.filter || '').replace(/progid:DXImageTransform\\.Microsoft\\.Matrix\\([^)]*\\)/, \"\") +\r\n\t\t\t(\"progid:DXImageTransform.Microsoft.Matrix(\" +\r\n\t\t\t\"M11=\" + m11 +\r\n\t\t\t\",M12=\" + m12 +\r\n\t\t\t\",M21=\" + m21 +\r\n\t\t\t\",M22=\" + m22 +\r\n\t\t\t\",FilterType='bilinear',sizingMethod='auto expand')\")\r\n\t\t\t;\r\n\r\n\t\t\tvar ow = parseInt(element.style.width || element.width || 0);\r\n\t\t\tvar oh = parseInt(element.style.height || element.height || 0);\r\n\r\n\t\t\tvar radian = rotate * Math.PI / 180;\r\n\t\t\tvar absCosX = Math.abs(Math.cos(radian));\r\n\t\t\tvar absSinY = Math.abs(Math.sin(radian));\r\n\r\n\t\t\tvar dx = (ow - (ow * absCosX + oh * absSinY)) / 2;\r\n\t\t\tvar dy = (oh - (ow * absSinY + oh * absCosX)) / 2;\r\n\r\n\t\t\telement.style.marginLeft = Math.floor(dx) + \"px\";\r\n\t\t\telement.style.marginTop = Math.floor(dy) + \"px\";\r\n\r\n\t\t\treturn (true);\r\n\t\t};\r\n\r\n\t\tvar transform_set = $.cssHooks.transform.set;\r\n\t\t$.cssHooks.transform.set = function (elem, value) {\r\n\t\t\ttransform_set.apply(this, [elem, value]);\r\n\t\t\tIETransform(elem, value);\r\n\t\t\treturn value;\r\n\t\t};\r\n\t}\r\n})(jQuery);","/**\r\n * @class  elFinder command \"rm\"\r\n * Delete files\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\nelFinder.prototype.commands.rm = function () {\r\n\r\n\tthis.shortcuts = [{\r\n\t\tpattern: 'delete ctrl+backspace'\r\n\t}];\r\n\r\n\tthis.getstate = function (sel) {\r\n\t\tvar fm = this.fm;\r\n\t\tsel = sel || fm.selected();\r\n\t\treturn !this._disabled && sel.length && $.map(sel, function (h) {\r\n\t\t\tvar f = fm.file(h);\r\n\t\t\treturn f && f.phash && !f.locked ? h : null\r\n\t\t}).length == sel.length\r\n\t\t\t? 0 : -1;\r\n\t}\r\n\r\n\tthis.exec = function (hashes) {\r\n\t\tvar self = this,\r\n\t\t\tfm = this.fm,\r\n\t\t\tdfrd = $.Deferred()\r\n\t\t\t\t.fail(function (error) {\r\n\t\t\t\t\terror && fm.error(error);\r\n\t\t\t\t}),\r\n\t\t\tfiles = this.files(hashes),\r\n\t\t\tcnt = files.length,\r\n\t\t\tcwd = fm.cwd().hash,\r\n\t\t\tgoroot = false;\r\n\r\n\t\tif (!cnt || this._disabled) {\r\n\t\t\treturn dfrd.reject();\r\n\t\t}\r\n\r\n\t\t$.each(files, function (i, file) {\r\n\t\t\tif (!file.phash) {\r\n\t\t\t\treturn !dfrd.reject(['errRm', file.name, 'errPerm']);\r\n\t\t\t}\r\n\t\t\tif (file.locked) {\r\n\t\t\t\treturn !dfrd.reject(['errLocked', file.name]);\r\n\t\t\t}\r\n\t\t\tif (file.hash == cwd) {\r\n\t\t\t\tgoroot = fm.root(file.hash);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif (dfrd.state() == 'pending') {\r\n\t\t\tfiles = this.hashes(hashes);\r\n\r\n\t\t\tfm.confirm({\r\n\t\t\t\ttitle: self.title,\r\n\t\t\t\ttext: 'confirmRm',\r\n\t\t\t\taccept: {\r\n\t\t\t\t\tlabel: 'btnRm',\r\n\t\t\t\t\tcallback: function () {\r\n\t\t\t\t\t\tfm.lockfiles({files: files});\r\n\t\t\t\t\t\tfm.request({\r\n\t\t\t\t\t\t\tdata: {cmd: 'rm', targets: files},\r\n\t\t\t\t\t\t\tnotify: {type: 'rm', cnt: cnt},\r\n\t\t\t\t\t\t\tpreventFail: true\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.fail(function (error) {\r\n\t\t\t\t\t\t\t\tdfrd.reject(error);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.done(function (data) {\r\n\t\t\t\t\t\t\t\tdfrd.done(data);\r\n\t\t\t\t\t\t\t\tgoroot && fm.exec('open', goroot)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t).always(function () {\r\n\t\t\t\t\t\t\t\tfm.unlockfiles({files: files});\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tcancel: {\r\n\t\t\t\t\tlabel: 'btnCancel',\r\n\t\t\t\t\tcallback: function () {\r\n\t\t\t\t\t\tdfrd.reject();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn dfrd;\r\n\t}\r\n}","/**\r\n * @class  elFinder command \"search\"\r\n * Find files\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\nelFinder.prototype.commands.search = function () {\r\n\tthis.title = 'Find files';\r\n\tthis.options = {ui: 'searchbutton'}\r\n\tthis.alwaysEnabled = true;\r\n\tthis.updateOnSelect = false;\r\n\r\n\t/**\r\n\t * Return command status.\r\n\t * Search does not support old api.\r\n\t *\r\n\t * @return Number\r\n\t **/\r\n\tthis.getstate = function () {\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t/**\r\n\t * Send search request to backend.\r\n\t *\r\n\t * @param  String  search string\r\n\t * @return $.Deferred\r\n\t **/\r\n\tthis.exec = function (q) {\r\n\t\tvar fm = this.fm;\r\n\r\n\t\tif (typeof(q) == 'string' && q) {\r\n\t\t\tfm.trigger('searchstart', {query: q});\r\n\r\n\t\t\treturn fm.request({\r\n\t\t\t\tdata: {cmd: 'search', q: q},\r\n\t\t\t\tnotify: {type: 'search', cnt: 1, hideCnt: true}\r\n\t\t\t});\r\n\t\t}\r\n\t\tfm.getUI('toolbar').find('.' + fm.res('class', 'searchbtn') + ' :text').focus();\r\n\t\treturn $.Deferred().reject();\r\n\t}\r\n\r\n}","/**\r\n * @class  elFinder command \"sort\"\r\n * Change sort files rule\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\nelFinder.prototype.commands.sort = function () {\r\n\t/**\r\n\t * Command options\r\n\t *\r\n\t * @type  Object\r\n\t */\r\n\tthis.options = {ui: 'sortbutton'};\r\n\r\n\tthis.getstate = function () {\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tthis.exec = function (hashes, sort) {\r\n\t\tvar fm = this.fm,\r\n\t\t\tsort = $.extend({\r\n\t\t\t\ttype: fm.sortType,\r\n\t\t\t\torder: fm.sortOrder,\r\n\t\t\t\tstick: fm.sortStickFolders\r\n\t\t\t}, sort);\r\n\r\n\t\tthis.fm.setSort(sort.type, sort.order, sort.stick);\r\n\t\treturn $.Deferred().resolve();\r\n\t}\r\n\r\n}","/**\r\n * @class  elFinder command \"up\"\r\n * Go into parent directory\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\nelFinder.prototype.commands.up = function () {\r\n\tthis.alwaysEnabled = true;\r\n\tthis.updateOnSelect = false;\r\n\r\n\tthis.shortcuts = [{\r\n\t\tpattern: 'ctrl+up'\r\n\t}];\r\n\r\n\tthis.getstate = function () {\r\n\t\treturn this.fm.cwd().phash ? 0 : -1;\r\n\t}\r\n\r\n\tthis.exec = function () {\r\n\t\treturn this.fm.cwd().phash ? this.fm.exec('open', this.fm.cwd().phash) : $.Deferred().reject();\r\n\t}\r\n\r\n}","/**\r\n * @class elFinder command \"upload\"\r\n * Upload files using iframe or XMLHttpRequest & FormData.\r\n * Dialog allow to send files using drag and drop\r\n *\r\n * @type  elFinder.command\r\n * @author  Dmitry (dio) Levashov\r\n */\r\nelFinder.prototype.commands.upload = function () {\r\n\tvar hover = this.fm.res('class', 'hover');\r\n\r\n\tthis.disableOnSearch = true;\r\n\tthis.updateOnSelect = false;\r\n\r\n\t// Shortcut opens dialog\r\n\tthis.shortcuts = [{\r\n\t\tpattern: 'ctrl+u'\r\n\t}];\r\n\r\n\t/**\r\n\t * Return command state\r\n\t *\r\n\t * @return Number\r\n\t **/\r\n\tthis.getstate = function () {\r\n\t\treturn !this._disabled && this.fm.cwd().write ? 0 : -1;\r\n\t}\r\n\r\n\tthis.exec = function (data) {\r\n\t\tvar fm = this.fm,\r\n\t\t\tupload = function (data) {\r\n\t\t\t\tdialog.elfinderdialog('close');\r\n\t\t\t\tfm.upload(data)\r\n\t\t\t\t\t.fail(function (error) {\r\n\t\t\t\t\t\tdfrd.reject(error);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.done(function (data) {\r\n\t\t\t\t\t\tdfrd.resolve(data);\r\n\t\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tdfrd, dialog, input, button, dropbox;\r\n\r\n\t\tif (this.disabled()) {\r\n\t\t\treturn $.Deferred().reject();\r\n\t\t}\r\n\r\n\t\tif (data && (data.input || data.files)) {\r\n\t\t\treturn fm.upload(data);\r\n\t\t}\r\n\r\n\t\tdfrd = $.Deferred();\r\n\r\n\r\n\t\tinput = $('<input type=\"file\" multiple=\"true\"/>')\r\n\t\t\t.change(function () {\r\n\t\t\t\tupload({input: input[0]});\r\n\t\t\t});\r\n\r\n\t\tbutton = $('<div class=\"ui-button ui-widget ui-state-default  ui-button-text-only\"><span class=\"ui-button-text\">' + fm.i18n('selectForUpload') + '</span></div>')\r\n\t\t\t.append($('<form/>').append(input))\r\n\t\t\t.hover(function () {\r\n\t\t\t\tbutton.toggleClass(hover)\r\n\t\t\t})\r\n\r\n\t\tdialog = $('<div class=\"elfinder-upload-dialog-wrapper\"/>')\r\n\t\t\t.append(button);\r\n\r\n\t\tif (fm.dragUpload) {\r\n\t\t\tdropbox = $('<div class=\" elfinder-upload-dropbox\">' + fm.i18n('dropFiles') + '</div>')\r\n\t\t\t\t.prependTo(dialog)\r\n\t\t\t\t.after('<div class=\"elfinder-upload-dialog-or\">' + fm.i18n('or') + '</div>')[0];\r\n\r\n\t\t\tdropbox.addEventListener('dragenter', function (e) {\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\t$(dropbox).addClass(hover);\r\n\t\t\t}, false);\r\n\r\n\t\t\tdropbox.addEventListener('dragleave', function (e) {\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\t$(dropbox).removeClass(hover);\r\n\t\t\t}, false);\r\n\r\n\t\t\tdropbox.addEventListener('dragover', function (e) {\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t\te.preventDefault();\r\n\t\t\t}, false);\r\n\r\n\t\t\tdropbox.addEventListener('drop', function (e) {\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\tupload({files: e.dataTransfer.files});\r\n\t\t\t}, false);\r\n\r\n\t\t}\r\n\r\n\t\tfm.dialog(dialog, {\r\n\t\t\ttitle: this.title,\r\n\t\t\tmodal: true,\r\n\t\t\tresizable: false,\r\n\t\t\tdestroyOnClose: true\r\n\t\t});\r\n\r\n\t\treturn dfrd;\r\n\t}\r\n\r\n}","/**\r\n * @class  elFinder command \"view\"\r\n * Change current directory view (icons/list)\r\n *\r\n * @author Dmitry (dio) Levashov\r\n **/\r\nelFinder.prototype.commands.view = function () {\r\n\tthis.value = this.fm.viewType;\r\n\tthis.alwaysEnabled = true;\r\n\tthis.updateOnSelect = false;\r\n\r\n\tthis.options = {ui: 'viewbutton'};\r\n\r\n\tthis.getstate = function () {\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tthis.exec = function () {\r\n\t\tvar value = this.fm.storage('view', this.value == 'list' ? 'icons' : 'list');\r\n\t\tthis.fm.viewchange();\r\n\t\tthis.update(void(0), value);\r\n\t}\r\n\r\n}","})(jQuery);"],"sourceRoot":"/source/"}